(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[12],{2411:function(e,t,n){var r=n(2412);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(112)(r,o);r.locals&&(e.exports=r.locals)},2412:function(e,t,n){(e.exports=n(111)(!1)).push([e.i,".GeoMarker-container{position:absolute}.markerHolder:hover .GeoMarker-popover-container{z-index:1100}.markerHolder:hover .GeoMarker-container{z-index:1100}.GeoMarker-container:hover .GeoMarker-popover-container{display:block}.GeoMarker-container-selected .GeoMarker-popover-container{z-index:1100}.GeoMarker-container-selected{z-index:1100}.GeoMarker-container-selected .GeoMarker-popover-container{display:block}.GeoMarker-popover-container{position:absolute;display:none;left:50%;transform:translate(-50%, 20px);bottom:100%;padding-bottom:24px}\n",""])},2414:function(e,t,n){var r=n(2415);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(112)(r,o);r.locals&&(e.exports=r.locals)},2415:function(e,t,n){(e.exports=n(111)(!1)).push([e.i,".pac-control{margin-top:10px;border:1px solid transparent;border-radius:2px 0 0 2px;box-sizing:border-box;-moz-box-sizing:border-box;height:32px;outline:none;box-shadow:0 2px 6px rgba(0,0,0,0.3)}.pac-input{background-color:#fff;font-family:Roboto;font-size:15px;font-weight:300;margin-left:12px;padding:0 11px 0 13px;text-overflow:ellipsis;max-width:300px}.pac-input:focus{border-color:#4d90fe}\n",""])},2509:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n.n(r),a=n(10),i=n.n(a),l=n(4),s=n.n(l),u=n(5),c=n.n(u),p=n(1),d=n(11),f=n(79),h=n(41),g=n(3),m=n(21),k=n(0),b=n(100),v=n(2231),y=n.n(v),M=n(13),O=n.n(M),E=n(15),x=n(625),C=n(277),j=n(2413),w=n.n(j),P=(n(2411),function(e,t,n,r){var o,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":O()(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(i=(a<3?o(i):a>3?o(t,n,i):o(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}),I=function(e){function t(){return o()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c()(t,e),i()(t,[{key:"round",value:function(e){return parseFloat(e.toFixed(6))}},{key:"buttonRef",value:function(e){var t=this;Object(k.l)(e).foreach((function(e){e.addEventListener("click",(function(e){e.stopImmediatePropagation(),t.props.onLocationSelect&&t.props.onLocationSelect(t.props.lat,t.props.lng)}))}))}},{key:"containerRef",value:function(e){var t=this;Object(k.l)(e).foreach((function(e){e.addEventListener("touchstart",(function(e){e.stopImmediatePropagation(),t.props.onMarkerSelect(t.props.markerId)})),e.addEventListener("touchend",(function(e){e.stopImmediatePropagation()})),e.addEventListener("click",(function(e){e.stopImmediatePropagation()})),e.addEventListener("mouseleave",(function(e){e.stopImmediatePropagation(),t.props.onMarkerUnselect(t.props.markerId)}))}))}},{key:"getContainerClass",value:function(){var e=this;return"GeoMarker-container "+this.props.selectedMarkerId.filter((function(t){return e.props.markerId===t})).map((function(e){return"GeoMarker-container-selected"})).getOrElse((function(){return""}))}},{key:"render",value:function(){this.props.lat,this.props.lng;return p.createElement("div",{className:this.getContainerClass(),style:this.props.style,ref:this.containerRef},p.createElement("div",{className:"GeoMarker-popover-container"},p.createElement(x.a,{className:"GeoMarker-popover"},p.createElement("div",{style:{display:"flex",padding:"5px",alignItems:"center"}},p.createElement("div",{style:{flex:1}},p.createElement("div",null,this.props.label),p.createElement("div",null,this.round(this.props.lat),", ",this.round(this.props.lng))),this.props.onLocationSelect&&p.createElement("div",{style:{flex:0,flexShrink:0,marginLeft:"5px"}},p.createElement(C.a,{buttonRef:this.buttonRef},p.createElement(w.a,null)))))),this.props.icon)}}]),t}(p.Component),S=I=P([E.autobind],I),$=n(610),G=function(e){return p.createElement($.a,Object.assign({},e),p.createElement("g",null,p.createElement("path",{d:"m12 0c-4.4183 2.3685e-15 -8 3.5817-8 8 0 1.421 0.3816 2.75 1.0312 3.906 0.1079 0.192 0.221 0.381 0.3438 0.563l6.625 11.531 6.625-11.531c0.102-0.151 0.19-0.311 0.281-0.469l0.063-0.094c0.649-1.156 1.031-2.485 1.031-3.906 0-4.4183-3.582-8-8-8zm0 4c2.209 0 4 1.7909 4 4 0 2.209-1.791 4-4 4-2.2091 0-4-1.791-4-4 0-2.2091 1.7909-4 4-4z",fill:"#e74c3c"}),p.createElement("path",{d:"m12 3c-2.7614 0-5 2.2386-5 5 0 2.761 2.2386 5 5 5 2.761 0 5-2.239 5-5 0-2.7614-2.239-5-5-5zm0 2c1.657 0 3 1.3431 3 3s-1.343 3-3 3-3-1.3431-3-3 1.343-3 3-3z",fill:"#c0392b"})))},R=n(39),L=n(8),_=n.n(L),D=n(46),U=function(e){function t(e){o()(this,t);var n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={markerId:R.v4(),selectedMarkerId:new k.b},n}return c()(t,e),i()(t,[{key:"onMarkerSelect",value:function(e){this.setState(_()(this.state,{selectedMarkerId:{$set:Object(k.l)(e)}}))}},{key:"onMarkerUnselect",value:function(e){this.setState(_()(this.state,{selectedMarkerId:{$set:new k.b}}))}},{key:"render",value:function(){var e=this,t=this.props.display.elementCss.flatMap((function(e){return e.proportions})).getOrElse((function(){return new g.ElementProportions}));return this.props.value.map((function(n){return p.createElement("div",{style:{flex:t.width.map((function(e){return"auto"===e?"0 0 1":"0 0 "+e})).getOrElse((function(){return"0 0 auto"}))}},p.createElement("div",{style:Object.assign({width:"100%",height:t.height.getOrElse((function(){return"200px"}))},{zIndex:1e3})},n.lat&&n.lng&&p.createElement(y.a,{bootstrapURLKeys:{key:b.a.google_map_app_key,region:e.props.i18n.code,language:e.props.i18n.code},center:{lat:n.lat,lng:n.lng},defaultZoom:11},p.createElement(S,{lat:n.lat,lng:n.lng,label:Object(D.b)(e.props.display.label.text),markerId:e.state.markerId,selectedMarkerId:e.state.selectedMarkerId,onMarkerSelect:e.onMarkerSelect,onMarkerUnselect:e.onMarkerUnselect,key:"value",$markerHolderClassName:"markerHolder",style:{transform:"translate(-12px, -24px)"},icon:p.createElement(G,null)}))))})).getOrElse((function(){return p.createElement("div",null)}))}}]),t}(p.Component),B=Object(d.connect)((function(e,t){return{i18n:e.i18n,value:Object(m.g)(e.dataOutput,t.blockRendererId,t.output).map((function(e){return e.value})).filter((function(e){return e.tpe.value===g.ValueGeoPoint.$Type.value}))}}),(function(e,t){return{}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.dataOutput===t.dataOutput&&e.i18n===t.i18n},areStatePropsEqual:function(e,t){return Object(k.h)(e.value,t.value)&&e.i18n===t.i18n}})(U),z=n(816),V=n(506),H=n(2417),N=n.n(H),T=n(2416),W=n.n(T),F=function(e){return p.createElement($.a,Object.assign({},e),p.createElement("path",{fill:"#000000",d:"M2 12C2 6.48 6.48 2 12 2s10 4.48 10 10-4.48 10-10 10S2 17.52 2 12zm10 6c3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6 2.69 6 6 6z"}))},q=n(77),A=n(116),J=(n(2414),function(e,t,n,r){var o,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":O()(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(i=(a<3?o(i):a>3?o(t,n,i):o(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}),K=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":O()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Z={lat:51.5074,lng:.1278},X=function(e){function t(e){o()(this,t);var n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.searchBoxInput=new k.b;e.output;var r=e.value.filter((function(e){return e instanceof g.ValueGeoPoint})).map((function(e){return e}));r.map((function(e){return e.lng})),r.map((function(e){return e.lat}));return n.state={loading:r.isEmpty(),currentPositionMarker:new k.b,valuePositionMarker:r.map((function(e){return{position:{lat:e.lat,lng:e.lng},label:new k.b,id:R.v4()}})),mapCenterPosition:new k.b,markers:[],tripOrigin:new k.b,latMouseDiff:0,lngMouseDiff:0,isMapDraggable:!0,selectedMarkerId:new k.b},n}return c()(t,e),i()(t,[{key:"componentDidMount",value:function(){this.findCurrentPosition(this.props)}},{key:"findCurrentPosition",value:function(e){var t=this;Object(k.l)(navigator.geolocation).foreach((function(n){n.getCurrentPosition((function(n){t.setState(_()(t.state,{loading:{$set:!1},currentPositionMarker:{$set:Object(k.l)({position:{lat:n.coords.latitude,lng:n.coords.longitude},label:new k.b,id:R.v4()})},mapCenterPosition:{$set:Object(k.l)(e.value.filter((function(e){return e instanceof g.ValueGeoPoint})).map((function(e){return e})).matchWith((function(e){return{position:{lat:e.lat,lng:e.lng},label:new k.b,id:R.v4()}}),(function(){return{position:{lat:n.coords.latitude,lng:n.coords.longitude},label:new k.b,id:R.v4()}})))}}))}),(function(e){t.setState(_()(t.state,{loading:{$set:!1},currentPositionMarker:{$set:Object(k.l)({position:Z,label:new k.b,id:R.v4()})},mapCenterPosition:{$set:Object(k.l)({position:Z,label:new k.b,id:R.v4()})}}))}))}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;if(!Object(k.h)(e.value,this.props.value)){e.output;var n=e.value.filter((function(e){return e instanceof g.ValueGeoPoint})).map((function(e){return e})),r=(n.map((function(e){return e.lng})),n.map((function(e){return e.lat})),R.v4());this.setState(_()(this.state,{loading:{$set:!1},tripOrigin:{$set:new k.b},markers:{$set:[]},mapCenterPosition:{$set:n.matchWith((function(e){return Object(k.l)({position:{lat:e.lat,lng:e.lng},label:new k.b,id:R.v4()})}),(function(){return t.state.mapCenterPosition}))},valuePositionMarker:{$set:n.matchWith((function(e){return Object(k.l)({position:{lat:e.lat,lng:e.lng},label:new k.b,id:r})}),(function(){return t.state.valuePositionMarker}))},selectedMarkerId:{$set:Object(k.l)(r)}}))}}},{key:"onLongitudeChanged",value:function(e){var t=parseFloat(e.target.value);isNaN(t)||this.props.onChange(this.props.value.filter((function(e){return e instanceof g.ValueGeoPoint})).map((function(e){return e.updateLongitude(t)})).getOrElse((function(){return new g.ValueGeoPoint(t,0)})),this.props.output)}},{key:"onLatitudeChanged",value:function(e){var t=parseFloat(e.target.value);isNaN(t)||this.props.onChange(this.props.value.filter((function(e){return e instanceof g.ValueGeoPoint})).map((function(e){return e.updateLatitude(t)})).getOrElse((function(){return new g.ValueGeoPoint(t,0)})),this.props.output)}},{key:"onMarkerMouseDown",value:function(e,t,n){var r=this;this.state.valuePositionMarker.map((function(e){return e.id!==t.markerId})).getOrElse((function(){return!0}))||this.state.valuePositionMarker.foreach((function(e){r.setState(_()(r.state,{isMapDraggable:{$set:!1},latMouseDiff:{$set:e.position.lat-n.lat},lngMouseDiff:{$set:e.position.lng-n.lng}}))}))}},{key:"onMarkerMouseMove",value:function(e,t,n){var r=this;this.state.isMapDraggable||this.setState(_()(this.state,{valuePositionMarker:{$set:this.state.valuePositionMarker.matchWith((function(e){return Object(k.l)({position:{lat:n.lat+r.state.latMouseDiff,lng:n.lng+r.state.lngMouseDiff},label:new k.b,id:e.id})}),(function(){return Object(k.l)({position:{lat:n.lat+r.state.latMouseDiff,lng:n.lng+r.state.lngMouseDiff},label:new k.b,id:R.v4()})}))}}))}},{key:"onMarkerMouseUp",value:function(e,t,n){var r=this;this.state.isMapDraggable||Object(k.l)(n.lat).flatMap((function(e){return Object(k.l)(n.lng).map((function(t){return{lat:e,lng:t}}))})).matchWith((function(e){r.setState(_()(r.state,{valuePositionMarker:{$set:Object(k.l)({position:{lat:e.lat,lng:e.lng},label:new k.b,id:R.v4()})},isMapDraggable:{$set:!0}}),(function(){r.props.onChange(new g.ValueGeoPoint(e.lat,e.lng),r.props.output)}))}),(function(){r.setState(_()(r.state,{valuePositionMarker:{$set:r.props.value.filter((function(e){return e instanceof g.ValueGeoPoint})).map((function(e){return e})).map((function(e){return{position:{lat:e.lat,lng:e.lng},label:new k.b,id:R.v4()}}))},isMapDraggable:{$set:!0}}))}))}},{key:"onBlur",value:function(){this.props.onControlBlur()}},{key:"round",value:function(e){return parseFloat(e.toFixed(6))}},{key:"onChangeLocationClick",value:function(e,t){this.searchBoxInput.foreach((function(e){e.value=""})),this.props.onChange(new g.ValueGeoPoint(e,t),this.props.output)}},{key:"onClick",value:function(e){var t=e.lat,n=e.lng,r=e.event.pageX,o=e.event.pageY;this.showTripOrigin(t,n,o-20,r)}},{key:"showTripOrigin",value:function(e,t,n,r){var o=R.v4();this.setState(_()(this.state,{tripOrigin:{$set:Object(k.l)({position:{lat:e,lng:t},label:new k.b,id:o})},selectedMarkerId:{$set:Object(k.l)(o)}}))}},{key:"onMarkerSelect",value:function(e){this.setState(_()(this.state,{selectedMarkerId:{$set:Object(k.l)(e)}}))}},{key:"onMarkerUnselect",value:function(e){this.setState(_()(this.state,{selectedMarkerId:{$set:new k.b}}))}},{key:"onGoogleApiLoaded",value:function(e){var t=this,n=e.map,r=e.maps,o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("class","pac-input pac-control"),o.addEventListener("click",(function(e){e.stopPropagation()})),o.style.setProperty("width",n.getDiv().getBoundingClientRect().width-126-45-20+"px");var a=new r.places.SearchBox(o);n.controls[r.ControlPosition.TOP_LEFT].push(o),this.searchBoxInput=Object(k.l)(o),n.addListener("bounds_changed",(function(){o.style.setProperty("width",n.getDiv().getBoundingClientRect().width-126-45-20+"px"),a.setBounds(n.getBounds())})),a.addListener("places_changed",(function(){var e=a.getPlaces();t.setState(_()(t.state,{markers:{$set:e.map((function(e){return{label:Object(k.l)(e.name),position:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},id:R.v4()}}))},mapCenterPosition:{$set:Object(k.g)(e).matchWith((function(e){return Object(k.l)({position:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},label:new k.b,id:R.v4()})}),(function(){return t.state.mapCenterPosition}))}}))}))}},{key:"render",value:function(){var e=this,t=this.props.display,n=(this.props.output,this.props.value.filter((function(e){return e instanceof g.ValueGeoPoint})).map((function(e){return e}))),r=this.props.error,o=this.props.display.elementCss.flatMap((function(e){return e.proportions})).getOrElse((function(){return new g.ElementProportions}));return p.createElement("div",{style:{flex:o.width.map((function(e){return"auto"===e?"0 0 1":"0 0 "+e})).getOrElse((function(){return"0 0 auto"}))}},Object(D.a)(this.props.display.label.text),p.createElement("div",{style:Object.assign({width:"100%",height:o.height.getOrElse((function(){return"200px"}))},{zIndex:1e3})},this.state.loading?p.createElement(V.a,null):p.createElement(y.a,{bootstrapURLKeys:{key:b.a.google_map_app_key,region:this.props.i18n.code,language:this.props.i18n.code,libraries:["places"]},center:this.state.mapCenterPosition.map((function(e){return e.position})).getOrElse((function(){return Z})),defaultZoom:11,options:{mapTypeControl:!0},onGoogleApiLoaded:this.onGoogleApiLoaded,draggable:this.state.isMapDraggable,onClick:this.onClick,onChildMouseDown:this.onMarkerMouseDown,onChildMouseMove:this.onMarkerMouseMove,onChildMouseUp:this.onMarkerMouseUp,yesIWantToUseGoogleMapApiInternals:!0},this.state.tripOrigin.matchWith((function(t){return p.createElement(S,{lat:t.position.lat,lng:t.position.lng,key:"trip-origin",markerId:t.id,selectedMarkerId:e.state.selectedMarkerId,onMarkerSelect:e.onMarkerSelect,onMarkerUnselect:e.onMarkerUnselect,$markerHolderClassName:"markerHolder",style:{transform:"translate(-12px, -12px)"},onLocationSelect:e.onChangeLocationClick,icon:p.createElement(F,null)})}),(function(){return null})),this.state.currentPositionMarker.matchWith((function(t){return p.createElement(S,{lat:t.position.lat,lng:t.position.lng,key:"current",markerId:t.id,selectedMarkerId:e.state.selectedMarkerId,onMarkerSelect:e.onMarkerSelect,onMarkerUnselect:e.onMarkerUnselect,$markerHolderClassName:"markerHolder",style:{transform:"translate(-12px, -12px)"},label:e.props.i18n.t("Текущее местоположение"),onLocationSelect:e.onChangeLocationClick,icon:p.createElement(W.a,null)})}),(function(){return null})),this.state.markers.map((function(t,n){return p.createElement(S,{key:n,lat:t.position.lat,lng:t.position.lng,label:t.label.getOrElse((function(){return""})),markerId:t.id,selectedMarkerId:e.state.selectedMarkerId,onMarkerSelect:e.onMarkerSelect,onMarkerUnselect:e.onMarkerUnselect,$markerHolderClassName:"markerHolder",style:{transform:"translate(-12px, -12px)"},onLocationSelect:e.onChangeLocationClick,icon:p.createElement(N.a,null)})})),this.state.valuePositionMarker.matchWith((function(n){return p.createElement(S,{lat:n.position.lat,lng:n.position.lng,label:Object(D.b)(t.label.text),key:"value",markerId:n.id,selectedMarkerId:e.state.selectedMarkerId,onMarkerSelect:e.onMarkerSelect,onMarkerUnselect:e.onMarkerUnselect,$markerHolderClassName:"markerHolder",style:{transform:"translate(-12px, -24px)"},icon:p.createElement(G,null)})}),(function(){return null})))),this.props.control.showCoordFields&&p.createElement("div",{style:{display:"flex"}},p.createElement(z.a,{label:this.props.i18n.t("Широта"),onChange:this.onLatitudeChanged,placeholder:this.props.i18n.t("Широта"),value:n.map((function(e){return e.lat.toString()})).getOrElse((function(){return""})),style:{flex:1,marginRight:"5px"},disabled:n.map((function(e){return e.tpe.value===g.ValueGenerated.$Type.value})).getOrElse((function(){return!1})),error:r.nonEmpty(),onBlur:this.onBlur}),p.createElement(z.a,{label:this.props.i18n.t("Долгота"),onChange:this.onLongitudeChanged,placeholder:this.props.i18n.t("Долгота"),value:n.map((function(e){return e.lng.toString()})).getOrElse((function(){return""})),style:{flex:1,marginLeft:"5px"},disabled:n.map((function(e){return e.tpe.value===g.ValueGenerated.$Type.value})).getOrElse((function(){return!1})),error:r.nonEmpty(),onBlur:this.onBlur})),p.createElement(q.a,{formHelper:!0,display:this.props.display,error:this.props.error,blockStyle:this.props.blockStyle}))}}]),t}(p.Component);X=J([E.autobind,K("design:paramtypes",[Object])],X);var Y=Object(d.connect)((function(e,t){return{value:Object(m.g)(e.dataOutput,t.blockRendererId,t.output).map((function(e){return e.value})),error:Object(m.q)(e.dataOutput,t.blockRendererId,t.display.id),i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.dataOutput===t.dataOutput&&e.i18n===t.i18n},areStatePropsEqual:function(e,t){return Object(k.h)(e.value,t.value)&&Object(k.h)(e.error,t.error)&&e.i18n===t.i18n}})(Object(A.a)(X)),Q=function(e){function t(){return o()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c()(t,e),i()(t,[{key:"renderDisplayControl",value:function(){return p.createElement(h.a,{display:this.props.display,blockStyle:this.props.blockStyle},p.createElement(B,{display:this.props.display,blockRendererId:this.props.blockRendererId,output:this.props.output}))}},{key:"renderEditControl",value:function(){return p.createElement(Y,{display:this.props.display,blockRendererId:this.props.blockRendererId,output:this.props.output,control:this.props.control,onControlBlur:this.props.onControlBlur,onChange:this.props.onChange,blockStyle:this.props.blockStyle})}},{key:"renderEditByClickControl",value:function(){return p.createElement("div",null,this.props.i18n.t("Компонент для редактирования по клику не задан"))}}]),t}(f.a);t.default=Object(d.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areOwnPropsEqual:function(e,t){return e.blockRendererId===t.blockRendererId&&e.display===t.display&&e.control===t.control&&e.output===t.output&&e.blockType===t.blockType&&Object(k.h)(e.blockStyle,e.blockStyle)}})(Q)}}]);