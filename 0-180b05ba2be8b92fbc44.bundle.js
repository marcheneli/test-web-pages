(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[0],{2390:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(1)),o=(0,r(n(40)).default)(i.default.createElement("path",{d:"M19 13H5v-2h14v2z"}),"Remove");t.default=o},2487:function(e,t,n){var r=n(2488);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(112)(r,i);r.locals&&(e.exports=r.locals)},2488:function(e,t,n){(e.exports=n(111)(!1)).push([e.i,".ActionTemplateEditor__toolbar{margin-bottom:10px;background-color:#fff !important;flex-shrink:0}.public-DraftEditor-content{min-height:60px}.public-DraftEditorPlaceholder-root{padding:16px 18px}\n",""])},2489:function(e,t,n){var r=n(2490);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(112)(r,i);r.locals&&(e.exports=r.locals)},2490:function(e,t,n){(e.exports=n(111)(!1)).push([e.i,'/**\n * Draft v0.10.5\n *\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n.DraftEditor-editorContainer,.DraftEditor-root,.public-DraftEditor-content{height:inherit;text-align:initial}.public-DraftEditor-content[contenteditable=true]{-webkit-user-modify:read-write-plaintext-only}.DraftEditor-root{position:relative}.DraftEditor-editorContainer{background-color:rgba(255,255,255,0);border-left:.1px solid transparent;position:relative;z-index:1}.public-DraftEditor-block{position:relative}.DraftEditor-alignLeft .public-DraftStyleDefault-block{text-align:left}.DraftEditor-alignLeft .public-DraftEditorPlaceholder-root{left:0;text-align:left}.DraftEditor-alignCenter .public-DraftStyleDefault-block{text-align:center}.DraftEditor-alignCenter .public-DraftEditorPlaceholder-root{margin:0 auto;text-align:center;width:100%}.DraftEditor-alignRight .public-DraftStyleDefault-block{text-align:right}.DraftEditor-alignRight .public-DraftEditorPlaceholder-root{right:0;text-align:right}.public-DraftEditorPlaceholder-root{color:#9197a3;position:absolute;z-index:1}.public-DraftEditorPlaceholder-hasFocus{color:#bdc1c9}.DraftEditorPlaceholder-hidden{display:none}.public-DraftStyleDefault-block{position:relative;white-space:pre-wrap}.public-DraftStyleDefault-ltr{direction:ltr;text-align:left}.public-DraftStyleDefault-rtl{direction:rtl;text-align:right}.public-DraftStyleDefault-listLTR{direction:ltr}.public-DraftStyleDefault-listRTL{direction:rtl}.public-DraftStyleDefault-ol,.public-DraftStyleDefault-ul{margin:16px 0;padding:0}.public-DraftStyleDefault-depth0.public-DraftStyleDefault-listLTR{margin-left:1.5em}.public-DraftStyleDefault-depth0.public-DraftStyleDefault-listRTL{margin-right:1.5em}.public-DraftStyleDefault-depth1.public-DraftStyleDefault-listLTR{margin-left:3em}.public-DraftStyleDefault-depth1.public-DraftStyleDefault-listRTL{margin-right:3em}.public-DraftStyleDefault-depth2.public-DraftStyleDefault-listLTR{margin-left:4.5em}.public-DraftStyleDefault-depth2.public-DraftStyleDefault-listRTL{margin-right:4.5em}.public-DraftStyleDefault-depth3.public-DraftStyleDefault-listLTR{margin-left:6em}.public-DraftStyleDefault-depth3.public-DraftStyleDefault-listRTL{margin-right:6em}.public-DraftStyleDefault-depth4.public-DraftStyleDefault-listLTR{margin-left:7.5em}.public-DraftStyleDefault-depth4.public-DraftStyleDefault-listRTL{margin-right:7.5em}.public-DraftStyleDefault-unorderedListItem{list-style-type:square;position:relative}.public-DraftStyleDefault-unorderedListItem.public-DraftStyleDefault-depth0{list-style-type:disc}.public-DraftStyleDefault-unorderedListItem.public-DraftStyleDefault-depth1{list-style-type:circle}.public-DraftStyleDefault-orderedListItem{list-style-type:none;position:relative}.public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-listLTR:before{left:-36px;position:absolute;text-align:right;width:30px}.public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-listRTL:before{position:absolute;right:-36px;text-align:left;width:30px}.public-DraftStyleDefault-orderedListItem:before{content:counter(ol0) ". ";counter-increment:ol0}.public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth1:before{content:counter(ol1) ". ";counter-increment:ol1}.public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth2:before{content:counter(ol2) ". ";counter-increment:ol2}.public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth3:before{content:counter(ol3) ". ";counter-increment:ol3}.public-DraftStyleDefault-orderedListItem.public-DraftStyleDefault-depth4:before{content:counter(ol4) ". ";counter-increment:ol4}.public-DraftStyleDefault-depth0.public-DraftStyleDefault-reset{counter-reset:ol0}.public-DraftStyleDefault-depth1.public-DraftStyleDefault-reset{counter-reset:ol1}.public-DraftStyleDefault-depth2.public-DraftStyleDefault-reset{counter-reset:ol2}.public-DraftStyleDefault-depth3.public-DraftStyleDefault-reset{counter-reset:ol3}.public-DraftStyleDefault-depth4.public-DraftStyleDefault-reset{counter-reset:ol4}',""])},2491:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.styles=void 0;var i=r(n(150)),o=r(n(853)),a=r(n(122)),s=r(n(1)),l=(r(n(14)),r(n(18))),u=r(n(160)),p=r(n(384)),c=function(e){return{root:(0,a.default)({},e.typography.body1,(0,o.default)({minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",width:"auto",overflow:"hidden",whiteSpace:"nowrap"},e.breakpoints.up("sm"),{minHeight:"auto"})),gutters:{},selected:{},dense:(0,a.default)({},e.typography.body2,{minHeight:"auto"})}};t.styles=c;var d=s.default.forwardRef((function(e,t){var n,r=e.classes,o=e.className,u=e.component,c=void 0===u?"li":u,d=e.disableGutters,f=void 0!==d&&d,h=e.role,m=void 0===h?"menuitem":h,y=e.selected,v=e.tabIndex,g=(0,i.default)(e,["classes","className","component","disableGutters","role","selected","tabIndex"]);return e.disabled||(n=void 0!==v?v:-1),s.default.createElement(p.default,(0,a.default)({button:!0,role:m,tabIndex:n,component:c,selected:y,disableGutters:f,classes:{dense:r.dense},className:(0,l.default)(r.root,o,y&&r.selected,!f&&r.gutters),ref:t},g))})),f=(0,u.default)(c,{name:"MuiMenuItem"})(d);t.default=f},2492:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(1)),o=(0,r(n(40)).default)(i.default.createElement("path",{d:"M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"}),"FilterList");t.default=o},2506:function(e,t,n){"use strict";n.r(t);var r=n(2),i=n.n(r),o=n(10),a=n.n(o),s=n(4),l=n.n(s),u=n(5),p=n.n(u),c=n(13),d=n.n(c),f=n(1),h=n(11),m=n(15),y=n(823),v=n(277),g=n(507),b=n(388),O=n.n(b),E=n(3),F=n(34),j=n(849),T=n(21),C=n(610),I=function(e){return f.createElement(C.a,Object.assign({},e),f.createElement("path",{d:"M3,2H21V2H21V4H20.92L14,10.92V22.91L10,18.91V10.91L3.09,4H3V2Z"}))},k=function(e){return f.createElement(C.a,Object.assign({},e),f.createElement("path",{d:"M3,2H21V2H21V4H20.92L15,9.92V22.91L9,16.91V9.91L3.09,4H3V2M11,16.08L13,18.08V9H13.09L18.09,4H5.92L10.92,9H11V16.08Z"}))},R=function(e){return f.createElement(C.a,Object.assign({},e),f.createElement("path",{d:"M3,2H21V2H21V4H20.92L14,10.92V22.91L10,18.91V10.91L3.09,4H3V2M18,14C17.87,14 17.76,14.09 17.74,14.21L17.55,15.53C17.25,15.66 16.96,15.82 16.7,16L15.46,15.5C15.35,15.5 15.22,15.5 15.15,15.63L14.15,17.36C14.09,17.47 14.11,17.6 14.21,17.68L15.27,18.5C15.25,18.67 15.24,18.83 15.24,19C15.24,19.17 15.25,19.33 15.27,19.5L14.21,20.32C14.12,20.4 14.09,20.53 14.15,20.64L15.15,22.37C15.21,22.5 15.34,22.5 15.46,22.5L16.7,22C16.96,22.18 17.24,22.35 17.55,22.47L17.74,23.79C17.76,23.91 17.86,24 18,24H20C20.11,24 20.22,23.91 20.24,23.79L20.43,22.47C20.73,22.34 21,22.18 21.27,22L22.5,22.5C22.63,22.5 22.76,22.5 22.83,22.37L23.83,20.64C23.89,20.53 23.86,20.4 23.77,20.32L22.7,19.5C22.72,19.33 22.74,19.17 22.74,19C22.74,18.83 22.73,18.67 22.7,18.5L23.76,17.68C23.85,17.6 23.88,17.47 23.82,17.36L22.82,15.63C22.76,15.5 22.63,15.5 22.5,15.5L21.27,16C21,15.82 20.73,15.65 20.42,15.53L20.23,14.21C20.22,14.09 20.11,14 20,14M19,17.5A1.5,1.5 0 0,1 20.5,19A1.5,1.5 0 0,1 19,20.5C18.16,20.5 17.5,19.83 17.5,19A1.5,1.5 0 0,1 19,17.5Z"}))},S=n(26),w=n(6),D=n.n(w),x=n(38),P=n.n(x),$=n(863),V=n(2390),L=n.n(V),G=n(97),A=n(27),M=n(0),N=n(251),_=n(50),q=n(47),B=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"isValueDisable",value:function(e){return this.props.value.filter((function(e){return e.value.tpe.value===E.ValueObjectRefs.$Type.value})).map((function(t){return t.value.id.findIndex((function(t){return t.value===e.id.value}))>-1})).getOrElse((function(){return!1}))||this.isValueDeleted(e)}},{key:"isValueDeleted",value:function(e){return e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusDeleted.$Type.value||e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusNominalDeleted.$Type.value}},{key:"isProcessed",value:function(e){return this.props.processedFormRecords.filter((function(t){return t.value===e.id.value})).length>0}},{key:"checkLimit",value:function(e){var t=this;return this.props.limits.flatMap((function(n){return Object(M.g)(t.props.forms.list.filter((function(e){return e.id.value===t.props.parentFormId.value}))).map((function(e){return e.entity.limits.filter((function(e){return e.memberFieldId.value===t.props.output.formField.value}))})).flatMap((function(t){return Object(M.g)(t.map((function(t){var r=Object(M.g)(n.filter((function(e){return e.cfgId===t.limitType.id})));return(!r.isEmpty()||!t.limitType.required||t.limitType.tpe.value!==E.LimitTypeTotalLimitType.$Type.value)&&(r.isEmpty()&&t.limitType.required&&t.limitType.tpe.value===E.LimitTypeLinkedFieldType.$Type.value?e.formRecord.entity.getFormFieldValue(t.limitType.memberTypeId).filter((function(e){return e.value.id.length>0})).nonEmpty():r.map((function(n){switch(n.data.tpe.value){case E.LimitDataTotal.$Type.value:if(n.data.values.avail<0)return!1;break;case E.LimitDataLinkedValues.$Type.value:var r=n.data;return!Object(M.g)([].concat(P()(r.values)).filter((function(n){return e.formRecord.entity.getFormFieldValue(t.limitType.memberTypeId).flatMap((function(e){return Object(M.g)(e.value.id)})).filter((function(e){return e.value===n[0]})).nonEmpty()&&n[1].avail<1}))).nonEmpty()&&(!e.formRecord.entity.getFormFieldValue(t.limitType.memberTypeId).filter((function(e){return e.value.id.filter((function(e){return 0===[].concat(P()(r.values.keys())).filter((function(t){return t===e.value})).length})).length>0})).nonEmpty()||!t.limitType.required);default:throw"Unknown MembersLimit type"}return!0})).getOrElse((function(){return!0})))})).filter((function(e){return!e})))}))})).isEmpty()}},{key:"getValues",value:function(){return this.props.inputValue.map((function(e){return e.displayValuesAdding})).getOrElse((function(){return[]})).filter((function(e){return e instanceof S.O}))}},{key:"onOnlyOneChoiceRecordSelect",value:function(e,t){var n=this;Object(M.g)(this.getValues().filter((function(t){return t.id.value===e}))).foreach((function(e){return n.props.onObjRefAdd(e)}))}},{key:"getEnhancedTableProps",value:function(){return this.props.onlyOneChoice?{onRecordSelected:this.onOnlyOneChoiceRecordSelect.bind(this)}:{onRecordMarked:this.props.onRecordMarked,onSelectAll:this.props.onSelectAll}}},{key:"getRows",value:function(){var e=this;return this.getValues().map((function(t){var n=e.isValueDisable(t),r=e.isProcessed(t),i=e.isValueDisable(t)||r||!e.checkLimit(t);return{payload:t.id.value,id:t.id.value,fields:t.values,deleted:n||!e.checkLimit(t),selectDisabled:i,buttons:e.props.onlyOneChoice?[]:(new Array).concat(r?[f.createElement(g.a,{size:30})]:(new Array).concat(n||e.props.onlyOneChoice?[]:[f.createElement(v.a,{key:"add",style:Object.assign(Object.assign({},_.d),{padding:"4px"}),onClick:function(n){return e.props.onObjRefAdd(t)},disabled:n||!e.checkLimit(t)},f.createElement(O.a,{style:_.e}))]).concat(e.props.onObjRefDelete&&n?[f.createElement(v.a,{key:"delete",style:Object.assign(Object.assign({},_.d),{padding:"4px"}),onClick:function(n){return e.props.onObjRefDelete&&e.props.onObjRefDelete(t)},disabled:!n},f.createElement(L.a,{style:_.e}))]:[]))}}))}},{key:"render",value:function(){var e=this.props.fields.getOrElse((function(){return[]})),t=(Object(M.g)(e.filter((function(e){return e.entity.valueType.tag.map((function(e){return e.tpe.value===E.ValueTagSimpleDictionaryPosition.$Type.value})).getOrElse((function(){return!1}))}))),this.props.displayFieldsForAdding.map((function(e){switch(e.tpe.value){case E.DisplayFieldByField.$Type.value:return{id:e.fieldId.value,title:e.caption};case E.DisplayFieldByTemplate.$Type.value:return{id:e.template,title:e.caption};default:return{id:e.fieldId.value,title:e.caption}}}))),n=Object(M.g)(Object($.a)(this.props.displayFieldsForAdding.map((function(e,t){return e.sort.enabled?t:void 0})).filter((function(e){return void 0!==e})))).getOrElse((function(){return-1})),r=this.props.displayFieldsForAdding.reduce((function(e,t,n){return Object.assign(Object.assign({},e),D()({},n,!t.sort.enabled||t.sort.value.map((function(e){return e.tpe.value===E.SortOrderAsc.$Type.value})).getOrElse((function(){return!0}))))}),{});return f.createElement(N.a,Object.assign({showId:!1,error:new M.b},this.getEnhancedTableProps(),{markedRecords:this.props.markedFormRecords.map((function(e){return e.value})),fetching:this.props.dataInputFetching.getOrElse((function(){return!1})),empty:!1,columnStyles:this.props.displayFieldsForAdding.map((function(e){return{flex:e.columnWidth}})),columnIndexSort:n,columnOrderAsc:r,withActions:!0,headers:t,maxBodyHeight:Object(M.l)("50"),rows:this.getRows()}))}}]),t}(f.Component),U=Object(h.connect)((function(e,t){return{i18n:e.i18n,dataInputFetching:Object(M.j)(e.dataInputs.fetching,t.display.id.value),fields:Object(F.f)(e.fields,t.childFormId),inputValue:Object(G.c)(e.dataInputs,t.display.id).filter((function(e){return e instanceof q.d})).map((function(e){return e})),value:Object(T.g)(e.dataOutput,t.blockRendererId,t.output),limits:Object(A.k)(e.blockRendererContext,t.blockRendererId),forms:e.forms,formRecord:Object(A.e)(e.blockRendererContext,t.blockRendererId)}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataInputs.input===t.dataInputs.input&&e.dataOutput===t.dataOutput&&e.blockRendererContext===t.blockRendererContext&&e.fields.list===t.fields.list&&e.forms===t.forms},areStatePropsEqual:function(e,t){return Object(M.h)(e.fields,t.fields)&&Object(M.h)(e.value,t.value)&&Object(M.h)(e.inputValue,t.inputValue)&&Object(M.h)(e.limits,t.limits)&&Object(M.h)(e.formRecord,t.formRecord)&&e.i18n===t.i18n&&e.forms===t.forms}})(B),W=n(161),H=n(235),z=n(8),Z=n.n(z),J=n(103),K=n(62),Y=n(280),Q=n(236),X=n(187),ee=n(61),te=n(625),ne=n(848),re=n(658),ie=n(2206),oe=n(815),ae=n(665),se=n(1252),le=n(1253),ue=n(261),pe=n.n(ue),ce=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},de=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onSubstFieldChange",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:Z()(this.props.condition,{valueField:{$set:new E.Id(e.target.value)}})}))}},{key:"render",value:function(){var e=this.props.sourceFormId?Object(F.f)(this.props.fields,this.props.sourceFormId).getOrElse((function(){return[]})):[];return f.createElement(se.a,null,f.createElement(le.a,null,this.props.i18n.t("Поле значения")),f.createElement(ae.a,{native:!0,value:this.props.condition.valueField.value,onChange:this.onSubstFieldChange},e.map((function(e){return f.createElement("option",{key:e.id.value,value:e.id.value},e.entity.caption)}))))}}]),t}(f.Component);de=ce([m.autobind],de);var fe=Object(h.connect)((function(e,t){return{i18n:e.i18n,fields:e.fields}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(de),he=n(63),me=n(835),ye=n(66),ve=n(370);var ge=function(e){return e&&e.length?Object(ve.a)(e):[]},be=n(2198),Oe=n(847),Ee=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Fe=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},je=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={generatorId:e.value},n}return p()(t,e),a()(t,[{key:"onGeneratorChanged",value:function(e){var t=this;this.setState(Z()(this.state,{generatorId:{$set:e}}),(function(){t.props.onChanged(e)}))}},{key:"onGeneratorSelect",value:function(e){var t=e.target.value;"!noValuesGenerator"===t?this.onGeneratorChanged(new M.b):this.onGeneratorChanged(Object(M.l)(t).map((function(e){return parseInt(e)})).filter((function(e){return!isNaN(e)})).map((function(e){return new E.InternalId(e)})))}},{key:"render",value:function(){return f.createElement(se.a,{fullWidth:!0},f.createElement(le.a,null,this.props.labelText.getOrElse((function(){return""}))),f.createElement(ae.a,{error:this.props.errorText.nonEmpty(),onChange:this.onGeneratorSelect,fullWidth:this.props.fullWidth||!1,value:this.state.generatorId.map((function(e){return e.value.toString()})).getOrElse((function(){return"!noValuesGenerator"})),displayEmpty:!1},this.props.generators.map((function(e){return f.createElement(ne.a,{value:e.entity.internalId.value.toString(),key:e.id.value},f.createElement(be.a,{primary:e.entity.name}))}))),this.props.errorText.map((function(e){return f.createElement(Oe.a,null,e)})).getOrNull())}}]),t}(f.Component);je=Ee([m.autobind,Fe("design:paramtypes",[Object])],je);var Te,Ce=Object(h.connect)((function(e){return{i18n:e.i18n}}))(je),Ie=(n(2487),n(2489),n(116)),ke=n(42),Re=n(135),Se=n(74),we=n.n(Se),De=n(1173),xe=n(829),Pe=n(830),$e=n(418),Ve=n(238),Le=n(1019),Ge=n(1054),Ae=n(1018),Me=n(292),Ne=n(1020),_e=n(291),qe=n(1021),Be=n(239),Ue=n(1022),We=n(240),He=n(241),ze=n(1024),Ze=n(1023),Je=n(498),Ke=n(387),Ye=n(211),Qe=Object(Ke.a)(Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.fields===t.fields},areStatePropsEqual:function(e,t){return e.i18n===t.i18n},areOwnPropsEqual:function(e,t){return e.inline===t.inline}})((function(e){return f.createElement(Object(Ye.a)(e.inline),void 0,"{{"+e.i18n.t("Номер ряда")+"}}")}))),Xe=n(497),et=Object(Ke.a)(Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.fields===t.fields},areStatePropsEqual:function(e,t){return e.i18n===t.i18n},areOwnPropsEqual:function(e,t){return e.inline===t.inline}})((function(e){return f.createElement(Object(Ye.a)(e.inline),void 0,"{{"+e.i18n.t("Номер места")+"}}")}))),tt=n(499),nt=Object(Ke.a)(Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.fields===t.fields},areStatePropsEqual:function(e,t){return e.i18n===t.i18n},areOwnPropsEqual:function(e,t){return e.inline===t.inline}})((function(e){return f.createElement(Object(Ye.a)(e.inline),void 0,"{{"+e.i18n.t("Номер секции")+"}}")}))),rt=n(500),it=Object(Ke.a)(Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.fields===t.fields},areStatePropsEqual:function(e,t){return e.i18n===t.i18n},areOwnPropsEqual:function(e,t){return e.inline===t.inline}})((function(e){return f.createElement(Object(Ye.a)(e.inline),void 0,"{{"+e.i18n.t("Номер стола")+"}}")}))),ot=n(9),at=Object(ot.createAction)("EventLine.SeatmapModels.Fetching",(function(e){return e})),st=Object(ot.createAction)("EventLine.SeatmapModels.Resolved",(function(e){return e})),lt=Object(ot.createAction)("EventLine.SeatmapModels.Error",(function(e){return e})),ut=n(428),pt=n(68),ct=n(93),dt=(Object(ot.handleActions)((Te={},D()(Te,"EventLine.SeatmapModels.Fetching",(function(e,t){return Object(M.l)(t.payload).map((function(t){return Z()(e,{fetching:D()({},t.value,{$set:!0}),fetched:D()({},t.value,{$set:!1}),models:D()({},t.value,{$set:[]}),modelsMaps:D()({},t.value,{$set:{}}),error:D()({},t.value,{$set:new M.b})})})).getOrElse((function(){return e}))})),D()(Te,"EventLine.SeatmapModels.Resolved",(function(e,t){return Object(M.l)(t.payload).map((function(t){return Z()(e,{fetching:D()({},t.eventLineId.value,{$set:!1}),fetched:D()({},t.eventLineId.value,{$set:!0}),models:D()({},t.eventLineId.value,{$set:t.seatmapModels}),modelsMaps:D()({},t.eventLineId.value,{$set:Object(ct.c)(t.seatmapModels,(function(e){return e.entity.templateId.value}),(function(e){return e}))}),error:D()({},t.eventLineId.value,{$set:new M.b})})})).getOrElse((function(){return e}))})),D()(Te,"EventLine.SeatmapModels.Error",(function(e,t){return Object(M.l)(t.payload).map((function(t){return Z()(e,{fetching:D()({},t.eventLineId.value,{$set:!1}),fetched:D()({},t.eventLineId.value,{$set:!1}),models:D()({},t.eventLineId.value,{$set:[]}),modelsMaps:D()({},t.eventLineId.value,{$set:{}}),error:D()({},t.eventLineId.value,{$set:Object(M.l)(t.error)})})})).getOrElse((function(){return e}))})),Te),{fetching:{},fetched:{},models:{},modelsMaps:{},error:{}}),function(e){return function(t){return t(Object(pt.b)((function(t){return!function(e,t){return Object(M.j)(e.fetching,t.value).getOrElse((function(){return!1}))}(t.eventLineSeatModels,e)&&function(e,t){return Object(M.j)(e.fetched,t.value).getOrElse((function(){return!1}))}(t.eventLineSeatModels,e)}),function(e){return function(t){return t(at(e)),Object(ut.b)(e).then((function(n){return t(st({eventLineId:e,seatmapModels:n.list})),n})).catch((function(n){throw t(lt({eventLineId:e,error:n})),n}))}}(e)))}}),ft=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ht=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},mt=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={seatmapModelId:e.seatmapModelId,dataType:e.dataType},n}return p()(t,e),a()(t,[{key:"onSeatmapModelChanged",value:function(e){this.setState(Z()(this.state,{seatmapModelId:{$set:e}}))}},{key:"onSeatModelSelect",value:function(e){"!noValuesGenerator"===e.target.value?this.onSeatmapModelChanged(new M.b):this.onSeatmapModelChanged(E.Id.createId(e.target.value))}},{key:"onDataTypeChanged",value:function(e){this.setState(Z()(this.state,{dataType:{$set:e}}))}},{key:"onDataTypeSelect",value:function(e){var t=e.target.value;"!noValuesGenerator"===t?this.onDataTypeChanged(new M.b):this.onDataTypeChanged(Object(M.l)(t))}},{key:"onSubmit",value:function(){this.props.onSubmit(this.state.seatmapModelId,this.state.dataType)}},{key:"render",value:function(){return f.createElement(f.Fragment,null,f.createElement(se.a,{fullWidth:!0},f.createElement(le.a,null,this.props.labelText.getOrElse((function(){return""}))),f.createElement(ae.a,{error:this.props.errorText.nonEmpty(),onChange:this.onSeatModelSelect,fullWidth:this.props.fullWidth||!1,value:this.state.seatmapModelId.map((function(e){return e.value})).getOrElse((function(){return"!noValuesGenerator"})),displayEmpty:!1},this.props.seatmapModels.getOrElse((function(){return[]})).map((function(e){return f.createElement(ne.a,{value:e.id.value,key:e.id.value},f.createElement(be.a,{primary:e.entity.name+" - "+e.entity.activityDate.map((function(e){return new Date(e).toLocaleDateString()})).getOrElse((function(){return""}))}))}))),this.props.errorText.map((function(e){return f.createElement(Oe.a,null,e)})).getOrNull()),f.createElement(se.a,{fullWidth:!0},f.createElement(le.a,null,this.props.i18n.t("Источник данных")),f.createElement(ae.a,{error:this.props.errorText.nonEmpty(),onChange:this.onDataTypeSelect,fullWidth:this.props.fullWidth||!1,value:this.state.dataType.getOrElse((function(){return"!noValuesGenerator"})),displayEmpty:!1},f.createElement(ne.a,{value:Xe.a},f.createElement(be.a,{primary:this.props.i18n.t("Номер места")})),f.createElement(ne.a,{value:Je.a},f.createElement(be.a,{primary:this.props.i18n.t("Номер ряда")})),f.createElement(ne.a,{value:tt.a},f.createElement(be.a,{primary:this.props.i18n.t("Номер секции")})),f.createElement(ne.a,{value:rt.a},f.createElement(be.a,{primary:this.props.i18n.t("Номер стола")}))),this.props.errorText.map((function(e){return f.createElement(Oe.a,null,e)})).getOrNull()),f.createElement(y.a,{variant:"contained",onClick:this.onSubmit},this.props.i18n.t("Вставить")))}}]),t}(f.Component);mt=ft([m.autobind,ht("design:paramtypes",[Object])],mt);var yt,vt=Object(h.connect)((function(e){return{i18n:e.i18n,eventLineId:e.eventLine.eventLineId,seatmapModels:e.eventLine.eventLineId.flatMap((function(t){return function(e,t){return Object(M.j)(e.models,t.value)}(e.eventLineSeatModels,t)}))}}))(Object(X.a)((function(e){e.isTokenChecked&&e.eventLineId.foreach((function(t){e.dispatch(dt(t))}))}),(function(){}),(function(e,t){}))(mt)),gt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},bt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ot=(yt={},D()(yt,Ve.a,(function(e){return f.createElement(Le.a,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,Me.a,(function(e){return f.createElement(Ne.a,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,_e.a,(function(e){return f.createElement(qe.a,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,Be.a,(function(e){return f.createElement(Ue.a,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,We.a,(function(e){return f.createElement(Ze.a,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,He.a,(function(e){return f.createElement(ze.a,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,Xe.a,(function(e){return f.createElement(et,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,Je.a,(function(e){return f.createElement(Qe,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,tt.a,(function(e){return f.createElement(nt,Object.assign({},e.attributes,{inline:e.node}))})),D()(yt,rt.a,(function(e){return f.createElement(it,Object.assign({},e.attributes,{inline:e.node}))})),yt),Et=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.template=e.template,n.state={value:ye.n.fromJSON(Object(xe.a)(e.template)),generatorId:new M.b},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchTemplateForms()}},{key:"componentWillReceiveProps",value:function(e){e.template!==this.props.template&&e.template!==this.template&&(this.template=e.template,this.setState(Z()(this.state,{value:{$set:ye.n.fromJSON(Object(xe.a)(e.template))}})))}},{key:"onChange",value:function(e){var t=this;this.setState(Z()(this.state,{value:{$set:e.value}}),(function(){return t.updateTemplate(e.value)}))}},{key:"updateTemplate",value:function(e){var t=this;setTimeout((function(){if(t.state.value===e){var n=Object(Pe.b)(e.toJSON());t.template=n,t.props.onChange(n)}}),100)}},{key:"renderInline",value:function(e,t,n){return Object(ke.b)(e.node.type)(Ot).matchWith((function(t){return t(e)}),(function(){return n()}))}},{key:"openAddFieldPopover",value:function(e){var t=this;Object(K.e)(this.props.forms,this.props.formId).foreach((function(n){t.props.openPopover(Object(M.l)(Object(ee.findDOMNode)(e.currentTarget)),f.createElement(De.a,{form:n,fields:t.props.fields,withRefFieldSelector:t.props.withRefFieldSelector,onAddField:t.onAddField}))}))}},{key:"fetchTemplateForms",value:function(){var e=this;ge(Object(M.l)(this.props.template.match(/form_id\d+/gi)).getOrElse((function(){return[]})).map((function(e){return e.replace("form_id","")}))).forEach((function(t){return e.props.dispatch(Object(Re.e)(E.Id.createId(t).getOrElse((function(){throw"wrong form id"}))))}))}},{key:"getFormFields",value:function(e){return Object(F.f)(e.fields,e.formId).getOrElse((function(){return[]}))}},{key:"onAddField",value:function(e){this.editor.foreach((function(t){t.insertInline(Object(Ge.a)(e)).moveToStartOfNextText().focus()})),this.props.closePopover()}},{key:"openAddGeneratorPopover",value:function(e){this.props.openPopover(Object(M.l)(Object(ee.findDOMNode)(e.currentTarget)),f.createElement("div",{style:{padding:15}},f.createElement(Ce,{errorText:new M.b,labelText:new M.c(this.props.i18n.t("Генератор")),fullWidth:!0,generators:this.props.generators,onChanged:this.onGeneratorIdChange,value:this.state.generatorId}),f.createElement("div",{style:{textAlign:"right"}},f.createElement(y.a,{variant:"contained",onClick:this.onAddGenerator},this.props.i18n.t("Вставить")))))}},{key:"onGeneratorIdChange",value:function(e){this.setState(Z()(this.state,{generatorId:{$set:e}}))}},{key:"onAddGenerator",value:function(){var e=this;this.state.generatorId.foreach((function(t){e.editor.foreach((function(e){e.insertInline({object:"inline",type:Me.a,data:{generatorId:t.value.toString()}}).moveToStartOfNextText().focus()})),e.props.closePopover()}))}},{key:"onAddData",value:function(){this.editor.foreach((function(e){e.insertInline({object:"inline",type:_e.a,data:{}}).moveToStartOfNextText().focus()}))}},{key:"onAddSeatData",value:function(e,t){var n=this;e.foreach((function(e){t.foreach((function(t){n.editor.foreach((function(n){n.insertInline({object:"inline",type:t,data:{seatmapModelId:e.value}}).moveToStartOfNextText().focus()})),n.props.closePopover()}))}))}},{key:"openAddSeatDataPopover",value:function(e){this.props.openPopover(Object(M.l)(Object(ee.findDOMNode)(e.currentTarget)),f.createElement("div",{style:{padding:15}},f.createElement(vt,{errorText:new M.b,labelText:new M.c(this.props.i18n.t("Схема")),fullWidth:!0,onSubmit:this.onAddSeatData,seatmapModelId:new M.b,dataType:new M.b})))}},{key:"ref",value:function(e){this.editor=Object(M.l)(e)}},{key:"render",value:function(){return f.createElement("div",null,f.createElement("div",{className:"ActionTemplateEditor__toolbar"},this.props.generators.length>0&&f.createElement(y.a,{onClick:this.openAddGeneratorPopover,style:{marginRight:"10px",marginTop:0}},this.props.i18n.t("Генератор")),this.getFormFields(this.props).length>0&&f.createElement(v.a,{onClick:this.openAddFieldPopover,style:_.d},f.createElement(O.a,{style:_.e})),this.props.useData&&f.createElement(y.a,{onClick:this.onAddData,style:{marginTop:0}},this.props.i18n.t("Данные")),this.props.useSeat&&f.createElement(y.a,{onClick:this.openAddSeatDataPopover,style:{marginTop:0}},this.props.i18n.t("Место"))),f.createElement("div",{style:{border:"1px solid ".concat(we.a[300]),borderRadius:4,padding:"18.5px 14px"}},f.createElement($e.b,{formId:this.props.formId},f.createElement(me.a,{placeholder:this.props.i18n.t("Шаблон заполнения поля"),ref:this.ref,value:this.state.value,schema:Ae.a,onChange:this.onChange,renderInline:this.renderInline}))))}}]),t}(f.Component);Et=gt([m.autobind,bt("design:paramtypes",[Object])],Et);var Ft=Object(h.connect)((function(e){return{i18n:e.i18n,fields:e.fields,forms:e.forms}}))(Object(Ie.a)(Et)),jt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Tt=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onTemplateEditorStateChanged",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:Z()(this.props.condition,{template:{$set:e}})}))}},{key:"onTemplateSettingsClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Настройка шаблона"),f.createElement(Ft,{formId:this.props.sourceFormId,templateId:this.props.filterId.value,generators:[],template:this.props.condition.template,onChange:this.onTemplateEditorStateChanged}),[f.createElement(y.a,{variant:"contained",onClick:function(){return e.props.handleDialogClose(t)}},this.props.i18n.t("Закрыть"))])}},{key:"render",value:function(){return f.createElement(y.a,{variant:"contained",size:"small",onClick:this.onTemplateSettingsClick},this.props.i18n.t("Настроить шаблон"))}}]),t}(f.Component);Tt=jt([m.autobind],Tt);var Ct=Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(he.a)(Tt)),It=n(595),kt=n(949),Rt=n(262),St=n(1177);var wt=function(e,t){var n;return Object(St.a)(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},Dt=n(96),xt=n(361);var Pt=function(e,t,n){var r=Object(Dt.a)(e)?kt.a:wt;return n&&Object(xt.a)(e,t,n)&&(t=void 0),r(e,Object(Rt.a)(t,3))},$t=n(2208),Vt=n(2160),Lt=n(2491),Gt=n.n(Lt),At=n(850),Mt=n.n(At),Nt=n(851),_t=n.n(Nt),qt=n(860),Bt=n.n(qt),Ut=n(861),Wt=n.n(Ut),Ht=n(857),zt=n(825),Zt=n(423),Jt=n(967),Kt=n(28),Yt={root:{fontSize:"16px"},underline:{"&:after":{borderBottom:"1px solid ".concat("#4285f4")},"&:before":{borderBottom:"1px solid ".concat(we.a[300])},"&:hover:not($disabled):not($focused):not($error):before":{borderBottom:"2px solid ".concat("#4285f4")}}},Qt={primary:{main:"#4285f4",contrastText:"#fff",dark:"rgb(46, 93, 170)",light:"rgb(103, 157, 246)"},secondary:{main:"#E91E63",contrastText:"#fff",dark:"rgb(163, 21, 69)",light:"rgb(237, 75, 130)"},text:{primary:"#000000",disabled:"#000000",secondary:"#000000"}},Xt=n(367),en=n.n(Xt),tn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){var e,t,n,r,i=en()(Object.assign((e=this.props.muiTheme,t=this.props.organisationFetching,n=this.props.organisationId,r=e.value.map((function(e){return JSON.parse(e)})).map((function(e){return e.palette})).getOrElse((function(){return Qt})),Object(Kt.i)(e.enabled).filter((function(e){return e})).matchWith((function(){return Z()(_.f,{palette:{$merge:r},overrides:{$merge:{MuiInput:Yt},$unset:["MuiTab"]}})}),(function(){return t?Z()(_.f,{palette:{$merge:n.flatMap((function(e){return Object(Kt.i)(sessionStorage.getItem("platform5_mui_themes_map")).map((function(e){return JSON.parse(e)})).flatMap((function(t){return Object(Kt.g)(t,e.value).map((function(e){return e.palette}))}))})).getOrElse((function(){return Qt}))},overrides:{$unset:["MuiTab"]}}):Z()(_.f,{overrides:{$unset:["MuiTab"]}})}))),{}));return f.createElement(Jt.a,{theme:i},this.props.children)}}]),t}(f.Component),nn=Object(h.connect)((function(e){return{muiTheme:e.organisation.data.flatMap((function(e){return e.entity.uiConfig.map((function(e){return e.muiTheme}))})).getOrElse((function(){return new E.OptionalValue(!1,new Kt.a)})),organisationFetching:e.organisation.fetching,organisationId:e.organisation.organisationId}}),(function(e){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.organisation===t.organisation},areStatePropsEqual:function(e,t){return e.muiTheme===t.muiTheme&&e.organisationFetching===t.organisationFetching&&e.organisationId===t.organisationId}})(tn),rn=function(e,t){var n=t.style;return f.createElement(nn,null,f.createElement(Zt.DateTimePicker,Object.assign({style:n},e)))},on=n(2199),an=n(2197),sn=n(2207),ln=n(270),un=n.n(ln),pn=n(33),cn=n(203),dn=n.n(cn),fn=n(45),hn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},mn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},yn=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={currentPage:0,rowPerPage:20,displayValues:[],formRecordIds:e.formRecordIds,formRecords:[],markedFormRecords:[],displayValuesFetching:!1,displayValuesError:new M.b,sorting:[],searchValue:"",searchField:new M.b,totalRecords:0},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchFormRecords()}},{key:"fetchFormRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M.b;Object(fn.i)(new E.DataPageRequest(this.state.currentPage,this.state.rowPerPage,this.props.formId,t,this.state.sorting.map((function(e){return e.sortType})))).then((function(t){e.setState(Z()(e.state,{displayValues:{$set:t.page.records.map((function(t){return{id:t.id,formRecord:t,values:e.props.displayFields.map((function(e){return Object(M.j)(t.entity.values,e.id.value).map((function(e){return e.value.toString()})).getOrElse((function(){return""}))}))}}))},formRecords:{$set:t.page.records},displayValuesFetching:{$set:!1},markedFormRecords:{$set:[]}}))})).catch((function(t){e.setState(Z()(e.state,{displayValuesFetching:{$set:!1},displayValuesError:{$set:Object(M.l)(t)}}))}))}},{key:"onMarkedAddClick",value:function(){var e=this;if(0!==this.state.markedFormRecords.length){var t=this.state.markedFormRecords;this.setState(Z()(this.state,{markedFormRecords:{$set:[]},formRecordIds:{$push:t}}),(function(){e.props.onObjRefsAdd(e.state.displayValues.filter((function(e){return t.filter((function(t){return t.value===e.id.value})).length>0})))}))}}},{key:"onAddClick",value:function(e){var t=this;this.setState(Z()(this.state,{markedFormRecords:{$set:this.state.markedFormRecords.filter((function(t){return t.value!==e.id.value}))},formRecordIds:{$push:[e.id]}}),(function(){t.props.onObjRefsAdd([e])}))}},{key:"onDeleteClick",value:function(e){var t=this;this.setState(Z()(this.state,{formRecordIds:{$set:this.state.formRecordIds.filter((function(t){return t.value!==e.id.value}))}}),(function(){t.props.onObjRefsDelete([e])}))}},{key:"onSelectAll",value:function(){this.state.markedFormRecords.length===this.state.formRecords.length?this.setState(Z()(this.state,{markedFormRecords:{$set:[]}})):this.setState(Z()(this.state,{markedFormRecords:{$set:this.state.formRecords.map((function(e){return e.id}))}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex((function(t){return t.value===e}));t>=0?this.setState(Z()(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(Z()(this.state,{markedFormRecords:{$push:[new E.Id(e)]}}))}},{key:"onRecordSelected",value:function(e){}},{key:"onNextPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:this.state.currentPage+1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPrevPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:this.state.currentPage-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onFirstPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:0},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onLastPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:Math.ceil(this.state.totalRecords/this.state.rowPerPage)-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(Z()(this.state,{rowPerPage:{$set:e},markedFormRecords:{$set:this.state.rowPerPage<=e?this.state.markedFormRecords:[]}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchValueChanged",value:function(e){this.setState(Z()(this.state,{searchValue:{$set:e.target.value}}))}},{key:"onSearchRecords",value:function(){var e=this,t=this.state.searchField.map((function(t){return new E.FilterCondition(t,new E.FilterExpressionContains,new E.ValueStr(e.state.searchValue))}));this.setState(Z()(this.state,{currentPage:{$set:0},markedFormRecords:{$set:[]}}),(function(){return e.fetchFormRecords(t)}))}},{key:"getFormSortType",value:function(e){return this.props.dispatch(Object(Re.d)(this.props.formId,e))}},{key:"sortRecords",value:function(e,t,n){var r=this;this.setState(Z()(this.state,e.matchWith((function(e){var i=r.state.sorting.findIndex((function(e){return e.fieldId.value===t.value}));return-1===i?{sorting:{$push:[{fieldId:t,asc:n,sortType:e}]}}:{sorting:{$splice:[[i,1,{fieldId:t,asc:n,sortType:e}]]}}}),(function(){return{sorting:{$set:r.state.sorting.filter((function(e){return e.fieldId.value!==t.value}))}}}))),(function(){r.fetchFormRecords()}))}},{key:"onSortRequest",value:function(e){var t=this;Object(M.l)(this.state.sorting.find((function(t){return t.fieldId.value===e.value}))).map((function(n){n.asc?t.sortRecords(Object(M.l)(Z()(n.sortType,{asc:{$set:!1}})),e,!1):t.sortRecords(new M.b,e,!0)})).getOrElse((function(){t.sortRecords(t.getFormSortType(e),e,!0)}))}},{key:"onSearchFieldChange",value:function(e){this.setState(Z()(this.state,{searchField:{$set:new M.c(new E.Id(e.target.value))}}))}},{key:"isValueAdded",value:function(e){return this.state.formRecordIds.filter((function(t){return t.value===e.id.value})).length>0}},{key:"isValueDeleted",value:function(e){return e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusDeleted.$Type.value||e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusNominalDeleted.$Type.value}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(H.b,{leftButtonGroup:[f.createElement(y.a,{key:"add",variant:"contained",size:"small",onClick:this.onMarkedAddClick},this.props.i18n.t("Добавить"))]}),f.createElement(N.a,{showId:!1,error:this.state.displayValuesError,onSelectAll:this.onSelectAll,onRecordMarked:this.onRecordMarked,onRecordSelected:this.onRecordSelected,markedRecords:this.state.markedFormRecords.map((function(e){return e.value})),fetching:this.state.displayValuesFetching,empty:0===this.state.displayValues.length,withActions:!0,headers:this.props.displayFields.map((function(e){return{id:e.id.value,title:e.entity.caption}})),onSort:this.onSortRequest,sortedFieldIds:this.state.sorting,rows:this.state.displayValues.map((function(t){var n=e.isValueAdded(t),r=e.isValueDeleted(t);return{payload:t.id.value,id:t.id.value,fields:t.values,selectDisabled:r,buttons:[n?f.createElement(v.a,{key:"delete",style:_.d,onClick:function(n){return e.onDeleteClick(t)}},f.createElement(L.a,{style:_.e})):f.createElement(v.a,{key:"add",style:_.d,onClick:function(n){return e.onAddClick(t)},disabled:r},f.createElement(O.a,{style:_.e}))]}}))}),f.createElement(H.a,{blockTableSearch:!0,nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.state.totalRecords,shouldShowMassActions:!1,massActionsComponents:[],searchValue:this.state.searchValue,searchField:this.state.searchField.map((function(e){return e.value})).getOrNull(),searchFields:this.props.displayFields,onSearchValueChange:this.onSearchValueChanged,onSearchRecords:this.onSearchRecords,onSearchFieldChange:this.onSearchFieldChange}))}}]),t}(f.Component);yn=hn([m.autobind,mn("design:paramtypes",[Object])],yn);var vn=Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(yn),gn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},bn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},On=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={currentPage:0,rowPerPage:20,displayValues:[],formRecords:[],formRecordIds:e.formRecordIds,markedFormRecords:[],displayValuesFetching:!1,displayValuesError:new M.b},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchFormRecords()}},{key:"fetchFormRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M.b,n=Object(M.l)(new E.FilterGroupCondition([new E.RestrictedForm(this.props.valueType.family,this.state.formRecordIds)].concat(t?t.map((function(e){return[e]})).getOrElse((function(){return[]})):[]),new E.FilterPredicateAnd));Object(fn.i)(new E.DataPageRequest(this.state.currentPage,this.state.rowPerPage,this.props.valueType.family,n,[])).then((function(t){e.setState(Z()(e.state,{displayValues:{$set:t.page.records.map((function(t){return{id:t.id,values:e.props.displayFields.map((function(e){return Object(M.j)(t.entity.values,e.id.value).map((function(e){return e.value.toString()})).getOrElse((function(){return""}))}))}}))},formRecords:{$set:t.page.records},displayValuesFetching:{$set:!1}}))})).catch((function(t){e.setState(Z()(e.state,{displayValuesFetching:{$set:!1},displayValuesError:{$set:Object(M.l)(t)}}))}))}},{key:"onObjRefsAdd",value:function(e){var t=this;this.setState(Z()(this.state,{formRecordIds:{$push:e.map((function(e){return e.id}))}}),(function(){t.props.onChange(t.state.formRecordIds.concat(e.map((function(e){return e.id}))),t.state.formRecords.filter((function(t){return e.map((function(e){return e.id})).filter((function(e){return e.value===t.id.value})).length>0})))}))}},{key:"onObjRefsDelete",value:function(e){var t=this,n=this.state.formRecordIds.filter((function(t){return 0===e.filter((function(e){return e.id.value===t.value})).length}));this.setState(Z()(this.state,{formRecordIds:{$set:n}}),(function(){t.props.onChange(n,[])}))}},{key:"onAddClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Добавление анкеты"),f.createElement(vn,{formId:this.props.valueType.family,formRecordIds:this.state.formRecordIds,displayFields:this.props.displayFields,onObjRefsAdd:this.onObjRefsAdd,onObjRefsDelete:this.onObjRefsDelete}),[f.createElement(y.a,{variant:"contained",key:"close",onClick:function(n){e.props.handleDialogClose(t),e.setState(Z()(e.state,{displayValuesFetching:{$set:!0}}),(function(){e.fetchFormRecords()}))}},this.props.i18n.t("Закрыть"))])}},{key:"sliceCurrentPage",value:function(e){return e.slice(this.state.currentPage*this.state.rowPerPage,(this.state.currentPage+1)*this.state.rowPerPage)}},{key:"onSelectAll",value:function(){this.state.markedFormRecords.length===this.sliceCurrentPage(this.state.formRecordIds).length?this.setState(Z()(this.state,{markedFormRecords:{$set:[]}})):this.setState(Z()(this.state,{markedFormRecords:{$set:this.sliceCurrentPage(this.state.formRecordIds)}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex((function(t){return t.value===e.value}));t>=0?this.setState(Z()(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(Z()(this.state,{markedFormRecords:{$push:[e]}}))}},{key:"onRecordSelected",value:function(e){}},{key:"onNextPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:this.state.currentPage+1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPrevPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:this.state.currentPage-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onFirstPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:0},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onLastPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:Math.ceil(this.state.formRecordIds.length/this.state.rowPerPage)-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(Z()(this.state,{rowPerPage:{$set:e},markedFormRecords:{$set:this.state.rowPerPage<=e?this.state.markedFormRecords:[]}}),(function(){return t.fetchFormRecords()}))}},{key:"onDeleteValue",value:function(e){var t=this,n=this.state.formRecordIds.filter((function(t){return t.value!==e.id.value}));this.setState(Z()(this.state,{formRecordIds:{$set:n},displayValuesFetching:{$set:!0}}),(function(){t.props.onChange(n,[]),t.fetchFormRecords()}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(H.b,{leftButtonGroup:[f.createElement(y.a,{key:"add",variant:"contained",size:"small",onClick:this.onAddClick},this.props.i18n.t("Добавить"))]}),f.createElement(N.a,{showId:!1,error:this.state.displayValuesError,onSelectAll:this.onSelectAll,onRecordMarked:this.onRecordMarked,onRecordSelected:this.onRecordSelected,markedRecords:this.state.markedFormRecords.map((function(e){return e.value})),fetching:this.state.displayValuesFetching,empty:0===this.state.displayValues.length,withActions:!0,headers:this.props.displayFields.map((function(e){return{id:e.id.value,title:e.entity.caption}})),rows:this.state.displayValues.map((function(t){return{payload:t.id,id:t.id.value,fields:t.values,buttons:[f.createElement(v.a,{style:_.d,key:"delete",onClick:function(n){return e.onDeleteValue(t)}},f.createElement(dn.a,{style:_.e}))]}}))}),f.createElement(H.a,{blockTableSearch:!1,nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.state.formRecordIds.length,shouldShowMassActions:!1,massActionsComponents:[]}))}}]),t}(f.Component);On=gn([m.autobind,bn("design:paramtypes",[Object])],On);var En=Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(he.a)(On)),Fn=n(425),jn=n(82),Tn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Cn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},In=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={timeZoneOffset:(new Date).getTimezoneOffset()},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.formFieldType(this.props.condition.field).map((function(e){return e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))&&this.props.dispatch(Object(Fn.a)())}},{key:"componentWillReceiveProps",value:function(e){this.formFieldType(e.condition.field).map((function(e){return e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))&&!this.formFieldType(this.props.condition.field).map((function(e){return e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))&&e.dispatch(Object(Fn.a)())}},{key:"onConditionValueChanged",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:Z()(this.props.condition,{value:{$set:e}})}))}},{key:"onListValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueList([n.values[e.target.index]]))}))}},{key:"onContainsListValueChanged",value:function(e){this.onConditionValueChanged(new E.ValueList([new E.ValueStr(e.target.value)]))}},{key:"onLatitudeChanged",value:function(e){this.onConditionValueChanged(this.props.condition.value.updateLatitude(e.target.value))}},{key:"onLongitudeChanged",value:function(e){this.onConditionValueChanged(this.props.condition.value.updateLongitude(e.target.value))}},{key:"onRegExpChanged",value:function(e){this.props.condition.expression instanceof E.FilterExpressionRegExp&&this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:Z()(this.props.condition,{expression:{$set:Z()(this.props.condition.expression,{expr:{$set:e.target.value}})}})}))}},{key:"onObjRefsValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueObjectRefs([new E.Id(e)]))}))}},{key:"onUserRefsValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueUserRefs([new E.EntityRef(E.Id.createId(e).getOrElse((function(){throw"wrong user id"})),E.User.$Type.value)]))}))}},{key:"onOneOfUserRefsValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueUserRefs(e.map((function(e){return new E.EntityRef(E.Id.createId(e).getOrElse((function(){throw"wrong user id"})),E.User.$Type.value)}))))}))}},{key:"onObjRefsValueToggled",value:function(e,t){var n=this;this.formFieldType(this.props.condition.field).foreach((function(r){return n.onConditionValueChanged(Z()(t,{id:{$set:Object(It.a)(t.id,[new E.Id(e)],J.a)}}))}))}},{key:"onStringValueChanged",value:function(e){this.onConditionValueChanged(new E.ValueStr(e.target.value))}},{key:"onNumberValueChanged",value:function(e){var t=this;Object(pn.b)(e.target.value,this.props.condition.value.toString(),!0,(function(e){return t.onConditionValueChanged(new E.ValueNumber(e))}))}},{key:"onBoolValueChanged",value:function(e){this.onConditionValueChanged(new E.ValueBool(e))}},{key:"formFieldType",value:function(e){return Object(M.j)(this.props.fields.list,this.props.formId.value).flatMap((function(t){return Object(M.g)(t.filter((function(t){return t.id.value===e.value}))).map((function(e){return e.entity.valueType}))}))}},{key:"onObjRefsIdsChanged",value:function(e){this.onConditionValueChanged(new E.ValueObjectRefs(e))}},{key:"setObjectRefsValue",value:function(e){var t=this,n=this.props.openDialog(this.props.i18n.t("Настройка значения"),f.createElement(En,{formRecordIds:this.props.condition.value.id,valueType:e,displayFields:Object(F.f)(this.props.fields,e.family).getOrElse((function(){return[]})).filter((function(t){return e.displayFields.filter((function(e){return e.value===t.id.value})).length>0})),onChange:this.onObjRefsIdsChanged}),[f.createElement(y.a,{variant:"contained",key:"close",onClick:function(e){return t.props.handleDialogClose(n)}},this.props.i18n.t("Закрыть"))])}},{key:"onDateValueChange",value:function(e){var t=this;Object(M.l)(e).foreach((function(e){t.onConditionValueChanged(new E.ValueDate(e.getTime()))}))}},{key:"onTimeValueChange",value:function(e){var t=this;Object(M.l)(e).foreach((function(e){t.onConditionValueChanged(new E.ValueDate(e.getTime()+6e4*t.state.timeZoneOffset))}))}},{key:"onTimeZoneChange",value:function(e){this.setState({timeZoneOffset:e.target.value})}},{key:"getDateTypePicker",value:function(e){switch(e.dateType.tpe.value){case E.DateTypeDate.$Type.value:return f.createElement(Ht.DatePicker,{value:this.props.condition.value.value,onChange:this.onDateValueChange,leftArrowIcon:f.createElement(Mt.a,null),rightArrowIcon:f.createElement(_t.a,null),cancelLabel:this.props.i18n.t("Отмена"),okLabel:this.props.i18n.t("ОК"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),format:"dd.MM.yyyy"});case E.DateTypeTime.$Type.value:return f.createElement(zt.TimePicker,{cancelLabel:this.props.i18n.t("Отмена"),okLabel:this.props.i18n.t("ОК"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),onChange:this.onTimeValueChange,value:new Date(this.props.condition.value.value.getTime()-6e4*this.state.timeZoneOffset)});case E.DateTypeDateTime.$Type.value:return f.createElement(rn,{cancelLabel:this.props.i18n.t("Отмена"),okLabel:this.props.i18n.t("ОК"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),value:new Date(this.props.condition.value.value.getTime()-6e4*this.state.timeZoneOffset),onChange:this.onTimeValueChange,leftArrowIcon:f.createElement(Mt.a,null),rightArrowIcon:f.createElement(_t.a,null),dateRangeIcon:f.createElement(Bt.a,null),timeIcon:f.createElement(Wt.a,null)})}}},{key:"render",value:function(){var e=this;return this.props.condition.expression.tpe===E.FilterExpressionRegExp.$Type?f.createElement(oe.a,{style:{flex:1,marginTop:15},value:this.props.condition.expression.expr,onChange:this.onRegExpChanged}):this.formFieldType(this.props.condition.field).map((function(t){switch(t.tpe){case E.ValueTypeStr.$Type:return f.createElement(oe.a,{style:{flex:1,marginTop:15},value:Object(M.l)(e.props.condition.value).map((function(e){return e})).map((function(e){return e.value})).getOrElse((function(){return""})),onChange:e.onStringValueChanged});case E.ValueTypeNumber.$Type:return f.createElement(oe.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onNumberValueChanged});case E.ValueTypeBool.$Type:return f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:e.props.condition.value.toString(),onChange:function(t){return e.onBoolValueChanged("true"===t.target.value)}},f.createElement("option",{value:"true",key:0},"True"),f.createElement("option",{value:"false",key:1},"False")));case E.ValueTypeValuesList.$Type:return e.props.condition.expression.tpe.value===E.FilterExpressionContains.$Type.value||e.props.condition.expression.tpe.value===E.FilterExpressionNotContains.$Type.value?f.createElement(oe.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onContainsListValueChanged}):f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:Object(M.l)(e.props.condition.value).filter((function(e){return e instanceof E.ValueList})).flatMap((function(t){return Object(M.g)(e.props.condition.value.values)})).map((function(e){return e.toString()})).getOrElse((function(){return""})),onChange:e.onListValueChanged},t.values.map((function(e,t){return f.createElement("option",{value:e.toString(),key:t},e.value)}))));case E.ValueTypeGeoPoint.$Type:return f.createElement("div",{style:{flex:1,display:"flex"}},f.createElement(oe.a,{type:"number",style:{flex:1,marginTop:15},value:e.props.condition.value.lat,label:e.props.i18n.t("Широта"),onChange:e.onLatitudeChanged}),f.createElement(oe.a,{type:"number",style:{flex:1,marginTop:15},value:e.props.condition.value.lng,label:e.props.i18n.t("Долгота"),onChange:e.onLongitudeChanged}));case E.ValueTypeObjectRefs.$Type:return e.props.condition.expression.tpe.value===E.FilterExpressionGt.$Type.value||e.props.condition.expression.tpe.value===E.FilterExpressionLt.$Type.value?f.createElement(oe.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onNumberValueChanged}):Object(K.e)(e.props.forms,t.family).map((function(e){return E.FormType.isForm(e.entity.formType)})).getOrElse((function(){return!1}))?f.createElement(y.a,{onClick:function(n){return e.setObjectRefsValue(t)}},e.props.i18n.t("Настроить значение")):e.props.condition.expression.tpe.value===E.FilterExpressionOneOf.$Type.value?f.createElement("div",{style:{flex:1,margin:"0px 5px",height:"8em",overflowY:"auto"}},Object(M.j)(e.props.dictionaries.list,t.family.value).map((function(n){return n.map((function(n){return f.createElement(Vt.a,{label:Object(M.g)(t.displayFields).flatMap((function(e){return Object(M.l)(n.entity.values[e.value]).map((function(e){return e.value.toString()}))})).getOrElse((function(){return e.props.i18n.t("Значение отсутствует")})),control:f.createElement($t.a,{key:n.id.value,onClick:function(){return e.onObjRefsValueToggled(n.id.value,e.props.condition.value)},checked:Pt(e.props.condition.value.id,n.id)})})}))})).getOrElse((function(){return[]}))):f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{id:e.props.condition.expression.tpe.value,native:!0,value:Object(M.g)(e.props.condition.value.id).map((function(e){return e.value})).getOrElse((function(){return""})),onChange:function(t){return"string"==typeof t.target.value&&e.onObjRefsValueChanged(t.target.value)}},Object(M.j)(e.props.dictionaries.list,t.family.value).map((function(n){return n.map((function(n){return f.createElement("option",{key:n.id.value,value:n.id.value},Object(M.g)(t.displayFields).flatMap((function(e){return Object(M.j)(n.entity.values,e.value).map((function(e){return e.value.toString()}))})).getOrElse((function(){return e.props.i18n.t("Значение отсутствует")})))}))})).getOrElse((function(){return[]}))));case E.ValueTypeUserRefs.$Type:return e.props.condition.expression.tpe.value===E.FilterExpressionGt.$Type.value||e.props.condition.expression.tpe.value===E.FilterExpressionLt.$Type.value?f.createElement(oe.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onNumberValueChanged}):e.props.condition.expression.tpe.value===E.FilterExpressionOneOf.$Type.value?f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{fullWidth:!0,multiple:!0,value:e.props.condition.value.refs.map((function(e){return e.id.value})),onChange:function(t){return e.onOneOfUserRefsValueChanged(t.target.value)},renderValue:function(t){return t instanceof Array?e.props.users.descriptionsList.filter((function(e){return t.filter((function(t){return e.id===t})).length>0})).map((function(e){return e.name})).join(", "):""}},e.props.users.descriptionsList.map((function(t){return f.createElement(Gt.a,{value:t.id,key:t.id},t.avatarId.flatMap((function(e){return E.Id.createId(e.toString())})).flatMap((function(t){return e.props.token.map((function(n){return Object(jn.b)(n,t,e.props.cdnAddress)}))})).matchWith((function(e){return f.createElement(sn.a,null,f.createElement(on.a,{alt:t.name,src:e}))}),(function(){return f.createElement(an.a,null,f.createElement(un.a,null))})),f.createElement(be.a,{primary:t.name}))})))):f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{fullWidth:!0,value:Object(M.g)(e.props.condition.value.refs).map((function(e){return e.id.value})).getOrElse((function(){return""})),onChange:function(t){return"string"==typeof t.target.value&&e.onUserRefsValueChanged(t.target.value)},SelectDisplayProps:{style:{display:"flex"}}},e.props.users.descriptionsList.map((function(t){return f.createElement(Gt.a,{value:t.id,key:t.id},t.avatarId.flatMap((function(e){return E.Id.createId(e.toString())})).flatMap((function(t){return e.props.token.map((function(n){return Object(jn.b)(n,t,e.props.cdnAddress)}))})).matchWith((function(e){return f.createElement(sn.a,null,f.createElement(on.a,{alt:t.name,src:e}))}),(function(){return f.createElement(an.a,null,f.createElement(un.a,null))})),f.createElement(be.a,{primary:t.name}))}))));case E.ValueTypeFileList.$Type:return f.createElement("div",null);case E.ValueTypeDate.$Type:return f.createElement("div",null,f.createElement(se.a,{style:{marginTop:0}},e.getDateTypePicker(t)),f.createElement(se.a,null,f.createElement(ae.a,{value:e.state.timeZoneOffset,onChange:e.onTimeZoneChange},E.TimeZones.map((function(e,t){return f.createElement(Gt.a,{key:t,value:e.offset},e.name)})))));default:return f.createElement("div",{style:{marginTop:15}},e.props.i18n.t("Тип поля не поддерживается"))}})).getOrElse((function(){return f.createElement("div",null," ")}))}}]),t}(f.Component);In=Tn([m.autobind,Cn("design:paramtypes",[Object])],In);var kn=Object(h.connect)((function(e,t){return{i18n:e.i18n,fields:e.fields,forms:e.forms,dictionaries:e.dictionaries,users:e.users,token:e.auth.token,cdnAddress:e.config.cdnAddress}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.users===t.users},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.users===t.users}})(Object(he.a)(In)),Rn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Sn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getOperationName",value:function(e){switch(e.tpe.value){case E.FilterExpressionEq.$Type.value:return this.props.i18n.t("Равно");case E.FilterExpressionNotEq.$Type.value:return this.props.i18n.t("Не равно");case E.FilterExpressionGt.$Type.value:return this.props.i18n.t("Больше");case E.FilterExpressionLt.$Type.value:return this.props.i18n.t("Меньше");case E.FilterExpressionContains.$Type.value:return this.props.i18n.t("Включает");case E.FilterExpressionNotContains.$Type.value:return this.props.i18n.t("Не включает");case E.FilterExpressionPresent.$Type.value:return this.props.i18n.t("Заполнено");case E.FilterExpressionMissing.$Type.value:return this.props.i18n.t("Не заполнено");case E.FilterExpressionOneOf.$Type.value:return this.props.i18n.t("Одно из");case E.FilterExpressionRegExp.$Type.value:return this.props.i18n.t("Регулярное выражение");case E.FilterExpressionNearestPoints.$Type.value:return this.props.i18n.t("Находится в радиусе");case E.FilterExpressionCaseInsensitiveEq.$Type.value:return this.props.i18n.t("Равно (регистронезависимый)");case E.FilterExpressionCaseInsensitiveNotEq.$Type.value:return this.props.i18n.t("Не равно (регистронезависимый)");default:return"-"}}},{key:"onConditionValueChanged",value:function(e){this.props.predicate instanceof E.FilterCondition&&this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:Z()(this.props.predicate,{value:{$set:e}})}))}},{key:"onConditionOperationChanged",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:Z()(this.props.predicate,Object.assign({expression:{$set:e}},this.props.predicate.tpe.value===E.FilterCondition.$Type.value?{value:{$set:this.getPredicateValue(e)}}:{}))}))}},{key:"getPredicateValue",value:function(e){return e.tpe.value!==E.FilterExpressionGt.$Type.value&&e.tpe.value!==E.FilterExpressionLt.$Type.value||!this.formFieldType(this.props.fieldId).map((function(e){return e.tpe.value===E.ValueTypeObjectRefs.$Type.value||e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))?this.props.predicate.value:new E.ValueNumber(0)}},{key:"onConditionClick",value:function(e){e.target===ee.findDOMNode(this)&&this.props.dispatch(Object(Y.j)({filterId:this.props.filterId,selectedCondition:this.props.predicate}))}},{key:"onConditionDelete",value:function(){this.props.dispatch(Object(Y.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate}))}},{key:"onOperationSelected",value:function(e){Object(M.g)(E.FilterExpressions.filter((function(t){return t.tpe.value===e.target.value}))).foreach(this.onConditionOperationChanged)}},{key:"getFields",value:function(){var e=E.Role.getCurrentConfigId(this.props.user.userRole,this.props.currentForm.data,this.props.userCurrentConfigId).getOrNull(),t=this.props.currentForm.data.flatMap((function(t){return Object(M.g)(t.entity.dataListView.configs.filter((function(t){return t.id.id===e})))})).map((function(e){return e instanceof E.DataListConfigTable})).getOrElse((function(){return!1})),n=Object(M.j)(this.props.fields.list,this.props.formId.value).getOrElse((function(){return[]})).filter((function(e){return e.entity.valueType.tpe.value!==E.ValueTypeFormDataAttribute.$Type.value}));if(t){var r=this.props.currentForm.data.map((function(t){return Object(M.g)(t.entity.dataListView.configs.filter((function(t){return t.id.id===e})).map((function(e){return e.filterableFieldIds}))).getOrElse((function(){return[]}))})).getOrElse((function(){return[]})).map((function(e,t){return Object.assign(Object.assign({},e),{position:t})}));return n.filter((function(e){return Object(M.l)(r.find((function(t){return t.fieldId.value===e.id.value}))).getOrNull()})).map((function(e){return Object.assign(Object.assign({},e),{position:Object(M.l)(r.find((function(t){return t.fieldId.value===e.id.value}))).map((function(e){return e.position})).getOrElse((function(){return 0}))})})).sort((function(e,t){return e.position-t.position}))}return n}},{key:"getFieldFromCondition",value:function(){var e=this.props.predicate;switch(e.tpe.value){case E.FilterCondition.$Type.value:return Object(M.l)(e.field);case E.FilterSubstCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:return Object(M.l)(e.searchField);default:return new M.b}}},{key:"getFilterCondition",value:function(){var e=this;return this.getFieldFromCondition().flatMap((function(t){return e.formFieldType(Object(M.l)(t)).map((function(n){return new E.FilterCondition(t,e.props.predicate.expression,n.getDefaultValue())}))}))}},{key:"getTemplateCondition",value:function(){var e=this;return this.getFieldFromCondition().map((function(t){return new E.FilterTemplateCondition(e.props.predicate.expression,t,"")}))}},{key:"getSubstCondition",value:function(){var e=this;return this.getFieldFromCondition().flatMap((function(t){return e.formFieldType(Object(M.l)(t)).flatMap((function(n){return Object(M.l)(e.props.sourceFormId).flatMap((function(t){return Object(M.g)(Object(F.f)(e.props.fields,t).getOrElse((function(){return[]})).filter((function(e){return e.entity.valueType.tpe.value===n.tpe.value})))})).map((function(n){return new E.FilterSubstCondition(e.props.predicate.expression,t,n.id)}))}))}))}},{key:"getCondition",value:function(e){switch(e){case E.FilterCondition.$Type.value:return this.getFilterCondition();case E.FilterSubstCondition.$Type.value:return this.getSubstCondition();case E.FilterTemplateCondition.$Type.value:return this.getTemplateCondition();default:return new M.b}}},{key:"onConditionTypeChange",value:function(e){var t=this;this.props.predicate.tpe.value!==e.target.value&&this.getCondition(e.target.value).foreach((function(e){t.props.dispatch(Object(Y.i)({filterId:t.props.filterId,parentGroups:t.props.parentGroups,predicate:t.props.predicate,newPredicate:e}))}))}},{key:"onGeoPointDistanceChanged",value:function(e){this.props.predicate.expression instanceof E.FilterExpressionNearestPoints&&this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:Z()(this.props.predicate,{expression:{$set:Z()(this.props.predicate.expression,{distance:{$set:e.target.value}})}})}))}},{key:"renderSubstValueEditor",value:function(){return this.props.sourceFormId&&f.createElement(fe,{sourceFormId:this.props.sourceFormId,condition:this.props.predicate,filterId:this.props.filterId,parentGroups:this.props.parentGroups})}},{key:"renderTemplateValueEditor",value:function(){return this.props.sourceFormId&&f.createElement(Ct,{sourceFormId:this.props.sourceFormId,condition:this.props.predicate,filterId:this.props.filterId,parentGroups:this.props.parentGroups})}},{key:"renderFieldValueEditor",value:function(){return f.createElement(kn,{condition:this.props.predicate,formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups})}},{key:"renderValueEditor",value:function(){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return this.renderFieldValueEditor();case E.FilterSubstCondition.$Type.value:return this.renderSubstValueEditor();case E.FilterTemplateCondition.$Type.value:return this.renderTemplateValueEditor();default:return this.renderFieldValueEditor()}}},{key:"render",value:function(){var e=this;return this.props.filterExpressions&&0===this.props.filterExpressions.length?f.createElement(te.a,{style:{display:"flex",padding:"10px 10px 10px 25px",flexWrap:"wrap"},onClick:this.onConditionClick},this.props.children,f.createElement(v.a,{onClick:this.onConditionDelete},f.createElement(pe.a,null))):f.createElement(te.a,{style:{display:"flex",padding:"10px 10px 10px 25px",flexWrap:"nowrap"},onClick:this.onConditionClick},this.props.children,f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:this.props.predicate.expression.tpe.value,onChange:this.onOperationSelected},E.FilterExpressions.filter((function(t){return!e.props.displayFieldElements||t.tpe!==E.FilterExpressionNearestPoints.$Type})).filter((function(t){return e.formFieldType(e.props.fieldId).map((function(e){switch(e.tpe.value){case E.ValueTypeValuesList.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionContains.$Type||t.tpe===E.FilterExpressionNotContains.$Type;case E.ValueTypeBool.$Type.value:return t.tpe===E.FilterExpressionEq.$Type||t.tpe===E.FilterExpressionNotEq.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionMissing.$Type;case E.ValueTypeFileList.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type;case E.ValueTypeGeoPoint.$Type.value:return t.tpe===E.FilterExpressionNearestPoints.$Type;case E.ValueTypeObjectRefs.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionNotContains.$Type||t.tpe===E.FilterExpressionContains.$Type||t.tpe===E.FilterExpressionOneOf.$Type||t.tpe===E.FilterExpressionGt.$Type||t.tpe===E.FilterExpressionLt.$Type||t.tpe===E.FilterExpressionEq.$Type||t.tpe===E.FilterExpressionNotEq.$Type;case E.ValueTypeUserRefs.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionContains.$Type||t.tpe===E.FilterExpressionNotContains.$Type||t.tpe===E.FilterExpressionOneOf.$Type||t.tpe===E.FilterExpressionGt.$Type||t.tpe===E.FilterExpressionLt.$Type||t.tpe===E.FilterExpressionEq.$Type||t.tpe===E.FilterExpressionNotEq.$Type;case E.ValueTypeDate.$Type.value:return t.tpe===E.FilterExpressionGt.$Type||t.tpe===E.FilterExpressionLt.$Type||t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type;case E.ValueTypeStr.$Type.value:return t.tpe!==E.FilterExpressionGt.$Type&&t.tpe!==E.FilterExpressionLt.$Type&&t.tpe!==E.FilterExpressionOneOf.$Type&&t.tpe!==E.FilterExpressionNearestPoints.$Type;default:return t.tpe!==E.FilterExpressionOneOf.$Type}})).getOrElse((function(){return!0}))})).map((function(t){return f.createElement("option",{value:t.tpe.value,key:t.tpe.value},e.getOperationName(t))})))),this.props.predicate.expression instanceof E.FilterExpressionNearestPoints&&f.createElement(oe.a,{type:"number",style:{flex:1},value:this.props.predicate.expression.distance,label:this.props.i18n.t("Расстояние"),onChange:this.onGeoPointDistanceChanged}),this.props.sourceFormId&&f.createElement(se.a,null,f.createElement(le.a,null,this.props.i18n.t("Источник значения")),f.createElement(ae.a,{native:!0,value:this.props.predicate.tpe.value,onChange:this.onConditionTypeChange},f.createElement("option",{value:E.FilterCondition.$Type.value},this.props.i18n.t("Статический")),f.createElement("option",{value:E.FilterSubstCondition.$Type.value},this.props.i18n.t("Источник события, поле")),this.formFieldType(this.props.fieldId).map((function(e){return e.tpe.value===E.ValueTypeStr.$Type.value})).getOrElse((function(){return!1}))&&f.createElement("option",{value:E.FilterTemplateCondition.$Type.value},this.props.i18n.t("Источник события, шаблон")))),this.props.predicate.expression.tpe!==E.FilterExpressionMissing.$Type&&this.props.predicate.expression.tpe!==E.FilterExpressionPresent.$Type&&this.renderValueEditor(),f.createElement(v.a,{onClick:this.onConditionDelete},f.createElement(pe.a,null)))}},{key:"formFieldType",value:function(e){return Object(M.j)(this.props.fields.list,this.props.formId.value).flatMap((function(t){return Object(M.g)(t.filter((function(t){return t.id.value===e.map((function(e){return e.value})).getOrNull()}))).map((function(e){return e.entity.valueType}))}))}}]),t}(f.Component);Sn=Rn([m.autobind],Sn);var wn,Dn=Object(h.connect)((function(e){return{fields:e.fields,dictionaries:e.dictionaries,i18n:e.i18n,currentForm:e.currentForm,user:e.user,userCurrentConfigId:e.formRecordsTable.currentConfigId}}))(Sn),xn=n(100),Pn=n(591),$n=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Vn=(wn={},D()(wn,"ByDateAttributeCreated",(function(){return new E.DateAttributeTypeCreated})),D()(wn,"ByDateAttributeUpdated",(function(){return new E.DateAttributeTypeUpdated})),wn),Ln=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getExpressionFromField",value:function(e,t){return this.getFormFieldType(e).map((function(e){switch(e.tpe){case E.ValueTypeFileList.$Type:return t.tpe!==E.FilterExpressionMissing.$Type||t.tpe!==E.FilterExpressionPresent.$Type?new E.FilterExpressionPresent:t;case E.ValueTypeGeoPoint.$Type:return new E.FilterExpressionNearestPoints(0);case E.ValueTypeDate.$Type:return new E.FilterExpressionGt;case E.ValueTypeValuesList.$Type:return new E.FilterExpressionPresent;default:return t}})).getOrElse((function(){throw"FormField has not been found"}))}},{key:"updateCondition",value:function(e,t){var n=this;return new E.FilterCondition(e,this.getExpressionFromField(e,t),this.getFormFieldType(e).map((function(e){switch(e.tpe){case E.ValueTypeStr.$Type:return new E.ValueStr("");case E.ValueTypeBool.$Type:return new E.ValueBool(!1);case E.ValueTypeNumber.$Type:return new E.ValueNumber(0);case E.ValueTypeGeoPoint.$Type:return new E.ValueGeoPoint(45.5,45.5);case E.ValueTypeValuesList.$Type:return Object(M.g)(e.values).map((function(e){return new E.ValueList([e])})).getOrElse((function(){return new E.ValueList([])}));case E.ValueTypeObjectRefs.$Type:return n.props.predicate.tpe.value===E.FilterExpressionGt.$Type.value||n.props.predicate.tpe.value===E.FilterExpressionLt.$Type.value?new E.ValueNumber(0):new E.ValueObjectRefs(Object(M.g)(Object(xn.b)(n.props.dictionaries,e.family).getOrElse((function(){return[]}))).map((function(e){return[e.id]})).getOrElse((function(){return[]})));case E.ValueTypeUserRefs.$Type:return new E.ValueUserRefs([]);case E.ValueTypeFileList.$Type:return new E.ValueFileList([]);case E.ValueTypeDate.$Type:return new E.ValueDate((new Date).getTime());default:throw"Unknown value type: "+e.tpe.value}})).getOrElse((function(){throw"FormField has not been found"})),this.getFormFieldType(e).map((function(e){return e.tpe.value})))}},{key:"getFormFieldType",value:function(e){return Object(F.f)(this.props.formFields,this.props.formId).flatMap((function(t){return Object(M.g)(t.filter((function(t){return t.id.value===e.value}))).map((function(e){return e.entity.valueType}))}))}},{key:"updateSubstCondition",value:function(e,t){return Z()(t,{searchField:{$set:e},expression:{$set:this.getExpressionFromField(e,t.expression)}})}},{key:"updateTemplateCondition",value:function(e,t){return Z()(t,{searchField:{$set:e},expression:{$set:this.getExpressionFromField(e,t.expression)}})}},{key:"updatePredicate",value:function(e){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return this.updateCondition(e,this.props.predicate.expression);case E.FilterSubstCondition.$Type.value:return this.updateSubstCondition(e,this.props.predicate);case E.FilterTemplateCondition.$Type.value:return this.updateTemplateCondition(e,this.props.predicate);default:return this.updateCondition(e,new E.FilterExpressionPresent)}}},{key:"onConditionFieldChanged",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:this.updatePredicate(e)}))}},{key:"onNotifyTemplateChanged",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:new E.NotifyTemplateId(e,!1,new M.b)}))}},{key:"onDateIntervalChanged",value:function(e,t,n){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:new E.DateInterval(t,n,e)}))}},{key:"onChildFormChanged",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:new E.ChildFilter(e,new E.FilterGroupCondition([],new E.FilterPredicateAnd))}))}},{key:"onByFieldSourceChanged",value:function(e){var t=this;return Object(M.l)(e).filter((function(e){return 0===e.indexOf("ByField")})).flatMap((function(t){return Object(M.l)(e.substring(e.indexOf("-")+1))})).flatMap((function(e){return E.Id.createId(e)})).matchWith((function(e){return t.onConditionFieldChanged(e),new M.b}),(function(){return Object(M.l)(e)}))}},{key:"onByTemplateSourceChanged",value:function(e){var t=this;return Object(M.l)(e).filter((function(e){return 0===e.indexOf("ByNotifyTemplate")})).flatMap((function(e){return Object(M.g)(t.props.notifyTemplatesDescriptionsList).map((function(e){return e.id}))})).flatMap((function(e){return E.Id.createId(e)})).matchWith((function(e){return t.onNotifyTemplateChanged(e),new M.b}),(function(){return Object(M.l)(e)}))}},{key:"onByChildFormSourceChanged",value:function(e){var t=this;return Object(M.l)(e).filter((function(e){return 0===e.indexOf("ByChildForm")})).flatMap((function(e){return Object(M.g)(t.getRefFields()).map((function(e){return e.id}))})).matchWith((function(e){return t.onChildFormChanged(e),new M.b}),(function(){return Object(M.l)(e)}))}},{key:"onByDateIntervalSourceChanged",value:function(e){var t=this;return Object(M.l)(e).filter((function(e){return"ByDateAttributeUpdated"===e||"ByDateAttributeCreated"===e})).matchWith((function(e){return Object(ke.b)(e)(Vn).matchWith((function(e){return t.onDateIntervalChanged(e(),t.props.predicate instanceof E.DateInterval?t.props.predicate.start:new M.b,t.props.predicate instanceof E.DateInterval?t.props.predicate.end:new M.b)}),(function(){throw"unknown date attribute type"})),new M.b}),(function(){return Object(M.l)(e)}))}},{key:"onValueSourceSelected",value:function(e){var t=this;Object(M.l)(e.target.value).flatMap((function(e){return t.onByFieldSourceChanged(e)})).flatMap((function(e){return t.onByTemplateSourceChanged(e)})).flatMap((function(e){return t.onByChildFormSourceChanged(e)})).flatMap((function(e){return t.onByDateIntervalSourceChanged(e)}))}},{key:"getFields",value:function(){return this.props.fields}},{key:"getRefFields",value:function(){return this.getFields().filter((function(e){return e.entity.valueType.tpe.value===E.ValueTypeObjectRefs.$Type.value}))}},{key:"getSelectValue",value:function(){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return"ByField-"+this.props.predicate.field.value;case E.FilterSubstCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:return"ByField-"+this.props.predicate.searchField.value;case E.NotifyTemplateId.$Type.value:return"ByNotifyTemplate";case E.ChildFilter.$Type.value:return"ByChildForm";case E.DateInterval.$Type.value:if(this.props.predicate.attributeType instanceof E.DateAttributeTypeCreated)return"ByDateAttributeCreated";if(this.props.predicate.attributeType instanceof E.DateAttributeTypeUpdated)return"ByDateAttributeUpdated";throw"unknown date attribute type";default:throw"unknown predicate type"}}},{key:"render",value:function(){var e=this;return this.props.filterExpressions&&0===this.props.filterExpressions.length?f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:this.getSelectValue(),onChange:this.onValueSourceSelected},this.getFields().map((function(e){return f.createElement("option",{key:e.id.value,value:e.id.value},e.entity.caption)})))):f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:this.getSelectValue(),onChange:this.onValueSourceSelected},f.createElement("optgroup",{label:this.props.i18n.t("По полю")},this.getFields().map((function(e){return f.createElement("option",{key:e.id.value,value:"ByField-"+e.id.value},e.entity.caption)}))),!this.props.hideSpecial&&f.createElement("optgroup",{label:this.props.i18n.t("Специальный")},(new Array).concat(Object(M.l)(this.props.notifyTemplatesDescriptionsList).filter((function(e){return e.length>0})).matchWith((function(t){return[f.createElement("option",{key:"ByNotifyTemplate",value:"ByNotifyTemplate"},e.props.i18n.t("по письму"))]}),(function(){return new Array}))),this.getRefFields().length>0&&f.createElement("option",{key:"ByChildForm",value:"ByChildForm"},this.props.i18n.t("По данным ссылки")),f.createElement("option",{key:"ByDateAttributeCreated",value:"ByDateAttributeCreated"},this.props.i18n.t("По дате создания")),f.createElement("option",{key:"ByDateAttributeUpdated",value:"ByDateAttributeUpdated"},this.props.i18n.t("По дате редактирования")))))}}]),t}(f.Component);Ln=$n([m.autobind],Ln);var Gn=Object(h.connect)((function(e,t){return{i18n:e.i18n,form:Object(K.e)(e.forms,t.formId),user:e.user,formFields:e.fields,userCurrentConfigId:e.formRecordsTable.currentConfigId,notifyTemplatesDescriptionsList:e.notifyTemplates.descriptionsList.filter((function(n){return e.user.userRole.map((function(e){return!e.entity.isNotifyTemplateRestricted(t.formId,new E.Id(n.id))})).getOrElse((function(){return!1}))})),dictionaries:e.dictionaries}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplates===t.notifyTemplates},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplatesDescriptionsList===t.notifyTemplatesDescriptionsList}})(Object(X.a)((function(e){e.isTokenChecked&&e.dispatch(Object(Pn.a)(e.formId,new E.ActiveStatusAll))}))(Ln)),An=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Mn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getFieldId",value:function(){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return Object(M.l)(this.props.predicate.field);case E.FilterSubstCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:return Object(M.l)(this.props.predicate.searchField);default:return new M.b}}},{key:"render",value:function(){return f.createElement(Dn,{formId:this.props.formId,sourceFormId:this.props.sourceFormId,fieldId:this.getFieldId(),filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements,filterExpressions:this.props.filterExpressions},f.createElement(Gn,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements,hideSpecial:this.props.hideSpecial,fields:this.props.fields}))}}]),t}(f.Component);Mn=An([m.autobind],Mn);var Nn,_n=Object(h.connect)((function(e){return{i18n:e.i18n}}))(Mn),qn=n(454),Bn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Un=function(e,t){return new E.NotifyTemplateId(e,!1,Object(M.l)(new E.EmailFilterCondition(t,new E.EmailFilterOperatorEq)))},Wn=(Nn={},D()(Nn,"isSent",(function(e){return new E.NotifyTemplateId(e,!1,new M.b)})),D()(Nn,"isNotSent",(function(e){return new E.NotifyTemplateId(e,!0,new M.b)})),D()(Nn,E.EmailOpenedStateOpened.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionOpenedStatus(new E.EmailOpenedStateOpened))})),D()(Nn,E.EmailOpenedStateNotOpened.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionOpenedStatus(new E.EmailOpenedStateNotOpened))})),D()(Nn,E.EmailStatusInbox.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionStatus(new E.EmailStatusInbox))})),D()(Nn,E.EmailStatusSent.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionStatus(new E.EmailStatusSent))})),D()(Nn,E.EmailStatusDraft.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionStatus(new E.EmailStatusDraft))})),D()(Nn,E.EmailStatusRejected.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionStatus(new E.EmailStatusRejected))})),D()(Nn,E.EmailStatusDelivered.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionStatus(new E.EmailStatusDelivered))})),D()(Nn,E.EmailStatusBounce.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionStatus(new E.EmailStatusBounce))})),D()(Nn,E.EmailStatusComplaint.$Type.value,(function(e){return Un(e,new E.EmailFilterExpressionStatus(new E.EmailStatusComplaint))})),Nn),Hn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onNotifyTemplateChanged",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:Z()(this.props.predicate,{tplId:{$set:E.Id.createId(e.target.value).getOrElse((function(){throw"wrong notify template id"}))}})}))}},{key:"onDelete",value:function(){this.props.dispatch(Object(Y.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate}))}},{key:"getOperationValue",value:function(){return!this.props.predicate.idNegation&&this.props.predicate.emailFilter.isEmpty()?"isSent":this.props.predicate.idNegation&&this.props.predicate.emailFilter.isEmpty()?"isNotSent":this.props.predicate.emailFilter.filter((function(e){return e instanceof E.EmailFilterCondition})).filter((function(e){return e.expr instanceof E.EmailFilterExpressionOpenedStatus})).map((function(e){return e.expr})).map((function(e){return e.state.tpe.value})).getOrUndefined()||this.props.predicate.emailFilter.filter((function(e){return e instanceof E.EmailFilterCondition})).filter((function(e){return e.expr instanceof E.EmailFilterExpressionStatus})).map((function(e){return e.expr})).map((function(e){return e.value.tpe.value})).getOrUndefined()}},{key:"onOperationChange",value:function(e){var t=this;Object(ke.b)(e.target.value)(Wn).map((function(e){return e(t.props.predicate.tplId)})).foreach((function(e){t.props.dispatch(Object(Y.i)({filterId:t.props.filterId,parentGroups:t.props.parentGroups,predicate:t.props.predicate,newPredicate:e}))}))}},{key:"renderOperationSelect",value:function(){return f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:this.getOperationValue(),onChange:this.onOperationChange},f.createElement("optgroup",{label:this.props.i18n.t("по статусу отправки")},f.createElement("option",{value:"isSent"},this.props.i18n.t("Отправлено")),f.createElement("option",{value:"isNotSent"},this.props.i18n.t("Не отправлено"))),f.createElement("optgroup",{label:this.props.i18n.t("по статусу доставки")},f.createElement("option",{value:E.EmailStatusInbox.$Type.value},Object(qn.b)(E.EmailStatusInbox.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusSent.$Type.value},Object(qn.b)(E.EmailStatusSent.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusDraft.$Type.value},Object(qn.b)(E.EmailStatusDraft.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusRejected.$Type.value},Object(qn.b)(E.EmailStatusRejected.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusDelivered.$Type.value},Object(qn.b)(E.EmailStatusDelivered.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusBounce.$Type.value},Object(qn.b)(E.EmailStatusBounce.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusComplaint.$Type.value},Object(qn.b)(E.EmailStatusComplaint.$Type,this.props.i18n.t))),f.createElement("optgroup",{label:this.props.i18n.t("по статусу открытия")},f.createElement("option",{value:E.EmailOpenedStateOpened.$Type.value},this.props.i18n.t("Открыто")),f.createElement("option",{value:E.EmailOpenedStateNotOpened.$Type.value},this.props.i18n.t("Не открыто")))))}},{key:"renderNotifyTemplateSelect",value:function(){return f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:this.props.predicate.tplId.value,onChange:this.onNotifyTemplateChanged},this.props.notifyTemplatesDescriptionsList.map((function(e){return f.createElement("option",{key:e.id,value:e.id},e.name)}))))}},{key:"render",value:function(){return f.createElement("div",{style:{flex:1,display:"flex",alignItems:"center"}},f.createElement(Gn,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements,fields:this.props.fields}),this.renderOperationSelect(),this.renderNotifyTemplateSelect(),f.createElement(v.a,{onClick:this.onDelete},f.createElement(pe.a,null)))}}]),t}(f.Component);Hn=Bn([m.autobind],Hn);var zn=Object(h.connect)((function(e,t){return{i18n:e.i18n,notifyTemplatesDescriptionsList:e.notifyTemplates.descriptionsList.filter((function(n){return e.user.userRole.map((function(e){return!e.entity.isNotifyTemplateRestricted(t.formId,new E.Id(n.id))})).getOrElse((function(){return!1}))}))}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplates===t.notifyTemplates},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplatesDescriptionsList===t.notifyTemplatesDescriptionsList}})(Hn),Zn=n(39),Jn=n(2202),Kn=n(2492),Yn=n.n(Kn),Qn=n(237),Xn=n.n(Qn),er=n(109),tr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},nr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){var e=this.props.fields.name;return f.createElement("form",null,f.createElement(oe.a,{fullWidth:!0,autoFocus:!0,style:{marginBottom:"15px"},value:e.value,onChange:e.onChange,label:this.props.i18n.t("Название"),error:e.touched&&e.error,helperText:e.touched&&Object(M.l)(e.error).map((function(e){return e})).getOrNull()}),f.createElement(Rr,{formId:this.props.formId,filterId:this.props.fields.filterId.value,initialValue:this.props.fields.filter.value?Object(M.l)(this.props.fields.filter.value):new M.b}))}}]),t}(f.Component);nr=tr([m.autobind],nr);var rr=Object(h.connect)((function(e){return{i18n:e.i18n}}),(function(e){return{}}),(function(e,t,n){return Object.assign({},e,n)}),{withRef:!0})(Object(er.reduxForm)({form:"newFilterForm",fields:["name","filterId","filter"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение!")),n}})(nr)),ir=n(51),or=n(831),ar=n(621),sr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},lr=function(e){function t(){i()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.handleKeyDown=function(t){"Insert"===t.key&&e.onCreateRequest()},e}return p()(t,e),a()(t,[{key:"handleSubmit",value:function(e,t,n){var r=this;return new Promise((function(i,o){return e.then((function(e){i(e),r.props.dispatch(Object(ir.f)(r.props.i18n.t(("create"===t?"Создание":"Сохранение")+" успешно завершено"))),r.props.dispatch(Object(Q.b)()),r.handleClose(n)})).catch((function(e){o(e),r.props.dispatch(Object(ir.f)(r.props.i18n.t(("create"===t?"Создание":"Сохранение")+" завершилось ошибкой")))}))}))}},{key:"openEditForm",value:function(e,t,n){var r=this,i=void 0,o=this.props.openDialog(e,f.createElement(rr,{ref:function(e){return i=Object(Kt.i)(e).flatMap((function(e){return Object(Kt.i)(e.wrappedInstance)}))},formId:this.props.formId,initialValues:n,onSubmit:t}),[f.createElement(y.a,{onClick:function(){return r.handleClose(o)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(or.a,{variant:"contained",color:"primary",onClick:function(){return i.map((function(e){return e.submit()}))},formName:"newFilterForm"},this.props.i18n.t("Сохранить"))]);return o}},{key:"handleClose",value:function(e){this.props.handleDialogClose(e)}},{key:"onCreateRequest",value:function(){var e=this,t=this.openEditForm(this.props.i18n.t("Новый фильтр"),(function(n){return e.handleSubmit(Object(j.b)(e.props.filtersForm,n.filterId).flatMap((function(t){return Object(K.e)(e.props.forms,e.props.formId).map((function(e){return Object(Q.f)(e.id,[].concat(P()(e.entity.filters),[new E.FilterContainer(n.name,t)]))}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"create",t)}),{filterId:new E.Id(Zn.v4())})}},{key:"onEditRequest",value:function(e,t){var n=this,r=this.openEditForm(this.props.i18n.t("Редактировать фильтр"),(function(e){return n.handleSubmit(Object(j.b)(n.props.filtersForm,e.filterId).flatMap((function(r){return Object(K.e)(n.props.forms,n.props.formId).map((function(n){return Object(Q.f)(n.id,[].concat(P()(n.entity.filters.slice(0,t)),[new E.FilterContainer(e.name,r)],P()(n.entity.filters.slice(t+1))))}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"update",r)}),{name:e.name,filterId:new E.Id(Zn.v4()),filter:e.filter})}},{key:"onUserFilterCreateRequest",value:function(){var e=this,t=this.openEditForm(this.props.i18n.t("Новый фильтр"),(function(n){return e.handleSubmit(Object(j.b)(e.props.filtersForm,n.filterId).map((function(t){return e.props.dispatch(Object(ar.d)({filter:new E.FilterContainer(n.name,t)})),new Promise((function(e,t){return e()}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"create",t)}),{filterId:new E.Id(Zn.v4())})}},{key:"onUserFilterEditRequest",value:function(e,t){var n=this,r=this.openEditForm(this.props.i18n.t("Редактировать фильтр"),(function(e){return n.handleSubmit(Object(j.b)(n.props.filtersForm,e.filterId).map((function(r){return n.props.dispatch(Object(ar.f)({idx:t,filter:new E.FilterContainer(e.name,r)})),new Promise((function(e,t){return e()}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"update",r)}),{name:e.name,filterId:new E.Id(Zn.v4()),filter:e.filter})}},{key:"onDelete",value:function(e){var t=this;Object(K.e)(this.props.forms,this.props.formId).map((function(n){return Object(Q.f)(n.id,[].concat(P()(n.entity.filters.slice(0,e)),P()(n.entity.filters.slice(e+1)))).then((function(e){return t.props.dispatch(Object(Q.b)())}))}))}},{key:"onUserFilterDelete",value:function(e){this.props.dispatch(Object(ar.e)(e))}},{key:"renderContents",value:function(){var e=this;if(this.props.showSystemFilters){var t=Object(K.e)(this.props.forms,this.props.formId).map((function(e){return e.entity.filters})).getOrElse((function(){return[]}));return f.createElement(f.Fragment,null,f.createElement(H.b,null,f.createElement(y.a,{variant:"contained",onClick:this.onCreateRequest,color:"primary",disabled:this.props.actionsDisabled},this.props.i18n.t("Создать"))),f.createElement(N.a,{showId:!0,withActions:!0,error:this.props.forms.error,onRecordSelected:this.props.actionsDisabled?function(){}:this.onEditRequest,fetching:this.props.forms.fetching,empty:0===t.length,headers:[{id:"filterName",title:this.props.i18n.t("Название")}],rows:t.map((function(t,n){return{id:n.toString(),payload:t,fields:[t.name],buttons:[f.createElement(v.a,{disabled:e.props.actionsDisabled,style:_.d,key:"edit",onClick:function(r){r.stopPropagation(),e.onEditRequest(t,n)}},f.createElement(Xn.a,{style:_.e})),f.createElement(v.a,{disabled:e.props.actionsDisabled,style:_.d,key:"delete",onClick:function(t){t.stopPropagation(),e.onDelete(n)}},f.createElement(dn.a,{style:_.e}))]}}))}))}if(this.props.showUserFilters){var n=this.props.userFilters.filters.filter((function(t){return Object(Kt.d)(t.filter.conditions).flatMap((function(t){return Object(K.e)(e.props.forms,e.props.formId).flatMap((function(n){return e.props.dispatch(Object(Re.b)(n.id,t.field))}))})).nonEmpty()}));return f.createElement(f.Fragment,null,f.createElement(H.b,null,f.createElement(y.a,{variant:"contained",onClick:this.onUserFilterCreateRequest,color:"primary"},this.props.i18n.t("Создать"))),f.createElement(N.a,{showId:!0,withActions:!0,error:new Kt.a,onRecordSelected:this.onUserFilterEditRequest,fetching:!1,empty:0===n.length,headers:[{id:"filterName",title:this.props.i18n.t("Название")}],rows:n.map((function(t,n){return{id:n.toString(),payload:t,fields:[t.name],buttons:[f.createElement(v.a,{style:_.d,key:"edit",onClick:function(r){r.stopPropagation(),e.onUserFilterEditRequest(t,n)}},f.createElement(Xn.a,{style:_.e})),f.createElement(v.a,{style:_.d,key:"delete",onClick:function(t){t.stopPropagation(),e.onUserFilterDelete(n)}},f.createElement(dn.a,{style:_.e}))]}}))}))}}},{key:"render",value:function(){return f.createElement("div",{onKeyDown:this.handleKeyDown,style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},this.renderContents())}}]),t}(f.Component);lr=sr([m.autobind],lr);var ur=Object(h.connect)((function(e){return{i18n:e.i18n,forms:e.forms,filtersForm:e.filtersForm,userFilters:e.userFilters}}))(Object(he.a)(lr)),pr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},cr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFilterTemplateEditRequest",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Пользовательские фильтры"),f.createElement(ur,{formId:this.props.formId,showUserFilters:!0,actionsDisabled:!0}),[f.createElement(y.a,{key:"close",variant:"contained",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть"))]);this.props.closePopover()}},{key:"onFilterTemplateChanged",value:function(e){this.props.dispatch(Object(Y.k)({filterId:this.props.filterId,filter:e})),this.props.closePopover()}},{key:"handleFiltersLibraryClick",value:function(e){var t=this,n=Object(K.e)(this.props.forms,this.props.formId).map((function(e){return e.entity.filters})).getOrElse((function(){return[]})).map((function(e){return f.createElement(ne.a,{key:Zn.v4(),value:e.name,onClick:function(){return t.onFilterTemplateChanged(e.filter)}},e.name)})),r=this.props.userFilters.filters.filter((function(e){return Object(M.g)(e.filter.conditions).flatMap((function(e){return Object(K.e)(t.props.forms,t.props.formId).flatMap((function(n){return t.props.dispatch(Object(Re.b)(n.id,e.field))}))})).nonEmpty()})).map((function(e){return f.createElement(ne.a,{key:Zn.v4(),value:e.name,onClick:function(){return t.onFilterTemplateChanged(e.filter)}},e.name)}));this.props.openPopover(Object(M.l)(e.currentTarget),f.createElement(f.Fragment,null,f.createElement(ne.a,null,f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Системные"),":")),n,f.createElement(ne.a,null,f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Пользовательские"),":")),r,f.createElement(ne.a,{onClick:this.onFilterTemplateEditRequest},f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Отредактировать")))))}},{key:"render",value:function(){return f.createElement(Jn.a,{title:this.props.i18n.t("Библиотека фильтров")},f.createElement(v.a,{onClick:this.handleFiltersLibraryClick},f.createElement(Yn.a,null)))}}]),t}(f.Component);cr=pr([m.autobind],cr);var dr=Object(h.connect)((function(e,t){return{i18n:e.i18n,userFilters:e.userFilters,forms:e.forms}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.userFilters===t.userFilters&&e.currentForm===t.currentForm}})(Object(Ie.a)(Object(he.a)(cr))),fr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},hr=new E.Id(Zn.v4()),mr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFieldChange",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:new E.ChildFilter(new E.Id(e.target.value),new E.FilterGroupCondition([],new E.FilterPredicateAnd))}))}},{key:"onDelete",value:function(){this.props.dispatch(Object(Y.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate}))}},{key:"getRefFormId",value:function(){return Object(F.c)(this.props.formFields,this.props.predicate.parentRefField).matchWith((function(e){return e.entity.valueType.family}),(function(){throw"wrong form id"}))}},{key:"getRefFields",value:function(){return this.props.fields.filter((function(e){return e.entity.valueType.tpe.value===E.ValueTypeObjectRefs.$Type.value}))}},{key:"onEditFilter",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Редактирование фильтрации"),f.createElement("div",null,f.createElement("div",{style:{position:"absolute",right:0,top:0,zIndex:10}},f.createElement(dr,{filterId:hr,formId:this.getRefFormId()})),f.createElement(Rr,{initialValue:Object(M.l)(this.props.predicate.childFilter),filterId:hr,formId:this.getRefFormId(),initFilter:!0})),[f.createElement(y.a,{key:"close",variant:"contained",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"5px"}},this.props.i18n.t("Закрыть")),f.createElement(y.a,{key:"save",variant:"contained",color:"primary",onClick:function(){return e.handleFilterSave(t)}},this.props.i18n.t("Сохранить"))])}},{key:"handleFilterSave",value:function(e){var t=this;Object(j.b)(this.props.filtersForm,hr).map((function(n){t.props.dispatch(Object(Y.i)({filterId:t.props.filterId,parentGroups:t.props.parentGroups,predicate:t.props.predicate,newPredicate:Z()(t.props.predicate,{childFilter:{$set:n}})})),t.props.handleDialogClose(e)}))}},{key:"render",value:function(){return f.createElement(te.a,{style:{display:"flex",padding:"10px 10px 10px 25px",flexWrap:"nowrap"}},f.createElement(Gn,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements,fields:this.props.fields}),f.createElement(se.a,{style:{flex:1}},f.createElement(ae.a,{native:!0,value:this.props.predicate.parentRefField.value,onChange:this.onFieldChange},this.getRefFields().map((function(e){return f.createElement("option",{key:e.id.value,value:e.id.value},e.entity.caption)})))),f.createElement(y.a,{variant:"contained",onClick:this.onEditFilter,style:{marginLeft:"5px"}},this.props.i18n.t("Редактировать фильтр")),f.createElement(v.a,{onClick:this.onDelete},f.createElement(pe.a,null)))}}]),t}(f.Component);mr=fr([m.autobind],mr);var yr=Object(h.connect)((function(e,t){return{i18n:e.i18n,formFields:e.fields,filtersForm:e.filtersForm}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.fields===t.fields&&e.filtersForm===t.filtersForm},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.formFields===t.formFields&&e.filtersForm===t.filtersForm}})(Object(he.a)(mr)),vr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},gr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onDelete",value:function(){this.props.dispatch(Object(Y.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate}))}},{key:"onStartChange",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:Z()(this.props.predicate,{start:{$set:Object(M.l)(e).map((function(e){return e.getTime()}))}})}))}},{key:"onEndChange",value:function(e){this.props.dispatch(Object(Y.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:Z()(this.props.predicate,{end:{$set:Object(M.l)(e).map((function(e){return e.getTime()}))}})}))}},{key:"render",value:function(){return f.createElement("div",{style:{flex:1,display:"flex",alignItems:"center"}},f.createElement(Gn,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements,fields:this.props.fields}),f.createElement(rn,{style:{flex:1},cancelLabel:this.props.i18n.t("Отмена"),label:this.props.i18n.t("С"),okLabel:this.props.i18n.t("OK"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),value:this.props.predicate.start.getOrNull(),onChange:this.onStartChange,leftArrowIcon:f.createElement(Mt.a,null),rightArrowIcon:f.createElement(_t.a,null),dateRangeIcon:f.createElement(Bt.a,null),timeIcon:f.createElement(Wt.a,null)}),f.createElement(rn,{style:{flex:1},cancelLabel:this.props.i18n.t("Отмена"),label:this.props.i18n.t("По"),okLabel:this.props.i18n.t("OK"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),value:this.props.predicate.end.getOrNull(),onChange:this.onEndChange,leftArrowIcon:f.createElement(Mt.a,null),rightArrowIcon:f.createElement(_t.a,null),dateRangeIcon:f.createElement(Bt.a,null),timeIcon:f.createElement(Wt.a,null)}),f.createElement(v.a,{onClick:this.onDelete},f.createElement(pe.a,null)))}}]),t}(f.Component);gr=vr([m.autobind],gr);var br,Or=Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(gr),Er=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Fr=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},jr=br=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={menuAnchorElement:new M.b},n}return p()(t,e),a()(t,[{key:"onGroupAdd",value:function(){this.props.dispatch(Object(Y.n)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,group:this.props.group,predicate:new E.FilterGroupCondition([],new E.FilterPredicateAnd)}))}},{key:"onGroupDelete",value:function(){this.props.dispatch(Object(Y.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.group}))}},{key:"getInitialValue",value:function(e){switch(e.valueType.tpe.value){case E.ValueTypeStr.$Type.value:return new E.ValueStr("");case E.ValueTypeNumber.$Type.value:return new E.ValueNumber(0);case E.ValueTypeValuesList.$Type.value:return new E.ValueList([Object(M.i)(e.valueType.values,0).getOrElse((function(){return new E.ValueStr("")}))]);case E.ValueTypeFileList.$Type.value:return new E.ValueList([]);case E.ValueTypeObjectRefs.$Type.value:return new E.ValueObjectRefs([]);default:throw"Unknown value type"}}},{key:"getInitialExpression",value:function(e){switch(e.valueType.tpe.value){case E.ValueTypeValuesList.$Type.value:return new E.FilterExpressionContains;default:return new E.FilterExpressionEq}}},{key:"valueTypeFilter",value:function(e){return e.valueType.tpe.value===E.ValueTypeStr.$Type.value||e.valueType.tpe.value===E.ValueTypeNumber.$Type.value||e.valueType.tpe.value===E.ValueTypeValuesList.$Type.value||e.valueType.tpe.value===E.ValueTypeFileList.$Type.value||e.valueType.tpe.value===E.ValueTypeObjectRefs.$Type.value}},{key:"addConditionElement",value:function(){var e=this;Object(M.g)(this.props.fields.filter((function(t){return e.valueTypeFilter(t.entity)}))).map((function(t){e.props.dispatch(Object(Y.n)({filterId:e.props.filterId,parentGroups:e.props.parentGroups,group:e.props.group,predicate:new E.FilterCondition(t.id,e.getInitialExpression(t.entity),e.getInitialValue(t.entity),Object(M.l)(t.entity.valueType.tpe.value.replace("forms.ValueType.","forms.package$ValueType$")))}))})).getOrElse((function(){e.props.dispatch(Object(ir.f)(e.props.i18n.t("Отсутствуют доступные для фильтрации поля")))}))}},{key:"onConditionAdd",value:function(){this.addConditionElement()}},{key:"onGroupClick",value:function(e){0!==this.props.parentGroups.length&&e.target===ee.findDOMNode(this)&&this.props.dispatch(Object(Y.m)({filterId:this.props.filterId,selectedGroup:this.props.group}))}},{key:"onOperandAndSelect",value:function(){this.props.dispatch(Object(Y.l)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,group:this.props.group,expression:new E.FilterPredicateAnd}))}},{key:"onOperandOrSelect",value:function(){this.props.dispatch(Object(Y.l)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,group:this.props.group,expression:new E.FilterPredicateOr}))}},{key:"renderPredicate",value:function(e){switch(e.tpe.value){case E.FilterGroupCondition.$Type.value:return f.createElement(Tr,{formId:this.props.formId,sourceFormId:this.props.sourceFormId,filterId:this.props.filterId,parentGroups:[].concat(P()(this.props.parentGroups),[this.props.group]),group:e,selectedGroup:this.props.selectedGroup,selectedCondition:this.props.selectedCondition,displayFieldElements:this.props.displayFieldElements,filterExpressions:this.props.filterExpressions,fields:this.props.fields});case E.FilterCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:case E.FilterSubstCondition.$Type.value:return f.createElement(_n,{formId:this.props.formId,sourceFormId:this.props.sourceFormId,filterId:this.props.filterId,parentGroups:[].concat(P()(this.props.parentGroups),[this.props.group]),predicate:e,selectedCondition:this.props.selectedCondition,displayFieldElements:this.props.displayFieldElements,filterExpressions:this.props.filterExpressions,hideSpecial:this.props.hideSpecial,fields:this.props.fields});case E.NotifyTemplateId.$Type.value:return f.createElement(zn,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:[].concat(P()(this.props.parentGroups),[this.props.group]),predicate:e,displayFieldElements:this.props.displayFieldElements,fields:this.props.fields});case E.ChildFilter.$Type.value:return f.createElement(yr,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:[].concat(P()(this.props.parentGroups),[this.props.group]),predicate:e,displayFieldElements:this.props.displayFieldElements,fields:this.props.fields});case E.DateInterval.$Type.value:return f.createElement(Or,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:[].concat(P()(this.props.parentGroups),[this.props.group]),predicate:e,fields:this.props.fields});default:return f.createElement("div",null,this.props.i18n.t("Неизвестный тип предиката"))}}},{key:"onMenuClosed",value:function(){this.setState({menuAnchorElement:new M.b})}},{key:"onMenuRequested",value:function(e){this.setState({menuAnchorElement:Object(M.l)(Object(ee.findDOMNode)(e.currentTarget))})}},{key:"render",value:function(){var e=this,t=0===this.props.parentGroups.length?{boxShadow:"none",paddingTop:"3px"}:{padding:"10px 10px 10px 40px"};return f.createElement(te.a,{style:t,onClick:this.onGroupClick},this.props.group.conditions.filter((function(e){return!(e instanceof E.AllowedForm)})).map((function(t,n,r){return f.createElement("div",{key:n,style:{position:"relative",marginBottom:"10px"}},e.renderPredicate(t),r.length>1&&n!==r.length-1&&f.createElement(te.a,{square:!1,style:{position:"absolute",left:"-28px",bottom:"-30px",width:"56px",height:"56px",zIndex:1,textAlign:"center",lineHeight:"50px",backgroundColor:br.getOperandColor(e.props.group.predicate)}},f.createElement(v.a,{onClick:e.onMenuRequested},f.createElement(ie.a,{style:{color:"#fff"}},br.getOperandCaption(e.props.group.predicate))),f.createElement(re.a,{anchorEl:e.state.menuAnchorElement.getOrUndefined(),open:e.state.menuAnchorElement.nonEmpty(),onClose:e.onMenuClosed},f.createElement(ne.a,{onClick:e.onOperandAndSelect},e.props.i18n.t("&")),f.createElement(ne.a,{onClick:e.onOperandOrSelect},e.props.i18n.t("|")))))})),f.createElement("div",{style:{position:"relative"}},f.createElement(y.a,{variant:"contained",onClick:this.onGroupAdd},this.props.i18n.t("Добавить группу")),f.createElement(y.a,{variant:"contained",onClick:this.onConditionAdd,style:{marginLeft:"10px"}},this.props.i18n.t("Добавить условие")),0!==this.props.parentGroups.length&&f.createElement(y.a,{variant:"contained",onClick:this.onGroupDelete,style:{position:"absolute",right:0}},this.props.i18n.t("Удалить"))))}}],[{key:"getOperandCaption",value:function(e){switch(e.tpe){case E.FilterPredicateAnd.$Type:return"&";case E.FilterPredicateOr.$Type:return"|"}}},{key:"getOperandColor",value:function(e){switch(e.tpe){case E.FilterPredicateAnd.$Type:return"#4CAF50";case E.FilterPredicateOr.$Type:return"#2196F3"}}}]),t}(f.Component);jr=br=Er([m.autobind,Fr("design:paramtypes",[Object])],jr);var Tr=Object(h.connect)((function(e){return{i18n:e.i18n}}))(jr),Cr=Tr,Ir=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},kr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFilterConfigRequested",value:function(){this.props.dispatch(Object(Y.k)({filterId:this.props.filterId,filter:new E.FilterGroupCondition([],new E.FilterPredicateAnd)}))}},{key:"componentDidMount",value:function(){var e=this;this.props.initFilter&&this.props.dispatch(Object(Y.k)({filterId:this.props.filterId,filter:new E.FilterGroupCondition([],new E.FilterPredicateAnd)})),Object(M.l)(this.props.initialValue).getOrElse((function(){return Object(M.l)(e.props.value).getOrElse((function(){return Object(M.l)(new E.FilterGroupCondition([],new E.FilterPredicateAnd))}))})).map((function(t){e.props.dispatch(Object(Y.k)({filterId:e.props.filterId,filter:t}))}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;Object(M.l)(e.initialValue).foreach((function(e){Object(J.a)(t.props.initialValue,e)||e.foreach((function(e){return t.props.dispatch(Object(Y.k)({filterId:t.props.filterId,filter:e}))}))})),Object(M.l)(this.props.onChange).foreach((function(n){var r=Object(M.j)(e.filtersForm.filter,e.filterId.value);Object(J.a)(Object(M.j)(t.props.filtersForm.filter,t.props.filterId.value),r)||n(r)})),this.props.value!==e.value&&Object(M.l)(e.value).foreach((function(n){Object(J.a)(Object(M.j)(t.props.filtersForm.filter,t.props.filterId.value),n)||n.foreach((function(n){return t.props.dispatch(Object(Y.k)({filterId:e.filterId,filter:n}))}))}))}},{key:"getFields",value:function(){var e=this,t=E.Role.getCurrentConfigId(this.props.user.userRole,this.props.form,this.props.userCurrentConfigId).getOrNull(),n=this.props.form.flatMap((function(e){return Object(M.g)(e.entity.dataListView.configs.filter((function(e){return e.id.id===t})))})).map((function(e){return e instanceof E.DataListConfigTable})).getOrElse((function(){return!1})),r=Object(F.f)(this.props.fields,this.props.formId).getOrElse((function(){return[]})).filter((function(e){return e.entity.valueType.tpe.value!==E.ValueTypeFormDataAttribute.$Type.value}));if(n){var i=this.props.form.map((function(e){return Object(M.g)(e.entity.dataListView.configs.filter((function(e){return e.id.id===t})).map((function(e){return e.filterableFieldIds}))).getOrElse((function(){return[]}))})).getOrElse((function(){return[]})).map((function(e,t){return Object.assign(Object.assign({},e),{position:t})}));return r.filter((function(t){return!e.props.displayFieldElements||e.props.displayFieldElements.filter((function(e){return e.dataOutput.map((function(e){return e.formField.value})).getOrNull()===t.id.value})).length>0})).filter((function(e){return Object(M.l)(i.find((function(t){return t.fieldId.value===e.id.value}))).getOrNull()})).map((function(e){return Object.assign(Object.assign({},e),{position:Object(M.l)(i.find((function(t){return t.fieldId.value===e.id.value}))).map((function(e){return e.position})).getOrElse((function(){return 0}))})})).sort((function(e,t){return e.position-t.position}))}return r}},{key:"render",value:function(){var e=this;return f.createElement("div",null,Object(M.j)(this.props.filtersForm.filter,this.props.filterId.value).map((function(t){return f.createElement(Cr,{formId:e.props.formId,sourceFormId:e.props.sourceFormId,filterId:e.props.filterId,parentGroups:[],fields:e.getFields(),group:t,selectedGroup:Object(j.d)(e.props.filtersForm,e.props.filterId),selectedCondition:Object(j.c)(e.props.filtersForm,e.props.filterId),displayFieldElements:e.props.displayFieldElements,filterExpressions:e.props.filterExpressions,hideSpecial:e.props.hideSpecial})})).getOrElse((function(){return e.props.initFilter?f.createElement("div",null):f.createElement(Cr,{formId:e.props.formId,fields:e.getFields(),sourceFormId:e.props.sourceFormId,filterId:e.props.filterId,parentGroups:[],group:new E.FilterGroupCondition([],new E.FilterPredicateAnd),selectedGroup:Object(j.d)(e.props.filtersForm,e.props.filterId),selectedCondition:Object(j.c)(e.props.filtersForm,e.props.filterId),displayFieldElements:e.props.displayFieldElements,filterExpressions:e.props.filterExpressions,hideSpecial:e.props.hideSpecial})})))}}]),t}(f.Component);kr=Ir([m.autobind],kr);var Rr=Object(h.connect)((function(e,t){return{dictionaries:e.dictionaries,filtersForm:e.filtersForm,form:Object(K.e)(e.forms,t.formId),user:e.user,fields:e.fields,userCurrentConfigId:e.formRecordsTable.currentConfigId,i18n:e.i18n}}))(Object(X.a)((function(e){e.isTokenChecked&&(e.dictionaries.dictionariesFetchedForms[e.formId.value]||e.dictionaries.listFetching||e.dispatch(Object(Q.a)(e.formId)))}),(function(){}),(function(e,t){e.isTokenChecked&&(Object(M.j)(e.dictionaries.dictionariesFetchedForms,e.formId.value).getOrElse((function(){return!0}))||e.dictionaries.listFetching||e.dispatch(Object(Q.a)(e.formId)))}))(kr)),Sr=n(54),wr=n(212);n.d(t,"filterId",(function(){return Pr}));var Dr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},xr=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Pr=new E.Id(Zn.v4()),$r=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={currentPage:0,rowPerPage:20,searchField:new M.b,searchValue:new M.b,filter:new M.b,filterEnabled:!1,markedFormRecords:[],processedFormRecords:[]},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.outputValue.filter((function(e){return e.value.tpe.value===E.ValueObjectRefs.$Type.value})).map((function(e){return e.value.id.length})),n=e.outputValue.filter((function(e){return e.value.tpe.value===E.ValueObjectRefs.$Type.value})).map((function(e){return e.value.id.length}));Object(M.h)(n,t)||this.setState(Z()(this.state,{processedFormRecords:{$set:[]}}))}},{key:"combineFilter",value:function(e){return this.state.filterEnabled&&this.state.filter.nonEmpty?this.state.filter.map((function(t){return e.map((function(e){return new E.FilterGroupCondition([e,t],new E.FilterPredicateAnd)})).getOrElse((function(){return t}))})):e}},{key:"fetchFormRecords",value:function(e){var t=this;Object(W.d)(new E.DataPageRequest(this.state.currentPage,this.state.rowPerPage,this.props.childFormId,this.combineFilter(e||new M.b))).then((function(e){t.props.display.control.foreach((function(n){t.props.dispatch(Object(q.j)({displayId:t.props.display.id,value:t.props.dispatch(Object(wr.c)(n,t.props.childFormId,e.page.records,e.page.total,t.props.objRefsField.entity.valueType))}))}))})).catch((function(e){return console.error("Failed to resolve input data",e)}))}},{key:"onFirstPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:0}}),(function(){return e.fetchFormRecords()}))}},{key:"onLastPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:Math.ceil(this.props.inputValue.map((function(e){return e.total})).getOrElse((function(){return 0}))/this.state.rowPerPage)-1}}),(function(){return e.fetchFormRecords()}))}},{key:"onNextPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:this.state.currentPage+1}}),(function(){return e.fetchFormRecords()}))}},{key:"onPrevPage",value:function(){var e=this;this.setState(Z()(this.state,{currentPage:{$set:this.state.currentPage-1}}),(function(){return e.fetchFormRecords()}))}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(Z()(this.state,{rowPerPage:{$set:e}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchFieldChange",value:function(e){var t=this;this.setState(Z()(this.state,{searchField:{$set:new M.c(new E.Id(e))}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchValueChange",value:function(e){var t=this;this.setState(Z()(this.state,{searchValue:{$set:new M.c(e.target.value)}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchRecords",value:function(){var e=this;this.state.searchField.foreach((function(t){e.state.searchValue.foreach((function(n){var r=new E.FilterGroupCondition([new E.FilterCondition(t,new E.FilterExpressionContains,new E.ValueStr(n))],new E.FilterPredicateAnd);e.fetchFormRecords(new M.c(r))}))}))}},{key:"onFilterSave",value:function(e){var t=this;this.setState(Z()(this.state,{filter:{$set:this.props.filterForm}}),(function(){return t.props.handleDialogClose(e)}))}},{key:"onOpenFilterConfiguration",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Редактирование фильтрации"),f.createElement("div",null,f.createElement("div",{style:{position:"absolute",right:0,top:0,zIndex:10}},f.createElement(dr,{filterId:Pr,formId:this.props.childFormId})),f.createElement(Rr,{initialValue:this.state.filter,filterId:Pr,formId:this.props.childFormId})),[f.createElement(y.a,{variant:"contained",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"5px"}},this.props.i18n.t("Закрыть")),f.createElement(y.a,{variant:"contained",color:"primary",onClick:function(){return e.onFilterSave(t)}},this.props.i18n.t("Сохранить"))])}},{key:"onFilterToggle",value:function(){var e=this;this.setState(Z()(this.state,{filterEnabled:{$set:!this.state.filterEnabled}}),(function(){return e.fetchFormRecords()}))}},{key:"isValueDeleted",value:function(e){return e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusDeleted.$Type.value||e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusNominalDeleted.$Type.value}},{key:"onSelectAll",value:function(e,t){var n=this,r=this.props.inputValue.map((function(e){return e.displayValues})).getOrElse((function(){return[]})).filter((function(e){return e instanceof S.O})).filter((function(e){return!n.isValueDeleted(e)}));t?this.setState(Z()(this.state,{markedFormRecords:{$set:this.state.markedFormRecords.concat(r.filter((function(e){return 0===n.state.markedFormRecords.filter((function(t){return t.value===e.id.value})).length})).map((function(e){return e.id})))}})):this.setState(Z()(this.state,{markedFormRecords:{$set:this.state.markedFormRecords.filter((function(e){return 0===r.filter((function(t){return t.id.value===e.value})).length}))}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex((function(t){return t.value===e}));t>=0?this.setState(Z()(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(Z()(this.state,{markedFormRecords:{$push:[new E.Id(e)]}}))}},{key:"processFormRecords",value:function(e,t){var n=this;this.setState(Z()(this.state,{processedFormRecords:{$set:e.map((function(e){return e.id}))}}),(function(){t.finally((function(){n.setState(Z()(n.state,{processedFormRecords:{$set:[]}}))}))}))}},{key:"onMarkedFormRecordsAdd",value:function(){var e=this,t=this.props.inputValue.map((function(e){return e.displayValues})).getOrElse((function(){return[]})).filter((function(e){return e instanceof S.O})).filter((function(t){return e.state.markedFormRecords.filter((function(e){return e.value===t.id.value})).length>0})).filter((function(t){return 0===e.props.value.map((function(e){return e.id})).getOrElse((function(){return[]})).filter((function(e){return e.value===t.id.value})).length})).map((function(e){return e}));this.processFormRecords(t,this.props.onObjRefsAdd(t))}},{key:"onObjRefAdd",value:function(e){this.processFormRecords([e],this.props.onObjRefAdd(e))}},{key:"onObjRefDelete",value:function(e){var t=this;Object(M.l)(this.props.onObjRefDelete).foreach((function(n){t.processFormRecords([e],n(e))}))}},{key:"render",value:function(){var e=this,t=this.state.filterEnabled?f.createElement(I,{color:"#E91E63"}):f.createElement(k,null);return f.createElement("div",{style:{flexDirection:"column",width:"100%",display:"flex",minHeight:0}},f.createElement(H.b,{leftButtonGroup:[f.createElement(v.a,{key:"massAdding",onClick:this.onMarkedFormRecordsAdd},this.state.processedFormRecords.length>1?f.createElement(g.a,null):f.createElement(O.a,null)),f.createElement(v.a,{key:"filter",onClick:this.onFilterToggle},t),f.createElement(v.a,{key:"filter-set",onClick:this.onOpenFilterConfiguration},f.createElement(R,null))]}),f.createElement(U,{childFormId:this.props.childFormId,parentFormId:this.props.parentFormId,display:this.props.display,displayFields:this.props.displayFields,displayFieldsForAdding:this.props.displayFieldsForAdding,blockRendererId:this.props.blockRendererId,output:this.props.output,input:this.props.input,onObjRefAdd:this.onObjRefAdd,onObjRefDelete:this.onObjRefDelete,onSelectAll:this.onSelectAll,onRecordMarked:this.onRecordMarked,markedFormRecords:this.state.markedFormRecords,processedFormRecords:this.state.processedFormRecords,onlyOneChoice:this.props.onlyOneChoice}),f.createElement(H.a,{nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.props.inputValue.map((function(e){return e.total})).getOrElse((function(){return 0})),shouldShowMassActions:!1,massActionsComponents:[],searchField:this.state.searchField.map((function(e){return e.value})).getOrNull(),searchFields:this.props.childFields.getOrElse((function(){return[]})).filter((function(t){return e.props.displayFields.filter((function(e){return e.tpe.value===E.DisplayFieldByField.$Type.value})).filter((function(e){return t.id.value===e.fieldId.value})).length>0})),onSearchRecords:this.onSearchRecords,onSearchFieldChange:this.onSearchFieldChange,searchValue:this.state.searchValue.getOrElse((function(){return""})),onSearchValueChange:this.onSearchValueChange}))}}]),t}(f.Component);$r=Dr([m.autobind,xr("design:paramtypes",[Object])],$r);t.default=Object(h.connect)((function(e,t){return{i18n:e.i18n,childFields:Object(F.f)(e.fields,t.childFormId),filterForm:Object(j.b)(e.filtersForm,Pr),inputValue:Object(G.c)(e.dataInputs,t.display.id).filter((function(e){return e instanceof q.d})).map((function(e){return e})),outputValue:Object(T.g)(e.dataOutput,t.blockRendererId,t.output),systemFilters:e.currentForm.data.map((function(e){return e.entity.filters})),userFilters:e.userFilters.filters,value:Object(T.g)(e.dataOutput,t.blockRendererId,t.output).map((function(e){return e.value})).filter((function(e){return e.tpe.value===E.ValueObjectRefs.$Type.value}))}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataInputs.input===t.dataInputs.input&&e.dataOutput===t.dataOutput&&e.fields.list===t.fields.list&&e.filtersForm===t.filtersForm},areStatePropsEqual:function(e,t){return Object(M.h)(e.filterForm,t.filterForm)&&Object(M.h)(e.value,t.value)&&Object(M.h)(e.outputValue,t.outputValue)&&Object(M.h)(e.inputValue,t.inputValue)&&Object(M.h)(e.childFields,t.childFields)&&e.i18n===t.i18n}})(Object(Sr.a)([function(e){e.dispatch(Object(wr.a)(e.blockRendererId,e.display,e.parentFormId))}],[],[],[])(Object(he.a)($r)))},384:function(e,t,n){"use strict";n.r(t);var r=n(1258);n.d(t,"default",(function(){return r.a}))}}]);