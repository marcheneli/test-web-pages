(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[64],{1449:function(e,t,n){"use strict";n.r(t);var o=n(6),i=n.n(o),a=n(10),r=n.n(a),s=n(7),l=n.n(s),p=n(8),c=n.n(p),h=n(11),d=n.n(h),u=n(2),f=n(14),m=n(2139),g=n(2140),v=n.n(g),y=n(13),E=(n(2141),n(52)),b=n.n(E),R=n(160),C=n.n(R),w=n(190),k=n.n(w),O=n(19),S=n.n(O),j=n(25),$=n.n(j),H=n(241),A=n.n(H),z=n(243),x=n.n(z),_=n(242),W=n.n(_),L=n(261),M=n.n(L),P=n(770),I=n.n(P),D=n(1888),F=n.n(D),T=n(1889),N=n.n(T),V=n(631),U=n.n(V),B=n(414),q=n.n(B),G=n(1922),J=n.n(G),Q=n(1923),X=n.n(Q),Z=n(2145),K=n.n(Z),Y=n(94),ee=n.n(Y),te=function(e){return u.createElement(ee.a,Object.assign({},e),u.createElement("path",{d:"M10.59,12L14.59,8H11V6H18V13H16V9.41L12,13.41V16H20V4H8V12H10.59M22,2V18H12V22H2V12H6V2H22M10,14H4V20H10V14Z"}))},ne=n(0),oe=n(3),ie=n(2016),ae=(n(2017),function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r}),re=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},se=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isLoad:!1},n}return c()(t,e),r()(t,[{key:"onLoad",value:function(){this.setState(oe(this.state,{isLoad:{$set:!0}}))}},{key:"componentDidMount",value:function(){ie.set({width:640,height:360,dest_width:1280,dest_height:720,enable_flash:!0}),ie.attach("#webcam_preview"),ie.on("load",this.onLoad)}},{key:"componentWillUnmount",value:function(){ie.off("load",this.onLoad),ie.reset()}},{key:"render",value:function(){return u.createElement("div",{style:{textAlign:"center",position:"relative"}},!this.state.isLoad&&u.createElement(C.a,{size:100,style:{position:"absolute",left:"50%",top:"50%"}}),u.createElement("div",{id:"webcam_preview",style:{display:"inline-block"}}))}}]),t}(u.Component),le=se=ae([y.autobind,re("design:paramtypes",[Object])],se),pe=n(71),ce=n(1921),he=n(83),de=n(105),ue=n(51),fe=n(95),me=n(26),ge=n.n(me),ve=n(33),ye=n.n(ve),Ee=n(75),be=n.n(Ee),Re=n(203),Ce=n.n(Re),we=n(24),ke=n.n(we),Oe=n(54),Se=n.n(Oe),je=n(1485),$e=n.n(je),He=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},Ae=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ze=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={recommendedAspectRatioMenu:{open:!1,anchorEl:new ne.None}},n}return c()(t,e),r()(t,[{key:"onRecommendedAspectRatioSelected",value:function(e){var t=this;this.setState(oe(this.state,{recommendedAspectRatioMenu:{open:{$set:!1},anchorEl:{$set:new ne.None}}}),function(){t.props.fields.width.onChange(e.aspectRatioWidth),t.props.fields.height.onChange(e.aspectRatioHeight)})}},{key:"onRecommendedAspectRatioMenuClosed",value:function(){this.setState(oe(this.state,{recommendedAspectRatioMenu:{open:{$set:!1},anchorEl:{$set:new ne.None}}}))}},{key:"onRecommendedAspectRatioMenuOpen",value:function(e){this.setState(oe(this.state,{recommendedAspectRatioMenu:{open:{$set:!0},anchorEl:{$set:Object(ne.toOption)(Object(ue.findDOMNode)(e.currentTarget))}}}))}},{key:"render",value:function(){var e=this,t=this.props.handleSubmit;return u.createElement("form",{onSubmit:t},u.createElement("div",{style:{display:"flex"}},u.createElement(ye.a,{style:{flexShrink:0},label:this.props.i18n.t("Включить"),control:u.createElement(be.a,{checked:this.props.fields.enabled.value,onChange:function(t,n){return e.props.fields.enabled.onChange(n)}})}),u.createElement("div",{style:{flex:1,textAlign:"right"}},u.createElement($.a,{onClick:this.onRecommendedAspectRatioMenuOpen},u.createElement($e.a,null)))),u.createElement(ge.a,{type:"number",fullWidth:!0,label:this.props.i18n.t("По ширине"),value:this.props.fields.width.value,onChange:this.props.fields.width.onChange}),u.createElement(ge.a,{type:"number",fullWidth:!0,label:this.props.i18n.t("По высоте"),value:this.props.fields.height.value,onChange:this.props.fields.height.onChange}),u.createElement(Ce.a,{anchorEl:this.state.recommendedAspectRatioMenu.anchorEl.getOrUndefined(),anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.recommendedAspectRatioMenu.open,onClose:this.onRecommendedAspectRatioMenuClosed},(this.props.fields.recommendedAspectRatios.value||[]).map(function(t,n){return u.createElement(ke.a,{key:n,onClick:function(){return e.onRecommendedAspectRatioSelected(t)}},u.createElement(Se.a,{primary:""+t.fileName.map(function(e){return e+" - "}).getOrElse(function(){return""})+t.aspectRatioWidth+" : "+t.aspectRatioHeight}))})))}}]),t}(u.Component);ze=He([y.autobind,Ae("design:paramtypes",[Object])],ze);var xe=Object(f.connect)(function(e){return{i18n:e.i18n}},function(e){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(fe.reduxForm)({form:"aspectRatioForm",fields:["width","height","enabled","recommendedAspectRatios"]})(ze)),_e=n(45),We=n.n(_e),Le=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},Me=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Pe=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={recommendedSizeMenu:{open:!1,anchorEl:new ne.None}},n}return c()(t,e),r()(t,[{key:"onRecommendedSizeSelected",value:function(e){var t=this;this.setState(oe(this.state,{recommendedSizeMenu:{open:{$set:!1},anchorEl:{$set:new ne.None}}}),function(){t.props.fields.width.onChange(e.width),t.props.fields.height.onChange(e.height)})}},{key:"onRecommendedSizeMenuClosed",value:function(){this.setState(oe(this.state,{recommendedSizeMenu:{open:{$set:!1},anchorEl:{$set:new ne.None}}}))}},{key:"onRecommendedSizeMenuOpen",value:function(e){this.setState(oe(this.state,{recommendedSizeMenu:{open:{$set:!0},anchorEl:{$set:Object(ne.toOption)(Object(ue.findDOMNode)(e.currentTarget))}}}))}},{key:"onWidthChanged",value:function(e){var t=e.target.value;this.props.fields.keepAspectRatio.value&&this.props.fields.height.onChange(Math.round(t*this.props.fields.height.initialValue/this.props.fields.width.initialValue)),this.props.fields.width.onChange(t)}},{key:"onHeightChanged",value:function(e){var t=e.target.value;this.props.fields.keepAspectRatio.value&&this.props.fields.width.onChange(Math.round(t*this.props.fields.width.initialValue/this.props.fields.height.initialValue)),this.props.fields.height.onChange(t)}},{key:"onQualityChanged",value:function(e){/^(0(\.\d*)?|1(\.0*)?|0(\,\d*)?|1(\,0*)?)$/.test(e.target.value)&&this.props.fields.quality.onChange(e.target.value)}},{key:"render",value:function(){var e=this,t=this.props.handleSubmit;return u.createElement("form",{onSubmit:t},u.createElement("div",{style:{textAlign:"right"}},u.createElement($.a,{onClick:this.onRecommendedSizeMenuOpen},u.createElement($e.a,null))),u.createElement(ge.a,{type:"number",fullWidth:!0,label:this.props.i18n.t("Ширина"),value:this.props.fields.width.value,onChange:this.onWidthChanged}),u.createElement(ge.a,{type:"number",fullWidth:!0,label:this.props.i18n.t("Высота"),value:this.props.fields.height.value,onChange:this.onHeightChanged}),u.createElement(ye.a,{style:{flexShrink:0},label:this.props.i18n.t("Сохранять соотношение"),control:u.createElement(We.a,{checked:this.props.fields.keepAspectRatio.value,onChange:this.props.fields.keepAspectRatio.onChange})}),u.createElement(ge.a,{fullWidth:!0,label:this.props.i18n.t("Качество при сохранении"),value:this.props.fields.quality.value,onChange:this.onQualityChanged}),u.createElement(Ce.a,{anchorEl:this.state.recommendedSizeMenu.anchorEl.getOrUndefined(),anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.recommendedSizeMenu.open,onClose:this.onRecommendedSizeMenuClosed},(this.props.fields.recommendedSizes.value||[]).map(function(t,n){return u.createElement(ke.a,{key:n,onClick:function(){return e.onRecommendedSizeSelected(t)}},u.createElement(Se.a,{primary:""+t.fileName.map(function(e){return e+" - "}).getOrElse(function(){return""})+t.width+"X"+t.height}))})))}}]),t}(u.Component);Pe=Le([y.autobind,Me("design:paramtypes",[Object])],Pe);var Ie=Object(f.connect)(function(e){return{i18n:e.i18n}},function(e){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(fe.reduxForm)({form:"imageSizeForm",fields:["width","height","recommendedSizes","keepAspectRatio","quality"]})(Pe)),De=n(194);n(2143);n.d(t,"MOBILE_DEVICE_WIDTH",function(){return Ne}),n.d(t,"MOBILE_DEVICE_HEIGHT",function(){return Ve}),n.d(t,"cropperIconButtonStyle",function(){return Ue});var Fe=function(e,t,n,o){var i,a=arguments.length,r=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},Te=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ne=400,Ve=600,Ue={padding:"8px"},Be=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.fileInput=new ne.None,n.state={photoResult:null,photoFile:null,photoHeight:0,photoWidth:0,photoCropper:null,rotation:0,loading:!0,cropping:!1,cropped:!1,errorFile:!1,aspectRatioWidth:4,aspectRatioHeight:3,aspectRatioEnabled:!1,windowWidth:window.innerWidth,windowHeight:window.innerHeight,dialog:{open:!1,actions:[],title:new ne.None,body:new ne.None},popover:{open:!1,anchorElement:new ne.None,body:new ne.None,styleGrey:!1}},n}return c()(t,e),r()(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize)}},{key:"componentWillUnmount",value:function(){Object(ne.toOption)(this.state.photoCropper).foreach(function(e){Object(ne.toOption)(e.img).foreach(function(e){e.onload=null})}),window.removeEventListener("resize",this.onWindowResize)}},{key:"onWindowResize",value:function(){this.setState(oe(this.state,{windowWidth:{$set:window.innerWidth},windowHeight:{$set:window.innerHeight}}))}},{key:"openDialog",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.setState(oe(this.state,{dialog:{$set:{open:!0,title:new ne.Some(e),body:new ne.Some(t),actions:n||[]}}}))}},{key:"handleDialogClose",value:function(){this.setState(oe(this.state,{dialog:{$set:oe(this.state.dialog,{open:{$set:!1}})}}))}},{key:"fileInputHandler",value:function(e){this.fileInput=Object(ne.toOption)(e)}},{key:"onImageLoad",value:function(e){this.setState(oe(this.state,{loading:{$set:!1},photoHeight:{$set:e.target.naturalHeight},photoWidth:{$set:e.target.naturalWidth}}))}},{key:"refHandler",value:function(e){e&&this.setState(oe(this.state,{photoCropper:{$set:e}}))}},{key:"onCropClick",value:function(){this.cropHandler()}},{key:"cropHandler",value:function(e){var t=this;this.setState(oe(this.state,{cropping:{$set:!0},cropped:{$set:!0}}),function(){return window.setTimeout(function(){return t.state.photoCropper.getCroppedCanvas({fillColor:"#ffffff"}).toBlob(function(n){t.setState(oe(t.state,{photoResult:{$set:t.state.photoCropper.getCroppedCanvas().toDataURL()},photoFile:{$set:n},loading:{$set:!0},cropping:{$set:!1}}),function(){e?e():window.setTimeout(function(){t.setState(oe(t.state,{loading:{$set:!1}}))},1e3)})},"image/png")},1e3)})}},{key:"imageFromServer",value:function(){return this.state.photoCropper.props.src.includes(this.props.cdnAddress)}},{key:"saveHandler",value:function(){var e=this,t=function(){e.setState(oe(e.state,{loading:{$set:!0}}),function(){if(e.state.photoFile)e.props.onSave(e.state.photoFile,function(){e.setState(oe(e.state,{loading:{$set:!1}}))});else{var t=e.state.photoCropper.props.src;Object(m.a)(t).then(function(e){return e.blob()}).then(function(t){e.props.onSave(t,function(){e.setState(oe(e.state,{loading:{$set:!1}}))})})}})},n=function(){e.state.photoResult||!e.imageFromServer()?Object(ne.toOption)(e.props.reduceSize).filter(function(t){return t.value.filter(function(n){return t.enabled&&e.state.photoWidth>n}).nonEmpty()}).flatMap(function(e){return e.value}).matchWith(function(n){var o=e.props.aspectRatio||e.state.photoWidth/e.state.photoHeight;e.resizeImage(n,Math.round(n/o),1,t)},function(){t()}):e.props.onClose()};if(!this.state.aspectRatioEnabled||this.state.cropped)n();else var o=this.props.openDialog(this.props.i18n.t("Подтверждение"),u.createElement(b.a,null,this.props.i18n.t("Изображение не было обрезано, уверены что хотите сохранить?")),[u.createElement(S.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(o)}},this.props.i18n.t("Отмена")),u.createElement(S.a,{variant:"raised",onClick:function(){n(),setTimeout(function(){return e.props.handleDialogClose(o)},100)},color:"primary"},this.props.i18n.t("Подтвердить"))])}},{key:"deleteHandler",value:function(){this.props.onDelete()}},{key:"rotateLeft",value:function(){var e=-270===this.state.rotation?0:this.state.rotation-90;this.state.photoCropper.rotateTo(e),this.setState(oe(this.state,{rotation:{$set:e}}))}},{key:"rotateRight",value:function(){var e=270===this.state.rotation?0:this.state.rotation+90;this.state.photoCropper.rotateTo(e),this.setState(oe(this.state,{rotation:{$set:e}}))}},{key:"fileUpload",value:function(){this.fileInput.foreach(function(e){return e.click()})}},{key:"checkFileType",value:function(e){return 0===e.type.indexOf("image")}},{key:"getImageBitmap",value:function(e){return"createImageBitmap"in window?createImageBitmap(e):new Promise(function(t,n){var o=document.createElement("img");o.addEventListener("load",function(){t(this)}),o.addEventListener("error",function(e){n(e)}),o.src=URL.createObjectURL(e)})}},{key:"fileChanged",value:function(e){var t=this,n=new FileReader,o=e.target.files[e.target.files.length-1];Object(ne.toOption)(o).map(function(e){return t.checkFileType(e)}).getOrElse(function(){return!1})?(n.onload=function(e){t.getImageBitmap(o).then(function(n){t.setState(oe(t.state,{photoResult:{$set:e.target.result},photoFile:{$set:o},errorFile:{$set:!1}}))}).catch(function(e){t.setState(oe(t.state,{loading:{$set:!1},errorFile:{$set:!0}}),function(){t.props.dispatch(Object(pe.h)(t.props.i18n.t("Ошибка в загружаемом файле изображения")))})})},this.props.onFileChange(o),window.setTimeout(function(){return n.readAsDataURL(o)},1e3),this.setState(oe(this.state,{loading:{$set:!0}}))):this.props.dispatch(Object(pe.h)(this.props.i18n.t("Неверный формат или файл не указан")))}},{key:"openPhotoTaker",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Камера"),u.createElement(le,null),[u.createElement(S.a,{key:"close",variant:"raised",onClick:function(){return e.props.handleDialogClose(t)}},this.props.i18n.t("Закрыть")),u.createElement(S.a,{key:"photograph",color:"primary",variant:"raised",onClick:function(){return function(t){ie.snap(function(n){e.setState(oe(e.state,{loading:{$set:!0},photoResult:{$set:n},photoFile:{$set:Object(ce.a)(n)},dialog:{open:{$set:!1}},errorFile:{$set:!1}})),e.props.onFileCreate(n),e.props.handleDialogClose(t)})}(t)},style:{marginRight:"10px"}},this.props.i18n.t("Сфотографировать"))])}},{key:"isRightAspectRatio",value:function(){if(!this.props.aspectRatio)return!0;var e=this.state.photoWidth/this.state.photoHeight-this.props.aspectRatio;return e<=.01&&e>=-.01}},{key:"getToolTipContent",value:function(){return u.createElement("div",null,this.props.i18n.t("Нажмите")," ",u.createElement(U.a,{style:{fill:"white"}})," ",this.props.i18n.t("чтобы загрузить фото или")," ",u.createElement(J.a,{style:{fill:"white"}})," ",this.props.i18n.t("чтобы сделать снимок"),".",u.createElement("p",null),this.props.i18n.t("При необходимости поверните фото кнопками")," ",u.createElement(F.a,{style:{fill:"white"}})," ",u.createElement(N.a,{style:{fill:"white"}}),u.createElement("p",null),this.props.i18n.t("Обрежьте фото с помощью")," ",u.createElement(I.a,{style:{fill:"white"}})," ",this.props.i18n.t("и нажмите Сохранить"),".")}},{key:"openToolTip",value:function(e){this.openPopover(e,Object(ne.toOption)(this.getToolTipContent()),!0)}},{key:"openPopover",value:function(e,t,n){this.state.popover.open||this.setState(oe(this.state,{popover:{$set:{open:!0,anchorElement:new ne.Some(e.currentTarget),body:t,styleGrey:n}}}))}},{key:"closePopover",value:function(){this.setState(oe(this.state,{popover:{$set:{open:!1,anchorElement:new ne.None,body:new ne.None,styleGrey:!1}}}))}},{key:"renderUploadStepLabels",value:function(){return!!this.state.photoResult||this.props.src.nonEmpty()?null:u.createElement(b.a,null,u.createElement("div",{style:{color:"red"}},this.props.i18n.t("Для загрузки файла нажмите")+" ",u.createElement($.a,{disabled:this.state.loading,onClick:this.fileUpload,style:{padding:0}},u.createElement(U.a,{fontSize:"small",style:{color:"red"}}))," "+this.props.i18n.t("или")+" ",u.createElement($.a,{disabled:this.state.loading,onClick:this.openPhotoTaker,style:{padding:0}},u.createElement(J.a,{fontSize:"small",style:{color:"red"}}))," "+this.props.i18n.t("чтобы сфотографировать")+"."))}},{key:"renderCropOrSaveStepLabels",value:function(){var e=!!this.state.photoResult||this.props.src.nonEmpty(),t=this.state.photoWidth/this.state.photoHeight,n=this.state.aspectRatioWidth/this.state.aspectRatioHeight,o=this.state.aspectRatioEnabled&&t!==n;return e&&!this.props.aspectRatio&&o?u.createElement(b.a,null,u.createElement("div",{style:{color:"red"}},this.props.i18n.t("Для обрезки фото нажмите "),u.createElement($.a,{disabled:!e||this.state.loading,onClick:this.onCropClick,style:{padding:0}},u.createElement(I.a,{fontSize:"small",style:{color:"red"}})),this.props.i18n.t("Для сохранения нажмите "),u.createElement("span",{onClick:this.saveHandler,style:{textDecoration:"underline",cursor:"pointer"}},this.props.i18n.t("Сохранить")))):null}},{key:"renderErrorLabels",value:function(){return this.state.errorFile?u.createElement(b.a,null,u.createElement("div",{style:{color:"red"}},this.props.i18n.t("Ошибка в загружаемом файле изображения"))):null}},{key:"renderCropStepLabels",value:function(){var e=!!this.state.photoResult||this.props.src.nonEmpty();return!this.isRightAspectRatio()&&e&&this.props.aspectRatio?u.createElement(b.a,null,u.createElement("div",{style:{color:"red"}},this.props.i18n.t("Выделите рамкой необходимую область и нажмите "),u.createElement($.a,{disabled:!e||this.state.loading,onClick:this.onCropClick,style:{padding:0}},u.createElement(I.a,{fontSize:"small",style:{color:"red"}})))):null}},{key:"renderSaveStepLabels",value:function(){return!this.state.loading&&!this.state.cropping&&this.isRightAspectRatio()&&this.props.aspectRatio?u.createElement(b.a,null,u.createElement("div",{style:{color:"red",display:"flex",alignItems:"center",marginTop:"5px",marginBottom:"5px"}},this.props.i18n.t("Для сохранения нажмите"),u.createElement("span",{onClick:this.saveHandler,style:{textDecoration:"underline",cursor:"pointer"}}," ",this.props.i18n.t("Сохранить")))):null}},{key:"onReduceImageWidthClick",value:function(){var e=this.state.photoWidth/this.state.photoHeight;this.resizeImage(500,Math.round(500/e),1)}},{key:"renderRecommendedSizeNotification",value:function(){var e=this.props.i18n.t,t=this.state.photoWidth;return t>De.b&&this.props.croppBeforeUpload&&u.createElement(b.a,{style:{color:"red"}},e("Ширина изображения")+" "+t+"px "+e("превышает рекомендуемую")+" "+De.b+"px. "+e("Для уменьшения нажмите")+" ",u.createElement($.a,{onClick:this.onReduceImageWidthClick,style:{padding:0}},u.createElement(K.a,{fontSize:"small",style:{color:"red"}})))}},{key:"onAspectRatioEdit",value:function(e){var t=this,n=void 0;this.openPopover(e,Object(ne.toOption)(u.createElement("div",{style:{padding:"5px"}},u.createElement(xe,{ref:function(e){return n=Object(ne.toOption)(e).flatMap(function(e){return Object(ne.toOption)(e.wrappedInstance)})},onSubmit:function(e){return new Promise(function(n,o){t.setState(oe(t.state,{aspectRatioWidth:{$set:e.width},aspectRatioHeight:{$set:e.height},aspectRatioEnabled:{$set:e.enabled}}),function(){n(),t.closePopover()})})},initialValues:{width:this.state.aspectRatioWidth,height:this.state.aspectRatioHeight,enabled:this.state.aspectRatioEnabled,recommendedAspectRatios:this.props.recommendedAspectRatios}}),u.createElement("div",{style:{textAlign:"right"}},u.createElement(S.a,{variant:"raised",onClick:function(){return n.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))))),!1)}},{key:"resizeImage",value:function(e,t,o,i){var a=this,r=this.state.photoResult||this.props.src.getOrElse(function(){return a.props.defaultSrc.getOrElse(function(){return n(622)})}),s=new Image;s.setAttribute("crossorigin","anonymous"),s.src=r,s.onload=function(){var n=document.createElement("canvas");n.width=e,n.height=t;var r=n.getContext("2d");Object(ne.toOption)(r).foreach(function(n){n.drawImage(s,0,0,e,t),n.canvas.toBlob(function(e){a.setState(oe(a.state,{cropping:{$set:!0}}),function(){window.setTimeout(function(){a.setState(oe(a.state,{photoResult:{$set:n.canvas.toDataURL()},photoFile:{$set:e},loading:{$set:!0},cropping:{$set:!1}}),function(){i?i():window.setTimeout(function(){a.setState(oe(a.state,{loading:{$set:!1}}))},1e3)})},1e3)})},"image/png",o)})}}},{key:"onResizeEdit",value:function(e){var t=this,n=void 0;this.openPopover(e,Object(ne.toOption)(u.createElement("div",{style:{padding:"5px"}},u.createElement(Ie,{ref:function(e){return n=Object(ne.toOption)(e).flatMap(function(e){return Object(ne.toOption)(e.wrappedInstance)})},onSubmit:function(e){return new Promise(function(n,o){n(),t.closePopover(),t.resizeImage(e.width,e.height,parseFloat(e.quality))})},initialValues:{width:this.state.photoWidth,height:this.state.photoHeight,recommendedSizes:this.props.recommendedSizes,quality:.6}}),u.createElement("div",{style:{textAlign:"right"}},u.createElement(S.a,{variant:"raised",onClick:function(){return n.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))))),!1)}},{key:"onSaveClick",value:function(){this.props.cropAndSave?this.cropHandler(this.saveHandler):this.saveHandler()}},{key:"getAllowedFormats",value:function(){return this.props.allowedFormats}},{key:"render",value:function(){var e=this,t=!!this.state.photoResult||this.props.src.nonEmpty(),o=this.state.photoResult||this.props.src.getOrElse(function(){return e.props.defaultSrc.getOrElse(function(){return n(622)})});return u.createElement("div",{style:{display:"flex",flexDirection:"column"}},u.createElement("input",{ref:this.fileInputHandler,type:"file",onChange:this.fileChanged,style:{display:"none"},accept:this.getAllowedFormats()}),u.createElement("div",{className:"PhotoCopper__toolbar"},u.createElement($.a,{disabled:!t||this.state.loading,onClick:this.onCropClick,style:Ue},u.createElement(I.a,null)),u.createElement($.a,{disabled:!t||this.state.loading,onClick:this.rotateLeft,style:Ue},u.createElement(F.a,null)),u.createElement($.a,{disabled:!t||this.state.loading,onClick:this.rotateRight,style:Ue},u.createElement(N.a,null)),this.props.aspectRatioEdit&&u.createElement($.a,{disabled:!t||this.state.loading,onClick:this.onAspectRatioEdit,style:Ue},u.createElement(X.a,{style:this.state.aspectRatioEnabled?{fill:"#E91E63"}:{}})),this.props.resizeEdit&&u.createElement($.a,{disabled:!t||this.state.loading,onClick:this.onResizeEdit,style:Ue},u.createElement(te,null)),u.createElement($.a,{disabled:this.state.loading,onClick:this.fileUpload,style:Ue},u.createElement(U.a,null)),u.createElement($.a,{disabled:this.state.loading,onClick:this.openPhotoTaker,style:Ue},u.createElement(J.a,null)),u.createElement($.a,{disabled:!t||this.state.loading,onClick:this.deleteHandler,style:Ue},u.createElement(q.a,null))),this.state.windowHeight>Ve&&u.createElement("div",null,this.renderErrorLabels(),this.renderUploadStepLabels(),this.renderCropStepLabels(),this.renderSaveStepLabels(),this.renderCropOrSaveStepLabels(),this.renderRecommendedSizeNotification()),u.createElement("div",null,u.createElement("div",{style:{position:"relative",height:"400px"}},u.createElement(qe,{photoSrc:o,onLoad:this.onImageLoad,style:{position:"absolute",display:this.state.loading?"block":"none",top:0,left:0,height:"400px",width:"100%"}}),(!this.state.loading||this.state.cropping)&&u.createElement(v.a,{src:o,style:{height:"400px",width:"100%"},ref:this.refHandler,aspectRatio:this.props.aspectRatioEdit&&this.state.aspectRatioEnabled?this.state.aspectRatioWidth/this.state.aspectRatioHeight:this.props.aspectRatio,autoCropArea:this.isRightAspectRatio()&&this.props.aspectRatio&&!this.props.aspectRatioEdit?1:.8}),(this.state.loading||this.state.cropping)&&u.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},u.createElement(C.a,{size:80})))),u.createElement("div",{style:{marginTop:"15px",textAlign:"right",flexShrink:0}},u.createElement(S.a,{style:{marginRight:"10px"},onClick:this.props.onClose},this.props.i18n.t("Закрыть")),u.createElement(S.a,{variant:"raised",color:"primary",onClick:this.onSaveClick,disabled:this.state.loading||this.state.cropping||!this.isRightAspectRatio()&&!this.props.cropAndSave},this.props.cropAndSave?this.props.i18n.t("Обрезать и сохранить"):this.props.i18n.t("Сохранить"))),u.createElement(A.a,{fullWidth:!0,open:this.state.dialog.open,onClose:this.handleDialogClose},u.createElement(x.a,{style:{borderTop:"none"}},this.state.dialog.actions),u.createElement(M.a,{style:{borderBottom:"none"}},this.state.dialog.title.getOrElse(function(){return""})),u.createElement(W.a,null,this.state.dialog.body.getOrElse(function(){return u.createElement("div",null)}))),this.state.popover.open&&u.createElement(k.a,{classes:{paper:this.state.popover.styleGrey?"PhotoCopper__tooltip-paper-grey":"PhotoCopper__tooltip-paper"},open:this.state.popover.open,anchorEl:this.state.popover.anchorElement.getOrElse(function(){throw"popover anchor hasn't been provided"}),anchorOrigin:{horizontal:"left",vertical:"top"},transformOrigin:{horizontal:"left",vertical:"top"},onClose:this.closePopover},this.state.popover.body.getOrElse(function(){return u.createElement("div",null)})))}}]),t}(u.Component);Be=Fe([y.autobind,Te("design:paramtypes",[Object])],Be);t.default=Object(f.connect)(function(e){return{i18n:e.i18n,cdnAddress:e.config.cdnAddress}})(Object(de.a)(Object(he.a)(Be)));var qe=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c()(t,e),r()(t,[{key:"onError",value:function(e){}},{key:"render",value:function(){return u.createElement("div",{style:this.props.style},u.createElement("div",{className:"cropper-bg",style:{textAlign:"center",height:"400px",position:"relative"}},u.createElement("img",{src:this.props.photoSrc,onLoad:this.props.onLoad,onErrorCapture:this.onError,onError:this.onError,style:{height:"400px",position:"absolute",top:0,left:"50%",transform:"translateX(-50%)"}}),u.createElement("div",{style:{width:"100%",height:"100%",top:0,right:0,position:"absolute",opacity:.5,backgroundColor:"#000"}})))}}]),t}(u.Component)},1921:function(e,t,n){"use strict";function o(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),i=new Uint8Array(o),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([o],{type:n})}n.d(t,"a",function(){return o})},2140:function(e,t,n){e.exports=n(97)(603)},2143:function(e,t,n){var o=n(2144);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,i);o.locals&&(e.exports=o.locals)},2144:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".PhotoCopper__toolbar {\n  background-color: #fff !important;\n  width: 90% !important;\n  flex-shrink: 0; }\n\n.PhotoCopper__tooltip-paper-grey {\n  display: inline-block !important;\n  opacity: 1 !important;\n  padding: 10px !important;\n  z-index: 3000 !important;\n  color: white !important;\n  border-radius: 5px !important;\n  background-color: #616161; }\n\n.PhotoCopper__tooltip-paper {\n  display: inline-block !important;\n  opacity: 1 !important;\n  padding: 10px !important;\n  z-index: 3000 !important;\n  border-radius: 5px !important; }\n\n.cropper-container {\n  width: 100% !important;\n  height: 100% !important;\n  margin: 0 auto; }\n",""])}}]);