(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[14],{1459:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return l});var a=n(79),r=n(104),i=n(82),o=function(){return function(e,t){return e(i.default.isA5000?Object(a.Mb)():Object(a.h)())}},l=function(e,t){return function(n,i){return i().eventLine.data.foreach(function(o){Object(r.e)(i().forms,e).foreach(function(r){n(Object(a.H)(o.id,r.entity.formType.getFormTypeId(),e,t))})})}}},1461:function(e,t,n){"use strict";var a=n(6),r=n.n(a),i=n(10),o=n.n(i),l=n(7),p=n.n(l),c=n(8),u=n.n(c),s=n(2),d=n(14),f=n(1469),m=n(1459),h=n(320),v=n(69),g=n(0),y=n(624);t.a=function(e){return Object(d.connect)(function(e){return{auth:e.auth,websocket:e.websocket,routing:e.routing}})(function(e){return function(t){function n(){return r()(this,n),p()(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return u()(n,t),o()(n,[{key:"componentWillMount",value:function(){var e=this;this.props.auth.signedOut||this.props.websocket.active&&(this.props.auth.checking||this.props.auth.checked&&this.props.auth.signedIn||this.props.auth.signingIn||this.props.auth.signedIn||Object(g.toOption)(this.props.routing.location).map(function(t){Object(g.liftKey)(Object(y.a)(t.search),"token").map(function(t){t.map(function(t){e.props.dispatch(Object(f.d)(t)).catch(function(t){e.signOut()})})}).getOrElse(function(){e.props.auth.token.map(function(t){e.props.dispatch(Object(f.d)(t)).catch(function(t){e.signOut()})}).getOrElse(function(){e.signOut()})})}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.auth.signedOut||e.websocket.active&&(e.auth.checking||(e.auth.checked&&e.auth.signedIn||e.auth.signingIn||e.auth.signedIn)&&(!e.websocket.active||this.props.websocket.active)||e.auth.token.map(function(n){e.dispatch(Object(f.d)(n)).catch(function(e){t.signOut()})}).getOrElse(function(){t.signOut()}))}},{key:"signOut",value:function(){this.props.dispatch(Object(v.r)()),this.props.dispatch(Object(h.c)()),this.props.dispatch(Object(m.b)())}},{key:"render",value:function(){return this.props.auth.signedIn&&!this.props.auth.signingIn?s.createElement(e,this.props):s.createElement("div",null)}}]),n}(s.Component)}(e))}},1462:function(e,t,n){"use strict";var a=n(855);Object.defineProperty(t,"__esModule",{value:!0});var r={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=a(n(1464));Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))})},1463:function(e,t,n){"use strict";var a=n(855),r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(36)),o=r(n(2)),l=(r(n(31)),a(n(1462))),p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var n=e.breakpoint,a=void 0===n?"sm":n;return(0,l.default)()(function(e){return o.default.createElement(t,(0,i.default)({fullScreen:(0,l.isWidthDown)(a,e.width)},e))})}};t.default=p},1464:function(e,t,n){"use strict";var a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isWidthDown=t.isWidthUp=void 0;var r=a(n(36)),i=a(n(39)),o=a(n(73)),l=a(n(74)),p=a(n(76)),c=a(n(77)),u=a(n(78)),s=a(n(2)),d=(a(n(31)),a(n(217))),f=a(n(373)),m=(n(61),a(n(539))),h=a(n(263)),v=n(859),g=a(n(860));t.isWidthUp=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?v.keys.indexOf(e)<v.keys.indexOf(t):v.keys.indexOf(e)<=v.keys.indexOf(t)};t.isWidthDown=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?v.keys.indexOf(t)<v.keys.indexOf(e):v.keys.indexOf(t)<=v.keys.indexOf(e)};var y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var n=e.withTheme,a=void 0!==n&&n,y=e.noSSR,b=void 0!==y&&y,O=e.initialWidth,w=e.resizeInterval,E=void 0===w?166:w,x=function(e){function n(e){var t;return(0,o.default)(this,n),(t=(0,p.default)(this,(0,c.default)(n).call(this,e))).state={width:b?t.getWidth():void 0},"undefined"!=typeof window&&(t.handleResize=(0,f.default)(function(){var e=t.getWidth();e!==t.state.width&&t.setState({width:e})},E)),t}return(0,u.default)(n,e),(0,l.default)(n,[{key:"componentDidMount",value:function(){var e=this.getWidth();e!==this.state.width&&this.setState({width:e})}},{key:"componentWillUnmount",value:function(){this.handleResize.clear()}},{key:"getWidth",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.innerWidth,t=this.props.theme.breakpoints,n=null,a=1;null===n&&a<v.keys.length;){var r=v.keys[a];if(e<t.values[r]){n=v.keys[a-1];break}a+=1}return n=n||"xl"}},{key:"render",value:function(){var e=(0,g.default)({theme:this.props.theme,name:"MuiWithWidth",props:(0,r.default)({},this.props)}),n=e.initialWidth,o=e.theme,l=e.width,p=(0,i.default)(e,["initialWidth","theme","width"]),c=(0,r.default)({width:l||this.state.width||n||O},p);return void 0===c.width?null:(a&&(c.theme=o),s.default.createElement(s.default.Fragment,null,s.default.createElement(t,c),s.default.createElement(d.default,{target:"window",onResize:this.handleResize})))}}]),n}(s.default.Component);return(0,m.default)(x,t),(0,h.default)()(x)}};t.default=y},1465:function(e,t,n){"use strict";var a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.isHorizontal=w,t.getAnchor=E,t.default=t.styles=void 0;var r=a(n(36)),i=a(n(55)),o=a(n(39)),l=a(n(73)),p=a(n(74)),c=a(n(76)),u=a(n(77)),s=a(n(78)),d=a(n(2)),f=(a(n(31)),a(n(47))),m=a(n(625)),h=a(n(38)),v=a(n(858)),g=a(n(93)),y=n(110),b=n(321),O={left:"right",right:"left",top:"down",bottom:"up"};function w(e){return-1!==["left","right"].indexOf(e.anchor)}function E(e){return"rtl"===e.theme.direction&&w(e)?O[e.anchor]:e.anchor}var x=function(e){return{root:{},docked:{flex:"0 0 auto"},paper:{overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:e.zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:"none"},paperAnchorLeft:{left:0,right:"auto"},paperAnchorRight:{left:"auto",right:0},paperAnchorTop:{top:0,left:0,bottom:"auto",right:0,height:"auto",maxHeight:"100%"},paperAnchorBottom:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"},paperAnchorDockedLeft:{borderRight:"1px solid ".concat(e.palette.divider)},paperAnchorDockedTop:{borderBottom:"1px solid ".concat(e.palette.divider)},paperAnchorDockedRight:{borderLeft:"1px solid ".concat(e.palette.divider)},paperAnchorDockedBottom:{borderTop:"1px solid ".concat(e.palette.divider)},modal:{}}};t.styles=x;var T=function(e){function t(){var e,n;(0,l.default)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=(0,c.default)(this,(e=(0,u.default)(t)).call.apply(e,[this].concat(r)))).mounted=!1,n}return(0,s.default)(t,e),(0,p.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0}},{key:"render",value:function(){var e=this.props,t=(e.anchor,e.BackdropProps),n=e.children,a=e.classes,l=e.className,p=e.elevation,c=e.ModalProps,u=(c=void 0===c?{}:c).BackdropProps,s=(0,o.default)(c,["BackdropProps"]),h=e.onClose,b=e.open,w=e.PaperProps,x=e.SlideProps,T=(e.theme,e.transitionDuration),j=e.variant,F=(0,o.default)(e,["anchor","BackdropProps","children","classes","className","elevation","ModalProps","onClose","open","PaperProps","SlideProps","theme","transitionDuration","variant"]),k=E(this.props),I=d.default.createElement(g.default,(0,r.default)({elevation:"temporary"===j?p:0,square:!0,className:(0,f.default)(a.paper,a["paperAnchor".concat((0,y.capitalize)(k))],(0,i.default)({},a["paperAnchorDocked".concat((0,y.capitalize)(k))],"temporary"!==j))},w),n);if("permanent"===j)return d.default.createElement("div",(0,r.default)({className:(0,f.default)(a.root,a.docked,l)},F),I);var C=d.default.createElement(v.default,(0,r.default)({in:b,direction:O[k],timeout:T,appear:this.mounted},x),I);return"persistent"===j?d.default.createElement("div",(0,r.default)({className:(0,f.default)(a.root,a.docked,l)},F),C):d.default.createElement(m.default,(0,r.default)({BackdropProps:(0,r.default)({},t,u,{transitionDuration:T}),className:(0,f.default)(a.root,a.modal,l),open:b,onClose:h},F,s),C)}}]),t}(d.default.Component);T.defaultProps={anchor:"left",elevation:16,open:!1,transitionDuration:{enter:b.duration.enteringScreen,exit:b.duration.leavingScreen},variant:"temporary"};var j=(0,h.default)(x,{name:"MuiDrawer",flip:!1,withTheme:!0})(T);t.default=j},1473:function(e,t,n){"use strict";var a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=a(n(1463))},1474:function(e,t,n){"use strict";var a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=a(n(1465))},1476:function(e,t,n){"use strict";var a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(2)),i=(0,a(n(44)).default)(r.default.createElement(r.default.Fragment,null,r.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),r.default.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})),"ArrowBack");t.default=i},1478:function(e,t,n){"use strict";var a=n(6),r=n.n(a),i=n(10),o=n.n(i),l=n(7),p=n.n(l),c=n(8),u=n.n(c),s=n(2),d=n(218),f=n.n(d),m=n(25),h=n.n(m),v=n(1476),g=n.n(v),y=(n(1481),n(52)),b=n.n(y),O=function(e){function t(){return r()(this,t),p()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),o()(t,[{key:"render",value:function(){return s.createElement(f.a,{className:"PageHeader__main"},this.props.onGoBackRequested?s.createElement(h.a,{onClick:this.props.onGoBackRequested,style:{flexShrink:0}},s.createElement(g.a,null)):s.createElement("div",{style:{display:"inline-block"}}),s.createElement(b.a,{variant:"title",align:"center",style:{flex:1}},this.props.title),s.createElement("div",{style:{flexShrink:0}},this.props.rightButtonGroup))}}]),t}(s.Component);t.a=O},1481:function(e,t,n){var a=n(1482);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(a,r);a.locals&&(e.exports=a.locals)},1482:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".PageHeader__main {\n  display: flex;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  margin-bottom: 10px;\n  background-color: #fff !important;\n  height: 48px !important;\n  width: 100% !important;\n  flex-shrink: 0;\n  padding: 0; }\n",""])},1509:function(e,t,n){"use strict";n(244);var a=n(17),r=n(6),i=n.n(r),o=n(7),l=n.n(o),p=n(8),c=n.n(p),u=n(18),s=(function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","List",{}))}c()(t,e)}(u.a),function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListForm",{formId:e}))}c()(t,e)}(u.a),function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListFormDescriptions",{formId:e}))}return c()(t,e),t}(u.a)),d=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Update",{config:e}))}return c()(t,e),t}(u.a),f=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Create",{config:e}))}return c()(t,e),t}(u.a),m=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Delete",{configId:e}))}return c()(t,e),t}(u.a),h=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Request",{configId:e}))}return c()(t,e),t}(u.a),v=n(21);n.d(t,"c",function(){return g}),n.d(t,"e",function(){return y}),n.d(t,"d",function(){return b}),n.d(t,"a",function(){return O}),n.d(t,"b",function(){return w});var g=function(e){return a.a.send(new s(e),function(e){return e})},y=function(e){return a.a.send(new d(e),Object(v.f)())},b=function(e){return a.a.send(new h(e),Object(v.e)())},O=function(e){return a.a.send(new f(e),Object(v.f)())},w=function(e){return a.a.send(new m(e),v.d)}},1512:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return l});var a=n(244),r=n(1509),i=n(87),o=function(e){return function(t,n){return t(Object(a.h)({form:e})),r.c(e).then(function(n){return t(Object(a.i)({form:e,resolved:n})),n}).catch(function(n){throw t(Object(a.g)({form:e,error:n})),n})}},l=function(e){return function(t){return t(Object(i.b)(function(e){return!e.exportPipelines.descriptionsFetching&&e.exportPipelines.descriptionsFetching},o(e)))}}},2740:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n.n(a),i=n(10),o=n.n(i),l=n(7),p=n.n(l),c=n(8),u=n.n(c),s=n(11),d=n.n(s),f=n(2),m=n(13),h=n(14),v=n(19),g=n.n(v),y=n(93),b=n.n(y),O=n(160),w=n.n(O),E=n(1509),x=n(529),T=n(652),j=function(e){return function(t){return t(Object(x.e)()),E.d(e).then(function(e){return t(Object(x.f)(e.record)),e.record}).catch(function(e){throw t(Object(x.d)(e)),e})}},F=n(1512),k=n(1),I=n(0),C=n(627),P=n(1478),_=n(1467),N=n(79),S=n(95),D=n(16),B=n(59),$=n(24),R=n.n($),L=n(26),W=n.n(L),A=n(30),z=n.n(A),M=n(75),H=n.n(M),J=n(45),G=n.n(J),V=n(33),U=n.n(V),q=n(34),K=n.n(q),Y=n(32),Q=n.n(Y),X=n(54),Z=n.n(X),ee=n(659),te=n(161),ne=n(3),ae=n(99),re=n(270),ie=n(228),oe=function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},le=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},pe=new k.Id(B.v4()),ce=function(e){function t(e){r()(this,t);var n=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={fileInput:new I.None},n}return u()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.fields.excelTemplate.value&&Object(ae.b)(new k.Id(this.props.fields.excelTemplate.value)).then(function(t){e.props.fields.excelTemplateFileName.onChange(t.record.entity.originalName)})}},{key:"componentWillReceiveProps",value:function(e){this.props.fields.excelTemplate.value!==e.fields.excelTemplate.value&&e.fields.excelTemplate.value&&Object(ae.b)(new k.Id(e.fields.excelTemplate.value)).then(function(t){e.fields.excelTemplateFileName.onChange(t.record.entity.originalName)})}},{key:"getDataFormatName",value:function(e){switch(e){case k.DataFormatCsv.$Type:return this.props.i18n.t("Csv");case k.DataFormatExcel.$Type:return this.props.i18n.t("Excel");case k.DataFormatJson.$Type:return this.props.i18n.t("Json");case k.DataFormatText.$Type:return this.props.i18n.t("Текст");case k.DataFormatJsScript.$Type:return this.props.i18n.t("JsScript");default:throw"DataFormat has not been found"}}},{key:"fileInputHandler",value:function(e){this.setState(ne(this.state,{fileInput:{$set:Object(I.toOption)(e)}}))}},{key:"fileChanged",value:function(e){var t=this,n=e.target.files[0];Object(ae.h)(n,this.props.config.cdnAddress,this.props.auth.token,this.props.organisation.organisationId,this.props.eventLine.eventLineId,new I.None,new I.None).then(function(e){t.onExcelTemplateFileChanged(e)}).catch(function(e){console.log("File uploaded with error",e)})}},{key:"onExcelTemplateLoad",value:function(){this.state.fileInput.foreach(function(e){e.click()})}},{key:"onExcelTemplateFileChanged",value:function(e){this.props.fields.excelTemplate.onChange(e.value)}},{key:"onTemplateEditorStateChanged",value:function(e){var t=Object(D.convertToRaw)(e.getCurrentContent()),n=Object(re.a)(t);this.props.fields.jsonTemplate.onChange(n)}},{key:"getFileTypeNameByTypeValue",value:function(e){switch(e){case k.FileNameTypeFileId.$Type.value:return this.props.i18n.t("ID файла");case k.FileNameTypeDbName.$Type.value:return this.props.i18n.t("Имя базы");case k.FileNameTypeOriginalName.$Type.value:return this.props.i18n.t("Оригинальное название");case k.FileNameTypeFormDataId.$Type.value:return this.props.i18n.t("ID анкеты");default:return this.props.i18n.t("ID файла")}}},{key:"render",value:function(){var e=this,t=this.props,n=t.i18n,a=t.fields,r=a.name,i=a.paramsType,o=a.format,l=a.fields,p=a.limits,c=a.filterConfiguration,u=a.timeBoundEnabled,s=(a.timeBoundFormat,a.timeBoundLimit),d=a.fileField,m=a.archivesLimit,h=a.jsScript,v=a.nameType,y=a.fileExtensionFormat,b=a.useExcelTemplate,O=(a.excelTemplate,a.excelTemplateFileName),E=a.jsonTemplate,x=a.useJsonTemplate;t.onSubmit;return f.createElement("form",null,f.createElement("input",{ref:this.fileInputHandler,type:"file",onChange:this.fileChanged,style:{display:"none"},accept:".xlsx"}),f.createElement("h4",{className:"Form__header-first"},this.props.i18n.t("Основное")),f.createElement("div",{className:"Form__content-block"},f.createElement(W.a,{label:n.t("Название"),fullWidth:!0,error:r.touched&&r.error,value:r.value,onChange:r.onChange,autoFocus:!0})),i.value===k.ExportPipelineStages.$Type.value&&f.createElement("div",{className:"Form__content-block"},f.createElement(Q.a,{fullWidth:!0},f.createElement(K.a,null,n.t("Формат")),f.createElement(z.a,{fullWidth:!0,value:o.value,error:o.touched&&o.error,onChange:function(e){return o.onChange(e.target.value)}},k.DataFormatTypes.map(function(t,n){return f.createElement(R.a,{key:n,value:t.value},f.createElement(Z.a,{primary:e.getDataFormatName(t)}))}))),o.value===k.DataFormatJsScript.$Type.value&&f.createElement("div",null,f.createElement(W.a,{label:this.props.i18n.t("Расширение отдаваемого файла"),fullWidth:!0,value:y.value,onChange:y.onChange}),f.createElement(W.a,{label:this.props.i18n.t("Скрипт"),fullWidth:!0,value:h.value,onChange:h.onChange,multiline:!0,rows:4,rowsMax:10})),o.value===k.DataFormatExcel.$Type.value&&f.createElement("div",null,f.createElement(U.a,{label:this.props.i18n.t("Использовать шаблон"),control:f.createElement(G.a,{checked:b.value,onChange:function(e,t){return b.onChange(t)}})}),f.createElement("br",null),b.value&&f.createElement("div",null,f.createElement("div",{style:{fontSize:"12px"}},this.props.i18n.t("Используйте $data$ для подстановки данных в шаблоне")),f.createElement(g.a,{variant:"raised",color:"primary",style:{marginRight:"5px"},onClick:this.onExcelTemplateLoad},this.props.i18n.t("Загрузить"))),f.createElement("span",null,!!O.value&&this.props.i18n.t("Сейчас вы используете")+" "+O.value+" "+this.props.i18n.t("в качестве шаблона"))),o.value===k.DataFormatJson.$Type.value&&f.createElement("div",null,f.createElement(U.a,{label:this.props.i18n.t("Использовать шаблон"),control:f.createElement(G.a,{checked:x.value,onChange:function(e,t){return x.onChange(t)}})}),f.createElement("br",null),x.value&&f.createElement(ie.a,{formId:this.props.currentForm.data.map(function(e){return e.id}).getOrElse(function(){return new k.Id("")}),templateId:"",generators:[],useData:!0,template:E.value||"",onChange:this.onTemplateEditorStateChanged})),this.props.currentForm.fetching?f.createElement(w.a,null):this.props.currentForm.data.map(function(t){return f.createElement("div",null,f.createElement(ee.a,{label:e.props.i18n.t("Экспортируемые поля"),exportPipelineFields:Object(T.a)(l.value||[]),formId:t.id.value,onChange:function(e){return l.onChange(e)},errorText:l.touched&&l.error,fieldParamsEnabled:!0,aliasEnabled:!0}))}).getOrNull(),f.createElement("div",{style:{marginTop:"20px"}}),f.createElement(U.a,{label:n.t("Выгружать лимиты"),control:f.createElement(H.a,{checked:p.checked,onChange:function(e,t){return p.onChange(t)},style:{maxWidth:700}})}),f.createElement("h4",{style:{marginLeft:"-20px"},className:"Form__header-first"},this.props.i18n.t("Фильтрация")),this.props.currentForm.fetching?f.createElement(w.a,null):this.props.currentForm.data.map(function(e){return f.createElement(te.a,{value:Object(I.toOption)(c.value),filterId:pe,onChange:function(e){return e.foreach(c.onChange)},formId:e.id})}).getOrNull()),i.value===k.ExportFileArchive.$Type.value&&f.createElement("div",{className:"Form__content-block"},f.createElement(W.a,{label:n.t("Ограничение на хранение архивов"),type:"number",fullWidth:!0,error:m.touched&&m.error,value:m.value,onChange:m.onChange}),f.createElement(U.a,{label:n.t("Ограничить запрос фотографий по времени"),control:f.createElement(H.a,{checked:u.checked,onChange:function(e,t){return u.onChange(t)},style:{maxWidth:700}})}),u.value&&f.createElement(W.a,{label:n.t("Ограничивать выгрузку фото старше")+": (часов)",type:"number",fullWidth:!0,error:s.touched&&s.error,value:s.value,onChange:s.onChange}),f.createElement(Q.a,{fullWidth:!0},f.createElement(K.a,null,n.t("Поле с файлом")),f.createElement(z.a,{fullWidth:!0,value:d.value,error:d.touched&&d.error,onChange:function(e){return d.onChange(e.target.value)}},this.props.currentForm.data.map(function(t){return Object(I.liftKey)(e.props.formFields.list,t.id.value).map(function(e){return e.filter(function(e){return e.entity.valueType.tpe===k.ValueTypeFileList.$Type}).map(function(e){return f.createElement(R.a,{key:e.id.value,value:e.id.value},f.createElement(Z.a,{primary:e.entity.caption}))})}).getOrNull()}).getOrNull())),f.createElement(Q.a,{fullWidth:!0},f.createElement(K.a,null,n.t("Тип имени файла")),f.createElement(z.a,{fullWidth:!0,value:v.value,error:v.touched&&v.error,onChange:v.onChange},k.FileNameTypes.map(function(t){return f.createElement(R.a,{key:t.$Type.value,value:t.$Type.value},e.getFileTypeNameByTypeValue(t.$Type.value))})))))}}]),t}(f.Component);ce=oe([m.autobind,le("design:paramtypes",[Object])],ce);var ue=Object(h.connect)(function(e){return{i18n:e.i18n,currentForm:e.currentForm,auth:e.auth,organisation:e.organisation,eventLine:e.eventLine,formFields:e.fields,config:e.config}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(S.reduxForm)({form:"exportPipeline",fields:["name","paramsType","format","fields","limits","timeBoundEnabled","timeBoundFormat","timeBoundLimit","fileField","archivesLimit","filterConfiguration","jsScript","fileExtensionFormat","useExcelTemplate","excelTemplate","excelTemplateFileName","jsonTemplate","useJsonTemplate","nameType"],validate:function(e,t){var n={};switch(e.paramsType){case k.ExportPipelineStages.$Type.value:e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение")),e.format&&0!==e.format.trim().length||(n.format=t.i18n.t("Обязательное значение")),e.fields&&0!==e.fields.length||(n.fields=t.i18n.t("Ни одно поле не добавлено. Для добавления выберите поле и нажмите кнопку добавить."))}return n}})(ce)),se=n(50),de=n(136),fe=n(1461),me=n(176),he=n(71),ve=function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},ge=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ye=0,be=1,Oe=function(e){function t(e){r()(this,t);var n=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Object.assign(_.a.screenInitialState(),{mode:-1!==location.href.indexOf("/new")?ye:be,paramsType:-1!==location.href.indexOf("/exportFiles/")?k.ExportFileArchive.$Type.value:k.ExportPipelineStages.$Type.value})));return n.formInstance=new I.None,n}return u()(t,e),o()(t,[{key:"componentWillReceiveProps",value:function(e){var t={mode:-1!==location.href.indexOf("/new")?ye:be,paramsType:-1!==location.href.indexOf("/exportFiles/")?k.ExportFileArchive.$Type.value:k.ExportPipelineStages.$Type.value};this.setState(Object.assign(this.state,t))}},{key:"getFileNameTypeClassByTpeValue",value:function(e){switch(e){case k.FileNameTypeFileId.$Type.value:return new k.FileNameTypeFileId;case k.FileNameTypeDbName.$Type.value:return new k.FileNameTypeDbName;case k.FileNameTypeOriginalName.$Type.value:return new k.FileNameTypeOriginalName;case k.FileNameTypeFormDataId.$Type.value:return new k.FileNameTypeFormDataId;default:return new k.FileNameTypeFileId}}},{key:"getCurrentPipeline",value:function(e){return this.props.exportPipeline.result}},{key:"renderNavigation",value:function(){return f.createElement(C.a,null)}},{key:"notifyTemplateFormRefHandler",value:function(e){this.formInstance=Object(I.toOption)(e).flatMap(function(e){return Object(I.toOption)(e.wrappedInstance)})}},{key:"onSaveClick",value:function(){this.formInstance.map(function(e){return e.submit()})}},{key:"onCreate",value:function(e){var t=this,n=new I.None;switch(e.paramsType){case k.ExportPipelineStages.$Type.value:n=Object(I.toOption)(new k.ExportPipelineStages(new k.ExportPipelineStageFetch(new k.Id(this.props.params.formId),new I.None,e.filterConfiguration instanceof I.None?e.filterConfiguration:Object(I.toOption)(e.filterConfiguration)),new k.ExportPipelineStageProcessing(Object(T.a)(e.fields),e.limits),new k.ExportPipelineStageFormat(Object(se.o)(e.format,e)),new k.ExportPipelineStageMaterialize(Object(se.o)(e.format,e))));break;case k.ExportFileArchive.$Type.value:n=Object(I.toOption)(new k.ExportFileArchive(new k.TimeBound(e.timeBoundEnabled,e.timeBoundFormat,e.timeBoundLimit?Object(I.toOption)(36e5*e.timeBoundLimit):new I.None),new k.Id(e.fileField),e.archivesLimit?Object(I.toOption)(e.archivesLimit):new I.None,this.getFileNameTypeClassByTpeValue(e.nameType)))}return n.map(function(n){return new Promise(function(a,r){Object(E.a)(new k.ExportPipeline(e.name,new k.Id(t.props.params.formId),n)).then(function(e){switch(a(e),t.props.dispatch(Object(he.h)(t.props.i18n.t("Новая конфигурация успешно создана!"))),t.handleDialogClose(!1),t.props.dispatch(Object(F.a)(new k.Id(t.props.params.formId))),t.props.dispatch(j(e.id)),t.state.paramsType){case k.ExportPipelineStages.$Type.value:t.props.dispatch(Object(N.x)(new k.Id(t.props.params.eventLineId),new k.Id(t.props.params.formTypeId),new k.Id(t.props.params.formId),e.id));break;case k.ExportFileArchive.$Type.value:t.props.dispatch(Object(N.y)(new k.Id(t.props.params.eventLineId),new k.Id(t.props.params.formTypeId),new k.Id(t.props.params.formId),e.id));break;default:throw new Error("unsupported export params type")}}).catch(function(e){r(e),t.props.dispatch(Object(he.h)(t.props.i18n.t("Ошибка во время создания конфигурации!")))})})}).getOrElse(function(){throw new Error("Unknown export params type")})}},{key:"onSave",value:function(e){var t=this;return new Promise(function(n,a){var r=new I.None;switch(e.paramsType){case k.ExportPipelineStages.$Type.value:r=Object(I.toOption)(new k.ExportPipelineStages(new k.ExportPipelineStageFetch(new k.Id(t.props.params.formId),new I.None,Object(I.toOption)(e.filterConfiguration)),new k.ExportPipelineStageProcessing(Object(T.a)(e.fields),e.limits),new k.ExportPipelineStageFormat(Object(se.o)(e.format,e)),new k.ExportPipelineStageMaterialize(Object(se.o)(e.format,e))));break;case k.ExportFileArchive.$Type.value:r=Object(I.toOption)(new k.ExportFileArchive(new k.TimeBound(e.timeBoundEnabled,e.timeBoundFormat,e.timeBoundLimit?Object(I.toOption)(36e5*e.timeBoundLimit):new I.None),new k.Id(e.fileField),e.archivesLimit?Object(I.toOption)(e.archivesLimit):new I.None,t.getFileNameTypeClassByTpeValue(e.nameType)))}t.props.exportPipeline.result.map(function(i){return r.map(function(r){return Object(E.e)(ne(i,{entity:{$set:new k.ExportPipeline(e.name,new k.Id(t.props.params.formId),r)}})).then(function(e){n(e),t.props.dispatch(Object(he.h)(t.props.i18n.t("Изменения в конфигурации успешно сохранены!"))),t.handleDialogClose(!1),t.props.dispatch(Object(F.a)(new k.Id(t.props.params.formId))),t.props.dispatch(j(e.id))}).catch(function(e){a(e),t.props.dispatch(Object(he.h)(t.props.i18n.t("Ошибка во время сохранения изменений в конфигурации!")))})}).getOrElse(function(){throw new Error("Unknown export params type")})})})}},{key:"onGoBackRequested",value:function(){switch(this.state.paramsType){case k.ExportPipelineStages.$Type.value:this.props.dispatch(Object(N.D)(new k.Id(this.props.params.eventLineId),new k.Id(this.props.params.formTypeId),new k.Id(this.props.params.formId)));break;case k.ExportFileArchive.$Type.value:this.props.dispatch(Object(N.A)(new k.Id(this.props.params.eventLineId),new k.Id(this.props.params.formTypeId),new k.Id(this.props.params.formId)));break;default:throw new Error("unsupported export params type")}}},{key:"getInitialValues",value:function(){var e=this;return this.props.exportPipeline.result.map(function(e){var t={name:e.entity.name,paramsType:e.entity.params.tpe.value,timeBoundEnabled:!1,filterConfiguration:new k.FilterGroupCondition([],new k.FilterPredicateAnd)};switch(e.entity.params.tpe.value){case k.ExportPipelineStages.$Type.value:var n=e.entity.params;return Object.assign(t,{format:n.materializeStage.dataFormat.tpe.value,fields:n.processingStage.fields,limits:n.processingStage.limits,filterConfiguration:n.fetchStage.filter.getOrElse(function(){return t.filterConfiguration})},n.materializeStage.dataFormat.tpe.value===k.DataFormatJsScript.$Type.value?{jsScript:n.materializeStage.dataFormat.script,fileExtensionFormat:n.materializeStage.dataFormat.fileExtension}:{jsScript:"",fileExtensionFormat:""},n.materializeStage.dataFormat.tpe.value===k.DataFormatExcel.$Type.value?{useExcelTemplate:n.materializeStage.dataFormat.useTemplate,excelTemplate:n.materializeStage.dataFormat.template.map(function(e){return e.value}).getOrNull()}:{useExcelTemplate:"",excelTemplate:""},n.materializeStage.dataFormat.tpe.value===k.DataFormatJson.$Type.value?{useJsonTemplate:n.materializeStage.dataFormat.useTemplate,jsonTemplate:n.materializeStage.dataFormat.template.getOrNull()}:{useJsonTemplate:"",jsonTemplate:""});case k.ExportFileArchive.$Type.value:var a=e.entity.params;return Object.assign(t,{timeBoundEnabled:a.timeBound.enabled,timeBoundFormat:a.timeBound.timeFormat,timeBoundLimit:a.timeBound.timeLimit.map(function(e){return e/36e5}).getOrNull(),fileField:a.fileField.value,archivesLimit:a.archivesLimit.getOrNull(),nameType:a.nameType.tpe.value});default:throw new Error}}).getOrElse(function(){return{paramsType:e.state.paramsType,extConfigEnabled:!1,extConfigUrl:"",limits:!1,timeBoundFormat:"",timeBoundEnabled:!1,filterConfiguration:new k.FilterGroupCondition([],new k.FilterPredicateAnd)}})}},{key:"render",value:function(){var e=this.props.exportPipeline.fetching;return this.renderScreenBody({className:""},f.createElement("div",{style:{display:"flex",flexDirection:"column",minHeight:0}},f.createElement(P.a,{title:this.props.i18n.t("Настройка экспорта"),onGoBackRequested:this.onGoBackRequested,rightButtonGroup:[f.createElement(g.a,{variant:"raised",style:{margin:"0px 15px"},onClick:this.onSaveClick,color:"primary"},this.props.i18n.t("Сохранить"))]}),f.createElement(b.a,{className:"DefaultPage__paper",style:{padding:8}},e?f.createElement(w.a,null):f.createElement(ue,{ref:this.notifyTemplateFormRefHandler,initialValues:this.state.mode===be?this.getInitialValues():{paramsType:this.state.paramsType,extConfigEnabled:!1,extConfigUrl:"",limits:!1,timeBoundFormat:"",timeBoundEnabled:!1,filterConfiguration:new k.FilterGroupCondition([],new k.FilterPredicateAnd)},onSubmit:this.state.mode===be?this.onSave:this.onCreate}))))}}]),t}(_.a);Oe=ve([m.autobind,ge("design:paramtypes",[Object])],Oe);t.default=Object(h.connect)(function(e){return{exportPipeline:e.exportPipeline,forms:e.forms,i18n:e.i18n}})(Object(fe.a)(Object(de.a)(function(e){e.isTokenChecked&&(e.forms.fetching||e.dispatch(Object(me.h)(new k.Id(e.params.formId))),e.dispatch(Object(F.b)(new k.Id(e.params.formId))),Object(I.toOption)(e.params.exportPipelineId).foreach(function(t){e.dispatch(j(new k.Id(t)))}))},function(){},function(e,t){t.forms.fetching&&!e.forms.fetching&&e.dispatch(Object(me.h)(new k.Id(e.params.formId))),e.params.formId!==t.params.formId&&(e.dispatch(Object(me.h)(new k.Id(e.params.formId))),e.dispatch(Object(F.b)(new k.Id(e.params.formId)))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&(e.dispatch(Object(me.h)(new k.Id(e.params.formId))),e.dispatch(Object(F.b)(new k.Id(e.params.formId)))),e.params.exportPipelineId!==t.params.exportPipelineId&&Object(I.toOption)(e.params.exportPipelineId).foreach(function(t){e.dispatch(j(new k.Id(t)))}),e.params.exportPipelineId===t.params.exportPipelineId&&e.isTokenChecked&&!t.isTokenChecked&&Object(I.toOption)(e.params.exportPipelineId).foreach(function(t){e.dispatch(j(new k.Id(t)))})})(Oe)))}}]);