(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[26],{1477:function(e,t,n){"use strict";var o=n(17),r=n(21),i=n(6),a=n.n(i),s=n(7),c=n.n(s),l=n(8),p=n.n(l),u=n(18),d=function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","Create",{document:e}))}return p()(t,e),t}(u.a),f=function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","Update",{document:e}))}return p()(t,e),t}(u.a),h=function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","Delete",{id:e}))}return p()(t,e),t}(u.a),g=function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","List",{form:e}))}return p()(t,e),t}(u.a),m=function(e){function t(e,n){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","ListFormData",{formId:e,formDataId:n}))}return p()(t,e),t}(u.a),v=function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","ListIds",{ids:e}))}return p()(t,e),t}(u.a),y=n(193);n.d(t,"c",function(){return C}),n.d(t,"d",function(){return E}),n.d(t,"e",function(){return b}),n.d(t,"f",function(){return O}),n.d(t,"a",function(){return j}),n.d(t,"b",function(){return I});var C=function(e){return function(t){return t(Object(y.q)(e)),o.a.send(new g(e),Object(r.g)()).then(function(n){return t(Object(y.r)({formId:e,documents:n.list})),n}).catch(function(n){throw t(Object(y.p)({formId:e,error:n})),n})}},E=function(e){return function(t){return t(Object(y.k)()),o.a.send(new v(e),Object(r.g)()).then(function(e){return t(Object(y.l)(e.list)),e}).catch(function(e){throw t(Object(y.j)(e)),e})}},b=function(e,t){return function(n){return n(Object(y.n)(t)),o.a.send(new m(e,t),Object(r.g)()).then(function(e){return n(Object(y.o)({formDataId:t,documents:e.list})),e}).catch(function(e){throw n(Object(y.m)({formDataId:t,error:e})),e})}},O=function(e){return o.a.send(new f(e),Object(r.f)())},j=function(e){return o.a.send(new d(e),Object(r.f)())},I=function(e){return o.a.send(new h(e),Object(r.f)())}},1483:function(e,t,n){"use strict";var o=n(17),r=n(21),i=n(6),a=n.n(i),s=n(7),c=n.n(s),l=n(8),p=n.n(l),u=n(18),d=function(e){function t(e,n,o,r,i,s){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Permissions.Apps","Create",{name:e,organisationId:n,roleId:o,eventLineId:r,appType:i,active:s}))}return p()(t,e),t}(u.a),f=function(e){function t(e,n,o,r,i){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Permissions.Apps","Update",{id:e,name:n,roleId:o,appType:r,active:i}))}return p()(t,e),t}(u.a),h=function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Permissions.Apps","Delete",{appId:e}))}return p()(t,e),t}(u.a),g=(function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Permissions.Apps","Request",{appId:e}))}p()(t,e)}(u.a),function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Permissions.Apps","ListEventLine",{eventLineId:e}))}return p()(t,e),t}(u.a)),m=function(e){function t(e){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Permissions.Apps","ListOrganisation",{organisationId:e}))}return p()(t,e),t}(u.a),v=function(e){function t(e,n){return a()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Permissions.Apps","EnrichContext",{loginValues:e,formId:n}))}return p()(t,e),t}(u.a),y=n(427),C=n(5);Object(C.createAction)("Application.Fetching"),Object(C.createAction)("Application.Resolve"),Object(C.createAction)("Application.Error"),Object(C.createAction)("Auth.SetBlockId",function(e){return e});n.d(t,"d",function(){return E}),n.d(t,"e",function(){return b}),n.d(t,"f",function(){return O}),n.d(t,"a",function(){return j}),n.d(t,"b",function(){return I}),n.d(t,"c",function(){return k});var E=function(e){return function(t){return t(Object(y.e)()),o.a.send(new g(e),Object(r.g)()).then(function(e){return t(Object(y.f)(e.list)),e}).catch(function(e){throw t(Object(y.d)(e)),e})}},b=function(e){return function(t){return t(Object(y.e)()),o.a.send(new m(e),Object(r.g)()).then(function(e){return t(Object(y.f)(e.list)),e}).catch(function(e){throw t(Object(y.d)(e)),e})}},O=function(e,t,n,i,a){return o.a.send(new f(e,t,n,i,a),Object(r.f)())},j=function(e,t,n,i,a,s){return o.a.send(new d(e,t,n,i,a,s),Object(r.f)())},I=function(e){return o.a.send(new h(e),Object(r.f)())},k=function(e,t){return o.a.send(new v(e,t),function(e){return e})}},1489:function(e,t,n){e.exports=n(97)(462)},1495:function(e,t,n){"use strict";var o=n(6),r=n.n(o),i=n(10),a=n.n(i),s=n(7),c=n.n(s),l=n(8),p=n.n(l),u=n(11),d=n.n(u),f=n(2),h=n(13),g=n(542),m=n.n(g),v=n(38),y=n.n(v),C=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},E=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(m.a,{style:{margin:0},classes:this.props.classes,variant:this.props.variant,color:this.props.color,disabled:this.props.disabled,onClick:this.props.onClick,type:this.props.type,size:this.props.size},this.props.children)}}]),t}(f.Component);E=C([h.autobind],E),t.a=y()(function(e){return{sizeSmall:{minWidth:32,minHeight:16,fontSize:e.typography.pxToRem(8)}}})(E)},1505:function(e,t,n){e.exports=n(97)(709)},1520:function(e,t,n){e.exports=n(97)(211)},1574:function(e,t,n){e.exports=n(97)(9)},1575:function(e,t,n){e.exports=n(97)(181)},1576:function(e,t,n){e.exports=n(97)(62)},1578:function(e,t,n){e.exports=n(97)(221)},1579:function(e,t,n){e.exports=n(97)(198)},1590:function(e,t,n){"use strict";var o=n(21),r=n(6),i=n.n(r),a=n(7),s=n.n(a),c=n(8),l=n.n(c),p=n(18),u=function(e){function t(e){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","ListByEventLine",{eventLineId:e}))}return l()(t,e),t}(p.a),d=function(e){function t(e){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Create",{generator:e}))}return l()(t,e),t}(p.a),f=function(e){function t(e){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Update",{generator:e}))}return l()(t,e),t}(p.a),h=function(e){function t(e){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Delete",{generatorId:e}))}return l()(t,e),t}(p.a),g=n(17),m=n(440);n.d(t,"a",function(){return v}),n.d(t,"d",function(){return y}),n.d(t,"b",function(){return C}),n.d(t,"c",function(){return E});var v=function(e){return g.a.send(new d(e),Object(o.c)())},y=function(e){return g.a.send(new f(e),Object(o.f)())},C=function(e){return g.a.send(new h(e),Object(o.d)())},E=function(e){return function(t){return t(Object(m.e)()),g.a.send(new u(e),Object(o.g)()).then(function(e){return t(Object(m.f)(e.list)),e}).catch(function(e){throw t(Object(m.d)(e)),e})}}},1614:function(e,t,n){e.exports=n(49)(39)},1616:function(e,t,n){"use strict";var o=n(2),r=n(94),i=n.n(r);t.a=function(e){return o.createElement(i.a,Object.assign({},e),o.createElement("path",{d:"M3,2H21V2H21V4H20.92L14,10.92V22.91L10,18.91V10.91L3.09,4H3V2Z"}))}},1617:function(e,t,n){e.exports=n(97)(76)},1628:function(e,t,n){e.exports=n(97)(75)},1629:function(e,t,n){e.exports=n(97)(117)},1630:function(e,t,n){e.exports=n(97)(121)},1631:function(e,t,n){e.exports=n(97)(15)},1634:function(e,t,n){e.exports=n(97)(85)},1776:function(e,t,n){e.exports=n(97)(518)},1778:function(e,t,n){e.exports=n(97)(201)},1779:function(e,t,n){e.exports=n(97)(531)},1780:function(e,t,n){e.exports=n(97)(122)},1781:function(e,t,n){e.exports=n(97)(652)},1782:function(e,t,n){e.exports=n(97)(613)},1783:function(e,t,n){e.exports=n(97)(560)},1786:function(e,t,n){e.exports=n(97)(129)},1787:function(e,t,n){e.exports=n(97)(197)},1788:function(e,t,n){e.exports=n(97)(86)},1790:function(e,t,n){e.exports=n(97)(551)},1791:function(e,t,n){e.exports=n(97)(553)},1797:function(e,t,n){e.exports=n(97)(514)},1799:function(e,t,n){e.exports=n(97)(61)},1802:function(e,t,n){e.exports=n(97)(44)},1817:function(e,t,n){e.exports=n(49)(117)},1818:function(e,t,n){e.exports=n(49)(65)},1978:function(e,t,n){e.exports=n(97)(42)},1979:function(e,t,n){e.exports=n(97)(60)},2059:function(e,t,n){var o=n(2376);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2066:function(e,t,n){e.exports=n(97)(555)},2067:function(e,t,n){e.exports=n(97)(562)},2069:function(e,t,n){e.exports=n(97)(200)},2071:function(e,t,n){e.exports=n(97)(460)},2072:function(e,t,n){e.exports=n(97)(84)},2074:function(e,t,n){e.exports=n(97)(30)},2083:function(e,t,n){e.exports=n(97)(202)},2367:function(e,t,n){var o=n(2368);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2368:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".HeaderSection__header-nav {\n  background-color: #fff !important;\n  height: 48px !important;\n  display: flex;\n  align-items: center;\n  justify-content: space-between; }\n",""])},2370:function(e,t,n){var o=n(2371);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2371:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".ConfigSection__container {\n  width: 400px;\n  box-sizing: border-box;\n  overflow-y: auto;\n  margin-right: 10px;\n  display: flex;\n  flex-direction: column;\n  height: 100%; }\n\n.ConfigSection__paper {\n  flex: 1;\n  overflow-y: auto; }\n\n.ConfigSection__widget:hover {\n  background-color: #ccc;\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab; }\n",""])},2374:function(e,t,n){var o=n(2375);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2375:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".DiagramScene__container {\n  flex: 2;\n  box-sizing: border-box;\n  overflow-y: auto;\n  margin-left: 10px;\n  display: flex;\n  flex-direction: column; }\n\n.srd-default-link path {\n  stroke: #000000;\n  stroke-width: 4; }\n",""])},2376:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".action-widget-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n",""])},2377:function(e,t,n){var o=n(2378);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2378:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".CommentWidget-root {\n  z-index: 1000;\n  display: none;\n  position: absolute;\n  top: -10px;\n  left: 50%;\n  transform: translate(-50%, -100%); }\n\n.CommentWidget-text {\n  background: rgba(70, 70, 70, 0.8);\n  border: 1px solid #333;\n  border-radius: 4px;\n  color: #fff;\n  display: inline-block;\n  font-size: smaller;\n  padding: 5px; }\n",""])},2385:function(e,t,n){e.exports=n(49)(237)},2388:function(e,t,n){e.exports=n(49)(43)},2389:function(e,t,n){e.exports=n(49)(120)},2391:function(e,t,n){e.exports=n(49)(35)},2392:function(e,t,n){e.exports=n(49)(222)},2393:function(e,t,n){e.exports=n(49)(168)},2394:function(e,t,n){e.exports=n(49)(179)},2395:function(e,t,n){e.exports=n(49)(169)},2396:function(e,t,n){e.exports=n(49)(28)},2397:function(e,t,n){e.exports=n(49)(23)},2398:function(e,t,n){e.exports=n(49)(51)},2399:function(e,t,n){e.exports=n(49)(48)},2400:function(e,t,n){var o=n(2401);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2401:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".two-inputs-action-widget-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n",""])},2402:function(e,t,n){var o=n(2403);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2403:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".widget-icon {\n  position: absolute;\n  top: 55%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n  .widget-icon path {\n    fill: white; }\n",""])},2407:function(e,t,n){var o=n(2408);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2408:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".timer-widget-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n",""])},2410:function(e,t,n){var o=n(2411);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2411:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".router-widget-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n  .router-widget-icon path {\n    fill: white; }\n",""])},2417:function(e,t,n){e.exports=n(97)(192)},2420:function(e,t,n){e.exports=n(97)(510)},2422:function(e,t,n){e.exports=n(97)(74)},2423:function(e,t,n){e.exports=n(97)(120)},2427:function(e,t,n){e.exports=n(97)(452)},2430:function(e,t,n){e.exports=n(97)(512)},2433:function(e,t,n){e.exports=n(97)(655)},2447:function(e,t,n){e.exports=n(97)(517)},2450:function(e,t,n){e.exports=n(97)(563)},2452:function(e,t,n){e.exports=n(97)(182)},2453:function(e,t,n){e.exports=n(97)(185)},2454:function(e,t,n){e.exports=n(97)(64)},2457:function(e,t,n){e.exports=n(97)(16)},2460:function(e,t,n){e.exports=n(97)(559)},2465:function(e,t,n){e.exports=n(97)(116)},2466:function(e,t,n){e.exports=n(97)(508)},2468:function(e,t,n){e.exports=n(97)(506)},2494:function(e,t,n){var o=n(2495);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2495:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".timer-widget-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n",""])},2497:function(e,t,n){var o=n(2498);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2498:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".timer-widget-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n",""])},2500:function(e,t,n){var o=n(2501);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2501:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".EditorSection__container {\n  margin-top: 20px;\n  display: flex;\n  flex: 1; }\n\n.EditorSection__node-widget:hover .CommentWidget-root {\n  display: block; }\n",""])},2502:function(e,t,n){var o=n(2503);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,r);o.locals&&(e.exports=o.locals)},2503:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".JourneyPage__page-container {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-height: 0; }\n",""])},2715:function(e,t,n){"use strict";n.r(t);var o=n(6),r=n.n(o),i=n(10),a=n.n(i),s=n(7),c=n.n(s),l=n(8),p=n.n(l),u=n(11),d=n.n(u),f=n(2),h=n(14),g=n(13),m=n(1467),v=n(1),y=n(627),C=n(19),E=n.n(C),b=n(562),O=n(79),j=n(3),I=(n(2367),n(71)),k=n(1478),T=n(564),P=n(238),w=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},F=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"openJourneysPage",value:function(){var e=this;this.props.eventLine.data.foreach(function(t){e.props.dispatch(Object(O.T)(t.id))})}},{key:"onSave",value:function(){var e=this;this.props.journeyEditor.record.foreach(function(t){var n=j(t,{entity:{definition:{components:{$set:e.props.journeyEditor.components},edges:{$set:e.props.journeyEditor.edges},inputs:{$set:e.props.journeyEditor.inputs},outputs:{$set:e.props.journeyEditor.outputs},viewComponents:{$set:e.props.journeyEditor.viewComponents}},uiConfig:{$set:e.props.journeyEditor.defaultFormId.map(function(e){return new v.JourneyUIConfig(e)})},throttle:{$set:e.props.journeyEditor.throttle}}});Object(b.i)(n).then(function(){e.props.dispatch(Object(P.f)(n)),e.props.dispatch(Object(I.h)(e.props.i18n.t("Сохранение успешно завершено"))),e.props.eventLine.data.foreach(function(t){e.props.dispatch(Object(T.a)(t.id))})}).catch(function(){e.props.dispatch(Object(I.h)(e.props.i18n.t("Сохранение завершилось ошибкой")))})})}},{key:"render",value:function(){var e=this;return f.createElement(k.a,{title:this.props.i18n.t("Цепочка")+" - "+this.props.journeyEditor.record.map(function(e){return e.entity.name}).getOrElse(function(){return e.props.i18n.t("не загружена")}),onGoBackRequested:this.openJourneysPage,rightButtonGroup:[f.createElement(E.a,{variant:"raised",onClick:this.onSave,style:{margin:"0px 15px",flexShrink:0},color:"primary"},this.props.i18n.t("Сохранить"))]})}}]),t}(f.Component);F=w([g.autobind],F);var x=Object(h.connect)(function(e){return{i18n:e.i18n,journeyEditor:e.journeyEditor,eventLine:e.eventLine}})(F),D=n(51),R=n(220),_=n.n(R),$=n(93),S=n.n($),N=n(223),M=n.n(N),L=n(224),A=n.n(L),W=n(225),H=n.n(W),U=n(52),J=n.n(U),V=n(191),B=n.n(V),z=n(1769),q=n.n(z),G=n(543),Z=n.n(G),Y=n(603),K=n.n(Y),X=n(426),Q="ActionType",ee=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:Q,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#f0b029",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Действие"))))}}]),t}(f.Component),te="TwoInputsActionType",ne=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:te,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#f0b029",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Действие с двумя входами"))))}}]),t}(f.Component),oe="TriggerType",re=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:oe,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#7ab260",borderRadius:"50%",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Триггер"))))}}]),t}(f.Component),ie="JobTriggerType",ae=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:ie,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#f0b029",borderRadius:"50%",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Таймер"))))}}]),t}(f.Component),se="MergeType",ce=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:se,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#ee336d",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Слияние"))))}}]),t}(f.Component),le="RouterType",pe=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:le,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#ee336d",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Фильтр"))))}}]),t}(f.Component),ue="TimerTriggerType",de=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:ue,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#2196f3",borderRadius:"50%",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Таймер-Триггер"))))}}]),t}(f.Component),fe=n(117),he=n(0),ge=n(101),me=n(1483),ve=n(1494),ye=n(641),Ce=n(1590),Ee=n(59),be=n(673),Oe=n(104),je=n(176),Ie=n(25),ke=n.n(Ie),Te=n(98),Pe=n.n(Te),we=n(107),Fe=n.n(we),xe=n(219),De=n.n(xe),Re=n(54),_e=n.n(Re),$e=n(72),Se=n.n($e),Ne=n(86),Me=n.n(Ne),Le=n(1528),Ae=n.n(Le),We=n(1816),He=n.n(We),Ue=n(83),Je=n(95),Ve=n(26),Be=n.n(Ve),ze=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qe=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){var e=this.props.fields.name;return f.createElement("form",null,f.createElement(Be.a,{fullWidth:!0,autoFocus:!0,value:e.value,onChange:e.onChange,label:this.props.i18n.t("Название"),error:e.touched&&e.error,helperText:e.touched&&Object(he.toOption)(e.error).map(function(e){return e}).getOrNull()}))}}]),t}(f.Component);qe=ze([g.autobind],qe);var Ge=Object(h.connect)(function(e){return{i18n:e.i18n}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(Je.reduxForm)({form:"PortForm",fields:["name"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение")),n}})(qe)),Ze=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ye=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"openEditForm",value:function(e,t,n){var o=this,r=new he.None,i=this.props.openDialog(e,f.createElement(Ge,{ref:function(e){return r=Object(he.toOption)(e).flatMap(function(e){return Object(he.toOption)(e.wrappedInstance)})},initialValues:n,onSubmit:t}),[f.createElement(E.a,{variant:"raised",onClick:function(){return o.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){r.foreach(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))]);return i}},{key:"onAddPortButtonClick",value:function(){var e=this,t=this.openEditForm("Добавление нового порта",function(n){return new Promise(function(o,r){e.props.handleDialogClose(t),e.props.onChange(j(e.props.ports,{$push:[new v.Contact(Ee.v4(),n.name)]})),o()})})}},{key:"onPortEdit",value:function(e,t){var n=this,o=this.openEditForm("Редактирование порта",function(e){return new Promise(function(r,i){n.props.handleDialogClose(o),n.props.onChange(j(n.props.ports,{$splice:[[t,1,new v.Contact(Ee.v4(),e.name)]]})),r()})},{name:e.name})}},{key:"onPortRemove",value:function(e){this.props.onChange(j(this.props.ports,{$splice:[[e,1]]}))}},{key:"onMoveUp",value:function(e){this.props.onChange(j(this.props.ports,{$splice:[[e-1,2,this.props.ports[e],this.props.ports[e-1]]]}))}},{key:"onMoveDown",value:function(e){this.props.onChange(j(this.props.ports,{$splice:[[e,2,this.props.ports[e+1],this.props.ports[e]]]}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement("p",null,this.props.label),f.createElement(Pe.a,null,this.props.ports.map(function(t,n){return f.createElement(Fe.a,{key:t.uid},f.createElement(_e.a,{primary:t.name}),f.createElement(De.a,null,f.createElement(ke.a,{onClick:function(){return e.onMoveDown(n)},disabled:n===e.props.ports.length-1},f.createElement(Ae.a,null)),f.createElement(ke.a,{onClick:function(){return e.onMoveUp(n)},disabled:0===n},f.createElement(He.a,null)),f.createElement(ke.a,{onClick:function(){return e.onPortEdit(t,n)}},f.createElement(Me.a,null)),f.createElement(ke.a,{onClick:function(){return e.onPortRemove(n)}},f.createElement(Se.a,null))))})),f.createElement("div",null,f.createElement(E.a,{variant:"raised",onClick:this.onAddPortButtonClick,style:{marginRight:"10px"}},this.props.i18n.t("Добавить порт"))))}}]),t}(f.Component);Ye=Ze([g.autobind],Ye);var Ke=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Object(Ue.a)(Ye)),Xe=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Qe=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onPortsChange",value:function(e){this.props.dispatch(Object(ge.D)({componentId:this.props.stageId,inputs:e}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Ke,{label:this.props.i18n.t("Входы"),ports:this.props.inputs,onChange:this.onPortsChange}))}}]),t}(f.Component);Qe=Xe([g.autobind],Qe);var et=Object(h.connect)(function(e){return{i18n:e.i18n}})(Qe),tt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},nt=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement("div",null,f.createElement(et,{mergeConfig:this.props.mergeConfig,stageId:this.props.stageId,inputs:this.props.inputs}))}}]),t}(f.Component);nt=tt([g.autobind],nt);var ot=Object(h.connect)(function(e,t){return{i18n:e.i18n}})(nt),rt=n(30),it=n.n(rt),at=n(34),st=n.n(at),ct=n(32),lt=n.n(ct),pt=n(50),ut=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},dt=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onEventTypeSelected",value:function(e){var t=this;Object(he.headOption)(v.EventTypes.filter(function(t){return t.tpe.value===e.target.value})).matchWith(function(e){return t.props.dispatch(Object(ge.T)(j(t.props.triggerConfig,{eventType:{$set:e}})))},function(){throw"Unknown event type - TriggerAttributes.onEventTypeSelected"})}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Тип события")),f.createElement(it.a,{fullWidth:!0,native:!0,value:this.props.triggerConfig.eventType.tpe.value,onChange:this.onEventTypeSelected},f.createElement("optgroup",{label:this.props.i18n.t("Основные")},f.createElement("option",{value:v.EventTypeFormDataCreated.$Type.value},Object(pt.F)(v.EventTypeFormDataCreated.$Type.value,this.props.i18n.t)),f.createElement("option",{value:v.EventTypeFormDataUpdated.$Type.value},Object(pt.F)(v.EventTypeFormDataUpdated.$Type.value,this.props.i18n.t)),f.createElement("option",{value:v.EventTypeFormDataDeleted.$Type.value},Object(pt.F)(v.EventTypeFormDataDeleted.$Type.value,this.props.i18n.t)),f.createElement("option",{value:v.EventTypeDocumentPrinted.$Type.value},Object(pt.F)(v.EventTypeDocumentPrinted.$Type.value,this.props.i18n.t)),f.createElement("option",{value:v.EventTypeInteraction.$Type.value},Object(pt.F)(v.EventTypeInteraction.$Type.value,this.props.i18n.t)),f.createElement("option",{value:v.EventTypeJourneyEvent.$Type.value},Object(pt.F)(v.EventTypeJourneyEvent.$Type.value,this.props.i18n.t)),f.createElement("option",{value:v.EventTypeEmailTracked.$Type.value},Object(pt.F)(v.EventTypeEmailTracked.$Type.value,this.props.i18n.t)),f.createElement("option",{value:v.EventTypeEmailFetched.$Type.value},Object(pt.F)(v.EventTypeEmailFetched.$Type.value,this.props.i18n.t))))))}}]),t}(f.Component);dt=ut([g.autobind],dt);var ft=Object(h.connect)(function(e,t){return{i18n:e.i18n}})(dt),ht=n(24),gt=n.n(ht),mt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vt=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onRepeatCountChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{params:{trigger:{repeatCount:{$set:parseInt(e.target.value)}}}})))}},{key:"onExprChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{params:{trigger:{expr:{expr:{$set:e.target.value}}}}})))}},{key:"onIntervalChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{params:{trigger:{expr:{interval:{$set:""+1e9*parseInt(e.target.value)}}}}})))}},{key:"getTriggerExpression",value:function(e){switch(e){case v.TriggerExpressionCron.$Type.value:return new v.TriggerExpressionCron("");case v.TriggerExpressionInterval.$Type.value:return new v.TriggerExpressionInterval(""+1e12);default:throw"Unknown trigger expression type"}}},{key:"onTriggerExpressionTypeChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{params:{trigger:{expr:{$set:this.getTriggerExpression(e.target.value)}}}})))}},{key:"render",value:function(){var e=this;return Object(he.toOption)(this.props.triggerConfig.params).filter(function(e){return e.tpe.value===v.TriggerParamsPredefTrigger.$Type.value}).map(function(t){return f.createElement("div",null,f.createElement(Be.a,{fullWidth:!0,label:e.props.i18n.t("Число повторений"),value:t.trigger.repeatCount,type:"number",onChange:e.onRepeatCountChanged}),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,e.props.i18n.t("Тип выражения триггера")),f.createElement(it.a,{fullWidth:!0,value:t.trigger.expr.tpe.value,onChange:e.onTriggerExpressionTypeChanged},f.createElement(gt.a,{value:v.TriggerExpressionCron.$Type.value},e.props.i18n.t("Крон")),f.createElement(gt.a,{value:v.TriggerExpressionInterval.$Type.value},e.props.i18n.t("Интервал")))),t.trigger.expr instanceof v.TriggerExpressionCron&&f.createElement(Be.a,{fullWidth:!0,type:"text",value:t.trigger.expr.expr,label:e.props.i18n.t("Крон выражение"),onChange:e.onExprChanged}),t.trigger.expr instanceof v.TriggerExpressionInterval&&f.createElement(Be.a,{fullWidth:!0,type:"number",value:""+parseInt(t.trigger.expr.interval)/1e9,label:e.props.i18n.t("Интервал (сек)"),onChange:e.onIntervalChanged}))}).getOrNull()}}]),t}(f.Component);vt=mt([g.autobind],vt);var yt=Object(h.connect)(function(e){return{i18n:e.i18n}})(vt),Ct=n(29),Et=n(423),bt=n(68),Ot=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},jt=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){Object(he.toOption)(this.props.triggerConfig.params).filter(function(e){return e.tpe.value===v.TriggerParamsDynamicField.$Type.value}).foreach(function(e){})}},{key:"componentWillReceiveProps",value:function(e){var t=Object(he.toOption)(this.props.triggerConfig.params).filter(function(e){return e.tpe.value===v.TriggerParamsDynamicField.$Type.value}).map(function(e){return e.formId}),n=Object(he.toOption)(e.triggerConfig.params).filter(function(e){return e.tpe.value===v.TriggerParamsDynamicField.$Type.value}).map(function(e){return e.formId});Object(he.isEqual)(t.map(function(e){return e.value}),n.map(function(e){return e.value}))||n.foreach(function(e){})}},{key:"onFormChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{params:{formId:{$set:e}}})))}},{key:"onFieldChanged",value:function(e){var t=this;e.foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.triggerConfig,{params:{fieldId:{$set:e}}})))})}},{key:"render",value:function(){var e=this;return Object(he.toOption)(this.props.triggerConfig.params).filter(function(e){return e.tpe.value===v.TriggerParamsDynamicField.$Type.value}).map(function(t){return f.createElement("div",null,f.createElement(Et.a,{formId:Object(he.toOption)(t.formId),onChange:e.onFormChanged,excludedForms:[]}),f.createElement(bt.a,{labelText:Object(he.toOption)(e.props.i18n.t("Поле")),fields:Object(Ct.e)(e.props.fields,t.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===v.ValueTypeInterval.$Type.value}),onChanged:e.onFieldChanged,fullWidth:!0,native:!0,value:Object(he.toOption)(t.fieldId),errorText:new he.None}))}).getOrNull()}}]),t}(f.Component);jt=Ot([g.autobind],jt);var It=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(jt),kt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Tt=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getTriggerParams",value:function(e,t){switch(e){case v.TriggerParamsPredefTrigger.$Type.value:return new v.TriggerParamsPredefTrigger(new v.JobTrigger(Ee.v4(),1,new v.TriggerExpressionInterval(""+1e12)));case v.TriggerParamsDynamicField.$Type.value:return new v.TriggerParamsDynamicField(t,new v.Id(""));default:throw"Unknown trigger params type"}}},{key:"onTriggerParamsTypeChanged",value:function(e,t){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{params:{$set:this.getTriggerParams(e,t)}})))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,this.props.defaultFormId.map(function(t){return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,e.props.i18n.t("Тип параметров таймера")),f.createElement(it.a,{fullWidth:!0,native:!0,value:e.props.triggerConfig.params.tpe.value,onChange:function(n){return e.onTriggerParamsTypeChanged(n.target.value,t)}},f.createElement("optgroup",{label:e.props.i18n.t("Основные")},f.createElement("option",{value:v.TriggerParamsPredefTrigger.$Type.value},e.props.i18n.t("Заданные параметры")),f.createElement("option",{value:v.TriggerParamsDynamicField.$Type.value},e.props.i18n.t("Параметры из поля анкеты")))))}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}),this.props.triggerConfig.params instanceof v.TriggerParamsPredefTrigger&&f.createElement(yt,{triggerConfig:this.props.triggerConfig}),this.props.triggerConfig.params instanceof v.TriggerParamsDynamicField&&f.createElement(It,{triggerConfig:this.props.triggerConfig}),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"green",marginRight:5}})," - ",this.props.i18n.t("Вход для данных")),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"red",marginRight:5}})," - ",this.props.i18n.t("Вход для остановки")))}}]),t}(f.Component);Tt=kt([g.autobind],Tt);var Pt=Object(h.connect)(function(e,t){return{i18n:e.i18n}})(Tt),wt=n(16),Ft=n(45),xt=n.n(Ft),Dt=n(33),Rt=n.n(Dt),_t=n(185),$t=n(442),St=n(142),Nt=n(160),Mt=n.n(Nt),Lt=n(264),At=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(Lt.c)(this.props.valueType.family,new he.None))}},{key:"onEntryToggled",value:function(e){this.props.onChange(Object(_t.a)(this.props.value,[e],St.a))}},{key:"displayValue",value:function(e,t){var n=this;switch(t.tpe){case v.ValueStr.$Type:return t.value.toString();case v.ValueDate.$Type:switch(e.dateType.tpe.value){case v.DateTypeDate.$Type.value:return t.value.toLocaleDateString();case v.DateTypeTime.$Type.value:return t.value.getHours()>9?(""+t.value.toLocaleTimeString()).slice(0,5):(""+t.value.toLocaleTimeString()).slice(0,4);case v.DateTypeDateTime.$Type.value:return t.value.toLocaleString();default:return this.props.i18n.t("Неизвестный тип значения")}case v.ValueObjectRefs.$Type:var o=e,r=t;return Object(he.liftKey)(this.props.dictionaries.list,o.family.value).map(function(e){return r.id.reduce(function(t,r){return t.push(Object(he.headOption)(e.filter(function(e){return e.id.value===r.value})).map(function(e){return o.displayFields.map(function(t){return Object(he.toOption)(e.entity.values[t.value]).map(function(e){switch(e.value.tpe){case v.ValueStr.$Type:return e.value.value;case v.ValueObjectRefs.$Type:return"Ref#"+e.value.id.join(", ");default:return n.props.i18n.t("-- Не поддерживаемое значение --")}}).getOrElse(function(){return""})}).join("-")}).getOrElse(function(){return""})),t},[]).join(", ")}).getOrElse(function(){return n.props.i18n.t("--- Некорректная ссылка ---")});default:return t.toString()}}},{key:"render",value:function(){var e=this,t=Object(he.liftKey)(this.props.dictionaries.fetching,this.props.valueType.family.value),n=Object(he.liftKey)(this.props.dictionaries.list,this.props.valueType.family.value);return t.filter(function(e){return!!e}).matchWith(function(e){return Object(he.toOption)(f.createElement(Mt.a,null))},function(){return n.map(function(t){return f.createElement(lt.a,null,t.map(function(t){return f.createElement(Rt.a,{control:f.createElement(xt.a,{key:t.id.value,checked:Object($t.a)(e.props.value,t.id),onChange:function(){return e.onEntryToggled(t.id)}}),label:Object(he.headOption)(e.props.valueType.displayFields).flatMap(function(e){return Object(he.toOption)(t.entity.values[e.value])}).map(function(t){return e.displayValue(e.props.valueType,t.value)}).getOrElse(function(){return""})})}))})}).getOrNull()}}]),t}(f.Component),Wt=Object(h.connect)(function(e){return{i18n:e.i18n,dictionaries:e.dictionaries}})(At),Ht=n(270),Ut=n(228),Jt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Vt=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"onTemplateEditorStateChanged",value:function(e){var t=Object(wt.convertToRaw)(e.getCurrentContent()),n=Object(Ht.a)(t);this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{template:{$set:new v.ValueStr(n)}})))}},{key:"onObjRefsTemplateChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{template:{$set:new v.ValueObjectRefs(e)}})))}},{key:"onAppendDataChanged",value:function(e,t){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{appendData:{$set:t}})))}},{key:"onBoolValueChange",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{template:{$set:new v.ValueBool("true"===e)}})))}},{key:"onFieldChanged",value:function(e){var t=this;e.foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{fieldId:{$set:e}})))})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(bt.a,{labelText:Object(he.toOption)(this.props.i18n.t("Поле")),fields:Object(Ct.e)(this.props.fields,this.props.actionConfig.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value!==v.ValueTypeFormDataAttribute.$Type.value}),onChanged:this.onFieldChanged,fullWidth:!0,native:!0,value:Object(he.toOption)(this.props.actionConfig.fieldId),errorText:new he.None}),Object(he.headOption)(Object(Ct.e)(this.props.fields,this.props.actionConfig.formId).getOrElse(function(){return[]}).filter(function(t){return t.id.value===e.props.actionConfig.fieldId.value})).map(function(t){switch(t.entity.valueType.tpe){case v.ValueTypeObjectRefs.$Type:return f.createElement("div",null,f.createElement(Rt.a,{label:e.props.i18n.t("Добавлять ссылку"),control:f.createElement(xt.a,{checked:e.props.actionConfig.appendData,style:{marginBottom:"12px"},onChange:e.onAppendDataChanged})}),f.createElement(Wt,{valueType:t.entity.valueType,value:Object(he.toOption)(e.props.actionConfig.template).filter(function(e){return e instanceof v.ValueObjectRefs}).map(function(e){return e.id}).getOrElse(function(){return[]}),onChange:e.onObjRefsTemplateChanged}));case v.ValueTypeBool.$Type:return f.createElement(it.a,{fullWidth:!0,style:{flex:1,margin:"0px 5px"},value:Object(he.toOption)(e.props.actionConfig.template).filter(function(e){return e instanceof v.ValueBool}).map(function(e){return e.toString()}).getOrElse(function(){return"true"}),onChange:function(t){return e.onBoolValueChange(t.target.value)}},f.createElement(gt.a,{value:"true",key:0},f.createElement(_e.a,{primary:e.props.i18n.t("True")})),f.createElement(gt.a,{value:"false",key:1},f.createElement(_e.a,{primary:e.props.i18n.t("False")})));default:return f.createElement(Ut.a,{formId:e.props.actionConfig.formId,templateId:e.props.stageId,generators:e.props.valuesGenerators.list,template:e.props.actionConfig.template.toString(),onChange:e.onTemplateEditorStateChanged})}}).getOrNull())}}]),t}(f.Component);Vt=Jt([g.autobind],Vt);var Bt=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields,valuesGenerators:e.valuesGenerators}})(Vt),zt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qt=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"onFieldChanged",value:function(e){var t=this;e.foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{fieldId:{$set:e}})))})}},{key:"onOperationChange",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{operation:{$set:Object(pt.c)(e.target.value)}})))}},{key:"onArgumentChange",value:function(e){var t=parseFloat(e.target.value);isNaN(t)||this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{argument:{$set:t}})))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(bt.a,{labelText:Object(he.toOption)(this.props.i18n.t("Поле")),fields:Object(Ct.e)(this.props.fields,this.props.actionConfig.formId).getOrElse(function(){return[]}).filter(function(e){var t=e.entity.valueType.tpe;return t.value===v.ValueTypeNumber.$Type.value||t.value===v.ValueTypeMoney.$Type.value}),onChanged:this.onFieldChanged,fullWidth:!0,native:!0,value:Object(he.toOption)(this.props.actionConfig.fieldId),errorText:new he.None}),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,{style:{marginLeft:15}},this.props.i18n.t("Операция")),f.createElement(it.a,{value:this.props.actionConfig.operation.tpe.value,onChange:this.onOperationChange},v.mathOperations.map(function(e,t){return f.createElement(gt.a,{key:t,value:e.value},Object(pt.d)(e))}))),f.createElement(Be.a,{fullWidth:!0,type:"number",value:this.props.actionConfig.argument,onChange:this.onArgumentChange,label:this.props.i18n.t("Аргумент")}))}}]),t}(f.Component);qt=zt([g.autobind],qt);var Gt=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(qt),Zt=n(416),Yt=n.n(Zt),Kt=n(319),Xt=n.n(Kt),Qt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},en=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onHeaderDelete",value:function(e){this.props.onChange(j(this.props.headers,{$splice:[[e,1]]}))}},{key:"onHeaderAdd",value:function(){this.props.onChange(j(this.props.headers,{$push:[new v.HttpHeader("","")]}))}},{key:"onHeaderKeyChange",value:function(e,t,n){this.props.onChange(j(this.props.headers,{$splice:[[e,1,j(t,{key:{$set:n}})]]}))}},{key:"onHeaderValueChange",value:function(e,t,n){this.props.onChange(j(this.props.headers,{$splice:[[e,1,j(t,{value:{$set:n}})]]}))}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{marginTop:"10px"}},f.createElement("div",null,this.props.i18n.t("Заголовки")),this.props.headers.map(function(t,n){return f.createElement("div",{style:{display:"flex"},key:n},f.createElement(Be.a,{fullWidth:!0,style:{marginRight:"15px"},placeholder:e.props.i18n.t("Ключ"),value:t.key,onChange:function(o){return e.onHeaderKeyChange(n,t,o.target.value)}}),f.createElement(Be.a,{fullWidth:!0,placeholder:e.props.i18n.t("Значение"),value:t.value,onChange:function(o){return e.onHeaderValueChange(n,t,o.target.value)}}),f.createElement(ke.a,{style:{alignSelf:"center",flexShrink:0},onClick:function(t){return e.onHeaderDelete(n)}},f.createElement(Se.a,null)))}),f.createElement(E.a,{variant:"raised",color:"primary",onClick:this.onHeaderAdd},this.props.i18n.t("Добавить заголовок")))}}]),t}(f.Component),tn=en=Qt([g.autobind],en),nn=n(555),on=n.n(nn),rn=n(552),an=n.n(rn),sn=n(271),cn=n.n(sn),ln=n(267),pn=n.n(ln),un=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},dn=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onTokenFetchRequireChanged",value:function(e){this.props.onChange(j(this.props.tokenFetch,{enabled:{$set:e}}))}},{key:"getHttpMethod",value:function(e){switch(e){case v.HttpMethodGET.$Type.value:return new v.HttpMethodGET;case v.HttpMethodPOST.$Type.value:return new v.HttpMethodPOST("");default:throw"Unknown http method type"}}},{key:"onTokenFetchJsonPathChanged",value:function(e){this.props.onChange(j(this.props.tokenFetch,{jsonPath:{$set:e}}))}},{key:"onTokenFetchHttpMethodChanged",value:function(e){this.props.onChange(j(this.props.tokenFetch,{resource:{method:{$set:this.getHttpMethod(e)}}}))}},{key:"onTokenFetchHttpHeadersChanged",value:function(e){this.props.onChange(j(this.props.tokenFetch,{resource:{headers:{$set:e}}}))}},{key:"onTokenFetchHttpMethodPOSTBodyChanged",value:function(e){this.props.onChange(j(this.props.tokenFetch,{resource:{method:{body:{$set:e}}}}))}},{key:"onTokenFetchUtiChanged",value:function(e){this.props.onChange(j(this.props.tokenFetch,{resource:{uri:{$set:e}}}))}},{key:"onTokenFetchCacheEnabled",value:function(e){this.props.onChange(j(this.props.tokenFetch,{cache:{enabled:{$set:e}}}))}},{key:"onExpiredInChanged",value:function(e){var t=parseInt(e.target.value);isNaN(t)||this.props.onChange(j(this.props.tokenFetch,{cache:{expiredIn:{$set:new v.Duration(t,v.TimeUnitType.Minutes)}}}))}},{key:"render",value:function(){var e=this,t=this.props.tokenFetch.enabled,n=this.props.tokenFetch.jsonPath,o=this.props.tokenFetch.resource,r=this.props.tokenFetch.cache;return f.createElement("div",null,f.createElement(Rt.a,{style:{marginLeft:"5px"},label:this.props.i18n.t("Требуется получение токена"),control:f.createElement(xt.a,{style:{width:30,height:30},onChange:function(t,n){return e.onTokenFetchRequireChanged(n)},checked:t,icon:f.createElement(on.a,{style:{fontSize:20}}),checkedIcon:f.createElement(an.a,{style:{fontSize:20}})})}),t&&f.createElement("div",null,o.tpe.value===v.ImportOperationResourceUriResource.$Type.value&&f.createElement(Be.a,{style:{display:"block",width:"initial",marginLeft:"20px",marginBottom:"20px"},label:this.props.i18n.t("Ссылка для запроса токена"),value:o.uri,onChange:function(t){return e.onTokenFetchUtiChanged(t.target.value)},fullWidth:!0}),o.method instanceof v.HttpMethod&&f.createElement("div",{style:{marginLeft:"20px"}},f.createElement(Yt.a,{name:"httpMethod",onChange:function(t,n){return e.onTokenFetchHttpMethodChanged(n)},value:o.method.tpe.value},f.createElement(Rt.a,{value:v.HttpMethodGET.$Type.value,control:f.createElement(Xt.a,{style:{width:30,height:30},icon:f.createElement(cn.a,{style:{fontSize:20}}),checkedIcon:f.createElement(pn.a,{style:{fontSize:20}})}),label:this.props.i18n.t("GET")}),f.createElement(Rt.a,{value:v.HttpMethodPOST.$Type.value,control:f.createElement(Xt.a,{style:{width:30,height:30},icon:f.createElement(cn.a,{style:{fontSize:20}}),checkedIcon:f.createElement(pn.a,{style:{fontSize:20}})}),label:this.props.i18n.t("POST")}))),f.createElement("div",{style:{marginLeft:"20px"}},f.createElement(tn,{headers:o.headers,onChange:this.onTokenFetchHttpHeadersChanged,i18n:this.props.i18n})),o.method.tpe.value===v.HttpMethodPOST.$Type.value?f.createElement("div",{style:{marginLeft:"20px"}},f.createElement(Be.a,{fullWidth:!0,label:this.props.i18n.t("Тело запроса"),value:o.method.body,multiline:!0,rows:2,rowsMax:10,onChange:function(t){return e.onTokenFetchHttpMethodPOSTBodyChanged(t.target.value)}})):null,f.createElement(Rt.a,{style:{marginLeft:"5px"},label:this.props.i18n.t("Кешировать токен"),control:f.createElement(xt.a,{style:{width:30,height:30},onChange:function(t,n){return e.onTokenFetchCacheEnabled(n)},checked:r.enabled,icon:f.createElement(on.a,{style:{fontSize:20}}),checkedIcon:f.createElement(an.a,{style:{fontSize:20}})})}),r.enabled&&f.createElement(Be.a,{style:{marginLeft:"20px"},fullWidth:!0,label:this.props.i18n.t("Время кеширования, мин"),value:r.expiredIn.getMinutes(),onChange:this.onExpiredInChanged}),f.createElement(Be.a,{fullWidth:!0,label:this.props.i18n.t("Путь к токену"),value:n,onChange:function(t){return e.onTokenFetchJsonPathChanged(t.target.value)},style:{marginLeft:"20px"}}),f.createElement("div",{style:{marginLeft:"20px",fontSize:"small",color:"#757575"}},this.props.i18n.t("Для подстановки токена используйте переменную $access_token"))))}}]),t}(f.Component),fn=dn=un([g.autobind],dn),hn=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gn=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"onFileFieldChanged",value:function(e){var t=this;e.foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{fileFieldId:{$set:e}})))})}},{key:"onHttpHeadersChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{headers:{$set:e}}})))}},{key:"onHttpMethodChanged",value:function(e,t){var n=void 0;switch(t){case v.HttpMethodGET.$Type.value:n=new v.HttpMethodGET;break;case v.HttpMethodPOST.$Type.value:n=new v.HttpMethodPOST("");break;default:throw"Unknown http method type"}this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{method:{$set:n}}})))}},{key:"onFileProcessingChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{processing:{$set:function(){switch(e.target.value){case v.FileProcessingNoOp.$Type.value:return new v.FileProcessingNoOp;case v.FileProcessingJsonBase64.$Type.value:return new v.FileProcessingJsonBase64("","");default:throw"Unknown file processing type"}}()}})))}},{key:"onJsonProcessingPathChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{processing:{path:{$set:e.target.value}}})))}},{key:"onJsonProcessingFileExtChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{processing:{fileExt:{$set:e.target.value}}})))}},{key:"onHttpMethodPOSTBodyChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{method:{body:{$set:e.target.value}}}})))}},{key:"onFetchUriChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{uri:{$set:e.target.value}}})))}},{key:"onTokenFetchChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{tokenFetch:{$set:Object(he.toOption)(e)}}})))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(bt.a,{labelText:Object(he.toOption)(this.props.i18n.t("Поле для сохранения файла")),fields:Object(Ct.e)(this.props.fields,this.props.actionConfig.formId).getOrElse(function(){return[]}),onChanged:this.onFileFieldChanged,fullWidth:!0,native:!0,value:Object(he.toOption)(this.props.actionConfig.fileFieldId),errorText:new he.None}),Object(he.toOption)(this.props.actionConfig.resource).filter(function(e){return e.tpe.value===v.ImportOperationResourceUriResource.$Type.value}).map(function(e){return e}).map(function(t){return f.createElement(Be.a,{label:e.props.i18n.t("Ссылка на файл"),value:t.uri,onChange:e.onFetchUriChanged,fullWidth:!0})}).getOrNull(),Object(he.toOption)(this.props.actionConfig.resource).filter(function(e){return e.tpe.value===v.ImportOperationResourceUriResource.$Type.value}).map(function(e){return e}).map(function(e){return e.method}).map(function(t){return f.createElement("div",null,f.createElement("h4",null,e.props.i18n.t("Авторизация")),f.createElement(fn,{i18n:e.props.i18n,tokenFetch:Object(he.toOption)(e.props.actionConfig.resource).filter(function(e){return e instanceof v.ImportOperationResourceUriResource}).flatMap(function(e){return e.tokenFetch}).getOrElse(function(){return new v.TokenFetch(!1,new v.ImportOperationResourceUriResource("",new v.HttpMethodGET,[new v.HttpHeader("","")]),"")}),onChange:e.onTokenFetchChanged}),f.createElement("h4",null,e.props.i18n.t("Настройки основного запроса")),t instanceof v.HttpMethod&&f.createElement("div",null,f.createElement(Yt.a,{name:"httpMethod",onChange:e.onHttpMethodChanged,value:t.tpe.value},f.createElement(Rt.a,{label:e.props.i18n.t("GET"),value:v.HttpMethodGET.$Type.value,control:f.createElement(Xt.a,null)}),f.createElement(Rt.a,{label:e.props.i18n.t("POST"),value:v.HttpMethodPOST.$Type.value,control:f.createElement(Xt.a,null)}))))}).getOrNull(),Object(he.toOption)(this.props.actionConfig.resource).filter(function(e){return e.tpe.value===v.ImportOperationResourceUriResource.$Type.value}).map(function(e){return e}).map(function(e){return e.headers}).map(function(t){return f.createElement(tn,{headers:t,onChange:e.onHttpHeadersChanged,i18n:e.props.i18n})}).getOrNull(),Object(he.toOption)(this.props.actionConfig.resource).filter(function(e){return e.tpe.value===v.ImportOperationResourceUriResource.$Type.value}).map(function(e){return e}).filter(function(e){return e.method.tpe.value===v.HttpMethodPOST.$Type.value}).map(function(e){return e.method}).map(function(t){return f.createElement("div",null,f.createElement(Be.a,{fullWidth:!0,label:e.props.i18n.t("Тело запроса"),value:t.body,multiline:!0,rows:2,rowsMax:10,onChange:e.onHttpMethodPOSTBodyChanged}))}).getOrNull(),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Способ дополнительной обработки")),f.createElement(it.a,{value:this.props.actionConfig.processing.tpe.value,fullWidth:!0,onChange:this.onFileProcessingChanged},f.createElement(gt.a,{value:v.FileProcessingNoOp.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Без обработки")})),f.createElement(gt.a,{value:v.FileProcessingJsonBase64.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Файл(ы) в base64 в теле JSON")})))),this.props.actionConfig.processing instanceof v.FileProcessingJsonBase64&&f.createElement("div",null,f.createElement(Be.a,{label:this.props.i18n.t("Путь JSON"),fullWidth:!0,value:this.props.actionConfig.processing.path,onChange:this.onJsonProcessingPathChanged}),f.createElement(Be.a,{label:this.props.i18n.t("Расширение файла"),fullWidth:!0,value:this.props.actionConfig.processing.fileExt,onChange:this.onJsonProcessingFileExtChanged})))}}]),t}(f.Component);gn=hn([g.autobind],gn);var mn=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(gn),vn=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yn=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId),this.props.dispatch(Object(ve.b)(this.props.actionConfig.formId))}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&(e.onFormIdChange(e.actionConfig.formId),e.dispatch(Object(ve.b)(e.actionConfig.formId)))}},{key:"onImportPipelineChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{configId:{$set:new v.Id(e.target.value)}})))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Конфигурация импорта")),f.createElement(it.a,{value:this.props.actionConfig.configId.value,fullWidth:!0,onChange:this.onImportPipelineChanged},this.props.importPipelines.descriptionsList.map(function(e){return f.createElement(gt.a,{value:e.id.toString(),key:e.id.toString()},f.createElement(_e.a,{primary:e.name}))}))))}}]),t}(f.Component);yn=vn([g.autobind],yn);var Cn=Object(h.connect)(function(e){return{i18n:e.i18n,importPipelines:e.importPipelines}})(yn),En=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bn=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"getFormDataStatus",value:function(e){switch(e){case v.FormDataStatusDeleted.$Type.value:return new v.FormDataStatusDeleted;case v.FormDataStatusNominalDeleted.$Type.value:return new v.FormDataStatusNominalDeleted;default:throw"unknown form data status type"}}},{key:"onFormDataStatusChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{status:{$set:this.getFormDataStatus(e.target.value)}})))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Статус удаления")),f.createElement(it.a,{value:this.props.actionConfig.status.tpe.value,fullWidth:!0,onChange:this.onFormDataStatusChanged},f.createElement(gt.a,{value:v.FormDataStatusNominalDeleted.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Временное удаление")})),f.createElement(gt.a,{value:v.FormDataStatusDeleted.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Перманентное удаление")})))))}}]),t}(f.Component);bn=En([g.autobind],bn);var On=Object(h.connect)(function(e){return{i18n:e.i18n,importPipelines:e.importPipelines}})(bn),jn=n(4),In=n.n(jn),kn=n(75),Tn=n.n(kn),Pn=n(376),wn=n.n(Pn),Fn=n(2369),xn=n.n(Fn),Dn=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Rn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_n=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={newReceiver:new he.None,editedReceiver:new he.None,editedReceiverIdx:new he.None},n}return p()(t,e),a()(t,[{key:"onReceiverAdded",value:function(){var e=this;this.state.newReceiver.foreach(function(t){e.props.onChange(j(e.props.receivers,{$push:[t]})),e.setState(j(e.state,{newReceiver:{$set:new he.None}}))})}},{key:"onReceiverDeleted",value:function(e){this.props.onChange(j(this.props.receivers,{$splice:[[e,1]]}))}},{key:"onEditedReceiverChanged",value:function(e){this.setState(j(this.state,{editedReceiver:{$set:Object(he.toOption)(e.target.value)}}))}},{key:"onReceiverSave",value:function(){var e=this;this.state.editedReceiverIdx.foreach(function(t){e.state.editedReceiver.foreach(function(n){e.setState(j(e.state,{editedReceiver:{$set:new he.None},editedReceiverIdx:{$set:new he.None}}),function(){e.props.onChange(j(e.props.receivers,{$splice:[[t,1,n]]}))})})})}},{key:"onReceiverSelected",value:function(e){this.setState(j(this.state,{editedReceiverIdx:{$set:Object(he.toOption)(e)},editedReceiver:{$set:Object(he.toOption)(this.props.receivers[e])}}))}},{key:"onNewReceiverChanged",value:function(e){this.setState(j(this.state,{newReceiver:{$set:Object(he.toOption)(e.target.value)}}))}},{key:"getTextFieldTitle",value:function(){return this.props.notificationType instanceof v.MessageParamsDataEmailData?this.props.i18n.t("Email получателя"):this.props.i18n.t("Номер получателя")}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(wn.a,null,this.props.i18n.t("Список получателей")),this.props.receivers.map(function(t,n){return f.createElement("div",{key:n,style:{display:"flex",alignItems:"center"}},e.state.editedReceiverIdx.getOrNull()===n?f.createElement(Be.a,{style:{flex:1},label:e.getTextFieldTitle(),value:e.state.editedReceiver.getOrElse(function(){return""}),onChange:e.onEditedReceiverChanged}):f.createElement("div",{style:{flex:1}},t),e.state.editedReceiverIdx.getOrNull()===n?f.createElement(ke.a,{style:{alignSelf:"center",flexShrink:0},onClick:e.onReceiverSave},f.createElement(xn.a,null)):f.createElement(ke.a,{style:{alignSelf:"center",flexShrink:0},onClick:function(){return e.onReceiverSelected(n)}},f.createElement(Me.a,null)),f.createElement(ke.a,{style:{alignSelf:"center",flexShrink:0},onClick:function(){return e.onReceiverDeleted(n)}},f.createElement(Se.a,null)))}),f.createElement("div",{style:{display:"flex",alignItems:"center"}},f.createElement(Be.a,{style:{flex:1},placeholder:this.getTextFieldTitle(),value:this.state.newReceiver.getOrElse(function(){return""}),onChange:this.onNewReceiverChanged}),f.createElement(E.a,{variant:"raised",style:{alignSelf:"center",flexShrink:0},disabled:this.state.newReceiver.isEmpty(),onClick:this.onReceiverAdded},this.props.i18n.t("Добавить"))))}}]),t}(f.Component);_n=Dn([g.autobind,Rn("design:paramtypes",[Object])],_n);var $n=Object(h.connect)(function(e){return{i18n:e.i18n}})(_n),Sn=n(82),Nn=n(161),Mn=n(56),Ln=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},An=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Wn=v.Id.createId(Ee.v4()),Hn=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={notificationType:new he.None},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;this.getFormIdFormTemplateId(this.props.actionConfig.template).foreach(function(t){e.setFormId(t)}),this.getTemplate(this.props.actionConfig.template,this.props.notifyTemplatesList).map(function(t){e.setNotifyType(new he.TypeId(t.params))}).getOrElse(function(){e.setNotifyType(v.MessageParamsDataEmailData.$Type)})}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.actionConfig.template.value!==this.props.actionConfig.template.value&&(this.getFormIdFormTemplateId(e.actionConfig.template).foreach(function(e){t.setFormId(e)}),this.getTemplate(e.actionConfig.template,e.notifyTemplatesList).map(function(e){t.setNotifyType(new he.TypeId(e.params))}).getOrElse(function(){t.setNotifyType(v.MessageParamsDataEmailData.$Type)}))}},{key:"setFormId",value:function(e){this.props.formId.map(function(e){return e.value}).getOrElse(function(){return""})!==e.value&&this.props.onFormIdChange(e)}},{key:"getTemplate",value:function(e,t){return Object(he.headOption)(t.getOrElse(function(){return[]}).filter(function(t){return t.id===e.value}))}},{key:"getFormIdFormTemplateId",value:function(e){return this.getTemplate(e,this.props.notifyTemplatesList).map(function(e){return new v.Id(e.formId)})}},{key:"onSendNotifyTemplateIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{template:{$set:new v.Id(e.target.value)}})))}},{key:"onReceiversEnabled",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{receiversEnabled:{$set:e}})))}},{key:"onDraftOnlyEnabled",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{draftOnly:{$set:e}})))}},{key:"onReceiversChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{receivers:{$set:e}})))}},{key:"setNotifyType",value:function(e){this.setState(j(this.state,{notificationType:{$set:Object(he.toOption)(e)}}))}},{key:"onSendNotifyTypeChanged",value:function(e){this.setNotifyType(new he.TypeId(e.target.value))}},{key:"onFilterSettingsRequest",value:function(){var e=this,t=this.props.actionConfig,n=this.props.openDialog(this.props.i18n.t("Настройка фильтрации"),this.props.formId.map(function(n){return Wn.map(function(o){return f.createElement(Nn.a,{formId:n,filterId:o,value:t.filter,onChange:e.handleFilterChange})}).getOrElse(function(){return f.createElement(f.Fragment,null)})}).getOrElse(function(){return f.createElement(f.Fragment,null)}),[f.createElement(E.a,{key:"close",variant:"raised",style:{marginRight:"10px"},onClick:function(){return e.props.handleDialogClose(n)}},this.props.i18n.t("Закрыть"))])}},{key:"handleFilterChange",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{filter:{$set:e}})))}},{key:"renderFilteredNotificationsOptions",value:function(){return f.createElement(E.a,{color:"primary",onClick:this.onFilterSettingsRequest},this.props.i18n.t("Настройка фильтрации"))}},{key:"renderDefaultOptions",value:function(e){var t=this;return f.createElement(f.Fragment,null,f.createElement(Rt.a,{label:this.props.i18n.t("Отправлять по списку получателей"),control:f.createElement(Tn.a,{checked:e.receiversEnabled,onChange:function(e,n){return t.onReceiversEnabled(n)}})}),f.createElement(Rt.a,{label:this.props.i18n.t("Создавать черновик"),control:f.createElement(Tn.a,{checked:e.draftOnly,onChange:function(e,n){return t.onDraftOnlyEnabled(n)}})}),e.receiversEnabled&&f.createElement($n,{receivers:e.receivers,onChange:this.onReceiversChanged,notificationType:this.state.notificationType.getOrElse(function(){return v.MessageParamsDataEmailData.$Type})}))}},{key:"renderOptions",value:function(e){var t;return Object(Mn.b)(e.tpe.value)((t={},In()(t,v.SendNotification.$Type.value,this.renderDefaultOptions(e)),In()(t,v.SendAggregateNotification.$Type.value,this.renderDefaultOptions(e)),In()(t,v.SendNotificationsFiltered.$Type.value,this.renderFilteredNotificationsOptions()),t)).getOrElse(function(){throw"unknown actionConfig type "+e.tpe.value})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Способ отправления")),f.createElement(it.a,{fullWidth:!0,value:this.state.notificationType.map(function(e){return e.value}).getOrElse(function(){return""}),onChange:this.onSendNotifyTypeChanged},f.createElement(gt.a,{key:v.MessageParamsDataEmailData.$Type.value,value:v.MessageParamsDataEmailData.$Type.value},this.props.i18n.t("Email")),f.createElement(gt.a,{key:v.MessageParamsDataSmsData.$Type.value,value:v.MessageParamsDataSmsData.$Type.value},this.props.i18n.t("SMS")),!Sn.default.isA5000&&f.createElement(gt.a,{key:v.MessengerParamsData.$Type.value,value:v.MessengerParamsData.$Type.value},this.props.i18n.t("Телеграм")),f.createElement(gt.a,{key:v.MessageParamsDataWebPushData.$Type.value,value:v.MessageParamsDataWebPushData.$Type.value},this.props.i18n.t("Пуш уведомление")))),this.renderOptions(this.props.actionConfig),this.props.formId.map(function(t){return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,e.props.i18n.t("Шаблон сообщения")),f.createElement(it.a,{fullWidth:!0,value:e.props.actionConfig.template.value,onChange:e.onSendNotifyTemplateIdChanged},e.props.notifyTemplatesList.getOrElse(function(){return[]}).filter(function(e){return t.value===e.formId}).filter(function(t){return e.state.notificationType.map(function(e){return t.params===e.value}).getOrElse(function(){return!1})}).map(function(e,t){return f.createElement(gt.a,{key:t,value:e.id},e.name)})))}).getOrNull())}}]),t}(f.Component);Hn=Ln([g.autobind,An("design:paramtypes",[Object])],Hn);var Un=Object(h.connect)(function(e,t){return{i18n:e.i18n,notifyTemplatesList:t.formId.map(function(t){return e.notifyTemplates.eventLineDescriptionsList.filter(function(n){return e.user.userRole.map(function(e){return!e.entity.isNotifyTemplateRestricted(t,new v.Id(n.id))}).getOrElse(function(){return!1})})})}})(Object(Ue.a)(Hn)),Jn=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Vn=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;this.getFormIdFormTemplateId(this.props.actionConfig.template).foreach(function(t){e.setFormId(t)})}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.actionConfig.template.value!==this.props.actionConfig.template.value&&this.getFormIdFormTemplateId(e.actionConfig.template).foreach(function(e){t.setFormId(e)})}},{key:"setFormId",value:function(e){this.props.formId.map(function(e){return e.value}).getOrElse(function(){return""})!==e.value&&this.props.onFormIdChange(e)}},{key:"getTemplate",value:function(e){return Object(he.headOption)(this.props.notifyTemplatesList.getOrElse(function(){return[]}).filter(function(t){return t.id===e.value}))}},{key:"getFormIdFormTemplateId",value:function(e){return this.getTemplate(e).map(function(e){return new v.Id(e.formId)})}},{key:"onSendNotifyTemplateIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{template:{$set:new v.Id(e.target.value)}})))}},{key:"setNotifyType",value:function(e){this.setState(j(this.state,{notificationType:{$set:Object(he.toOption)(e)}}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Шаблон сообщения")),f.createElement(it.a,{fullWidth:!0,value:this.props.actionConfig.template.value,onChange:this.onSendNotifyTemplateIdChanged},""!==this.props.formId.map(function(e){return e.value}).getOrElse(function(){return""})?this.props.notifyTemplatesList.getOrElse(function(){return[]}).filter(function(t){return e.props.formId.map(function(e){return e.value===t.formId}).getOrElse(function(){return!1})}).filter(function(e){return e.params===v.MessageParamsDataFacebookData.$Type.value||e.params===v.MessageParamsDataLinkedInData.$Type.value}).map(function(e,t){return f.createElement(gt.a,{key:t,value:e.id},e.name)}):[])))}}]),t}(f.Component);Vn=Jn([g.autobind],Vn);var Bn=Object(h.connect)(function(e){return{i18n:e.i18n,notifyTemplatesList:e.currentForm.data.map(function(t){return e.notifyTemplates.eventLineDescriptionsList.filter(function(n){return e.user.userRole.map(function(e){return!e.entity.isNotifyTemplateRestricted(t.id,new v.Id(n.id))}).getOrElse(function(){return!1})})})}})(Vn),zn=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Gn=function(e){function t(e){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p()(t,e),a()(t,[{key:"onApplictionIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{appId:{$set:new v.Id(e.target.value)}})))}},{key:"onAllowedStatusEnabled",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{allowedStatus:{$set:e}})))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("application|Приложение")),f.createElement(it.a,{fullWidth:!0,value:this.props.actionConfig.appId.value,onChange:this.onApplictionIdChanged},this.props.applications.list.map(function(e){return f.createElement(gt.a,{key:e.id.value,value:e.id.value},e.entity.name)}))),f.createElement(Rt.a,{label:this.props.i18n.t("Регистрация активна"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.allowedStatus,onChange:function(t,n){return e.onAllowedStatusEnabled(n)}})}))}}]),t}(f.Component);Gn=zn([g.autobind,qn("design:paramtypes",[Object])],Gn);var Zn=Object(h.connect)(function(e){return{i18n:e.i18n,applications:e.applications}})(Gn),Yn=n(418),Kn=n(46),Xn=n(1495),Qn=n(422),eo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},to=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},no=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={templateEditor:!1},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"onExportUriChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{uri:{$set:e.target.value}}})))}},{key:"onHttpHeadersChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{headers:{$set:e}}})))}},{key:"getMethod",value:function(e){switch(e){case v.HttpMethodGET.$Type.value:return new v.HttpMethodGET;case v.HttpMethodPOST.$Type.value:return new v.HttpMethodPOST("");case v.HttpMethodPUT.$Type.value:return new v.HttpMethodPUT("");default:throw"Unknown http method type"}}},{key:"onHttpMethodChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{method:{$set:this.getMethod(e.target.value)}}})))}},{key:"onHttpMethodBodyChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{method:{body:{$set:e.target.value}}}})))}},{key:"onOpenTooltip",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Подсказка"),f.createElement("div",{className:"Tooltip_content"},f.createElement("p",null,this.props.i18n.t("Для простой вставки полей используйте $idX, где X - id поля анкеты, значение из которого требуется вставить.")),f.createElement("p",null,this.props.i18n.t("Доступно для использования в URI, Headers, Body.")),f.createElement("p",null,this.props.i18n.t("Для использования функционала шаблонизатора используйте пример:")),f.createElement("pre",null,f.createElement("p",null,"{{for user in FormName}}"),f.createElement("p",null,"   Hello {{user. FieldSystemName}}"),f.createElement("p",null,"{{/for}}")),f.createElement("p",null,this.props.i18n.t("Массив обязателен даже для одной анкеты.")),f.createElement("p",null,this.props.i18n.t("Доступно для использования в Body."))),[f.createElement(E.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(t)}},this.props.i18n.t("Закрыть"))])}},{key:"onEventIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{eventId:{$set:v.Id.createId(e.target.value).getOrElse(function(){throw"wrong journey event id"})}})))}},{key:"onTokenFetchChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{tokenFetch:{$set:Object(he.toOption)(e)}}})))}},{key:"onBodyTemplateChange",value:function(e){var t=Object(wt.convertToRaw)(e.getCurrentContent());this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{resource:{method:{body:{$set:Object(Ht.a)(t)}}}})))}},{key:"onBodyEditRequest",value:function(){this.setState({templateEditor:!this.state.templateEditor})}},{key:"render",value:function(){var e=this,t=this.props.actionConfig.resource.method;return f.createElement("div",null,f.createElement(Qn.a,{label:this.props.i18n.t("Идентификатор события"),fullWidth:!0,eventLineId:this.props.eventLineId,value:this.props.actionConfig.eventId.value,onChange:this.onEventIdChanged}),Object(he.toOption)(this.props.actionConfig.resource).filter(function(e){return e.tpe.value===v.ImportOperationResourceUriResource.$Type.value}).map(function(e){return e}).map(function(t){return f.createElement(Be.a,{placeholder:e.props.i18n.t("Ссылка экспорта"),value:t.uri,onChange:e.onExportUriChanged,fullWidth:!0})}).getOrNull(),f.createElement("div",{style:{display:"flex",flexWrap:"nowrap",alignItems:"center",justifyContent:"space-between"}},f.createElement("h4",null,this.props.i18n.t("Метод")),!Sn.default.isA5000&&f.createElement(ke.a,{style:Kn.f,onClick:this.onOpenTooltip},f.createElement(Yn.a,{style:Kn.g}))),f.createElement(Yt.a,{name:"httpMethod",style:{padding:"5px"},onChange:this.onHttpMethodChanged,value:t.tpe.value},f.createElement(Rt.a,{control:f.createElement(Xt.a,{style:Kn.h,icon:f.createElement(cn.a,{style:Kn.g}),checkedIcon:f.createElement(pn.a,{style:Kn.g})}),value:v.HttpMethodGET.$Type.value,label:this.props.i18n.t("GET")}),f.createElement(Rt.a,{control:f.createElement(Xt.a,{style:Kn.h,icon:f.createElement(cn.a,{style:Kn.g}),checkedIcon:f.createElement(pn.a,{style:Kn.g})}),value:v.HttpMethodPOST.$Type.value,label:this.props.i18n.t("POST")}),f.createElement(Rt.a,{control:f.createElement(Xt.a,{style:Kn.h,icon:f.createElement(cn.a,{style:Kn.g}),checkedIcon:f.createElement(pn.a,{style:Kn.g})}),value:v.HttpMethodPUT.$Type.value,label:this.props.i18n.t("PUT")})),Object(he.toOption)(this.props.actionConfig.resource).filter(function(e){return e.tpe.value===v.ImportOperationResourceUriResource.$Type.value}).map(function(e){return e}).map(function(e){return e.headers}).map(function(t){return f.createElement(tn,{headers:t,onChange:e.onHttpHeadersChanged,i18n:e.props.i18n})}).getOrNull(),(t instanceof v.HttpMethodPOST||t instanceof v.HttpMethodPUT)&&f.createElement(f.Fragment,null,f.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},f.createElement("h4",null,this.props.i18n.t("Body")),f.createElement("div",{style:{marginLeft:15}},f.createElement(Xn.a,{onClick:function(){return e.onBodyEditRequest()},variant:"outlined",color:"primary",size:"small"},this.state.templateEditor?"HTML":"Editor"))),this.state.templateEditor?f.createElement(Ut.a,{formId:this.props.actionConfig.formId,generators:[],onChange:this.onBodyTemplateChange,templateId:"",template:t.body,withRefFieldSelector:!0}):f.createElement(Be.a,{fullWidth:!0,placeholder:this.props.i18n.t("Тело запроса"),value:t.body,variant:"outlined",multiline:!0,rows:2,rowsMax:10,onChange:this.onHttpMethodBodyChanged})),this.props.actionConfig.resource.tokenFetch.map(function(t){return f.createElement(f.Fragment,null,f.createElement("h4",null,e.props.i18n.t("Авторизация")),f.createElement(fn,{i18n:e.props.i18n,tokenFetch:t,onChange:e.onTokenFetchChanged}))}).getOrNull())}}]),t}(f.Component);no=eo([g.autobind,to("design:paramtypes",[Object])],no);var oo=Object(h.connect)(function(e){return{i18n:e.i18n}})(Object(Ue.a)(no)),ro=n(1477),io=n(651),ao=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},so=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId),this.props.dispatch(Object(ro.c)(this.props.actionConfig.formId))}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&(e.onFormIdChange(e.actionConfig.formId),e.dispatch(Object(ro.c)(e.actionConfig.formId)))}},{key:"onTerminalChange",value:function(e){"FROM_SOURCE"===e.target.value?this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{terminalFromSource:{$set:!0}}))):this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{terminalId:{$set:Object(he.toOption)(e.target.value).map(function(t){return new v.Id(e.target.value)})},terminalFromSource:{$set:!1}})))}},{key:"onDocumentChange",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{documentId:{$set:new v.Id(e.target.value)}})))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Терминал")),f.createElement(it.a,{fullWidth:!0,onChange:this.onTerminalChange,value:this.props.actionConfig.terminalFromSource?"FROM_SOURCE":this.props.actionConfig.terminalId.map(function(e){return e.value}).getOrElse(function(){return""})},f.createElement(gt.a,{key:"FROM_SOURCE",value:"FROM_SOURCE"},f.createElement(_e.a,{primary:this.props.i18n.t("Из события")})),this.props.terminals.list.map(function(e){return f.createElement(gt.a,{key:e.id.value,value:e.id.value},f.createElement(_e.a,{primary:e.entity.name}))}))),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Документ")),f.createElement(it.a,{fullWidth:!0,onChange:this.onDocumentChange,value:this.props.actionConfig.documentId.value},Object(io.b)(this.props.documents,this.props.actionConfig.formId).getOrElse(function(){return[]}).map(function(e){return f.createElement(gt.a,{key:e.id.value,value:e.id.value},f.createElement(_e.a,{primary:e.entity.name}))}))))}}]),t}(f.Component);so=ao([g.autobind],so);var co=Object(h.connect)(function(e){return{i18n:e.i18n,terminals:e.terminals,documents:e.formDocuments}})(so),lo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},po=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"onLinkedFieldChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{linkedField:{$set:e}})))}},{key:"onFormChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{formId:{$set:e}})))}},{key:"onEventIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{eventId:{$set:v.Id.createId(e.target.value).getOrElse(function(){throw"wrong journey event id"})}})))}},{key:"onLinkEnabledChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{linkEnabled:{$set:e}})))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Qn.a,{label:this.props.i18n.t("Идентификатор события"),fullWidth:!0,eventLineId:this.props.eventLineId,value:this.props.actionConfig.eventId.value,onChange:this.onEventIdChanged}),f.createElement(Rt.a,{label:this.props.i18n.t("Связать с полем"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.linkEnabled,onChange:function(t,n){return e.onLinkEnabledChanged(n)}})}),this.props.actionConfig.linkEnabled&&f.createElement("div",null,f.createElement(Et.a,{formId:Object(he.toOption)(this.props.actionConfig.formId),onChange:this.onFormChanged,excludedForms:[]}),f.createElement(bt.a,{labelText:Object(he.toOption)(this.props.i18n.t("Поле")),fields:Object(Ct.e)(this.props.fields,this.props.actionConfig.formId).getOrElse(function(){return[]}),onChanged:this.onLinkedFieldChanged,fullWidth:!0,native:!0,value:this.props.actionConfig.linkedField,errorText:new he.None})))}}]),t}(f.Component);po=lo([g.autobind],po);var uo=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(po),fo=n(174),ho=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},go=new v.Id(Ee.v4()),mo=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.sourceFormId),this.fetchFields(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.sourceFormId.value!==this.props.actionConfig.sourceFormId.value&&e.onFormIdChange(e.actionConfig.sourceFormId),e.actionConfig.targetFormId.value!==this.props.actionConfig.targetFormId.value&&this.fetchFields(e)}},{key:"fetchFields",value:function(e){var t=this;Object(he.toOption)(this.props.actionConfig.targetFormId).filter(function(e){return""!==e.value}).foreach(function(e){t.props.dispatch(Object(fo.e)(e))})}},{key:"onLinkedFieldChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{linkedField:{$set:e}})))}},{key:"onSourceFormChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{sourceFormId:{$set:e}})))}},{key:"onTargetFormChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{targetFormId:{$set:e}})))}},{key:"onTargetEventIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{targetEventId:{$set:v.Id.createId(e.target.value).getOrElse(function(){throw"wrong journey event id"})}})))}},{key:"onEventBusEnabledChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{eventBus:{$set:e}})))}},{key:"onEventSerialOutEnabledChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{serialOut:{$set:e}})))}},{key:"onFilterChanged",value:function(e){var t=this;e.foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{filter:{$set:e}})))})}},{key:"onFilterSettingsClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Настройка фильтра"),f.createElement(Nn.a,{value:Object(he.toOption)(this.props.actionConfig.filter),filterId:go,formId:this.props.actionConfig.targetFormId,sourceFormId:this.props.actionConfig.sourceFormId,onChange:this.onFilterChanged}),[f.createElement(E.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(t)}},this.props.i18n.t("Закрыть"))],{maxWidth:"md"})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Qn.a,{label:this.props.i18n.t("Идентификатор события"),fullWidth:!0,eventLineId:this.props.eventLineId,value:this.props.actionConfig.targetEventId.value,onChange:this.onTargetEventIdChanged}),f.createElement(Rt.a,{label:this.props.i18n.t("Шина данных"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.eventBus,onChange:function(t,n){return e.onEventBusEnabledChanged(n)}})}),f.createElement(Rt.a,{label:this.props.i18n.t("Множественный поиск"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.serialOut,onChange:function(t,n){return e.onEventSerialOutEnabledChanged(n)}})}),f.createElement(Et.a,{label:this.props.i18n.t("Форма источника"),formId:Object(he.toOption)(this.props.actionConfig.sourceFormId),onChange:this.onSourceFormChanged,excludedForms:[]}),f.createElement(Et.a,{label:this.props.i18n.t("Форма назначения"),formId:Object(he.toOption)(this.props.actionConfig.targetFormId),onChange:this.onTargetFormChanged,excludedForms:[]}),this.props.actionConfig.sourceFormId.value&&this.props.actionConfig.targetFormId.value&&f.createElement("div",null,f.createElement(E.a,{variant:"raised",onClick:this.onFilterSettingsClick},this.props.i18n.t("Настроить фильтр"))),f.createElement(J.a,null,"* "+this.props.i18n.t("Ограничено 5000 записей")))}}]),t}(f.Component);mo=ho([g.autobind],mo);var vo=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(Object(Ue.a)(mo)),yo=n(1883),Co=n(67),Eo=n(70),bo=n(2115),Oo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},jo=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.actionConfig.params instanceof v.DataParserParamsFormDataSource&&""!==this.props.actionConfig.params.formId.value&&this.props.dispatch(Object(fo.e)(this.props.actionConfig.params.formId))}},{key:"componentWillReceiveProps",value:function(){}},{key:"onEventIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{eventId:{$set:v.Id.createId(e.target.value).getOrElse(function(){throw"wrong journey event id"})}})))}},{key:"getTextParser",value:function(e){var t=this.props.defaultFormId.getOrElse(function(){return new v.Id("")});switch(e){case v.DataParserParamsFormDataSource.$Type.value:return new v.DataParserParamsFormDataSource(t,new v.Id(""));case v.DataParserParamsByteArraySource.$Type.value:return new v.DataParserParamsByteArraySource;default:return new v.DataParserParamsFormDataSource(t,new v.Id(""))}}},{key:"onTextParserChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{params:{$set:this.getTextParser(e.target.value)}})))}},{key:"onTextParserFormIdChanged",value:function(e){this.props.dispatch(Object(fo.e)(e)),this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{params:{formId:{$set:e}}})))}},{key:"onTextParserFieldChanged",value:function(e){var t=this;e.foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{params:{sourceTextFieldId:{$set:e}}})))})}},{key:"onFormatterConfigChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{formatter:{config:{$set:e.target.value}}})))}},{key:"onSerialOutChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{serialOut:{$set:!e}})))}},{key:"onReadConfigSaveClick",value:function(e){var t=this;this.props.importPipelineEditor.params.map(function(e){return Object(yo.a)(e)}).filter(function(e){return e instanceof Co.b}).foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{reader:{$set:e.readStage}})))}),this.props.handleDialogClose(e)}},{key:"onReadConfigClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Настройка формата импорта"),f.createElement(To,{stage:this.props.actionConfig.reader}),[f.createElement(E.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return e.onReadConfigSaveClick(t)},color:"primary"},this.props.i18n.t("Применить"))])}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Qn.a,{label:this.props.i18n.t("Идентификатор события"),fullWidth:!0,eventLineId:this.props.eventLineId,value:this.props.actionConfig.eventId.value,onChange:this.onEventIdChanged}),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Тип источника данных")),f.createElement(it.a,{value:this.props.actionConfig.params.tpe.value,fullWidth:!0,onChange:this.onTextParserChanged},f.createElement(gt.a,{value:v.DataParserParamsFormDataSource.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Анкета")})),f.createElement(gt.a,{value:v.DataParserParamsByteArraySource.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Массив байтов")})))),this.props.actionConfig.params instanceof v.DataParserParamsFormDataSource&&f.createElement("div",null,f.createElement(Et.a,{formId:Object(he.toOption)(this.props.actionConfig.params.formId),onChange:this.onTextParserFormIdChanged,excludedForms:[]}),f.createElement(bt.a,{labelText:Object(he.toOption)(this.props.i18n.t("Поле")),fields:Object(Ct.e)(this.props.fields,this.props.actionConfig.params.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value!==v.ValueTypeFormDataAttribute.$Type.value}),onChanged:this.onTextParserFieldChanged,fullWidth:!0,native:!0,value:Object(he.toOption)(this.props.actionConfig.params.sourceTextFieldId),errorText:new he.None})),f.createElement(E.a,{variant:"raised",onClick:this.onReadConfigClick},this.props.i18n.t("Настроить конфигурацию чтения данных")),f.createElement(Rt.a,{label:this.props.i18n.t("Группировка ответов"),control:f.createElement(Tn.a,{checked:!this.props.actionConfig.serialOut,onChange:function(t,n){return e.onSerialOutChanged(n)}})}))}}]),t}(f.Component);jo=Oo([g.autobind],jo);var Io=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields,importPipelineEditor:e.importPipelineEditor}})(Object(Ue.a)(jo)),ko=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(Eo.ib)(new v.ME(new v.Id(Ee.v4()),new v.ImportPipeline(new v.Id(Ee.v4()),"",new v.ImportParamsFormDataStages(new v.ImportPipelineStageFetch(new v.ImportOperationResourceUriResource("",new v.HttpMethodGET,[]),new he.None),this.props.stage,new v.ImportPipelineStageFormat([]),new v.ImportPipelineStageMaterialize(new v.IdentityTypeFull,new he.None,new he.None),new he.None),[]))))}},{key:"render",value:function(){return this.props.importPipelineEditor.params.filter(function(e){return e instanceof Co.b}).map(function(e){return f.createElement(bo.a,{readStage:e.readStage})}).getOrNull()}}]),t}(f.Component),To=Object(h.connect)(function(e){return{importPipelineEditor:e.importPipelineEditor}})(ko),Po=n(1918),wo=n(1909),Fo=n(1910),xo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Do=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){this.props.actionConfig.formId.value!==e.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"onUpdateFormDataChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{updateFormDataFromEvent:{$set:e}})))}},{key:"onFormatSaveClick",value:function(e){var t=this;this.props.importPipelineEditor.params.map(function(e){return Object(yo.a)(e)}).filter(function(e){return e instanceof v.ImportParamsFormDataStages}).foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{format:{$set:e.formatStage},materializer:{$set:e.materialize}})))}),this.props.handleDialogClose(e)}},{key:"onAttributeEventIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{attributeEventId:{$set:v.Id.createId(e.target.value).getOrElse(function(){throw"wrong journey event id"})}})))}},{key:"onFormatSettingClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Настройка формата импорта"),f.createElement($o,{stage:this.props.actionConfig.format,stageMaterialize:this.props.actionConfig.materializer,formId:this.props.actionConfig.formId}),[f.createElement(E.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return e.onFormatSaveClick(t)},color:"primary"},this.props.i18n.t("Применить"))])}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Qn.a,{label:this.props.i18n.t("Идентификатор события"),fullWidth:!0,eventLineId:this.props.eventLineId,value:this.props.actionConfig.attributeEventId.value,onChange:this.onAttributeEventIdChanged}),f.createElement(Rt.a,{label:this.props.i18n.t("Изменять анкеты по данным из события"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.updateFormDataFromEvent,onChange:function(t,n){return e.onUpdateFormDataChanged(n)}})}),f.createElement(E.a,{variant:"raised",onClick:this.onFormatSettingClick},this.props.i18n.t("Настроить формат")),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"blue",marginRight:5}})," - ",this.props.i18n.t("Данные из парсера, с или без ИД анкеты")),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"green",marginRight:5}})," - ",this.props.i18n.t("Передаются данные попавшие на вход")))}}]),t}(f.Component);Do=xo([g.autobind],Do);var Ro=Object(h.connect)(function(e){return{i18n:e.i18n,importPipelineEditor:e.importPipelineEditor}})(Object(Ue.a)(Do)),_o=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(Eo.ib)(new v.ME(new v.Id(Ee.v4()),new v.ImportPipeline(this.props.formId,"",new v.ImportParamsFormDataStages(new v.ImportPipelineStageFetch(new v.ImportOperationResourceUriResource("",new v.HttpMethodGET,[]),new he.None),new v.ImportPipelineStageRead(new v.DataFormatExcel),this.props.stage,this.props.stageMaterialize,new he.None),[])))),this.props.dispatch(Object(fo.e)(this.props.formId))}},{key:"render",value:function(){var e=this;return this.props.importPipelineEditor.params.filter(function(e){return e instanceof Co.b}).map(function(t){return f.createElement(f.Fragment,null,f.createElement(Po.a,{format:t.formatStage,fetch:t.fetchStage,materialize:t.materialize,formId:e.props.formId,headers:[],initWithFirstField:!1,onHeadersDelete:function(){}}),f.createElement(wo.a,{identityType:t.materialize.identityType}),f.createElement(Fo.a,{deleteNonExistedRecords:t.materialize.deleteNonExistedRecords}))}).getOrNull()}}]),t}(f.Component),$o=Object(h.connect)(function(e){return{importPipelineEditor:e.importPipelineEditor}})(_o),So=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},No=new v.Id(Ee.v4()),Mo=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchFields(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.targetFormId.value!==this.props.actionConfig.targetFormId.value&&this.fetchFields(e)}},{key:"fetchFields",value:function(e){var t=this;Object(he.toOption)(this.props.actionConfig.targetFormId).filter(function(e){return""!==e.value}).foreach(function(e){t.props.dispatch(Object(fo.e)(e))})}},{key:"onLinkedFieldChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{linkedField:{$set:e}})))}},{key:"onSourceFormChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{sourceFormId:{$set:e}})))}},{key:"onTargetFormChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{targetFormId:{$set:e}})))}},{key:"onTargetEventIdChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{targetEventId:{$set:v.Id.createId(e.target.value).getOrElse(function(){throw"wrong journey event id"})}})))}},{key:"onEventBusEnabledChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{eventBus:{$set:e}})))}},{key:"onEventSerialOutEnabledChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{serialOut:{$set:e}})))}},{key:"onFilterChanged",value:function(e){var t=this;e.foreach(function(e){t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{filter:{$set:e}})))})}},{key:"onFilterSettingsClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Настройка фильтра"),f.createElement(Nn.a,{value:Object(he.toOption)(this.props.actionConfig.filter),filterId:No,formId:this.props.actionConfig.targetFormId,onChange:this.onFilterChanged}),[f.createElement(E.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(t)}},this.props.i18n.t("Закрыть"))],{maxWidth:"md"})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Qn.a,{label:this.props.i18n.t("Идентификатор события"),fullWidth:!0,eventLineId:this.props.eventLineId,value:this.props.actionConfig.targetEventId.value,onChange:this.onTargetEventIdChanged}),f.createElement(Rt.a,{label:this.props.i18n.t("Шина данных"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.eventBus,onChange:function(t,n){return e.onEventBusEnabledChanged(n)}})}),f.createElement(Rt.a,{label:this.props.i18n.t("Множественный поиск"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.serialOut,onChange:function(t,n){return e.onEventSerialOutEnabledChanged(n)}})}),f.createElement(Et.a,{label:this.props.i18n.t("Форма назначения"),formId:Object(he.toOption)(this.props.actionConfig.targetFormId),onChange:this.onTargetFormChanged,excludedForms:[]}),this.props.actionConfig.targetFormId.value&&f.createElement("div",null,f.createElement(E.a,{variant:"raised",onClick:this.onFilterSettingsClick},this.props.i18n.t("Настроить фильтр"))),f.createElement(J.a,null,"* "+this.props.i18n.t("Ограничено 5000 записей")))}}]),t}(f.Component);Mo=So([g.autobind],Mo);var Lo=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(Object(Ue.a)(Mo)),Ao=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Wo=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onReplaceCurrentalueChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{replace:{$set:e}})))}},{key:"onParentFormChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{parentForm:{$set:e}}))),this.props.onFormIdChange(e)}},{key:"onRefFieldChanged",value:function(e){var t=this;e.foreach(function(e){Object(he.headOption)(Object(Ct.e)(t.props.fields,t.props.actionConfig.parentForm).getOrElse(function(){return[]}).filter(function(t){return t.id.value===e.value})).map(function(n){return t.props.dispatch(Object(ge.T)(j(t.props.actionConfig,{refField:{$set:e},childForm:{$set:n.entity.valueType.family}})))})})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Rt.a,{label:this.props.i18n.t("Перезаписывать существующие значения"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.replace,onChange:function(t,n){return e.onReplaceCurrentalueChanged(n)}})}),f.createElement(Et.a,{label:this.props.i18n.t("Форма"),formId:Object(he.toOption)(this.props.actionConfig.parentForm),onChange:this.onParentFormChanged,excludedForms:[]}),f.createElement(bt.a,{labelText:Object(he.toOption)(this.props.i18n.t("Поле")),fields:Object(Ct.e)(this.props.fields,this.props.actionConfig.parentForm).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===v.ValueTypeObjectRefs.$Type.value}),onChanged:this.onRefFieldChanged,fullWidth:!0,native:!0,value:Object(he.toOption)(this.props.actionConfig.refField),errorText:new he.None}),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"green",marginRight:5}})," - ",this.props.i18n.t("Вход для основной анкеты")),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"blue",marginRight:5}})," - ",this.props.i18n.t("Вход для дочерней анкеты")))}}]),t}(f.Component);Wo=Ao([g.autobind],Wo);var Ho=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(Wo),Uo=function(e){switch(e){case v.EmailFieldTypeHtmlText.$Type.value:return new v.EmailFieldTypeHtmlText;case v.EmailFieldTypePlainText.$Type.value:return new v.EmailFieldTypePlainText;case v.EmailFieldTypeSubject.$Type.value:return new v.EmailFieldTypeSubject;default:throw"unknown email field type"}},Jo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Vo=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Bo=function(e){function t(e){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p()(t,e),a()(t,[{key:"onDataSourceChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{field:{$set:Uo(e.target.value)}})))}},{key:"onUpdatedAllowedEnabled",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{updatedAllowed:{$set:e}})))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Источник данных")),f.createElement(it.a,{fullWidth:!0,value:this.props.actionConfig.field.tpe.value,onChange:this.onDataSourceChanged},f.createElement(gt.a,{value:v.EmailFieldTypeHtmlText.$Type.value},this.props.i18n.t("Html письма")),f.createElement(gt.a,{value:v.EmailFieldTypePlainText.$Type.value},this.props.i18n.t("Текст письма")),f.createElement(gt.a,{value:v.EmailFieldTypeSubject.$Type.value},this.props.i18n.t("Тема письма")))),f.createElement(Rt.a,{label:this.props.i18n.t("Обновлять"),control:f.createElement(Tn.a,{checked:this.props.actionConfig.updatedAllowed,onChange:function(t,n){return e.onUpdatedAllowedEnabled(n)}})}))}}]),t}(f.Component);Bo=Jo([g.autobind,Vo("design:paramtypes",[Object])],Bo);var zo=Object(h.connect)(function(e){return{i18n:e.i18n}})(Bo),qo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Go=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.onFormIdChange(this.props.actionConfig.formId)}},{key:"componentWillReceiveProps",value:function(e){e.actionConfig.formId.value!==this.props.actionConfig.formId.value&&e.onFormIdChange(e.actionConfig.formId)}},{key:"onScriptChange",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{script:{$set:e.target.value}})))}},{key:"render",value:function(){return f.createElement(Be.a,{fullWidth:!0,label:this.props.i18n.t("Скрипт"),value:this.props.actionConfig.script,onChange:this.onScriptChange})}}]),t}(f.Component);Go=qo([g.autobind],Go);var Zo=Object(h.connect)(function(e){return{i18n:e.i18n}})(Go),Yo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ko=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xo=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={formId:new he.None},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.getFormIdFromTemplate(this.props)}},{key:"getFormIdFromTemplate",value:function(e){var t=this;(e.actionConfig instanceof v.SendNotification||e.actionConfig instanceof v.SendAggregateNotification||e.actionConfig instanceof v.SendNotificationsFiltered)&&Object(he.headOption)(e.eventLineDescriptionsList.filter(function(t){return t.id===e.actionConfig.template.value})).foreach(function(e){t.setState(j(t.state,{formId:{$set:Object(he.toOption)(new v.Id(e.formId))}}))})}},{key:"setFormId",value:function(e){this.state.formId.map(function(e){return e.value}).getOrElse(function(){return""})!==e.value&&this.setState(j(this.state,{formId:{$set:Object(he.toOption)(e)}}))}},{key:"onFormChanged",value:function(e){this.setFormId(e),(this.props.actionConfig instanceof v.UpdateFieldValue||this.props.actionConfig instanceof v.CalculateFieldValue||this.props.actionConfig instanceof v.ImportFile||this.props.actionConfig instanceof v.ImportData||this.props.actionConfig instanceof v.WebHook||this.props.actionConfig instanceof v.PrintDocument||this.props.actionConfig instanceof v.JourneyImportRows||this.props.actionConfig instanceof v.DeleteFormData)&&this.props.dispatch(Object(ge.T)(j(this.props.actionConfig,{formId:{$set:e}})))}},{key:"getStageConfig",value:function(e,t){switch(e){case v.UpdateFieldValue.$Type.value:return new v.UpdateFieldValue(t,new v.Id(""),new v.ValueStr(""));case v.CalculateFieldValue.$Type.value:return new v.CalculateFieldValue(t,new v.Id(""),new v.MathOperationPlus,0);case v.SendNotification.$Type.value:return new v.SendNotification(new v.Id(""));case v.SendAggregateNotification.$Type.value:return new v.SendAggregateNotification(new v.Id(""));case v.SocialPublishConfig.$Type.value:return new v.SocialPublishConfig(new v.Id(""));case v.SetRegAppStatus.$Type.value:return new v.SetRegAppStatus(new v.Id(""),!0);case v.ImportFile.$Type.value:return new v.ImportFile(t,new v.Id(""),new v.ImportOperationResourceUriResource("",new v.HttpMethodGET,[]),new v.FileProcessingNoOp);case v.ImportData.$Type.value:return new v.ImportData(t,new v.Id(""));case v.WebHook.$Type.value:return new v.WebHook(t,new v.ImportOperationResourceUriResource("",new v.HttpMethodPOST(""),[],Object(he.toOption)(new v.TokenFetch(!1,new v.ImportOperationResourceUriResource("",new v.HttpMethodGET,[new v.HttpHeader("","")]),""))),new v.Id(""));case v.PrintDocument.$Type.value:return new v.PrintDocument(t,new v.Id(""));case v.JourneyEvents.$Type.value:return new v.JourneyEvents(new v.Id(""),!1,t,new he.None);case v.JourneyFormDataChildrenSearch.$Type.value:return new v.JourneyFormDataChildrenSearch(new v.Id(""),t,t,new v.FilterGroupCondition([],new v.FilterPredicateAnd),!1);case v.JourneyImportRows.$Type.value:return new v.JourneyImportRows(!1,t,new v.ImportPipelineStageFormat([]),new v.ImportPipelineStageMaterialize(new v.IdentityTypeCreateOnly,new he.None,new he.None),new v.Id(""));case v.JourneyDataParser.$Type.value:return new v.JourneyDataParser(new v.Id(""),new v.DataParserParamsFormDataSource(t,new v.Id("")),new v.ImportPipelineStageRead(new v.DataFormatText("")),!1);case v.JourneyFormDataSearch.$Type.value:return new v.JourneyFormDataSearch(new v.Id(""),t,new v.FilterGroupCondition([],new v.FilterPredicateAnd),!1);case v.FormDataAppendRefs.$Type.value:return new v.FormDataAppendRefs(!1,t,new v.Id(""),new v.Id(""));case v.DeleteFormData.$Type.value:return new v.DeleteFormData(t,new v.FormDataStatusNominalDeleted);case v.JourneyEmailDataExtract.$Type.value:return new v.JourneyEmailDataExtract(new v.EmailFieldTypeHtmlText,!1);case v.FormDataConverterScript.$Type.value:return new v.FormDataConverterScript(t,"");case v.SendNotificationsFiltered.$Type.value:return new v.SendNotificationsFiltered(new v.Id(""),new he.None);default:throw"Unknown action config type"}}},{key:"getTwoOutputs",value:function(e){switch(e.length){case 0:return[new v.Contact(Ee.v4(),"success"),new v.Contact(Ee.v4(),"failed")];case 1:return e.concat([new v.Contact(Ee.v4(),"failed")]);case 2:default:return e}}},{key:"getOneOutput",value:function(e){switch(e.length){case 0:return[new v.Contact(Ee.v4(),"success")];case 1:return e;case 2:return e.filter(function(e){return"failed"!==e.name});default:return e}}},{key:"onStageConfigTypeChanged",value:function(e,t){var n=this;this.props.dispatch(Object(ge.T)(this.getStageConfig(e,t))),e===v.ImportFile.$Type.value||e===v.ImportData.$Type.value||e===v.JourneyImportRows.$Type.value||e===v.WebHook.$Type.value?Object(be.b)(this.props.journeyEditor).foreach(function(e){n.props.dispatch(Object(ge.D)({componentId:n.props.stageId,inputs:2===e.stage.inputs.length?[new v.Contact(Ee.v4(),"in")]:e.stage.inputs})),n.props.dispatch(Object(ge.G)({componentId:n.props.stageId,outputs:n.getTwoOutputs(e.stage.outputs)}))}):e===v.FormDataAppendRefs.$Type.value?Object(be.b)(this.props.journeyEditor).foreach(function(e){n.props.dispatch(Object(ge.D)({componentId:n.props.stageId,inputs:[new v.Contact(Ee.v4(),"parent"),new v.Contact(Ee.v4(),"children")]}))}):e===v.SendAggregateNotification.$Type.value?Object(be.b)(this.props.journeyEditor).foreach(function(e){n.props.dispatch(Object(ge.D)({componentId:n.props.stageId,inputs:[new v.Contact(Ee.v4(),"main"),new v.Contact(Ee.v4(),"aggregate")]}))}):Object(be.b)(this.props.journeyEditor).foreach(function(e){n.props.dispatch(Object(ge.D)({componentId:n.props.stageId,inputs:2===e.stage.inputs.length?[new v.Contact(Ee.v4(),"in")]:e.stage.inputs})),n.props.dispatch(Object(ge.G)({componentId:n.props.stageId,outputs:n.getOneOutput(e.stage.outputs)}))})}},{key:"isTwoInputsAction",value:function(){return this.props.actionConfig instanceof v.SendAggregateNotification||this.props.actionConfig instanceof v.FormDataAppendRefs}},{key:"render",value:function(){var e=this;return f.createElement("div",null,this.props.eventLine.eventLineId.map(function(t){return f.createElement("div",null,e.props.defaultFormId.map(function(t){return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,e.props.i18n.t("Тип действия")),f.createElement(it.a,{fullWidth:!0,native:!0,value:e.props.actionConfig.tpe.value,onChange:function(n){return e.onStageConfigTypeChanged(n.target.value,t)}},f.createElement("optgroup",{label:e.props.i18n.t("Основные")},!e.isTwoInputsAction()&&f.createElement(f.Fragment,null,f.createElement("option",{value:v.UpdateFieldValue.$Type.value},e.props.i18n.t("Изменение значения поля")),f.createElement("option",{value:v.CalculateFieldValue.$Type.value},e.props.i18n.t("Калькулятор значения")),f.createElement("option",{value:v.SendNotification.$Type.value},e.props.i18n.t("Отправка сообщения")),f.createElement("option",{value:v.SendNotificationsFiltered.$Type.value},e.props.i18n.t("Отправка сообщения по фильтру")),f.createElement("option",{value:v.SetRegAppStatus.$Type.value},e.props.i18n.t("Установка статуса регистрации")),f.createElement("option",{value:v.JourneyEmailDataExtract.$Type.value},e.props.i18n.t("Парсинг письма")),!Sn.default.isA5000&&f.createElement("option",{value:v.SocialPublishConfig.$Type.value},e.props.i18n.t("Опубликовать в соцсети")),f.createElement("option",{value:v.ImportFile.$Type.value},e.props.i18n.t("Импорт файла")),f.createElement("option",{value:v.ImportData.$Type.value},e.props.i18n.t("Импорт данных")),f.createElement("option",{value:v.WebHook.$Type.value},e.props.i18n.t("Вебхук")),f.createElement("option",{value:v.PrintDocument.$Type.value},e.props.i18n.t("Печать документа")),f.createElement("option",{value:v.JourneyEvents.$Type.value},e.props.i18n.t("Сгенерировать событие")),f.createElement("option",{value:v.JourneyFormDataChildrenSearch.$Type.value},e.props.i18n.t("Поиск дочерних анкет")),f.createElement("option",{value:v.JourneyFormDataSearch.$Type.value},e.props.i18n.t("Поиск анкет по фильтру")),f.createElement("option",{value:v.JourneyDataParser.$Type.value},e.props.i18n.t("Парсинг данных")),f.createElement("option",{value:v.JourneyImportRows.$Type.value},e.props.i18n.t("Импорт анкет")),f.createElement("option",{value:v.DeleteFormData.$Type.value},e.props.i18n.t("Удаление анкеты")),f.createElement("option",{value:v.FormDataConverterScript.$Type.value},e.props.i18n.t("Конвертация скриптом"))),e.isTwoInputsAction()&&f.createElement(f.Fragment,null,f.createElement("option",{value:v.FormDataAppendRefs.$Type.value},e.props.i18n.t("Добавление ссылки в анкету")),f.createElement("option",{value:v.SendAggregateNotification.$Type.value},e.props.i18n.t("Отправка сообщения с агрегацией"))))))}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}),!(e.props.actionConfig instanceof v.JourneyEvents||e.props.actionConfig instanceof v.JourneyDataParser||e.props.actionConfig instanceof v.JourneyEmailDataExtract)&&f.createElement(Et.a,{formId:e.state.formId,onChange:e.onFormChanged,excludedForms:[]}),e.props.actionConfig instanceof v.UpdateFieldValue&&f.createElement(Bt,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.CalculateFieldValue&&f.createElement(Gt,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.ImportFile&&f.createElement(mn,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.ImportData&&f.createElement(Cn,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.WebHook&&f.createElement(oo,{actionConfig:e.props.actionConfig,eventLineId:t,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.PrintDocument&&f.createElement(co,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.JourneyEvents&&f.createElement(uo,{actionConfig:e.props.actionConfig,eventLineId:t,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.JourneyFormDataChildrenSearch&&f.createElement(vo,{actionConfig:e.props.actionConfig,eventLineId:t,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.JourneyFormDataSearch&&f.createElement(Lo,{eventLineId:t,actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),(e.props.actionConfig instanceof v.SendNotification||e.props.actionConfig instanceof v.SendAggregateNotification||e.props.actionConfig instanceof v.SendNotificationsFiltered)&&e.state.formId.nonEmpty()&&f.createElement(Un,{actionConfig:e.props.actionConfig,formId:e.state.formId,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.SetRegAppStatus&&f.createElement(Zn,{actionConfig:e.props.actionConfig,stageId:e.props.stageId}),e.props.actionConfig instanceof v.JourneyEmailDataExtract&&f.createElement(zo,{actionConfig:e.props.actionConfig,stageId:e.props.stageId}),e.props.actionConfig instanceof v.SocialPublishConfig&&f.createElement(Bn,{actionConfig:e.props.actionConfig,formId:e.state.formId,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.JourneyDataParser&&f.createElement(Io,{actionConfig:e.props.actionConfig,eventLineId:t,stageId:e.props.stageId,defaultFormId:e.props.defaultFormId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.JourneyImportRows&&f.createElement(Ro,{actionConfig:e.props.actionConfig,eventLineId:t,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.FormDataAppendRefs&&f.createElement(Ho,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.DeleteFormData&&f.createElement(On,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}),e.props.actionConfig instanceof v.FormDataConverterScript&&f.createElement(Zo,{actionConfig:e.props.actionConfig,stageId:e.props.stageId,onFormIdChange:e.setFormId}))}).getOrNull())}}]),t}(f.Component);Xo=Yo([g.autobind,Ko("design:paramtypes",[Object])],Xo);var Qo=Object(h.connect)(function(e,t){return{i18n:e.i18n,journeyEditor:e.journeyEditor,forms:e.forms,eventLine:e.eventLine,fields:e.fields,dictionaries:e.dictionaries,blocks:e.blocks,valuesGenerators:e.valuesGenerators,eventLineDescriptionsList:e.notifyTemplates.eventLineDescriptionsList}})(Xo),er=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tr=new v.Id(Ee.v4()),nr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFilterChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{filter:{$set:e}}))}},{key:"onFormChanged",value:function(e){this.props.dispatch(Object(je.h)(e)),this.props.onChange(j(this.props.conditionConfig,{formId:{$set:e}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Et.a,{formId:Object(he.toOption)(this.props.conditionConfig.formId),onChange:this.onFormChanged,excludedForms:[]}),f.createElement("p",null,this.props.i18n.t("Фильтр")),""!==this.props.conditionConfig.formId.value&&f.createElement(Nn.a,{value:this.props.conditionConfig.filter,filterId:tr,formId:this.props.conditionConfig.formId,onChange:this.onFilterChanged}))}}]),t}(f.Component);nr=er([g.autobind],nr);var or=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(Ue.a)(nr)),rr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ir=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onTerminalChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{terminalId:{$set:"EMPTY"===e.target.value?new he.None:Object(he.toOption)(new v.Id(e.target.value))}}))}},{key:"onAccessZoneChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{zoneId:{$set:"EMPTY"===e.target.value?new he.None:Object(he.toOption)(new v.Id(e.target.value))}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Терминал")),f.createElement(it.a,{fullWidth:!0,onChange:this.onTerminalChanged,value:this.props.conditionConfig.terminalId.map(function(e){return e.value}).getOrElse(function(){return"EMPTY"})},f.createElement(gt.a,{key:"EMPTY",value:"EMPTY"},f.createElement(_e.a,{primary:""})),this.props.terminals.list.map(function(e){return f.createElement(gt.a,{key:e.id.value,value:e.id.value},f.createElement(_e.a,{primary:e.entity.name}))}))),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Зона доступа")),f.createElement(it.a,{fullWidth:!0,onChange:this.onAccessZoneChanged,value:this.props.conditionConfig.zoneId.map(function(e){return e.value}).getOrElse(function(){return"EMPTY"})},f.createElement(gt.a,{key:"EMPTY",value:"EMPTY"},f.createElement(_e.a,{primary:""})),this.props.accessZones.list.map(function(e){return f.createElement(gt.a,{key:e.id.value,value:e.id.value},f.createElement(_e.a,{primary:e.entity.name}))}))))}}]),t}(f.Component);ir=rr([g.autobind],ir);var ar=Object(h.connect)(function(e,t){return{i18n:e.i18n,terminals:e.terminals,accessZones:e.accessZones}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(ir),sr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},cr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onEventIdChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{eventId:{$set:v.Id.createId(e.target.value).getOrElse(function(){throw"wrong journey event id"})}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Qn.a,{label:this.props.i18n.t("Идентификатор события"),fullWidth:!0,eventLineId:this.props.eventLineId,value:this.props.conditionConfig.eventId.value,onChange:this.onEventIdChanged}))}}]),t}(f.Component);cr=sr([g.autobind],cr);var lr=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(cr),pr=n(103),ur=n(188),dr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentWillMount",value:function(){this.init(this.props),this.fetchBlocks(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.props.eventAttr.blockId.value!==e.eventAttr.blockId.value&&this.init(e),Object(he.isEqual)(this.props.formId,e.formId)||this.fetchBlocks(e)}},{key:"fetchBlocks",value:function(e){e.formId.foreach(function(t){e.dispatch(Object(ur.b)(t))})}},{key:"init",value:function(e){var t=this;Object(he.toOption)(e.eventAttr.blockId.value).filter(function(e){return""!==e}).foreach(function(){t.getFormIdFromBlockId(e.eventAttr.blockId).then(function(n){t.setFormId(n,e)})})}},{key:"setFormId",value:function(e,t){e.value!==t.formId.map(function(e){return e.value}).getOrNull()&&t.onFormIdChange(e)}},{key:"getFormIdFromBlockId",value:function(e){return this.props.dispatch(Object(ur.a)(e)).then(function(e){return e.entity.relatedForm})}},{key:"onSysAttrBlockIdChanged",value:function(e){this.props.onChange(j(this.props.eventAttr,{blockId:{$set:new v.Id(e.target.value)}}))}},{key:"render",value:function(){var e=this;return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Блок")),f.createElement(it.a,{fullWidth:!0,native:!0,value:this.props.eventAttr.blockId.value,onChange:this.onSysAttrBlockIdChanged},f.createElement("option",{value:""}),""!==this.props.formId.map(function(e){return e.value}).getOrElse(function(){return""})?this.props.formId.flatMap(function(t){return Object(pr.c)(e.props.blocks,t)}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement("option",{key:t,value:e.id.toString()},e.name)}):[]))}}]),t}(f.Component);fr=dr([g.autobind],fr);var hr=Object(h.connect)(function(e,t){return{i18n:e.i18n,blocks:e.blocks}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(fr),gr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentWillMount",value:function(){this.init(this.props)}},{key:"componentDidMount",value:function(){var e=this;this.props.formId.foreach(function(t){return e.props.dispatch(Object(ve.c)(t))})}},{key:"componentWillReceiveProps",value:function(e){this.props.eventAttr.pipeline.value!==e.eventAttr.pipeline.value&&this.init(e)}},{key:"init",value:function(e){var t=this;Object(he.toOption)(e.eventAttr.pipeline.value).filter(function(e){return""!==e}).foreach(function(){t.getFormIdFormImportPipelineId(e.eventAttr.pipeline).foreach(function(n){t.setFormId(n,e)})})}},{key:"setFormId",value:function(e,t){e.value!==t.formId.map(function(e){return e.value}).getOrNull()&&t.onFormIdChange(e)}},{key:"getFormIdFormImportPipelineId",value:function(e){return Object(he.headOption)(this.props.importPipelines.list.filter(function(t){return t.id.value===e.value})).map(function(e){return e.entity.form})}},{key:"onSysAttrImportPipelineIdChanged",value:function(e){this.props.onChange(j(this.props.eventAttr,{pipeline:{$set:new v.Id(e.target.value)}}))}},{key:"render",value:function(){var e=this;return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Импорт")),f.createElement(it.a,{fullWidth:!0,native:!0,value:this.props.eventAttr.pipeline.value,onChange:this.onSysAttrImportPipelineIdChanged},""!==this.props.formId.map(function(e){return e.value}).getOrElse(function(){return""})?this.props.importPipelines.eventLineDescriptionsList.filter(function(t){return e.props.formId.map(function(e){return e.value===t.formId}).getOrElse(function(){return!1})}).map(function(e,t){return f.createElement("option",{key:t,value:e.id},e.name)}):[]))}}]),t}(f.Component);mr=gr([g.autobind],mr);var vr=Object(h.connect)(function(e,t){return{i18n:e.i18n,importPipelines:e.importPipelines}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(mr),yr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Cr=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Er=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={formId:e.defaultFormId},n}return p()(t,e),a()(t,[{key:"getEventAttr",value:function(e){switch(e){case v.EventAttributesEmpty.$Type.value:return new v.EventAttributesEmpty;case v.EventAttributesBlock.$Type.value:return new v.EventAttributesBlock(new v.Id(""));case v.EventAttributesImport.$Type.value:return new v.EventAttributesImport(new v.Id(""));default:throw"Unknown event attribute type"}}},{key:"onEventAttrTypeChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{attr:{$set:this.getEventAttr(e.target.value)}}))}},{key:"onEventAttrChange",value:function(e){this.props.onChange(j(this.props.conditionConfig,{attr:{$set:e}}))}},{key:"onFormChanged",value:function(e){var t=this;this.setState(j(this.state,{formId:{$set:Object(he.toOption)(e)}}),function(){t.props.dispatch(Object(je.h)(e))})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Et.a,{formId:this.state.formId.matchWith(function(e){return Object(he.toOption)(e)},function(){return e.props.defaultFormId}),onChange:this.onFormChanged,excludedForms:[]}),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Источник события")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.attr.tpe.value,onChange:this.onEventAttrTypeChanged},f.createElement(gt.a,{value:v.EventAttributesEmpty.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Не указан")})),f.createElement(gt.a,{value:v.EventAttributesBlock.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Блок")})),f.createElement(gt.a,{value:v.EventAttributesImport.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Импорт")})))),this.props.conditionConfig.attr instanceof v.EventAttributesImport&&f.createElement(vr,{eventAttr:this.props.conditionConfig.attr,onChange:this.onEventAttrChange,onFormIdChange:this.onFormChanged,formId:this.state.formId}),this.props.conditionConfig.attr instanceof v.EventAttributesBlock&&f.createElement(hr,{eventAttr:this.props.conditionConfig.attr,onChange:this.onEventAttrChange,onFormIdChange:this.onFormChanged,formId:this.state.formId}))}}]),t}(f.Component);Er=yr([g.autobind,Cr("design:paramtypes",[Object])],Er);var br=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Er),Or=n(295),jr=n.n(Or),Ir=n(203),kr=n.n(Ir),Tr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Pr=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},wr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onAdd",value:function(){var e=j(this.props.triggers,{$push:[new v.UpdateTrigger(new v.Id(""),new v.FilterPredicateAnd)]});this.props.onChange(e)}},{key:"onRemove",value:function(e){var t=j(this.props.triggers,{$splice:[[e,1]]});this.props.onChange(t)}},{key:"onChange",value:function(e,t){var n=j(this.props.triggers,{$splice:[[e,1],[e,0,t]]});this.props.onChange(n)}},{key:"render",value:function(){var e=this,t=Object(he.liftKey)(this.props.fields.list,this.props.formId.value).getOrElse(function(){return[]});return f.createElement("div",{style:this.props.triggers.length<=1?{padding:"10px 10px 10px 10px"}:{padding:"10px 10px 10px 40px"}},this.props.triggers.map(function(n,o){return f.createElement(xr,{i18n:e.props.i18n,isOne:e.props.triggers.length<=1,trigger:n,fields:t,onChange:function(t){return e.onChange(o,t)},onRemove:function(){return e.onRemove(o)},last:e.props.triggers.length-1===o})}),f.createElement("div",null,f.createElement(E.a,{variant:"raised",onClick:this.onAdd},this.props.i18n.t("Добавить"))))}}]),t}(f.Component);wr=Tr([g.autobind],wr);var Fr=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(wr),xr=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={menuAnchorEl:new he.None},n}return p()(t,e),a()(t,[{key:"onPredicateAndSelect",value:function(){this.props.onChange(j(this.props.trigger,{join:{$set:new v.FilterPredicateAnd}}))}},{key:"onPredicateOrSelect",value:function(){this.props.onChange(j(this.props.trigger,{join:{$set:new v.FilterPredicateOr}}))}},{key:"onTriggerSourceFieldIdSelect",value:function(e){var t=this;e.foreach(function(e){t.props.onChange(j(t.props.trigger,{fieldId:{$set:e}}))})}},{key:"onMenuRequested",value:function(e){this.setState(j(this.state,{menuAnchorEl:{$set:Object(he.toOption)(Object(D.findDOMNode)(e.currentTarget))}}))}},{key:"onMenuClosed",value:function(){this.setState(j(this.state,{menuAnchorEl:{$set:new he.None}}))}},{key:"render",value:function(){return f.createElement("div",{style:{position:"relative",marginBottom:"10px"}},f.createElement(S.a,{style:{padding:this.props.isOne?"5px 53px 5px 5px":"5px 53px 5px 45px",boxSizing:"border-box",position:"relative"}},f.createElement("div",{style:{display:"flex"}},f.createElement("div",{style:{flexGrow:1,flexShrink:0,flexBasis:0}},f.createElement(bt.a,{errorText:new he.None,fullWidth:!0,native:!0,labelText:new he.Some(this.props.i18n.t("Поле")),fields:this.props.fields,onChanged:this.onTriggerSourceFieldIdSelect,value:Object(he.toOption)(this.props.trigger.fieldId)})),f.createElement("div",{style:{position:"absolute",right:"5px",top:"5px"}},f.createElement(ke.a,{onClick:this.props.onRemove},f.createElement(Se.a,null))))),this.props.last?null:f.createElement(S.a,{square:!1,style:{position:"absolute",left:"-28px",bottom:"-30px",width:"56px",height:"56px",zIndex:1,textAlign:"center",lineHeight:"50px",backgroundColor:Object(v.getPredicateColor)(Object(he.toOption)(this.props.trigger.join))}},f.createElement(ke.a,{onClick:this.onMenuRequested},f.createElement(jr.a,{style:{color:"#fff"}},Object(v.getPredicateCaption)(Object(he.toOption)(this.props.trigger.join)))),f.createElement(kr.a,{anchorEl:this.state.menuAnchorEl.getOrUndefined(),open:this.state.menuAnchorEl.nonEmpty(),onClose:this.onMenuClosed},f.createElement(gt.a,{onClick:this.onPredicateAndSelect},this.props.i18n.t("&")),f.createElement(gt.a,{onClick:this.onPredicateOrSelect},this.props.i18n.t("|")))))}}]),t}(f.Component);xr=Tr([g.autobind,Pr("design:paramtypes",[Object])],xr);var Dr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Rr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onUpdateTriggersChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{updateTrigger:{triggers:{$set:e}}}))}},{key:"onFormChanged",value:function(e){this.props.dispatch(Object(je.h)(e)),this.props.onChange(j(this.props.conditionConfig,{formId:{$set:e}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Et.a,{formId:Object(he.toOption)(this.props.conditionConfig.formId),onChange:this.onFormChanged,excludedForms:[]}),""!==this.props.conditionConfig.formId.value&&f.createElement(Fr,{triggers:this.props.conditionConfig.updateTrigger.triggers,formId:this.props.conditionConfig.formId,onChange:this.onUpdateTriggersChanged}))}}]),t}(f.Component);Rr=Dr([g.autobind],Rr);var _r=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Rr),$r=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Sr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onCommandChanged",value:function(e){this.props.onChange(j(this.props.params,{cmd:{$set:e.target.value}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Be.a,{fullWidth:!0,label:this.props.i18n.t("Команда"),value:this.props.params.cmd,onChange:this.onCommandChanged}))}}]),t}(f.Component);Sr=$r([g.autobind],Sr);var Nr=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Sr),Mr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Lr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onCommandChanged",value:function(e){this.props.onChange(j(this.props.params,{cmd:{$set:e.target.value}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Be.a,{fullWidth:!0,label:this.props.i18n.t("Команда"),value:this.props.params.cmd,onChange:this.onCommandChanged}))}}]),t}(f.Component);Lr=Mr([g.autobind],Lr);var Ar=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Lr),Wr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Hr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getJourneyParams",value:function(e){switch(e){case v.TelegramCommand.$Type.value:return new v.TelegramCommand("");case v.FacebookCommand.$Type.value:return new v.FacebookCommand("");default:throw"Unknown event attribute type"}}},{key:"onJourneyParamsTypeChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{paramsType:{$set:this.getJourneyParams(e.target.value)}}))}},{key:"onJourneyParamsChange",value:function(e){this.props.onChange(j(this.props.conditionConfig,{paramsType:{$set:e}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Тип параметра фильтрации")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.paramsType.tpe.value,onChange:this.onJourneyParamsTypeChanged},!Sn.default.isA5000&&f.createElement(gt.a,{value:v.TelegramCommand.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Команда телеграм бота")})),!Sn.default.isA5000&&f.createElement(gt.a,{value:v.FacebookCommand.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Команда facebook бота")})))),this.props.conditionConfig.paramsType instanceof v.TelegramCommand&&f.createElement(Nr,{params:this.props.conditionConfig.paramsType,onChange:this.onJourneyParamsChange}),this.props.conditionConfig.paramsType instanceof v.FacebookCommand&&f.createElement(Ar,{params:this.props.conditionConfig.paramsType,onChange:this.onJourneyParamsChange}))}}]),t}(f.Component);Hr=Wr([g.autobind],Hr);var Ur=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Hr),Jr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Vr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onLimitChanged",value:function(e){var t=parseInt(e.target.value);isNaN(t)||this.props.onChange(j(this.props.conditionConfig,{limit:{$set:t}}))}},{key:"onStepChanged",value:function(e){var t=parseInt(e.target.value);this.props.onChange(j(this.props.conditionConfig,{step:{$set:t}}))}},{key:"onGeneratorIdChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{generatorId:{$set:new v.Id(e.target.value)}}))}},{key:"onLimitModeChanged",value:function(e){var t=this;v.LimitControlMode.valueOf(e.target.value).foreach(function(e){t.props.onChange(j(t.props.conditionConfig,{mode:{$set:e}}))})}},{key:"getExpression",value:function(e){switch(e){case v.FilterExpressionGt.$Type.value:return new v.FilterExpressionGt;case v.FilterExpressionLt.$Type.value:return new v.FilterExpressionLt;default:throw"unknown expression type"}}},{key:"onExprChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{expr:{$set:this.getExpression(e.target.value)}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Be.a,{label:this.props.i18n.t("Лимит"),fullWidth:!0,type:"number",value:this.props.conditionConfig.limit,onChange:this.onLimitChanged}),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Условие")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.expr.tpe.value,onChange:this.onExprChanged},f.createElement(gt.a,{value:v.FilterExpressionLt.$Type.value},this.props.i18n.t("Меньше")),f.createElement(gt.a,{value:v.FilterExpressionGt.$Type.value},this.props.i18n.t("Больше")))),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Проверять значение")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.mode.tpe.value,onChange:this.onLimitModeChanged},f.createElement(gt.a,{value:v.LimitControlModeUpdate.$Type.value},this.props.i18n.t("Только активировать")),f.createElement(gt.a,{value:v.LimitControlModeCheckAndUpdate.$Type.value},this.props.i18n.t("Активировать и проверить")),f.createElement(gt.a,{value:v.LimitControlModeCheck.$Type.value},this.props.i18n.t("Только проверить")))),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Генератор")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.generatorId.value,onChange:this.onGeneratorIdChanged},this.props.valuesGenerators.list.map(function(e,t){return f.createElement(gt.a,{key:t,value:e.id.value},e.entity.name)}))),f.createElement(Be.a,{label:this.props.i18n.t("Шаг"),fullWidth:!0,type:"number",value:this.props.conditionConfig.step,onChange:this.onStepChanged}))}}]),t}(f.Component);Vr=Jr([g.autobind],Vr);var Br=Object(h.connect)(function(e,t){return{i18n:e.i18n,valuesGenerators:e.valuesGenerators}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Vr),zr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qr=(new v.Id(Ee.v4()),function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getFailureType",value:function(e){switch(e){case v.HttpErrorConfig.$Type.value:default:return new v.HttpErrorConfig(400)}}},{key:"onFailureTypeChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{failure:{$set:this.getFailureType(e.target.value)}}))}},{key:"onHttpStatusCodeChanged",value:function(e){var t=parseInt(e.target.value);this.props.onChange(j(this.props.conditionConfig,{failure:{code:{$set:t}}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Тип ошибки")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.failure.tpe.value,onChange:this.onFailureTypeChanged},f.createElement(gt.a,{value:v.HttpErrorConfig.$Type.value},f.createElement(_e.a,{primary:this.props.i18n.t("Ошибка http")})))),this.props.conditionConfig.failure instanceof v.HttpErrorConfig&&f.createElement("div",null,f.createElement(Be.a,{label:this.props.i18n.t("Статус код"),fullWidth:!0,type:"number",value:this.props.conditionConfig.failure.code,onChange:this.onHttpStatusCodeChanged})))}}]),t}(f.Component));qr=zr([g.autobind],qr);var Gr=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(Ue.a)(qr)),Zr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Yr=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onNotifyTemplateChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{templateId:{$set:new v.Id(e.target.value)}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,{shrink:!0},this.props.i18n.t("Письмо")),f.createElement(it.a,{fullWidth:!0,native:!0,value:this.props.conditionConfig.templateId.value,onChange:this.onNotifyTemplateChanged},this.props.notifyTemplatesDescriptionsList.filter(function(e){return e.params===v.MessageParamsDataEmailData.$Type.value}).map(function(e){return f.createElement("option",{value:e.id},e.name)}))))}}]),t}(f.Component);Yr=Zr([g.autobind],Yr);var Kr=Object(h.connect)(function(e,t){return{i18n:e.i18n,notifyTemplatesDescriptionsList:e.notifyTemplates.eventLineDescriptionsList}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplates.eventLineDescriptionsList===t.notifyTemplates.eventLineDescriptionsList},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplatesDescriptionsList===t.notifyTemplatesDescriptionsList}})(Object(Ue.a)(Yr)),Xr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Qr=new v.Id(Ee.v4()),ei=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getExpression",value:function(e){switch(e){case v.FilterExpressionGt.$Type.value:return new v.FilterExpressionGt;case v.FilterExpressionLt.$Type.value:case v.FilterExpressionEq.$Type.value:case v.FilterExpressionNotEq.$Type.value:return new v.FilterExpressionLt;default:throw"unknown expression type"}}},{key:"getNumericValueCondition",value:function(e){switch(e){case v.NumericValueConditionFieldId.$Type.value:return new v.NumericValueConditionFieldId(new v.Id(""),this.props.conditionConfig.condition.expr);case v.NumericValueConditionStatic.$Type.value:return new v.NumericValueConditionStatic(0,this.props.conditionConfig.condition.expr);default:throw"unknown numeric value condition type"}}},{key:"onConditionChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{condition:{$set:this.getNumericValueCondition(e.target.value)}}))}},{key:"onFieldChanged",value:function(e){var t=this;e.foreach(function(e){t.props.onChange(j(t.props.conditionConfig,{condition:{id:{$set:e}}}))})}},{key:"onCountValueChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{condition:{value:{$set:e.target.value}}}))}},{key:"onExprChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{condition:{expr:{$set:this.getExpression(e.target.value)}}}))}},{key:"onUseInputFormDataChanged",value:function(e,t){this.props.onChange(j(this.props.conditionConfig,{useInputFormData:{$set:t}}))}},{key:"onFilterChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{filter:{$set:e}}))}},{key:"onSourceFormChanged",value:function(e){this.props.dispatch(Object(je.h)(e)),this.props.onChange(j(this.props.conditionConfig,{sourceFormId:{$set:e}}))}},{key:"onTargetFormChanged",value:function(e){this.props.dispatch(Object(je.h)(e)),this.props.onChange(j(this.props.conditionConfig,{targetFormId:{$set:e}}))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Et.a,{excludedForms:[],label:this.props.i18n.t("Форма источник"),formId:Object(he.toOption)(this.props.conditionConfig.sourceFormId),onChange:this.onSourceFormChanged}),f.createElement(Et.a,{excludedForms:[],label:this.props.i18n.t("Форма назначения"),formId:Object(he.toOption)(this.props.conditionConfig.targetFormId),onChange:this.onTargetFormChanged}),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Тип условия")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.condition.tpe.value,onChange:this.onConditionChanged},f.createElement(gt.a,{value:v.NumericValueConditionFieldId.$Type.value},this.props.i18n.t("По полю")),f.createElement(gt.a,{value:v.NumericValueConditionStatic.$Type.value},this.props.i18n.t("По значению")))),this.props.conditionConfig.condition.tpe.value===v.NumericValueConditionFieldId.$Type.value&&f.createElement(bt.a,{labelText:Object(he.toOption)(this.props.i18n.t("Поле")),fields:Object(Ct.e)(this.props.fields,this.props.conditionConfig.sourceFormId).getOrElse(function(){return[]}),onChanged:this.onFieldChanged,fullWidth:!0,native:!0,value:Object(he.toOption)(this.props.conditionConfig.condition.id),errorText:new he.None}),this.props.conditionConfig.condition.tpe.value===v.NumericValueConditionStatic.$Type.value&&f.createElement(Be.a,{type:"number",label:this.props.i18n.t("Значение условия"),value:this.props.conditionConfig.condition.value,onChange:this.onCountValueChanged,fullWidth:!0}),f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Тип выражения")),f.createElement(it.a,{fullWidth:!0,value:this.props.conditionConfig.condition.expr.tpe.value,onChange:this.onExprChanged},f.createElement(gt.a,{value:v.FilterExpressionEq.$Type.value},this.props.i18n.t("Равно")),f.createElement(gt.a,{value:v.FilterExpressionNotEq.$Type.value},this.props.i18n.t("Не равно")),f.createElement(gt.a,{value:v.FilterExpressionLt.$Type.value},this.props.i18n.t("Меньше")),f.createElement(gt.a,{value:v.FilterExpressionGt.$Type.value},this.props.i18n.t("Больше")))),f.createElement(Rt.a,{label:this.props.i18n.t("Использовать входную анкету"),control:f.createElement(xt.a,{checked:this.props.conditionConfig.useInputFormData,style:{marginBottom:"12px"},onChange:this.onUseInputFormDataChanged})}),f.createElement("p",null,this.props.i18n.t("Фильтр")),""!==this.props.conditionConfig.sourceFormId.value&&""!==this.props.conditionConfig.sourceFormId.value&&f.createElement(Nn.a,{value:this.props.conditionConfig.filter,filterId:Qr,formId:this.props.conditionConfig.targetFormId,sourceFormId:this.props.conditionConfig.sourceFormId,onChange:this.onFilterChanged}))}}]),t}(f.Component);ei=Xr([g.autobind],ei);var ti=Object(h.connect)(function(e,t){return{i18n:e.i18n,fields:e.fields}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(Ue.a)(ei)),ni=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},oi=new v.Id(Ee.v4()),ri=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFilterChanged",value:function(e){var t=this;e.foreach(function(e){return t.props.onChange(j(t.props.conditionConfig,{filter:{$set:e}}))})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement("p",null,this.props.i18n.t("Фильтр")),this.props.defaultFormId.map(function(t){return f.createElement(Nn.a,{value:Object(he.headOption)(e.props.conditionConfig.filter.conditions).map(function(e){return""===e.field.value}).getOrElse(function(){return!0})?new he.None:Object(he.toOption)(e.props.conditionConfig.filter),filterId:oi,formId:t,onChange:e.onFilterChanged})}).getOrNull())}}]),t}(f.Component);ri=ni([g.autobind],ri);var ii=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(Ue.a)(ri)),ai=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},si=(new v.Id(Ee.v4()),function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFilterChanged",value:function(e){this.props.onChange(j(this.props.conditionConfig,{filter:{$set:e}}))}},{key:"onDataSourceChanged",value:function(e){this.onFilterChanged(j(this.props.conditionConfig.filter,{expr:{field:{$set:Uo(e.target.value)}}}))}},{key:"onValueChange",value:function(e){this.onFilterChanged(j(this.props.conditionConfig.filter,{expr:{value:{$set:e.target.value}}}))}},{key:"render",value:function(){var e=this.props.conditionConfig.filter;return f.createElement("div",null,e instanceof v.EmailFilterCondition&&e.expr instanceof v.EmailFilterExpressionFullTextSearch&&f.createElement(f.Fragment,null,f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,this.props.i18n.t("Поле")),f.createElement(it.a,{fullWidth:!0,value:e.expr.field.tpe.value,onChange:this.onDataSourceChanged},f.createElement(gt.a,{value:v.EmailFieldTypeHtmlText.$Type.value},this.props.i18n.t("Html письма")),f.createElement(gt.a,{value:v.EmailFieldTypePlainText.$Type.value},this.props.i18n.t("Текст письма")),f.createElement(gt.a,{value:v.EmailFieldTypeSubject.$Type.value},this.props.i18n.t("Тема письма")))),f.createElement(Be.a,{label:this.props.i18n.t("Значение"),fullWidth:!0,value:e.expr.value,onChange:this.onValueChange})))}}]),t}(f.Component));si=ai([g.autobind],si);var ci=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(Ue.a)(si)),li=function(e,t){switch(e){case v.FormDataFilter.$Type.value:return new v.FormDataFilter(t,new he.None);case v.SysEventAttrFilterConfig.$Type.value:return new v.SysEventAttrFilterConfig(new v.EventAttributesEmpty);case v.UpdateFieldFilter.$Type.value:return new v.UpdateFieldFilter(t,new v.UpdatedTriggerConfig([]));case v.InteractionFilter.$Type.value:return new v.InteractionFilter;case v.JourneyEventIdFilter.$Type.value:return new v.JourneyEventIdFilter(new v.Id(""));case v.ExceptionFilter.$Type.value:return new v.ExceptionFilter(new v.HttpErrorConfig(400));case v.CounterLimitFilter.$Type.value:return new v.CounterLimitFilter(new v.Id(""),0,new v.FilterExpressionGt,new v.LimitControlModeUpdate);case v.JourneyParamsFilter.$Type.value:return new v.JourneyParamsFilter(new v.TelegramCommand(""));case v.EmailTrackFilter.$Type.value:return new v.EmailTrackFilter(new v.Id(""));case v.FormDataCountFilter.$Type.value:return new v.FormDataCountFilter(new v.Id(""),new v.Id(""),new he.None,new v.NumericValueConditionStatic(0,new v.FilterExpressionEq),!1);case v.FormDataRegFilterConfig.$Type.value:return new v.FormDataRegFilterConfig(new v.FilterCondition(new v.Id(""),new v.FilterExpressionEq,new v.ValueStr("")));case v.EmailFieldsFilter.$Type.value:return new v.EmailFieldsFilter(new v.EmailFilterCondition(new v.EmailFilterExpressionFullTextSearch("",new v.EmailFieldTypeHtmlText),new v.EmailFilterOperatorContains));default:throw"Unknown condition config type"}},pi=function(e,t,n,o){switch(e.tpe.value){case v.FormDataFilter.$Type.value:return f.createElement(or,{conditionConfig:e,onChange:t});case v.SysEventAttrFilterConfig.$Type.value:return f.createElement(br,{conditionConfig:e,onChange:t,defaultFormId:o});case v.UpdateFieldFilter.$Type.value:return f.createElement(_r,{conditionConfig:e,onChange:t});case v.InteractionFilter.$Type.value:return f.createElement(ar,{conditionConfig:e,onChange:t});case v.JourneyEventIdFilter.$Type.value:return f.createElement(lr,{conditionConfig:e,eventLineId:n,onChange:t});case v.JourneyParamsFilter.$Type.value:return f.createElement(Ur,{conditionConfig:e,onChange:t});case v.CounterLimitFilter.$Type.value:return f.createElement(Br,{conditionConfig:e,onChange:t});case v.ExceptionFilter.$Type.value:return f.createElement(Gr,{conditionConfig:e,onChange:t});case v.FormDataCountFilter.$Type.value:return f.createElement(ti,{conditionConfig:e,onChange:t});case v.EmailTrackFilter.$Type.value:return f.createElement(Kr,{conditionConfig:e,onChange:t});case v.EmailFieldsFilter.$Type.value:return f.createElement(ci,{conditionConfig:e,onChange:t});case v.FormDataRegFilterConfig.$Type.value:return f.createElement(ii,{conditionConfig:e,defaultFormId:o,onChange:t});default:throw"Unknown condition config type"}},ui=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},di=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onStageConfigTypeChanged",value:function(e,t){this.props.dispatch(Object(ge.T)(li(e,t)))}},{key:"onStageConfigChange",value:function(e){this.props.dispatch(Object(ge.T)(e))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,this.props.defaultFormId.map(function(t){return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,e.props.i18n.t("Тип фильтра")),f.createElement(it.a,{fullWidth:!0,native:!0,value:e.props.conditionConfig.tpe.value,onChange:function(n){return e.onStageConfigTypeChanged(n.target.value,t)}},f.createElement("optgroup",{label:e.props.i18n.t("Основные")},f.createElement("option",{value:v.FormDataFilter.$Type.value},e.props.i18n.t("По анкете")),f.createElement("option",{value:v.SysEventAttrFilterConfig.$Type.value},e.props.i18n.t("По источнику события")),f.createElement("option",{value:v.UpdateFieldFilter.$Type.value},e.props.i18n.t("По обновлению поля")),f.createElement("option",{value:v.InteractionFilter.$Type.value},e.props.i18n.t("По взаимодействию")),f.createElement("option",{value:v.JourneyEventIdFilter.$Type.value},e.props.i18n.t("По идентификатору события")),f.createElement("option",{value:v.JourneyParamsFilter.$Type.value},e.props.i18n.t("По параметрам цепочки")),f.createElement("option",{value:v.FormDataRegFilterConfig.$Type.value},e.props.i18n.t("По данным регистрации")))))}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}),this.props.eventLineId.map(function(t){return pi(e.props.conditionConfig,e.onStageConfigChange,t,e.props.defaultFormId)}).getOrNull())}}]),t}(f.Component);di=ui([g.autobind],di);var fi=Object(h.connect)(function(e,t){return{i18n:e.i18n,eventLineId:e.eventLine.eventLineId}})(di),hi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gi=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},mi=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={condition:n.props.conditionConfig},n}return p()(t,e),a()(t,[{key:"onFilterChanged",value:function(e){var t=this;this.setState({condition:e},function(){t.props.onChange(e)})}},{key:"render",value:function(){var e=this;return this.props.eventLineId.map(function(t){return pi(e.state.condition,e.onFilterChanged,t,e.props.defaultFormId)}).getOrNull()}}]),t}(f.Component),vi=mi=hi([g.autobind,gi("design:paramtypes",[Object])],mi),yi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ci=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"openEditForm",value:function(e,t,n,o){var r=this,i=new he.None,a=n,s=this.props.openDialog(e,f.createElement("div",null,f.createElement(Ge,{ref:function(e){return i=Object(he.toOption)(e).flatMap(function(e){return Object(he.toOption)(e.wrappedInstance)})},initialValues:o,onSubmit:function(e){return t(e,a)}}),f.createElement(vi,{defaultFormId:this.props.defaultFormId,eventLineId:this.props.eventLineId,conditionConfig:n,onChange:function(e){a=e}})),[f.createElement(E.a,{key:"close",variant:"raised",onClick:function(){return r.props.handleDialogClose(s)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{key:"save",variant:"raised",onClick:function(){i.foreach(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))]);return s}},{key:"onAddOutputButtonClick",value:function(){var e=this;this.props.defaultFormId.foreach(function(t){var n=e.openEditForm("Добавление нового порта",function(t,o){return new Promise(function(r,i){e.props.handleDialogClose(n);var a=Ee.v4();e.props.onChange(j(e.props.filterEnvelopes,{$push:[new v.JourneyFilterEnvelope(e.props.filterEnvelopes.length,new v.OutId(a),o)]}),j(e.props.ports,{$push:[new v.Contact(a,t.name)]})),r()})},li(e.props.filterType.value,t))})}},{key:"onOutputEdit",value:function(e,t,n){var o=this,r=this.openEditForm("Редактирование порта",function(t,i){return new Promise(function(a,s){o.props.handleDialogClose(r),o.props.onChange(j(o.props.filterEnvelopes,{$splice:[[n,1,new v.JourneyFilterEnvelope(n,e,i)]]}),j(o.props.ports,{$splice:[[n+1,1,new v.Contact(e.id,t.name)]]})),a()})},t,{name:this.getOutputName(e)})}},{key:"onOutputRemove",value:function(e){this.props.onChange(j(this.props.filterEnvelopes,{$set:this.props.filterEnvelopes.filter(function(t,n){return e!==n}).map(function(e,t){return j(e,{pos:{$set:t}})})}),j(this.props.ports,{$splice:[[e+1,1]]}))}},{key:"getOutputName",value:function(e){var t=this;return Object(he.headOption)(this.props.ports.filter(function(t){return t.uid===e.id})).map(function(e){return e.name}).getOrElse(function(){return t.props.i18n.t("Порт не найден")})}},{key:"onMoveUp",value:function(e){this.props.onChange(j(this.props.filterEnvelopes,{$splice:[[e-1,2,j(this.props.filterEnvelopes[e],{pos:{$set:e-1}}),j(this.props.filterEnvelopes[e-1],{pos:{$set:e}})]]}),j(this.props.ports,{$splice:[[e,2,this.props.ports[e+1],this.props.ports[e]]]}))}},{key:"onMoveDown",value:function(e){this.props.onChange(j(this.props.filterEnvelopes,{$splice:[[e,2,j(this.props.filterEnvelopes[e+1],{pos:{$set:e}}),j(this.props.filterEnvelopes[e],{pos:{$set:e+1}})]]}),j(this.props.ports,{$splice:[[e+1,2,this.props.ports[e+2],this.props.ports[e+1]]]}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement("p",null,this.props.i18n.t("Выходы")),f.createElement(Pe.a,null,this.props.filterEnvelopes.map(function(t,n){return f.createElement(Fe.a,{key:t.outId.id},f.createElement(_e.a,{primary:e.getOutputName(t.outId)}),f.createElement(De.a,null,f.createElement(ke.a,{onClick:function(){return e.onMoveDown(n)},disabled:n===e.props.filterEnvelopes.length-1},f.createElement(Ae.a,null)),f.createElement(ke.a,{onClick:function(){return e.onMoveUp(n)},disabled:0===n},f.createElement(He.a,null)),f.createElement(ke.a,{onClick:function(){return e.onOutputEdit(t.outId,t.filter,n)}},f.createElement(Me.a,null)),f.createElement(ke.a,{onClick:function(){return e.onOutputRemove(n)}},f.createElement(Se.a,null))))})),f.createElement("div",null,f.createElement(E.a,{variant:"raised",onClick:this.onAddOutputButtonClick,style:{marginRight:"10px"}},this.props.i18n.t("Добавить порт"))))}}]),t}(f.Component);Ci=yi([g.autobind],Ci);var Ei=Object(h.connect)(function(e,t){return{i18n:e.i18n,eventLineId:e.eventLine.eventLineId}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Object(Ue.a)(Ci)),bi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Oi=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onStageConfigTypeChanged",value:function(e,t){this.props.dispatch(Object(ge.T)(j(this.props.conditionConfig,{rType:{$set:e},filters:{$set:[]}}))),this.props.dispatch(Object(ge.G)({componentId:this.props.stageId,outputs:this.props.outPorts.filter(function(e){return"default"===e.name})}))}},{key:"onOutputListChange",value:function(e,t){this.props.dispatch(Object(ge.T)(j(this.props.conditionConfig,{filters:{$set:e}}))),this.props.dispatch(Object(ge.G)({componentId:this.props.stageId,outputs:t}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,this.props.defaultFormId.map(function(t){return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,e.props.i18n.t("Тип фильтра")),f.createElement(it.a,{fullWidth:!0,native:!0,value:e.props.conditionConfig.rType,onChange:function(n){return e.onStageConfigTypeChanged(n.target.value,t)}},f.createElement("optgroup",{label:e.props.i18n.t("Основные")},f.createElement("option",{value:v.FormDataFilter.$Type.value},e.props.i18n.t("По анкете")),f.createElement("option",{value:v.SysEventAttrFilterConfig.$Type.value},e.props.i18n.t("По источнику события")),f.createElement("option",{value:v.UpdateFieldFilter.$Type.value},e.props.i18n.t("По обновлению поля")),f.createElement("option",{value:v.InteractionFilter.$Type.value},e.props.i18n.t("По взаимодействию")),f.createElement("option",{value:v.JourneyEventIdFilter.$Type.value},e.props.i18n.t("По идентификатору события")),f.createElement("option",{value:v.JourneyParamsFilter.$Type.value},e.props.i18n.t("По параметрам цепочки")),f.createElement("option",{value:v.CounterLimitFilter.$Type.value},e.props.i18n.t("По лимиту взаимодействий")),f.createElement("option",{value:v.ExceptionFilter.$Type.value},e.props.i18n.t("По исключению")),f.createElement("option",{value:v.EmailTrackFilter.$Type.value},e.props.i18n.t("По шаблону письма")),f.createElement("option",{value:v.FormDataCountFilter.$Type.value},e.props.i18n.t("По количеству анкет")),f.createElement("option",{value:v.FormDataRegFilterConfig.$Type.value},e.props.i18n.t("По данным регистрации")),f.createElement("option",{value:v.EmailFieldsFilter.$Type.value},e.props.i18n.t("По параметрам письма")))))}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}),f.createElement(Ei,{filterType:new he.TypeId(this.props.conditionConfig.rType),onChange:this.onOutputListChange,defaultFormId:this.props.defaultFormId,ports:this.props.outPorts,filterEnvelopes:this.props.conditionConfig.filters}))}}]),t}(f.Component);Oi=bi([g.autobind],Oi);var ji=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Object(Ue.a)(Oi)),Ii=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ki=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getTriggerExpression",value:function(e){switch(e){case v.TriggerExpressionCron.$Type.value:return new v.TriggerExpressionCron("");case v.TriggerExpressionInterval.$Type.value:return new v.TriggerExpressionInterval(""+1e12);default:throw"Unknown trigger expression type"}}},{key:"onTriggerExpressionTypeChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{expr:{$set:this.getTriggerExpression(e.target.value)}})))}},{key:"onExprChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{expr:{expr:{$set:e.target.value}}})))}},{key:"onIntervalChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{expr:{interval:{$set:""+1e9*parseInt(e.target.value)}}})))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,this.props.defaultFormId.map(function(t){return f.createElement(lt.a,{fullWidth:!0},f.createElement(st.a,null,e.props.i18n.t("Тип выражения триггера")),f.createElement(it.a,{fullWidth:!0,value:e.props.triggerConfig.expr.tpe.value,onChange:e.onTriggerExpressionTypeChanged},f.createElement(gt.a,{value:v.TriggerExpressionCron.$Type.value},e.props.i18n.t("Крон")),f.createElement(gt.a,{value:v.TriggerExpressionInterval.$Type.value},e.props.i18n.t("Интервал"))))}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}),this.props.triggerConfig.expr instanceof v.TriggerExpressionCron&&f.createElement(Be.a,{fullWidth:!0,type:"text",value:this.props.triggerConfig.expr.expr,label:this.props.i18n.t("Крон выражение"),onChange:this.onExprChanged}),this.props.triggerConfig.expr instanceof v.TriggerExpressionInterval&&f.createElement(Be.a,{fullWidth:!0,type:"number",value:""+parseInt(this.props.triggerConfig.expr.interval)/1e9,label:this.props.i18n.t("Интервал (сек)"),onChange:this.onIntervalChanged}))}}]),t}(f.Component);ki=Ii([g.autobind],ki);var Ti=Object(h.connect)(function(e,t){return{i18n:e.i18n}})(ki),Pi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},wi=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onLeftThresholdPercentChanged",value:function(e){this.props.dispatch(Object(ge.T)(j(this.props.triggerConfig,{leftThresholdPercent:{$set:parseInt(e.target.value)}})))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(Be.a,{fullWidth:!0,label:this.props.i18n.t("Левый порог (%)"),value:this.props.triggerConfig.leftThresholdPercent,type:"number",InputProps:{inputProps:{min:"0",max:"100"}},onChange:this.onLeftThresholdPercentChanged}),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"green",marginRight:5}})," - ",this.props.i18n.t("Левый порог")),f.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:15}},f.createElement("div",{style:{width:15,height:15,backgroundColor:"red",marginRight:5}})," - ",this.props.i18n.t("Правый порог")))}}]),t}(f.Component);wi=Pi([g.autobind],wi);var Fi=Object(h.connect)(function(e,t){return{i18n:e.i18n}})(wi),xi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Di=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ri=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={name:n.initName(e)},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){Object(he.isEqual)(this.props.journeyEditor.selectedComponentId,e.journeyEditor.selectedComponentId)||this.setState(j(this.state,{name:{$set:this.initName(e)}}))}},{key:"initName",value:function(e){return this.getOutputContact(e).map(function(e){return e.name})}},{key:"getOutputContact",value:function(e){return e.journeyEditor.selectedComponentId.flatMap(function(t){return Object(he.headOption)(e.journeyEditor.outputs.filter(function(e){return e.uid===t}))})}},{key:"onChange",value:function(e){var t=this,n=e.target.value;this.setState(j(this.state,{name:{$set:Object(he.toOption)(n)}}),function(){return t.getOutputContact(t.props).map(function(e){return t.props.dispatch(Object(ge.R)(j(e,{name:{$set:n}})))})})}},{key:"render",value:function(){return f.createElement(Be.a,{fullWidth:!0,autoFocus:!0,value:this.state.name.getOrElse(function(){return""}),onChange:this.onChange,label:this.props.i18n.t("Название")})}}]),t}(f.Component);Ri=xi([g.autobind,Di("design:paramtypes",[Object])],Ri);var _i=Object(h.connect)(function(e){return{i18n:e.i18n,journeyEditor:e.journeyEditor}})(Ri),$i=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Si=(new v.Id(Ee.v4()),function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getSelectedComponent",value:function(e){return e.journeyEditor.selectedComponentId.flatMap(function(t){return Object(he.headOption)(e.journeyEditor.components.filter(function(e){return e.stage.stageId===t}))})}},{key:"componentWillMount",value:function(){var e=this;this.getStageFormId(this.props).foreach(function(t){e.fetchFieldsAndDictionaries(e.props,t)})}},{key:"componentWillReceiveProps",value:function(e){var t=this;!Object(he.isEqual)(this.getStageFormId(this.props),this.getStageFormId(e))&&this.getStageFormId(e).foreach(function(n){t.fetchFieldsAndDictionaries(e,n)})}},{key:"getStageFormId",value:function(e){return Object(be.b)(e.journeyEditor).filter(function(e){return e.stage.stageConfig instanceof v.UpdateFieldValue||e.stage.stageConfig instanceof v.CalculateFieldValue||e.stage.stageConfig instanceof v.FormDataFilter||e.stage.stageConfig instanceof v.FormDataRegFilterConfig||e.stage.stageConfig instanceof v.UpdateFieldFilter||e.stage.stageConfig instanceof v.ImportFile||e.stage.stageConfig instanceof v.ImportData||e.stage.stageConfig instanceof v.WebHook||e.stage.stageConfig instanceof v.PrintDocument||e.stage.stageConfig instanceof v.JourneyEvents||e.stage.stageConfig instanceof v.JourneyFormDataChildrenSearch||e.stage.stageConfig instanceof v.JourneyFormDataSearch||e.stage.stageConfig instanceof v.FormDataAppendRefs||e.stage.stageConfig instanceof v.DeleteFormData||e.stage.stageConfig instanceof v.FormDataConverterScript||e.stage.stageConfig instanceof v.JobTriggerConfig&&e.stage.stageConfig.params instanceof v.TriggerParamsDynamicField}).map(function(e){return e.stage.stageConfig instanceof v.JobTriggerConfig&&e.stage.stageConfig.params instanceof v.TriggerParamsDynamicField?e.stage.stageConfig.params.formId:e.stage.stageConfig instanceof v.FormDataAppendRefs?e.stage.stageConfig.parentForm:e.stage.stageConfig instanceof v.JourneyFormDataChildrenSearch?e.stage.stageConfig.sourceFormId:e.stage.stageConfig instanceof v.JourneyFormDataSearch?e.stage.stageConfig.targetFormId:e.stage.stageConfig.formId})}},{key:"fetchFieldsAndDictionaries",value:function(e,t){var n=this;""!==t.value&&(e.dictionaries.dictionariesFetchedForms[t.value]||e.dictionaries.listFetching||(this.props.dispatch(Object(je.d)(t)),this.getSelectedComponent(e).filter(function(e){return e.stage.stageConfig instanceof v.SysEventAttrFilterConfig&&e.stage.stageConfig.attr instanceof v.EventAttributesImport}).map(function(e){n.props.dispatch(Object(ve.b)(t))})))}},{key:"render",value:function(){var e=this,t=this.props.journeyEditor.defaultFormId.nonEmpty()?this.props.journeyEditor.defaultFormId:this.props.firstFormIdValue;return Object(be.c)(this.props.journeyEditor)?f.createElement(_i,null):Object(be.b)(this.props.journeyEditor).map(function(n){return f.createElement("div",null,n.stage.stageConfig instanceof v.ZipMergeStage&&f.createElement(ot,{mergeConfig:n.stage.stageConfig,stageId:n.stage.stageId,inputs:n.stage.inputs}),n.stage.stageConfig instanceof v.TriggerConfig&&f.createElement(ft,{triggerConfig:n.stage.stageConfig}),n.stage.stageConfig instanceof v.JobTriggerConfig&&f.createElement(Pt,{defaultFormId:t,triggerConfig:n.stage.stageConfig}),n.stage.stageConfig instanceof v.TimerTrigger&&f.createElement(Ti,{defaultFormId:t,triggerConfig:n.stage.stageConfig}),n.stage.stageConfig instanceof v.BalancerRouter&&f.createElement(Fi,{defaultFormId:t,triggerConfig:n.stage.stageConfig}),(n.stage.stageConfig instanceof v.UpdateFieldValue||n.stage.stageConfig instanceof v.CalculateFieldValue||n.stage.stageConfig instanceof v.SendNotification||n.stage.stageConfig instanceof v.SendAggregateNotification||n.stage.stageConfig instanceof v.SocialPublishConfig||n.stage.stageConfig instanceof v.SetRegAppStatus||n.stage.stageConfig instanceof v.JourneyEmailDataExtract||n.stage.stageConfig instanceof v.ImportFile||n.stage.stageConfig instanceof v.ImportData||n.stage.stageConfig instanceof v.WebHook||n.stage.stageConfig instanceof v.PrintDocument||n.stage.stageConfig instanceof v.JourneyEvents||n.stage.stageConfig instanceof v.JourneyFormDataChildrenSearch||n.stage.stageConfig instanceof v.JourneyFormDataSearch||n.stage.stageConfig instanceof v.JourneyDataParser||n.stage.stageConfig instanceof v.JourneyImportRows||n.stage.stageConfig instanceof v.FormDataAppendRefs||n.stage.stageConfig instanceof v.DeleteFormData||n.stage.stageConfig instanceof v.FormDataConverterScript||n.stage.stageConfig instanceof v.SendNotificationsFiltered)&&f.createElement(Qo,{defaultFormId:t,actionConfig:n.stage.stageConfig,stageId:n.stage.stageId}),(n.stage.stageConfig instanceof v.FormDataFilter||n.stage.stageConfig instanceof v.SysEventAttrFilterConfig||n.stage.stageConfig instanceof v.UpdateFieldFilter||n.stage.stageConfig instanceof v.InteractionFilter||n.stage.stageConfig instanceof v.JourneyEventIdFilter||n.stage.stageConfig instanceof v.JourneyParamsFilter||n.stage.stageConfig instanceof v.FormDataRegFilterConfig)&&f.createElement(fi,{defaultFormId:t,conditionConfig:n.stage.stageConfig,openDialog:e.props.openDialog,handleDialogClose:e.props.handleDialogClose}),n.stage.stageConfig instanceof v.RouterConfig&&f.createElement(ji,{stageId:n.stage.stageId,defaultFormId:t,conditionConfig:n.stage.stageConfig,outPorts:n.stage.outputs}))}).getOrNull()}}]),t}(f.Component));Si=$i([g.autobind],Si);var Ni=Object(h.connect)(function(e,t){return{i18n:e.i18n,journeyEditor:e.journeyEditor,dictionaries:e.dictionaries,firstFormIdValue:Object(he.headOption)(e.eventLine.data.map(function(t){return Object(Oe.f)(e.forms,t.id)}).getOrElse(function(){return[]})).map(function(e){return e.id})}})(Si),Mi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Li=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onCommentChange",value:function(e){var t=this;Object(be.b)(this.props.journeyEditor).foreach(function(n){t.props.dispatch(Object(ge.V)(j(n.stage.viewConfig,{comment:{$set:Object(he.toOption)(e.target.value).filter(function(e){return""!==e})}})))})}},{key:"render",value:function(){var e=this;return Object(be.b)(this.props.journeyEditor).map(function(t){return f.createElement("div",null,f.createElement(Be.a,{fullWidth:!0,autoFocus:!0,multiline:!0,rowsMax:6,rows:3,value:t.stage.viewConfig.comment.getOrElse(function(){return""}),onChange:e.onCommentChange,label:e.props.i18n.t("Комментарий")}))}).getOrNull()}}]),t}(f.Component);Li=Mi([g.autobind],Li);var Ai=Object(h.connect)(function(e){return{i18n:e.i18n,journeyEditor:e.journeyEditor}})(Li),Wi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Hi=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"handleDefaultFormIdChange",value:function(e){this.props.dispatch(Object(ge.J)({defaultFormId:e}))}},{key:"handleThrottleEnabledChange",value:function(e,t){this.props.dispatch(Object(ge.W)(j(this.props.journeyEditor.throttle,{enabled:{$set:t},value:{$set:Object(he.toOption)(this.props.journeyEditor.throttle.value.matchWith(function(e){return e},function(){return new v.JourneyThrottle(new v.Duration(10,v.TimeUnitType.Seconds).duration,5)}))}})))}},{key:"handleTimeWindowChange",value:function(e){var t=new v.Duration(parseInt(e.target.value),v.TimeUnitType.Seconds);this.props.dispatch(Object(ge.W)(j(this.props.journeyEditor.throttle,{value:{$set:Object(he.toOption)(this.props.journeyEditor.throttle.value.matchWith(function(e){return j(e,{timeWindow:{$set:t}})},function(){return new v.JourneyThrottle(t.duration,5)}))}})))}},{key:"handleEventsAllowedChange",value:function(e){var t=parseInt(e.target.value);this.props.dispatch(Object(ge.W)(j(this.props.journeyEditor.throttle,{value:{$set:Object(he.toOption)(this.props.journeyEditor.throttle.value.matchWith(function(e){return j(e,{eventsAllowed:{$set:t}})},function(){return new v.JourneyThrottle(new v.Duration(10,v.TimeUnitType.Seconds).duration,t)}))}})))}},{key:"render",value:function(){return f.createElement("div",null,f.createElement(J.a,{component:"div",style:{width:"100%"}},f.createElement(Et.a,{formId:this.props.journeyEditor.defaultFormId,onChange:this.handleDefaultFormIdChange,excludedForms:[]}),f.createElement(Rt.a,{label:this.props.i18n.t("Ограничивать поток событий"),control:f.createElement(Tn.a,{checked:this.props.journeyEditor.throttle.enabled,onChange:this.handleThrottleEnabledChange})}),this.props.journeyEditor.throttle.enabled&&f.createElement("div",null,f.createElement(Be.a,{type:"number",fullWidth:!0,value:this.props.journeyEditor.throttle.value.map(function(e){return e.timeWindow}).map(function(e){return e.getSeconds()}).getOrUndefined(),onChange:this.handleTimeWindowChange,label:this.props.i18n.t("Временной промежуток (сек.)")}),f.createElement(Be.a,{type:"number",fullWidth:!0,value:this.props.journeyEditor.throttle.value.map(function(e){return e.eventsAllowed}).getOrUndefined(),onChange:this.handleEventsAllowedChange,label:this.props.i18n.t("Число событий")}))))}}]),t}(f.Component);Hi=Wi([g.autobind],Hi);var Ui=Object(h.connect)(function(e){return{i18n:e.i18n,journeyEditor:e.journeyEditor}})(Hi),Ji=(n(2370),"BalancerRouterType"),Vi=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:Ji,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#AEEA00",borderRadius:"50%",width:"50px",height:"50px"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Разделитель"))))}}]),t}(f.Component),Bi=n(662),zi=n(663),qi=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gi=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Zi={borderRadius:"50%",width:"100px",height:"100px"},Yi={width:"100px",height:"100px"},Ki=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={draggingComponentWidget:{width:0,componentType:new he.None}},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchData(this.props)}},{key:"componentWillReceiveProps",value:function(e){Object(he.isEqual)(this.props.eventLine.data,e.eventLine.data)||this.fetchData(e)}},{key:"fetchData",value:function(e){var t=this;e.eventLine.data.foreach(function(e){t.props.dispatch(Object(me.d)(e.id)),t.props.dispatch(Object(ve.c)(e.id)),t.props.dispatch(Object(ye.c)(e.id)),t.props.dispatch(Object(Ce.c)(e.id))})}},{key:"handleComponentListExpandChanged",value:function(e,t){this.props.dispatch(Object(ge.E)(t))}},{key:"handleComponentAttributesExpandChanged",value:function(e,t){this.props.dispatch(Object(ge.B)(t))}},{key:"handleStageViewAttributesExpandChanged",value:function(e,t){this.props.dispatch(Object(ge.U)(t))}},{key:"handleJourneyAttributesExpandChanged",value:function(e,t){this.props.dispatch(Object(ge.Q)(t))}},{key:"onComponentwidgetBeginDrag",value:function(e,t){this.setState(j(this.state,{draggingComponentWidget:{width:{$set:t},componentType:{$set:Object(he.toOption)(e)}}}))}},{key:"render",value:function(){var e=this,t=(this.props.journeyEditor.defaultFormId,0===this.props.journeyEditor.inputs.length),n=this.props.journeyEditor.record.map(function(e){return e.entity.singleRun}).getOrElse(function(){return!1});return f.createElement("div",{className:"ConfigSection__container"},f.createElement(S.a,null,this.props.journeyEditor.selectedComponentId.nonEmpty()&&f.createElement(M.a,{style:{marginBottom:"10px"},expanded:this.props.journeyEditor.expandComponentAttributes,onChange:this.handleComponentAttributesExpandChanged},f.createElement(A.a,{expandIcon:f.createElement(B.a,null)},f.createElement("div",{style:{display:"flex",alignItems:"center"}},f.createElement(K.a,{style:{marginRight:15}}),f.createElement(J.a,null,this.props.i18n.t("Настройки компонента")))),f.createElement(H.a,null,f.createElement(J.a,{component:"div",style:{width:"100%"}},f.createElement(Ni,{openDialog:this.props.openDialog,handleDialogClose:this.props.handleDialogClose})))),this.props.journeyEditor.selectedComponentId.nonEmpty()&&f.createElement(M.a,{style:{marginBottom:"10px"},expanded:this.props.journeyEditor.expandStageViewAttributes,onChange:this.handleStageViewAttributesExpandChanged},f.createElement(A.a,{expandIcon:f.createElement(B.a,null)},f.createElement("div",{style:{display:"flex",alignItems:"center"}},f.createElement(K.a,{style:{marginRight:15}}),f.createElement(J.a,null,this.props.i18n.t("Настройки отображения компонента")))),f.createElement(H.a,null,f.createElement(J.a,{component:"div",style:{width:"100%"}},f.createElement(Ai,null)))),f.createElement(M.a,{expanded:this.props.journeyEditor.expandComponentList,onChange:this.handleComponentListExpandChanged},f.createElement(A.a,{expandIcon:f.createElement(B.a,null)},f.createElement("div",{style:{display:"flex",alignItems:"center"}},f.createElement(q.a,{style:{marginRight:15}}),f.createElement(J.a,null,this.props.i18n.t("Компоненты")))),f.createElement(H.a,null,f.createElement(J.a,{component:"div",style:{width:"100%"}},f.createElement("div",{style:{display:"flex",flexDirection:"column"}},f.createElement(ee,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),!Sn.default.isA5000&&f.createElement(ne,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),!n&&f.createElement(re,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),!Sn.default.isA5000&&f.createElement(ce,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),!Sn.default.isA5000&&f.createElement(ae,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),!Sn.default.isA5000&&f.createElement(de,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),f.createElement(pe,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),!Sn.default.isA5000&&f.createElement(Vi,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),n&&t&&f.createElement(Bi.b,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}),n&&f.createElement(zi.b,{onBeginDrag:this.onComponentwidgetBeginDrag,i18n:this.props.i18n}))))),f.createElement(_.a,null),f.createElement(M.a,{expanded:this.props.journeyEditor.expandJourneyAttributes,onChange:this.handleJourneyAttributesExpandChanged},f.createElement(A.a,{expandIcon:f.createElement(B.a,null)},f.createElement("div",{style:{display:"flex",alignItems:"center"}},f.createElement(Z.a,{style:{marginRight:15}}),f.createElement(J.a,null,this.props.i18n.t("Настройки цепочки")))),f.createElement(H.a,null,f.createElement(Ui,null)))),f.createElement(ta,null,this.state.draggingComponentWidget.componentType.map(function(t){return f.createElement("div",{style:{width:e.state.draggingComponentWidget.width}},t===se&&f.createElement("div",{style:Object.assign({},Yi,{backgroundColor:"#ee336d"})}),t===Q&&f.createElement("div",{style:Object.assign({},Yi,{backgroundColor:"#f0b029"})}),t===te&&f.createElement("div",{style:Object.assign({},Yi,{backgroundColor:"#f0b029"})}),t===le&&f.createElement("div",{style:Object.assign({},Yi,{backgroundColor:"#ee336d"})}),t===oe&&f.createElement("div",{style:Object.assign({},Zi,{backgroundColor:"#7ab260"})}),t===ie&&f.createElement("div",{style:Object.assign({},Zi,{backgroundColor:"#f0b029"})}),t===ue&&f.createElement("div",{style:Object.assign({},Zi,{backgroundColor:"#2196f3"})}),t===Ji&&f.createElement("div",{style:Object.assign({},Zi,{backgroundColor:"#AEEA00"})}))}).getOrNull()))}}]),t}(f.Component);Ki=qi([g.autobind,Gi("design:paramtypes",[Object])],Ki);var Xi=Object(h.connect)(function(e){return{i18n:e.i18n,journeyEditor:e.journeyEditor,eventLine:e.eventLine,forms:e.forms}})(Ki),Qi={position:"fixed",pointerEvents:"none",zIndex:1054,left:0,top:0,width:"100%",height:"100%"},ea=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={top:0,left:0},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(){var e=D.findDOMNode(this);if(e){var t=e.getBoundingClientRect();this.setState({top:t.top,left:t.left})}}},{key:"render",value:function(){if(!this.props.isDragging)return null;if(!this.props.currentOffset)return null;var e=this.props.currentOffset,t=e.x,n=e.y;return f.createElement("div",{style:Qi},f.createElement("div",{style:{position:"absolute",top:n-this.state.top+"px",left:t-this.state.left+"px"}},this.props.children))}}]),t}(f.Component),ta=Object(fe.DragLayer)(function(e){return{isDragging:e.isDragging(),initialOffset:e.getInitialSourceClientOffset(),currentOffset:e.getSourceClientOffset()}})(ea),na=n(2705),oa=n(226),ra=n(1772),ia=n.n(ra),aa=n(1773),sa=n.n(aa),ca=n(1923),la=n.n(ca),pa=n(1505),ua=(n(2372),n(2374),n(1911)),da=n.n(ua),fa=n(2060),ha=n.n(fa),ga=n(2379),ma=n.n(ga),va=n(1597),ya=n.n(va),Ca=n(1912),Ea=n.n(Ca),ba=n(94),Oa=n.n(ba),ja=function(e){return f.createElement(Oa.a,Object.assign({},e),f.createElement("path",{d:"M23,12L19,8V11H10V13H19V16M1,18V6C1,4.89 1.9,4 3,4H15A2,2 0 0,1 17,6V9H15V6H3V18H15V15H17V18A2,2 0 0,1 15,20H3A2,2 0 0,1 1,18Z"}))},Ia=function(e){return f.createElement(Oa.a,Object.assign({},e),f.createElement("path",{d:"M7,2H17A2,2 0 0,1 19,4V20A2,2 0 0,1 17,22H7A2,2 0 0,1 5,20V4A2,2 0 0,1 7,2M7,4V8H17V4H7M7,10V12H9V10H7M11,10V12H13V10H11M15,10V12H17V10H15M7,14V16H9V14H7M11,14V16H13V14H11M15,14V16H17V14H15M7,18V20H9V18H7M11,18V20H13V18H11M15,18V20H17V18H15Z"}))},ka=n(2062),Ta=n.n(ka),Pa=n(2061),wa=n.n(Pa),Fa=n(2380),xa=n.n(Fa),Da=n(2381),Ra=n.n(Da),_a=n(1615),$a=n.n(_a),Sa=n(646),Na=n.n(Sa),Ma=n(887),La=n.n(Ma),Aa=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getInputColor",value:function(){switch(this.props.model.getName()){case"main":return"green";case"aggregate":return"black";case"parent":return"green";case"children":return"blue";case"data":return"green";case"reset":return"red";case zi.a:return La.a[700];default:return"blue"}}},{key:"getOutputColor",value:function(){switch(this.props.model.getName()){case"default":case"success":return"green";case Bi.a:return Na.a[900];default:return"red"}}},{key:"render",value:function(){return f.createElement("div",{style:{position:"relative",marginBottom:"5px"}},this.props.model.in&&f.createElement("div",{style:{backgroundColor:this.getInputColor(),width:this.props.isCondition?"20px":"10px",height:"20px",borderTopLeftRadius:"20px",borderBottomLeftRadius:"20px",borderTopRightRadius:this.props.isCondition?"20px":"none",borderBottomRightRadius:this.props.isCondition?"20px":"none",boxSizing:"border-box",border:this.props.isSelected?"solid #00c0ff 2px":"solid "+this.getInputColor()+" 2px"}}),!this.props.model.in&&f.createElement("div",{style:{backgroundColor:this.getOutputColor(),width:this.props.isCondition?"20px":"10px",height:"20px",borderTopRightRadius:"20px",borderBottomRightRadius:"20px",borderTopLeftRadius:this.props.isCondition?"20px":"none",borderBottomLeftRadius:this.props.isCondition?"20px":"none",boxSizing:"border-box",border:this.props.isSelected?"solid #00c0ff 2px":"solid "+this.getOutputColor()+" 2px"}}),f.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},f.createElement(pa.PortWidget,{node:this.props.model.getParent(),name:this.props.model.getName()})))}}]),t}(f.Component),Wa=(n(2059),n(2377),function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return this.props.comment.map(function(e){return f.createElement("div",{className:"CommentWidget-root"},f.createElement("div",{className:"CommentWidget-text"},e))}).getOrNull()}}]),t}(f.Component)),Ha=Object(h.connect)(function(e,t){return{i18n:e.i18n,comment:Object(he.headOption)(e.journeyEditor.components.filter(function(e){return e.stage.stageId===t.componentId})).flatMap(function(e){return e.stage.viewConfig.comment})}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.journeyEditor.components===t.journeyEditor.components},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&Object(he.isEqual)(e.comment,t.comment)}})(Wa),Ua=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ja=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Va=function(e){return e===v.ImportFile.$Type.value||e===v.ImportData.$Type.value||e===v.WebHook.$Type.value||e===v.JourneyImportRows.$Type.value},Ba=function(e){return e===v.FormDataAppendRefs.$Type.value},za=function(e){return e===v.FormDataAppendRefs.$Type.value},qa=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y},stageConfigType:new he.None,notifyType:new he.None},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;Object(he.headOption)(this.props.journeyEditor.components.filter(function(t){return t.stage.stageId===e.props.node.id})).foreach(function(t){e.setState(j(e.state,{stageConfigType:{$set:Object(he.toOption)(t.stage.stageConfig.tpe.value)}}))})}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.state;this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),n=j(n,{position:{x:{$set:e.node.x},y:{$set:e.node.y}}}));var o=Object(he.headOption)(e.journeyEditor.components.filter(function(t){return t.stage.stageId===e.node.id}));if(o.foreach(function(t){if(t.stage.stageConfig instanceof v.SendNotification||t.stage.stageConfig instanceof v.SendAggregateNotification||t.stage.stageConfig instanceof v.SendNotificationsFiltered){var o=t.stage.stageConfig.template;Object(he.headOption)(e.notifyTemplates.eventLineDescriptionsList.filter(function(e){return e.id.toString()===o.value})).map(function(e){n=j(n,{notifyType:{$set:Object(he.toOption)(e.params)}})})}}),e.journeyEditor.components!==this.props.journeyEditor.components){var r=Object(he.headOption)(this.props.journeyEditor.components.filter(function(e){return e.stage.stageId===t.props.node.id}));Object(he.isEqual)(o,r)||o.foreach(function(e){r.map(function(t){return t.stage.stageConfig.tpe.value!==e.stage.stageConfig.tpe.value}).foreach(function(t){n=j(n,{stageConfigType:{$set:Object(he.toOption)(e.stage.stageConfig.tpe.value)}})})}),Object(he.isEqual)(o.map(function(e){return e.stage.outputs}),r.map(function(e){return e.stage.outputs}))||o.foreach(function(e){r.foreach(function(n){var o=Ba(n.stage.stageConfig.tpe.value),r=Ba(e.stage.stageConfig.tpe.value),i=Va(n.stage.stageConfig.tpe.value),a=Va(e.stage.stageConfig.tpe.value);(o&&!(r&&a)||!(o&&i)&&a||o&&a)&&t.props.onOutPortsAdded(t.props.node,e.stage.outputs.filter(function(e){return 0===n.stage.outputs.filter(function(t){return t.uid===e.uid}).length})),t.props.onOutPortsDeleted(t.props.node,n.stage.outputs.filter(function(t){return 0===e.stage.outputs.filter(function(e){return e.uid===t.uid}).length}))})}),Object(he.isEqual)(o.map(function(e){return e.stage.inputs}),r.map(function(e){return e.stage.inputs}))||o.foreach(function(e){r.foreach(function(n){var o=za(n.stage.stageConfig.tpe.value),r=za(e.stage.stageConfig.tpe.value);(!o&&r||o&&!r)&&t.props.onInPortsAdded(t.props.node,e.stage.inputs.filter(function(e){return 0===n.stage.inputs.filter(function(t){return t.uid===e.uid}).length})),t.props.onInPortsDeleted(t.props.node,n.stage.inputs.filter(function(t){return 0===e.stage.inputs.filter(function(e){return e.uid===t.uid}).length}))})})}this.setState(n)}},{key:"getIcon",value:function(){var e={height:"48px",width:"48px",fill:"white"},t=this.state.stageConfigType.getOrElse(function(){return""}),n=this.state.notifyType.getOrElse(function(){return""});if(t===v.SendNotification.$Type.value||t===v.SendAggregateNotification.$Type.value||t===v.SendNotificationsFiltered.$Type.value)switch(n){case v.MessageParamsDataEmailData.$Type.value:return f.createElement(da.a,{className:"action-widget-icon",style:e});case v.MessageParamsDataSmsData.$Type.value:case v.MessageParamsDataWebPushData.$Type.value:return f.createElement(ha.a,{className:"action-widget-icon",style:e});case v.MessengerParamsData.$Type.value:return f.createElement(wa.a,{className:"action-widget-icon",style:e})}return t===v.ImportFile.$Type.value?f.createElement(ya.a,{className:"action-widget-icon",style:e}):t===v.WebHook.$Type.value?f.createElement(ja,{className:"action-widget-icon",style:e}):t===v.PrintDocument.$Type.value?f.createElement(Ea.a,{className:"action-widget-icon",style:e}):t===v.JourneyEvents.$Type.value?f.createElement(Ta.a,{className:"action-widget-icon",style:e}):t===v.JourneyFormDataChildrenSearch.$Type.value?f.createElement(Ta.a,{className:"action-widget-icon",style:e}):t===v.SocialPublishConfig.$Type.value?f.createElement(ma.a,{className:"action-widget-icon",style:e}):t===v.CalculateFieldValue.$Type.value?f.createElement(Ia,{className:"action-widget-icon",style:e}):t===v.SetRegAppStatus.$Type.value?f.createElement(Z.a,{className:"action-widget-icon",style:e}):t===v.ImportData.$Type.value?f.createElement(xa.a,{className:"action-widget-icon",style:e}):t===v.JourneyImportRows.$Type.value?f.createElement(xa.a,{className:"action-widget-icon",style:e}):t===v.JourneyDataParser.$Type.value?f.createElement(Ra.a,{className:"action-widget-icon",style:e}):t===v.JourneyFormDataSearch.$Type.value?f.createElement(f.Fragment,null,f.createElement(Ta.a,{className:"action-widget-icon",style:e}),f.createElement($a.a,{className:"action-widget-icon",style:{marginTop:35,height:"20px",width:"20px",fill:"white"}})):t===v.FormDataAppendRefs.$Type.value?f.createElement(xa.a,{className:"action-widget-icon",style:e}):t===v.JourneyEmailDataExtract.$Type.value?f.createElement(Z.a,{className:"action-widget-icon",style:e}):f.createElement(Me.a,{className:"action-widget-icon",style:e})}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},f.createElement("div",{className:"EditorSection__node-widget",style:{position:"relative",backgroundColor:"#f0b029",width:"100px",height:100+25*(Va(this.state.stageConfigType.getOrElse(function(){return""}))?1:0)+"px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #f0b029 2px"}},this.getIcon(),f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-100%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()})),f.createElement("div",{style:{width:"100px",marginTop:4,fontSize:"10px",textAlign:"center"}},Object(pt.Q)(this.state.stageConfigType.getOrElse(function(){return""}),this.props.i18n.t)))}}]),t}(f.Component);qa=Ua([g.autobind,Ja("design:paramtypes",[Object])],qa);var Ga=Object(h.connect)(function(e,t){return{i18n:e.i18n,journeyEditor:e.journeyEditor,notifyTemplates:e.notifyTemplates}})(qa),Za=n(2382),Ya=n.n(Za),Ka=n(2703),Xa=n(2390),Qa=n.n(Xa),es=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e&&(n.id=e),n}return p()(t,e),a()(t,[{key:"removePoint",value:function(e){var t=this;this.points.splice(this.getPointIndex(e),1),this.iterateListeners(function(n){n.onPointRemoved&&n.onPointRemoved(e,t)})}},{key:"addPoint",value:function(e,t){var n=this,o=Object(he.toOption)(t).getOrElse(function(){return 1});return this.points.splice(o,0,e),this.iterateListeners(function(t){t.onPointAdded&&t.onPointAdded(e,n)}),e}},{key:"removeLabels",value:function(){Qa()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"labels",[],this)}},{key:"setTargetPort",value:function(e){null!==e&&"out"===e.getType()||(null!==e&&e.addLink(this),null!==this.targetPort&&this.targetPort.removeLink(this),this.targetPort=e,this.iterateListeners(function(t,n){t.targetPortChanged&&t.targetPortChanged(Object.assign({},n,{port:e}))}))}}]),t}(pa.LinkModel),ts=function(e){function t(e,n,o,i){r()(this,t);var a=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o));return a.in="in"===n,a.type=n,o&&(a.id=o),a}return p()(t,e),a()(t,[{key:"deSerialize",value:function(e,n){Ya()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"deSerialize",this).call(this,e,n),this.in=e.in}},{key:"serialize",value:function(){return Object(Ka.a)(Ya()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"serialize",this).call(this),{in:this.in})}}]),a()(t,[{key:"setParent",value:function(e){this.parent=e}},{key:"removeLink",value:function(e){var t=this;delete this.links[e.getID()],this.iterateListeners(function(n){n.onLinkRemoved&&n.onLinkRemoved(t,e)})}},{key:"addLink",value:function(e){var t=this;this.links[e.getID()]=e,this.iterateListeners(function(n){n.onLinkAdded&&n.onLinkAdded(t,e)})}},{key:"createLinkModel",value:function(){return Ya()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"createLinkModel",this).call(this)||new es}}]),t}(pa.PortModel),ns=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.inPorts=[],o.outPorts=[],o}return p()(t,e),a()(t,[{key:"removePort",value:function(e){this.ports[e.name]&&(this.ports[e.name].setParent(null),delete this.ports[e.name]),this.inPorts=this.inPorts.filter(function(t){return t.getID()!==e.getID()}),this.outPorts=this.outPorts.filter(function(t){return t.getID()!==e.getID()})}},{key:"addPort",value:function(e){return e instanceof ts&&(e.setParent(this),this.ports[e.name]=e,e.in?this.inPorts.push(e):this.outPorts.push(e)),e}},{key:"moveOutPort",value:function(e,t){var n=this;e>t&&Object(he.lift)(this.outPorts,t).foreach(function(o){Object(he.lift)(n.outPorts,e).foreach(function(e){n.outPorts.splice(t,2,e,o)})}),e<t&&Object(he.lift)(this.outPorts,t).foreach(function(t){Object(he.lift)(n.outPorts,e).foreach(function(o){n.outPorts.splice(e,2,t,o)})})}},{key:"moveInPort",value:function(e,t){var n=this;e>t&&Object(he.lift)(this.inPorts,t).foreach(function(o){Object(he.lift)(n.inPorts,e).foreach(function(e){n.inPorts.splice(t,2,e,o)})}),e<t&&Object(he.lift)(this.inPorts,t).foreach(function(t){Object(he.lift)(n.inPorts,e).foreach(function(o){n.inPorts.splice(e,2,t,o)})})}},{key:"getInPorts",value:function(){return this.inPorts}},{key:"getOutPorts",value:function(){return this.outPorts}}]),t}(pa.NodeModel),os=function(e){function t(e,n,o,i,a,s,l){r()(this,t);var p=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Q));return p.onNodeDeleteClickHandler=e,p.onNodeMoved=n,p.onStageConfigTypeChanged=o,p.onOutPortsAdded=i,p.onOutPortsDeleted=a,p.onInPortsAdded=s,p.onInPortsDeleted=l,p}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(Ga,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved,onStageConfigTypeChanged:this.onStageConfigTypeChanged,onOutPortsAdded:this.onOutPortsAdded,onOutPortsDeleted:this.onOutPortsDeleted,onInPortsAdded:this.onInPortsAdded,onInPortsDeleted:this.onInPortsDeleted})}},{key:"getNewInstance",value:function(e){return new ns(Q)}}]),t}(pa.AbstractNodeFactory),rs=(n(2400),function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}),is=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},as=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y},stageConfigType:new he.None,notifyType:new he.None},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;Object(he.headOption)(this.props.journeyEditor.components.filter(function(t){return t.stage.stageId===e.props.node.id})).foreach(function(t){e.setState(e.setStageConfigType(t,e.props,e.state))})}},{key:"setStageConfigType",value:function(e,t,n){return j(n,{stageConfigType:{$set:Object(he.toOption)(e.stage.stageConfig.tpe.value)}})}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.state;this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),n=j(n,{position:{x:{$set:e.node.x},y:{$set:e.node.y}}}));var o=Object(he.headOption)(e.journeyEditor.components.filter(function(t){return t.stage.stageId===e.node.id}));if(o.foreach(function(t){if(t.stage.stageConfig instanceof v.SendAggregateNotification){var o=t.stage.stageConfig.template;Object(he.headOption)(e.notifyTemplates.eventLineDescriptionsList.filter(function(e){return e.id.toString()===o.value})).map(function(e){n=j(n,{notifyType:{$set:Object(he.toOption)(e.params)}})})}}),e.journeyEditor.components!==this.props.journeyEditor.components){var r=Object(he.headOption)(this.props.journeyEditor.components.filter(function(e){return e.stage.stageId===t.props.node.id}));Object(he.isEqual)(o,r)||o.foreach(function(o){r.map(function(e){return e.stage.stageConfig.tpe.value!==o.stage.stageConfig.tpe.value}).foreach(function(){n=t.setStageConfigType(o,e,n)})}),Object(he.isEqual)(o.map(function(e){return e.stage.inputs}),r.map(function(e){return e.stage.inputs}))||o.foreach(function(e){r.foreach(function(n){t.props.onInPortsAdded(t.props.node,e.stage.inputs.filter(function(e){return 0===n.stage.inputs.filter(function(t){return t.uid===e.uid}).length})),t.props.onInPortsDeleted(t.props.node,n.stage.inputs.filter(function(t){return 0===e.stage.inputs.filter(function(e){return e.uid===t.uid}).length}))})})}this.setState(n)}},{key:"getIcon",value:function(){var e={height:"48px",width:"48px",fill:"white"},t=this.state.stageConfigType.getOrElse(function(){return""}),n=this.state.notifyType.getOrElse(function(){return""});if(t===v.SendAggregateNotification.$Type.value)switch(n){case v.MessageParamsDataEmailData.$Type.value:return f.createElement(da.a,{className:"two-inputs-action-widget-icon",style:e});case v.MessageParamsDataSmsData.$Type.value:return f.createElement(ha.a,{className:"two-inputs-action-widget-icon",style:e});case v.MessageParamsDataWebPushData.$Type.value:return f.createElement(ha.a,{className:"action-widget-icon",style:e});case v.MessengerParamsData.$Type.value:return f.createElement(wa.a,{className:"action-widget-icon",style:e})}return f.createElement(Me.a,{className:"action-widget-icon",style:e})}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},f.createElement("div",{className:"EditorSection__node-widget",style:{position:"relative",backgroundColor:"#f0b029",width:"100px",height:"125px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #f0b029 2px"}},this.getIcon(),f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-100%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()})),f.createElement("div",{style:{width:"100px",marginTop:4,fontSize:"10px",textAlign:"center"}},Object(pt.Q)(this.state.stageConfigType.getOrElse(function(){return""}),this.props.i18n.t)))}}]),t}(f.Component);as=rs([g.autobind,is("design:paramtypes",[Object])],as);var ss=Object(h.connect)(function(e){return{i18n:e.i18n,journeyEditor:e.journeyEditor,notifyTemplates:e.notifyTemplates}})(as),cs=function(e){function t(e,n,o,i){r()(this,t);var a=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,te));return a.onNodeDeleteClickHandler=e,a.onNodeMoved=n,a.onInPortsAdded=o,a.onInPortsDeleted=i,a}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(ss,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved,onInPortsAdded:this.onInPortsAdded,onInPortsDeleted:this.onInPortsDeleted})}},{key:"getNewInstance",value:function(e){return new ns(te)}}]),t}(pa.AbstractNodeFactory),ls="ConditionType",ps=(function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement(X.b,{componentType:ls,onBeginDrag:this.props.onBeginDrag},f.createElement("div",{className:"ConfigSection__widget",style:{display:"flex",alignItems:"center",padding:"10px"}},f.createElement("div",{style:{backgroundColor:"#ee336d",width:"50px",height:"50px",transform:"rotate(45deg) scale(0.71, 0.71)"}}),f.createElement("span",{style:{marginLeft:"15px"}},this.props.i18n.t("Фильтр"))))}}])}(f.Component),n(1616)),us=(n(2402),function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}),ds=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},fs=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y}},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),this.setState({position:{x:e.node.x,y:e.node.y}}))}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n,isCondition:!0})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"render",value:function(){var e=this;return f.createElement("div",{className:"EditorSection__node-widget",style:{position:"relative"}},f.createElement("div",{style:{backgroundColor:"#ee336d",width:"100px",height:"100px",boxSizing:"border-box",transform:"rotate(45deg) scale(0.71, 0.71)",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #ee336d 2px"}}),f.createElement(ps.a,{className:"widget-icon",style:{width:"48px",height:"48px"}}),f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-50%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(50%, -50%)"}},this.props.node.getOutPorts().filter(function(e){return"success"===e.getName()}).map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",bottom:0,left:"50%",transform:"translate(-50%, 50%)"}},this.props.node.getOutPorts().filter(function(e){return"failed"===e.getName()}).map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()}))}}]),t}(f.Component),hs=fs=us([g.autobind,ds("design:paramtypes",[Object])],fs),gs=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,ls));return o.onNodeDeleteClickHandler=e,o.onNodeMoved=n,o}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(hs,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved})}},{key:"getNewInstance",value:function(e){return new ns(ls)}}]),t}(pa.AbstractNodeFactory),ms=n(265),vs=n.n(ms),ys=n(2404),Cs=n.n(ys),Es=n(2405),bs=n.n(Es),Os=n(2406),js=n.n(Os),Is=n(414),ks=n.n(Is),Ts=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ps=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ws=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y},eventType:new he.None},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;Object(he.headOption)(this.props.journeyEditor.components.filter(function(t){return t.stage.stageId===e.props.node.id})).foreach(function(t){e.setState(e.setStageConfigType(t,e.props,e.state))})}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.state;if(this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),n=j(n,{position:{x:{$set:e.node.x},y:{$set:e.node.y}}})),e.journeyEditor.components!==this.props.journeyEditor.components){var o=Object(he.headOption)(this.props.journeyEditor.components.filter(function(e){return e.stage.stageId===t.props.node.id})),r=Object(he.headOption)(e.journeyEditor.components.filter(function(t){return t.stage.stageId===e.node.id}));Object(he.isEqual)(r,o)||r.foreach(function(r){o.map(function(e){return e.stage.stageConfig.tpe.value!==r.stage.stageConfig.tpe.value}).foreach(function(){n=t.setStageConfigType(r,e,n)})})}this.setState(n)}},{key:"setStageConfigType",value:function(e,t,n){return j(n,{eventType:{$set:Object(he.toOption)(e.stage.stageConfig.eventType.tpe.value)}})}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"getIcon",value:function(){var e={height:"48px",width:"48px",fill:"white"},t=this.state.eventType.getOrElse(function(){return""});return t===v.EventTypeFormDataCreated.$Type.value?f.createElement(vs.a,{className:"action-widget-icon",style:e}):t===v.EventTypeFormDataUpdated.$Type.value?f.createElement(Cs.a,{className:"action-widget-icon",style:e}):t===v.EventTypeFormDataDeleted.$Type.value?f.createElement(ks.a,{className:"action-widget-icon",style:e}):t===v.EventTypeDocumentPrinted.$Type.value?f.createElement(Ea.a,{className:"action-widget-icon",style:e}):t===v.EventTypeInteraction.$Type.value?f.createElement(bs.a,{className:"action-widget-icon",style:e}):t===v.EventTypeJourneyEvent.$Type.value?f.createElement(Ta.a,{className:"action-widget-icon",style:e}):t===v.EventTypeEmailTracked.$Type.value?f.createElement(js.a,{className:"action-widget-icon",style:e}):t===v.EventTypeEmailFetched.$Type.value?f.createElement(js.a,{className:"action-widget-icon",style:e}):f.createElement(vs.a,{className:"action-widget-icon",style:e})}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},f.createElement("div",{className:"TriggerNodeWidget__container EditorSection__node-widget",style:{position:"relative",backgroundColor:"#7ab260",borderRadius:"50%",width:"100px",height:"100px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #7ab260 2px"}},this.getIcon(),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()})),f.createElement("div",{style:{width:"100px",marginTop:4,fontSize:"10px",textAlign:"center"}},Object(pt.F)(this.state.eventType.getOrElse(function(){return""}),this.props.i18n.t)))}}]),t}(f.Component);ws=Ts([g.autobind,Ps("design:paramtypes",[Object])],ws);var Fs=Object(h.connect)(function(e){return{i18n:e.i18n,journeyEditor:e.journeyEditor}})(ws),xs=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,oe));return o.onNodeDeleteClickHandler=e,o.onNodeMoved=n,o}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(Fs,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved})}},{key:"getNewInstance",value:function(e){return new ns(oe)}}]),t}(pa.AbstractNodeFactory),Ds=n(2409),Rs=n.n(Ds),_s=(n(2407),function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}),$s=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ss=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y}},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),this.setState({position:{x:e.node.x,y:e.node.y}}))}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"getInPortsStyle",value:function(e){switch(e){case 0:return{top:"30%",transform:"translate(-100%, -50%) rotateZ(23deg)"};case 1:return{top:"70%",transform:"translate(-100%, -50%) rotateZ(-17deg)"};default:return{}}}},{key:"render",value:function(){var e=this;return f.createElement("div",{className:"JobTriggerNodeWidget__container EditorSection__node-widget",style:{position:"relative",backgroundColor:"#f0b029",borderRadius:"50%",width:"100px",height:"100px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #7ab260 2px"}},f.createElement(Rs.a,{className:"timer-widget-icon",style:{height:"48px",width:"48px",fill:"white"}}),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),this.props.node.getInPorts().map(function(t,n){return f.createElement("div",{style:Object.assign({position:"absolute",left:2},e.getInPortsStyle(n))},e.generatePort(t,n,e.props.node.isSelected()))}),f.createElement(Ha,{componentId:this.props.node.getID()}))}}]),t}(f.Component),Ns=Ss=_s([g.autobind,$s("design:paramtypes",[Object])],Ss),Ms=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,ie));return o.onNodeDeleteClickHandler=e,o.onNodeMoved=n,o}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(Ns,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved})}},{key:"getNewInstance",value:function(e){return new ns(ie)}}]),t}(pa.AbstractNodeFactory),Ls=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},As=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ws=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y},stageConfigType:new he.None,notifyType:new he.None},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;Object(he.headOption)(this.props.journeyEditor.components.filter(function(t){return t.stage.stageId===e.props.node.id})).foreach(function(t){e.setState(j(e.state,{stageConfigType:{$set:Object(he.toOption)(t.stage.stageConfig.tpe.value)}}))})}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.state;if(this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),n=j(n,{position:{x:{$set:e.node.x},y:{$set:e.node.y}}})),e.journeyEditor.components!==this.props.journeyEditor.components){var o=Object(he.headOption)(this.props.journeyEditor.components.filter(function(e){return e.stage.stageId===t.props.node.id})),r=Object(he.headOption)(e.journeyEditor.components.filter(function(t){return t.stage.stageId===e.node.id}));Object(he.isEqual)(r,o)||(r.foreach(function(e){o.map(function(t){return t.stage.stageConfig.tpe.value!==e.stage.stageConfig.tpe.value}).foreach(function(){if(n=j(n,{stageConfigType:{$set:Object(he.toOption)(e.stage.stageConfig.tpe.value)}}),e.stage.stageConfig instanceof v.SendNotification)e.stage.stageConfig.template})}),r.foreach(function(e){o.foreach(function(t){e.stage})})),Object(he.isEqual)(r.map(function(e){return e.stage.inputs}),o.map(function(e){return e.stage.inputs}))||r.foreach(function(e){o.foreach(function(n){t.props.onInPortsAdded(t.props.node,e.stage.inputs.filter(function(e){return 0===n.stage.inputs.filter(function(t){return t.uid===e.uid}).length})),t.props.onInPortsDeleted(t.props.node,n.stage.inputs.filter(function(t){return 0===e.stage.inputs.filter(function(e){return e.uid===t.uid}).length})),t.props.onInPortsChanged(t.props.node,e.stage.inputs.filter(function(e){return 1===n.stage.inputs.filter(function(t){return t.uid===e.uid}).length&&1===n.stage.inputs.filter(function(t){return t.uid===e.uid&&t.name!==e.name}).length})),Object(he.headOption)(n.stage.inputs.filter(function(t,n){var o=e.stage.inputs.findIndex(function(e){return e.uid===t.uid});return o>-1&&o!==n})).foreach(function(o){t.props.onInPortMoved(t.props.node,e.stage.inputs.findIndex(function(e){return e.uid===o.uid}),n.stage.inputs.findIndex(function(e){return e.uid===o.uid}))})})})}this.setState(n)}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"onInPortAddedClick",value:function(e){var t=this;e.nativeEvent.stopImmediatePropagation(),Object(he.headOption)(this.props.journeyEditor.components.filter(function(e){return e.stage.stageId===t.props.node.id})).foreach(function(e){var n=Ee.v4(),o="in - "+e.stage.inputs.length;t.props.dispatch(Object(ge.D)({componentId:e.stage.stageId,inputs:e.stage.inputs.concat(new v.Contact(n,o))}))})}},{key:"render",value:function(){var e=this;return f.createElement("div",{className:"EditorSection__node-widget",style:{position:"relative",backgroundColor:"#ee336d",width:"100px",height:100+25*(this.props.node.getInPorts().length-1)+"px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #ee336d 2px"}},f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-100%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-100%, -50%)"}},f.createElement(ke.a,{onClick:this.onInPortAddedClick,color:"primary"},f.createElement(vs.a,null))),f.createElement(Ha,{componentId:this.props.node.getID()}))}}]),t}(f.Component);Ws=Ls([g.autobind,As("design:paramtypes",[Object])],Ws);var Hs=Object(h.connect)(function(e,t){return{journeyEditor:e.journeyEditor}})(Ws),Us=function(e){function t(e,n,o,i,a,s){r()(this,t);var l=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,se));return l.onNodeDeleteClickHandler=e,l.onNodeMoved=n,l.onInPortsAdded=o,l.onInPortsDeleted=i,l.onInPortsChanged=a,l.onInPortMoved=s,l}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(Hs,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved,onInPortsAdded:this.onInPortsAdded,onInPortsDeleted:this.onInPortsDeleted,onInPortsChanged:this.onInPortsChanged,onInPortMoved:this.onInPortMoved})}},{key:"getNewInstance",value:function(e){return new ns(se)}}]),t}(pa.AbstractNodeFactory),Js=(n(2410),function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}),Vs=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Bs=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y},stageConfigType:new he.None,notifyType:new he.None,rType:new he.None},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;Object(he.headOption)(this.props.journeyEditor.components.filter(function(t){return t.stage.stageId===e.props.node.id})).foreach(function(t){e.setState(j(e.state,{stageConfigType:{$set:Object(he.toOption)(t.stage.stageConfig.tpe.value)},rType:{$set:Object(he.toOption)(t.stage.stageConfig.rType)}}))})}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.state;if(this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),n=j(n,{position:{x:{$set:e.node.x},y:{$set:e.node.y}}})),e.journeyEditor.components!==this.props.journeyEditor.components){var o=Object(he.headOption)(this.props.journeyEditor.components.filter(function(e){return e.stage.stageId===t.props.node.id})),r=Object(he.headOption)(e.journeyEditor.components.filter(function(t){return t.stage.stageId===e.node.id}));Object(he.isEqual)(r,o)||(r.foreach(function(e){o.map(function(t){return t.stage.stageConfig.tpe.value!==e.stage.stageConfig.tpe.value}).foreach(function(){if(n=j(n,{stageConfigType:{$set:Object(he.toOption)(e.stage.stageConfig.tpe.value)},rType:{$set:Object(he.toOption)(e.stage.stageConfig.rType)}}),e.stage.stageConfig instanceof v.SendNotification)e.stage.stageConfig.template})}),r.foreach(function(e){o.foreach(function(t){e.stage})})),Object(he.isEqual)(r.map(function(e){return e.stage.outputs}),o.map(function(e){return e.stage.outputs}))||r.foreach(function(e){o.foreach(function(n){t.props.onOutPortsAdded(t.props.node,e.stage.outputs.filter(function(e){return 0===n.stage.outputs.filter(function(t){return t.uid===e.uid}).length})),t.props.onOutPortsDeleted(t.props.node,n.stage.outputs.filter(function(t){return 0===e.stage.outputs.filter(function(e){return e.uid===t.uid}).length})),t.props.onOutPortsChanged(t.props.node,e.stage.outputs.filter(function(e){return 1===n.stage.outputs.filter(function(t){return t.uid===e.uid}).length&&1===n.stage.outputs.filter(function(t){return t.uid===e.uid&&t.name!==e.name}).length})),Object(he.headOption)(n.stage.outputs.filter(function(t,n){var o=e.stage.outputs.findIndex(function(e){return e.uid===t.uid});return o>-1&&o!==n})).foreach(function(o){t.props.onOutPortMoved(t.props.node,e.stage.outputs.findIndex(function(e){return e.uid===o.uid}),n.stage.outputs.findIndex(function(e){return e.uid===o.uid}))})})})}this.setState(n)}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},f.createElement("div",{className:"EditorSection__node-widget",style:{position:"relative",backgroundColor:"#ee336d",width:"100px",height:100+25*(this.props.node.getOutPorts().length-1)+"px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #ee336d 2px"}},f.createElement(ps.a,{className:"router-widget-icon",style:{width:"48px",height:"48px"}}),f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-100%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().filter(function(e){return"default"!==e.name}).map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())}),this.props.node.getOutPorts().filter(function(e){return"default"===e.name}).map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()})),f.createElement("div",{style:{width:"100px",marginTop:4,fontSize:"10px",textAlign:"center"}},Object(pt.W)(this.state.rType.getOrElse(function(){return""}),this.props.i18n.t)))}}]),t}(f.Component);Bs=Js([g.autobind,Vs("design:paramtypes",[Object])],Bs);var zs=Object(h.connect)(function(e,t){return{i18n:e.i18n,journeyEditor:e.journeyEditor}})(Bs),qs=function(e){function t(e,n,o,i,a,s){r()(this,t);var l=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,le));return l.onNodeDeleteClickHandler=e,l.onNodeMoved=n,l.onOutPortsAdded=o,l.onOutPortsDeleted=i,l.onOutPortsChanged=a,l.onOutPortMoved=s,l}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(zs,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved,onOutPortsAdded:this.onOutPortsAdded,onOutPortsDeleted:this.onOutPortsDeleted,onOutPortsChanged:this.onOutPortsChanged,onOutPortMoved:this.onOutPortMoved})}},{key:"getNewInstance",value:function(e){return new ns(le)}}]),t}(pa.AbstractNodeFactory),Gs=n(348),Zs=n.n(Gs),Ys=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ks=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xs=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y}},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),this.setState({position:{x:e.node.x,y:e.node.y}}))}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{position:"relative",backgroundColor:Na.a[500],borderRadius:"50%",width:"100px",height:"100px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"none"}},f.createElement(Zs.a,{style:{height:"48px",width:"48px",fill:"white",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()}))}}]),t}(f.Component),Qs=Xs=Ys([g.autobind,Ks("design:paramtypes",[Object])],Xs),ec=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Bi.a));return o.onNodeDeleteClickHandler=e,o.onNodeMoved=n,o}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(Qs,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved})}},{key:"getNewInstance",value:function(e){return new ns(Bi.a)}}]),t}(pa.AbstractNodeFactory),tc=n(2412),nc=n.n(tc),oc=n(324),rc=n.n(oc),ic=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ac=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},sc=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y}},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),this.setState({position:{x:e.node.x,y:e.node.y}}))}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{position:"relative",backgroundColor:rc.a[500],borderRadius:"50%",width:"100px",height:"100px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"none"}},f.createElement(nc.a,{style:{height:"48px",width:"48px",fill:"white",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-100%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()}))}}]),t}(f.Component),cc=sc=ic([g.autobind,ac("design:paramtypes",[Object])],sc),lc=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,zi.a));return o.onNodeDeleteClickHandler=e,o.onNodeMoved=n,o}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(cc,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved})}},{key:"getNewInstance",value:function(e){return new ns(zi.a)}}]),t}(pa.AbstractNodeFactory),pc=function(e){function t(e,n){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return p()(t,e),a()(t,[{key:"x",get:function(){return this._x},set:function(e){var t=this;this.iterateListeners(function(n){n.onPointPositionChanged&&n.onPointPositionChanged({x:t._x,y:t._y},{x:e,y:t._y})}),this._x=e}},{key:"y",get:function(){return this._y},set:function(e){var t=this;this.iterateListeners(function(n){n.onPointPositionChanged&&n.onPointPositionChanged({x:t._x,y:t._y},{x:t._x,y:e})}),this._y=e}}]),t}(pa.PointModel),uc=n(2413),dc=n(1981),fc={width:60,height:60};function hc(e){var t=Object(dc.a)(e);return function(e){var t=function(e){return e.nodes.map(function(e){return{id:e.id,metadata:Object.assign({},fc,{id:e.id})}})}(e),n=function(e){return e.links.map(function(e){return{from:e.source,to:e.target}}).filter(function(t){return e.nodes.find(function(e){return e.id===t.from})&&e.nodes.find(function(e){return e.id===t.to})})}(e),o=new uc.graphlib.Graph;return o.setGraph({}),o.setDefaultEdgeLabel(function(){return{}}),t.forEach(function(e){o.setNode(e.id,e.metadata)}),n.forEach(function(e){e.from&&e.to&&o.setEdge(e.from,e.to)}),uc.layout(o),o.nodes().map(function(e){return o.node(e)})}(t).forEach(function(e){var n=t.nodes.find(function(t){return t.id===e.id});n.x=e.x,n.y=e.y}),t}var gc=n(894),mc=n.n(gc),vc=n(2496),yc=n.n(vc),Cc=(n(2494),function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}),Ec=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},bc=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y}},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),this.setState({position:{x:e.node.x,y:e.node.y}}))}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"render",value:function(){var e=this;return f.createElement("div",{className:"TimerTriggerNodeWidget__container EditorSection__node-widget",style:{position:"relative",backgroundColor:"#2196f3",borderRadius:"50%",width:"100px",height:"100px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"none"}},f.createElement(yc.a,{className:"timer-widget-icon",style:{height:"48px",width:"48px",fill:"white"}}),f.createElement("div",{style:{position:"absolute",top:"50%",right:0,transform:"translate(100%, -50%)"}},this.props.node.getOutPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-100%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()}))}}]),t}(f.Component),Oc=bc=Cc([g.autobind,Ec("design:paramtypes",[Object])],bc),jc=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,ue));return o.onNodeDeleteClickHandler=e,o.onNodeMoved=n,o}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(Oc,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved})}},{key:"getNewInstance",value:function(e){return new ns(ue)}}]),t}(pa.AbstractNodeFactory),Ic=n(2499),kc=n.n(Ic),Tc=(n(2497),function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}),Pc=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},wc=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:{x:e.node.x,y:e.node.y}},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.position.x===e.node.x&&this.state.position.y===e.node.y||(e.onNodeMoved(e.node),this.setState({position:{x:e.node.x,y:e.node.y}}))}},{key:"generatePort",value:function(e,t,n){return f.createElement(Aa,{key:t,model:e,isSelected:n})}},{key:"onDeleteClick",value:function(){this.props.onNodeDeleteClick(this.props.node)}},{key:"getOutPortsStyle",value:function(e){switch(e){case 0:return{top:"30%",transform:"translate(100%, -50%) rotateZ(-23deg)"};case 1:return{top:"70%",transform:"translate(100%, -50%) rotateZ(17deg)"};default:return{}}}},{key:"render",value:function(){var e=this;return f.createElement("div",{className:"BalancerRouterNodeWidget__container EditorSection__node-widget",style:{position:"relative",backgroundColor:"#AEEA00",borderRadius:"50%",width:"100px",height:"100px",boxSizing:"border-box",border:this.props.node.isSelected()?"solid #00c0ff 2px":"solid #7ab260 2px"}},f.createElement(kc.a,{className:"timer-widget-icon",style:{height:"48px",width:"48px",fill:"white"}}),this.props.node.getOutPorts().map(function(t,n){return f.createElement("div",{style:Object.assign({position:"absolute",right:2},e.getOutPortsStyle(n))},e.generatePort(t,n,e.props.node.isSelected()))}),f.createElement("div",{style:{position:"absolute",top:"50%",left:0,transform:"translate(-100%, -50%)"}},this.props.node.getInPorts().map(function(t,n){return e.generatePort(t,n,e.props.node.isSelected())})),f.createElement(Ha,{componentId:this.props.node.getID()}))}}]),t}(f.Component),Fc=wc=Tc([g.autobind,Pc("design:paramtypes",[Object])],wc),xc=function(e){function t(e,n){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Ji));return o.onNodeDeleteClickHandler=e,o.onNodeMoved=n,o}return p()(t,e),a()(t,[{key:"generateReactWidget",value:function(e,t){return f.createElement(Fc,{node:t,diagramEngine:e,onNodeDeleteClick:this.onNodeDeleteClickHandler,onNodeMoved:this.onNodeMoved})}},{key:"getNewInstance",value:function(e){return new ns(Ji)}}]),t}(pa.AbstractNodeFactory),Dc=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Rc=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};var _c=[8,46],$c=function(e){function t(e){r()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={engine:new he.None,diagramFocused:!1},n}return p()(t,e),a()(t,[{key:"getStageType",value:function(e){switch(e.value){case v.ZipMergeStage.$Type.value:return se;case v.FormDataFilter.$Type.value:case v.UpdateFieldFilter.$Type.value:case v.InteractionFilter.$Type.value:case v.SysEventAttrFilterConfig.$Type.value:case v.JourneyEventIdFilter.$Type.value:case v.FormDataRegFilterConfig.$Type.value:case v.EmailFieldsFilter.$Type.value:return ls;case v.TriggerConfig.$Type.value:return oe;case v.JobTriggerConfig.$Type.value:return ie;case v.UpdateFieldValue.$Type.value:case v.CalculateFieldValue.$Type.value:case v.SendNotification.$Type.value:case v.SendNotificationsFiltered.$Type.value:case v.SetRegAppStatus.$Type.value:case v.JourneyEmailDataExtract.$Type.value:return Q;case v.SendAggregateNotification.$Type.value:return te;case v.SocialPublishConfig.$Type.value:case v.ImportFile.$Type.value:case v.ImportData.$Type.value:case v.WebHook.$Type.value:case v.PrintDocument.$Type.value:case v.JourneyEvents.$Type.value:case v.JourneyFormDataChildrenSearch.$Type.value:case v.JourneyDataParser.$Type.value:case v.JourneyImportRows.$Type.value:return Q;case v.RouterConfig.$Type.value:return le;case v.JourneyParamsFilter.$Type.value:return ls;case v.TimerTrigger.$Type.value:return ue;case v.BalancerRouter.$Type.value:return Ji;case v.JourneyFormDataSearch.$Type.value:case v.DeleteFormData.$Type.value:return Q;case v.FormDataAppendRefs.$Type.value:return te;case v.FormDataConverterScript.$Type.value:return Q;default:throw"Unknown stage config type"}}},{key:"shouldComponentUpdate",value:function(e,t){var n=!Object(he.isEqual)(this.props.journeyEditor.record,e.journeyEditor.record),o=this.state!==t;return n||o}},{key:"componentDidMount",value:function(){var e=this;this.props.subscribeOnDistribute(this.onDistribute),this.props.journeyEditor.record.foreach(function(t){e.setState(j(e.state,{engine:{$set:e.initEngine(t.entity)}})),e.forceUpdate()}),window.addEventListener("click",this.onWindowMouseClick),window.addEventListener("keyup",this.onWindowKeyUp)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.onWindowMouseClick),window.removeEventListener("keyup",this.onWindowKeyUp)}},{key:"componentWillReceiveProps",value:function(e){var t=this;Object(he.isEqual)(this.props.journeyEditor.record,e.journeyEditor.record)||e.journeyEditor.record.foreach(function(e){t.setState(j(t.state,{engine:{$set:t.initEngine(e.entity)}})),t.forceUpdate()})}},{key:"onDistribute",value:function(){var e=this;this.state.engine.foreach(function(t){var n=t.getDiagramModel(),o=function(e,t){var n=hc(t.serializeDiagram()),o=new pa.DiagramModel;return o.deSerializeDiagram(n,e),o}(t,n);t.setDiagramModel(o),e.forceUpdate()})}},{key:"onWindowMouseClick",value:function(e){D.findDOMNode(this).contains(e.target)?this.state.diagramFocused||this.setState(j(this.state,{diagramFocused:{$set:!0}})):this.state.diagramFocused&&this.setState(j(this.state,{diagramFocused:{$set:!1}}))}},{key:"onWindowKeyUp",value:function(e){var t=this;this.state.diagramFocused&&-1!==_c.indexOf(e.keyCode)&&this.state.engine.foreach(function(e){e.getDiagramModel().getSelectedItems().forEach(function(e){e instanceof ns&&t.onComponentDelete(e),e instanceof es&&t.onLinkDeleted(e)})})}},{key:"initEngine",value:function(e){var t=new pa.DiagramEngine;t.registerNodeFactory(new os(this.onComponentDelete,this.onComponentMoved,this.onStageConfigTypeChanged,this.onOutPortsAdded,this.onOutPortsDeleted,this.onInPortsAdded,this.onInPortsDeleted)),t.registerNodeFactory(new cs(this.onComponentDelete,this.onComponentMoved,this.onInPortsAdded,this.onInPortsDeleted)),t.registerNodeFactory(new gs(this.onComponentDelete,this.onComponentMoved)),t.registerNodeFactory(new xs(this.onComponentDelete,this.onComponentMoved)),t.registerNodeFactory(new Ms(this.onComponentDelete,this.onComponentMoved)),t.registerNodeFactory(new jc(this.onComponentDelete,this.onComponentMoved)),t.registerNodeFactory(new Us(this.onComponentDelete,this.onComponentMoved,this.onInPortsAdded,this.onInPortsDeleted,this.onInPortsChanged,this.onInPortMoved)),t.registerNodeFactory(new qs(this.onComponentDelete,this.onComponentMoved,this.onOutPortsAdded,this.onOutPortsDeleted,this.onOutPortsChanged,this.onOutPortMoved)),t.registerNodeFactory(new xc(this.onComponentDelete,this.onComponentMoved)),t.registerLinkFactory(new pa.DefaultLinkFactory),t.registerLabelFactory(new pa.DefaultLabelFactory),t.registerNodeFactory(new ec(this.onComponentDelete,this.onComponentMoved)),t.registerNodeFactory(new lc(this.onComponentDelete,this.onComponentMoved));var n=t.getDiagramModel();return n.addListener(this.getDiagramModelListener()),this.addNodesToDiagramModel(e,n),this.addEdgesToDiagramModel(e,n),this.addLinkAddedListeners(n),this.addPointListeners(n),Object(he.toOption)(t)}},{key:"getDiagramModelListener",value:function(){var e=this;return{linksUpdated:function(t){t.isCreated&&e.onLinkAdded(t.link)}}}},{key:"onLinkAdded",value:function(e){this.setLinkLabelFromRouterType(e)}},{key:"onLinkUpdated",value:function(e){this.setLinkLabelFromMergeType(e)}},{key:"setLinkLabelFromMergeType",value:function(e){var t=e.getTargetPort();Object(he.toOption)(t).map(function(e){return e.getNode()}).filter(function(e){return e.getType()===se}).foreach(function(){var n=new pa.DefaultLabelModel;n.setLabel(t.getName()),e.addLabel(n)})}},{key:"setLinkLabelFromRouterType",value:function(e){var t=e.getSourcePort();Object(he.toOption)(t).map(function(e){return e.getNode()}).filter(function(e){return e.getType()===le}).foreach(function(){var n=new pa.DefaultLabelModel;n.setLabel(t.getName()),e.addLabel(n)})}},{key:"addNodesToDiagramModel",value:function(e,t){var n=this;e.definition.viewComponents.forEach(function(o){var r=e.definition.inputs.filter(function(e){return e.uid===o.id.id}).length>0,i=r?Bi.a:zi.a,a=r?"out":"in",s=new ns(i,o.id.id);s.x=o.point.x,s.y=o.point.y,s.addPort(new ts(i,a,s.getID())),n.addComponentMovedListener(s),t.addNode(s)}),e.definition.components.filter(function(e){return!(Sn.default.isA5000&&(e.stage.stageConfig instanceof v.JobTriggerConfig||e.stage.stageConfig instanceof v.SocialPublishConfig))}).forEach(function(e){var o=new ns(n.getStageType(e.stage.stageConfig.tpe),e.stage.stageId);e.stage.viewConfig instanceof v.StageView&&(o.x=e.stage.viewConfig.x,o.y=e.stage.viewConfig.y),e.stage.inputs.forEach(function(e,t){o.addPort(new ts(e.name,"in",e.uid))}),e.stage.outputs.forEach(function(e,t){o.addPort(new ts(e.name,"out",e.uid))}),n.addComponentMovedListener(o),t.addNode(o)})}},{key:"addEdgesToDiagramModel",value:function(e,t){var n=this;e.definition.edges.forEach(function(o){var r=new es;o.points.forEach(function(e){var t=new pc(r,e);n.addPointMoveListener(t,r),r.addPoint(t)});var i=e.definition.inputs.filter(function(e){return o.from.uid}).length>0,a=e.definition.outputs.filter(function(e){return o.to.uid}).length>0;Object(he.toOption)(i).filter(function(e){return e}).foreach(function(e){return Object(he.headOption)(Object(na.a)(t.getNodes(),function(e){return e.getID()===o.from.uid})).flatMap(function(e){return Object(he.headOption)(e.getOutPorts())}).foreach(function(e){return r.setSourcePort(e)})}),Object(he.toOption)(a).filter(function(e){return e}).foreach(function(e){return Object(he.headOption)(Object(na.a)(t.getNodes(),function(e){return e.getID()===o.to.uid})).flatMap(function(e){return Object(he.headOption)(e.getInPorts())}).foreach(function(e){return r.setTargetPort(e)})}),Object(he.headOption)(e.definition.components.filter(function(e){return e.stage.inputs.filter(function(e){return e.uid===o.to.uid}).length>0})).flatMap(function(e){return Object(he.headOption)(Object(na.a)(t.getNodes(),function(t){return t.getID()===e.stage.stageId}))}).flatMap(function(e){return Object(he.headOption)(Object(na.a)(e.getPorts(),function(e){return e.getID()===o.to.uid}))}).foreach(function(e){r.setTargetPort(e)}),Object(he.headOption)(e.definition.components.filter(function(e){return e.stage.outputs.filter(function(e){return e.uid===o.from.uid}).length>0})).flatMap(function(e){return Object(he.headOption)(Object(na.a)(t.getNodes(),function(t){return t.getID()===e.stage.stageId}))}).flatMap(function(e){return Object(he.headOption)(Object(na.a)(e.getPorts(),function(e){return e.getID()===o.from.uid}))}).foreach(function(e){r.setSourcePort(e)}),t.addLink(r)})}},{key:"addPointListeners",value:function(e){var t=this,n=e.getLinks();Object.keys(n).forEach(function(e){t.addPointListener(n[e])})}},{key:"addPointListener",value:function(e){var t=this;e.addListener({onPointAdded:function(e,n){if(e instanceof pa.PointModel&&!(e instanceof pc)){n.removePoint(e);var o=new pc(n,{x:e.getX(),y:e.getY()});t.addPointMoveListener(o,n),n.addPoint(o)}else e instanceof pc&&t.props.dispatch(Object(ge.M)({sourcePortId:n.getSourcePort().getID(),targetPortId:n.getTargetPort().getID(),pointX:e.x,pointY:e.y}))},onPointRemoved:function(e,n){e instanceof pc&&t.props.dispatch(Object(ge.N)({sourcePortId:n.getSourcePort().getID(),targetPortId:n.getTargetPort().getID(),pointX:e.x,pointY:e.y}))},targetPortChanged:function(e){t.setLinkLabelFromMergeType(e.entity)}})}},{key:"addPointMoveListener",value:function(e,t){var n=this;e.addListener({onPointPositionChanged:function(e,o){n.props.dispatch(Object(ge.O)({sourcePortId:t.getSourcePort().getID(),targetPortId:t.getTargetPort().getID(),prevPoint:e,nextPoint:o}))}})}},{key:"addLinkAddedListeners",value:function(e){var t=this,n=e.getNodes();Object.keys(n).forEach(function(e){n[e].getInPorts().forEach(function(e){t.addLinkAddedListener(e)})})}},{key:"addLinkAddedListener",value:function(e){var t=this;e.addListener({onLinkAdded:function(e,n){t.state.engine.foreach(function(o){var r=o.getDiagramModel();if(!(n instanceof es)&&n instanceof pa.LinkModel){r.removeLink(n);var i=new es(n.getID());i.setSourcePort(n.getSourcePort()),i.setTargetPort(e),r.addLink(i)}else n instanceof es&&Object(he.toOption)(n.getSourcePort()).foreach(function(o){t.addPointListener(n),t.props.dispatch(Object(ge.K)({sourcePortId:o.getID(),sourcePortName:o.getName(),targetPortId:e.getID(),targetPortName:e.getName()}))})})}})}},{key:"addComponentMovedListener",value:function(e){e.addListener({selectionChanged:this.onComponentSelectionChanged})}},{key:"onComponentDelete",value:function(e){var t=this;this.state.engine.foreach(function(n){var o=n.getDiagramModel();Object(na.a)(o.getLinks(),function(t){return Object(na.a)(e.getPorts(),function(e){return t.getSourcePort()===e||t.getTargetPort()===e}).length>0}).forEach(function(e){o.removeLink(e),t.onLinkDeleted(e)}),t.onNodeDeleted(e)})}},{key:"onInPortsAdded",value:function(e,t){var n=this;this.state.engine.foreach(function(o){t.forEach(function(t,o){var r=e.addPort(new ts(t.name,"in",t.uid));n.addLinkAddedListener(r)}),o.recalculatePortsVisually(),n.forceUpdate()})}},{key:"onOutPortsAdded",value:function(e,t){var n=this;this.state.engine.foreach(function(o){t.forEach(function(t,o){var r=e.addPort(new ts(t.name,"out",t.uid));n.addLinkAddedListener(r)}),o.recalculatePortsVisually(),n.forceUpdate()})}},{key:"onInPortsDeleted",value:function(e,t){var n=this;this.state.engine.foreach(function(o){t.forEach(function(t){e.getInPorts().filter(function(e){return e.id===t.uid}).forEach(function(t){e.removePort(t)}),Object(he.headOption)(n.props.journeyEditor.edges.filter(function(e){return e.to.uid===t.uid})).flatMap(function(e){var t=o.diagramModel.getLinks();return Object(he.headOption)(Object.keys(o.diagramModel.getLinks()).filter(function(n){return t[n].getSourcePort().getID()===e.from.uid&&t[n].getTargetPort().getID()===e.to.uid})).map(function(e){return t[e]})}).foreach(function(e){o.getDiagramModel().removeLink(e),n.onLinkDeleted(e)})}),o.recalculatePortsVisually(),n.forceUpdate()})}},{key:"onOutPortMoved",value:function(e,t,n){var o=this;this.state.engine.foreach(function(r){e.moveOutPort(t,n),r.recalculatePortsVisually(),o.forceUpdate()})}},{key:"onInPortMoved",value:function(e,t,n){var o=this;this.state.engine.foreach(function(r){e.moveInPort(t,n),r.recalculatePortsVisually(),o.forceUpdate()})}},{key:"onOutPortsDeleted",value:function(e,t){var n=this;this.state.engine.foreach(function(o){t.forEach(function(t){e.getOutPorts().filter(function(e){return e.id===t.uid}).forEach(function(t){e.removePort(t)}),Object(he.headOption)(n.props.journeyEditor.edges.filter(function(e){return e.from.uid===t.uid})).flatMap(function(e){var t=o.diagramModel.getLinks();return Object(he.headOption)(Object.keys(o.diagramModel.getLinks()).filter(function(n){return t[n].getSourcePort().getID()===e.from.uid&&t[n].getTargetPort().getID()===e.to.uid})).map(function(e){return t[e]})}).foreach(function(e){o.getDiagramModel().removeLink(e),n.onLinkDeleted(e)})}),o.recalculatePortsVisually(),n.forceUpdate()})}},{key:"onOutPortsChanged",value:function(e,t){var n=this;this.state.engine.foreach(function(e){var o=e.getDiagramModel().getLinks();t.forEach(function(e){Object.keys(o).filter(function(t){return o[t].getSourcePort().getID()===e.uid}).map(function(e){return o[e]}).forEach(function(t){t instanceof es&&Object(he.headOption)(t.labels).filter(function(e){return e instanceof pa.DefaultLabelModel}).foreach(function(t){t.setLabel(e.name)})})}),n.forceUpdate()})}},{key:"onInPortsChanged",value:function(e,t){var n=this;this.state.engine.foreach(function(e){var o=e.getDiagramModel().getLinks();t.forEach(function(e){Object.keys(o).filter(function(t){return o[t].getTargetPort().getID()===e.uid}).map(function(e){return o[e]}).forEach(function(t){t instanceof es&&Object(he.headOption)(t.labels).filter(function(e){return e instanceof pa.DefaultLabelModel}).foreach(function(t){t.setLabel(e.name)})})}),n.forceUpdate()})}},{key:"onStageConfigTypeChanged",value:function(e,t){}},{key:"onComponentMoved",value:function(e){switch(e.getType()){case Bi.a:case zi.a:return this.props.dispatch(Object(ge.Y)({id:e.getID(),x:e.x,y:e.y}));default:return this.props.dispatch(Object(ge.F)({componentId:e.getID(),x:e.x,y:e.y}))}}},{key:"onComponentSelectionChanged",value:function(e){e.isSelected?this.props.dispatch(Object(ge.H)(e.entity.getID())):this.props.dispatch(Object(ge.I)())}},{key:"onNodeAdded",value:function(e){switch(e.getType()){case Bi.a:return this.props.dispatch(Object(ge.P)({outId:new v.OutId(e.getID()),point:new v.EdgePoint(e.x,e.y)}));case zi.a:return this.props.dispatch(Object(ge.S)({outId:new v.OutId(e.getID()),point:new v.EdgePoint(e.x,e.y)}));default:return this.props.dispatch(Object(ge.A)({componentId:e.getID(),inputs:e.getInPorts().map(function(e){return new v.Contact(e.getID(),e.getName())}),outputs:e.getOutPorts().map(function(e){return new v.Contact(e.getID(),e.getName())}),componentType:e.getType(),x:e.x,y:e.y}))}}},{key:"onNodeDeleted",value:function(e){switch(e.getType()){case Bi.a:case zi.a:return this.props.dispatch(Object(ge.X)(e.getID()));default:return this.props.dispatch(Object(ge.C)(e.getID()))}}},{key:"onLinkDeleted",value:function(e){this.props.dispatch(Object(ge.L)({sourcePortId:e.getSourcePort().getID(),targetPortId:e.getTargetPort().getID()}))}},{key:"onComponentDrop",value:function(e,t,n){var o=this;this.state.engine.foreach(function(r){var i=new ns(e),a=r.getDiagramModel();if(o.addComponentMovedListener(i),i.x=(t-a.getOffsetX())*(100/a.getZoomLevel()),i.y=(n-a.getOffsetY())*(100/a.getZoomLevel()),e===ie){var s=i.addPort(new ts("data","in")),c=i.addPort(new ts("reset","in"));o.addLinkAddedListener(s),o.addLinkAddedListener(c)}if(e!==oe&&e!==se&&e!==te&&e!==ie&&e!==Bi.a&&e!==zi.a){var l=i.addPort(new ts("in","in"));o.addLinkAddedListener(l)}if(e===se){var p=i.addPort(new ts("in - 0","in")),u=i.addPort(new ts("in - 1","in"));o.addLinkAddedListener(p),o.addLinkAddedListener(u)}if(e===te){var d=i.addPort(new ts("main","in")),f=i.addPort(new ts("aggregate","in"));o.addLinkAddedListener(d),o.addLinkAddedListener(f)}if(e===ls)i.addPort(new ts("success","out")),i.addPort(new ts("failed","out"));else if(e===le)i.addPort(new ts("default","out"));else if(e===Ji){var h=Ee.v4(),g=Ee.v4();i.addPort(new ts("left","out",h)),i.addPort(new ts("right","out",g))}else e!==Bi.a&&e!==zi.a&&i.addPort(new ts("success","out"));if(e===Bi.a){var m=new ts(Bi.a,"out",i.getID());i.addPort(m),o.addLinkAddedListener(m)}if(e===zi.a){var v=new ts(zi.a,"in",i.getID());i.addPort(v),o.addLinkAddedListener(v)}o.onNodeAdded(i),a.addNode(i),o.forceUpdate()})}},{key:"onZoomInClick",value:function(){var e=this;this.state.engine.foreach(function(t){var n=t.getDiagramModel(),o=n.getZoomLevel();n.setZoomLevel(o+10),e.forceUpdate()})}},{key:"onZoomOutClick",value:function(){var e=this;this.state.engine.foreach(function(t){var n=t.getDiagramModel(),o=n.getZoomLevel();o<=0||(n.setZoomLevel(o-10),e.forceUpdate())})}},{key:"onFitInClick",value:function(){var e=this;this.state.engine.foreach(function(t){t.zoomToFit(),e.forceUpdate()})}},{key:"render",value:function(){var e=this;return f.createElement(Nc,{className:"DiagramScene__container",onComponentDrop:this.onComponentDrop},f.createElement(S.a,{style:{flex:1,display:"flex",flexDirection:"column"}},f.createElement(mc.a,{style:{flex:"0 0 50px",display:"flex",justifyContent:"flex-end",alignItems:"center"}},f.createElement(ke.a,{onClick:this.onFitInClick},f.createElement(la.a,null)),f.createElement(ke.a,{onClick:this.onZoomInClick},f.createElement(ia.a,null)),f.createElement("div",{style:{fontSize:"12px",width:35,textAlign:"center"}},this.state.engine.map(function(e){return Math.round(e.getDiagramModel().getZoomLevel())+"%"}).getOrElse(function(){return"100%"})),f.createElement(ke.a,{onClick:this.onZoomOutClick},f.createElement(sa.a,null))),this.state.engine.map(function(t){return f.createElement(pa.DiagramWidget,{diagramEngine:t,allowLooseLinks:!1,deleteKeys:e.state.diagramFocused?_c:[]})}).getOrNull()))}}]),t}(f.Component);$c=Dc([g.autobind,Rc("design:paramtypes",[Object])],$c);var Sc=Object(h.connect)(function(e){return{journeyEditor:e.journeyEditor}})($c),Nc=Object(oa.a)(Object(fe.DropTarget)([X.a],{hover:function(e,t,n){},drop:function(e,t,n){t&&!t.didDrop()&&Object(he.toOption)(n).foreach(function(n){var o=D.findDOMNode(n).getBoundingClientRect(),r=t.getItem(),i=t.getSourceClientOffset();Object(he.toOption)(r.componentType).foreach(function(t){e.onComponentDrop(t,i.x-o.left,i.y-o.top)})})}},function(e,t){return{connectDropTarget:e.dropTarget()}}))(function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return this.props.connectDropTarget(f.createElement("div",{className:this.props.className},this.props.children))}}]),t}(f.Component)),Mc=n(227),Lc=(n(2500),function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return f.createElement("div",{className:"EditorSection__container"},f.createElement(Xi,{openDialog:this.props.openDialog,handleDialogClose:this.props.handleDialogClose}),f.createElement(Sc,{subscribeOnDistribute:this.props.subscribeOnDistribute}))}}]),t}(f.Component)),Ac=Object(h.connect)(function(e){return{}})(Object(Mc.a)()(Lc)),Wc=n(136),Hc=n(1461),Uc=n(255),Jc=(n(2502),function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}),Vc=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Bc=function(e){function t(e){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Object.assign(m.a.screenInitialState(),{distribListeners:[]})))}return p()(t,e),a()(t,[{key:"onComponentUnselected",value:function(){}},{key:"onDistribute",value:function(){this.state.distribListeners.forEach(function(e){e()})}},{key:"subscribeOnDistribute",value:function(e){this.setState(j(this.state,{distribListeners:{$push:[e]}}))}},{key:"renderNavigation",value:function(){return f.createElement(y.a,null)}},{key:"render",value:function(){return this.renderScreenBody({className:"JourneyPage"},f.createElement("div",{className:"JourneyPage__page-container"},f.createElement(x,{onDistribute:this.onDistribute}),f.createElement(Ac,{openDialog:this.openDialog,handleDialogClose:this.handleDialogClose,subscribeOnDistribute:this.subscribeOnDistribute})))}}]),t}(m.a);Bc=Jc([g.autobind,Vc("design:paramtypes",[Object])],Bc);t.default=Object(h.connect)(function(e){return{journeys:e.journeys}})(Object(Hc.a)(Object(Wc.a)(function(e){e.isTokenChecked&&(Object(he.toOption)(e.params.journeyId).foreach(function(t){Object(he.headOption)(e.journeys.list.filter(function(t){return t.id.value===e.params.journeyId})).map(function(t){e.dispatch(Object(P.f)(t))}).getOrElse(function(){e.dispatch(Object(b.f)(new v.Id(t)))})}),e.dispatch(Object(Uc.d)(new v.Id(e.params.eventLineId))))},function(){},function(e,t){e.params.journeyId!==t.params.journeyId&&Object(he.toOption)(e.params.journeyId).foreach(function(t){e.dispatch(Object(b.f)(new v.Id(t)))}),e.params.eventLineId!==t.params.eventLineId&&e.dispatch(Object(Uc.d)(new v.Id(e.params.eventLineId))),e.params.journeyId===t.params.journeyId&&e.isTokenChecked&&!t.isTokenChecked&&Object(he.toOption)(e.params.journeyId).foreach(function(t){e.dispatch(Object(b.f)(new v.Id(t)))}),e.params.eventLineId===t.params.eventLineId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(Uc.d)(new v.Id(e.params.eventLineId)))})(Bc)))}}]);