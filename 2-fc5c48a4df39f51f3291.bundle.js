(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[2],{2457:function(e,t,n){var r={"./af":2261,"./af.js":2261,"./ar":2262,"./ar-dz":2263,"./ar-dz.js":2263,"./ar-kw":2264,"./ar-kw.js":2264,"./ar-ly":2265,"./ar-ly.js":2265,"./ar-ma":2266,"./ar-ma.js":2266,"./ar-sa":2267,"./ar-sa.js":2267,"./ar-tn":2268,"./ar-tn.js":2268,"./ar.js":2262,"./az":2269,"./az.js":2269,"./be":2270,"./be.js":2270,"./bg":2271,"./bg.js":2271,"./bm":2272,"./bm.js":2272,"./bn":2273,"./bn.js":2273,"./bo":2274,"./bo.js":2274,"./br":2275,"./br.js":2275,"./bs":2276,"./bs.js":2276,"./ca":2277,"./ca.js":2277,"./cs":2278,"./cs.js":2278,"./cv":2279,"./cv.js":2279,"./cy":2280,"./cy.js":2280,"./da":2281,"./da.js":2281,"./de":2282,"./de-at":2283,"./de-at.js":2283,"./de-ch":2284,"./de-ch.js":2284,"./de.js":2282,"./dv":2285,"./dv.js":2285,"./el":2286,"./el.js":2286,"./en-SG":2287,"./en-SG.js":2287,"./en-au":2288,"./en-au.js":2288,"./en-ca":2289,"./en-ca.js":2289,"./en-gb":2290,"./en-gb.js":2290,"./en-ie":2291,"./en-ie.js":2291,"./en-il":2292,"./en-il.js":2292,"./en-nz":2293,"./en-nz.js":2293,"./eo":2294,"./eo.js":2294,"./es":2295,"./es-do":2296,"./es-do.js":2296,"./es-us":2297,"./es-us.js":2297,"./es.js":2295,"./et":2298,"./et.js":2298,"./eu":2299,"./eu.js":2299,"./fa":2300,"./fa.js":2300,"./fi":2301,"./fi.js":2301,"./fo":2302,"./fo.js":2302,"./fr":2303,"./fr-ca":2304,"./fr-ca.js":2304,"./fr-ch":2305,"./fr-ch.js":2305,"./fr.js":2303,"./fy":2306,"./fy.js":2306,"./ga":2307,"./ga.js":2307,"./gd":2308,"./gd.js":2308,"./gl":2309,"./gl.js":2309,"./gom-latn":2310,"./gom-latn.js":2310,"./gu":2311,"./gu.js":2311,"./he":2312,"./he.js":2312,"./hi":2313,"./hi.js":2313,"./hr":2314,"./hr.js":2314,"./hu":2315,"./hu.js":2315,"./hy-am":2316,"./hy-am.js":2316,"./id":2317,"./id.js":2317,"./is":2318,"./is.js":2318,"./it":2319,"./it-ch":2320,"./it-ch.js":2320,"./it.js":2319,"./ja":2321,"./ja.js":2321,"./jv":2322,"./jv.js":2322,"./ka":2323,"./ka.js":2323,"./kk":2324,"./kk.js":2324,"./km":2325,"./km.js":2325,"./kn":2326,"./kn.js":2326,"./ko":2327,"./ko.js":2327,"./ku":2328,"./ku.js":2328,"./ky":2329,"./ky.js":2329,"./lb":2330,"./lb.js":2330,"./lo":2331,"./lo.js":2331,"./lt":2332,"./lt.js":2332,"./lv":2333,"./lv.js":2333,"./me":2334,"./me.js":2334,"./mi":2335,"./mi.js":2335,"./mk":2336,"./mk.js":2336,"./ml":2337,"./ml.js":2337,"./mn":2338,"./mn.js":2338,"./mr":2339,"./mr.js":2339,"./ms":2340,"./ms-my":2341,"./ms-my.js":2341,"./ms.js":2340,"./mt":2342,"./mt.js":2342,"./my":2343,"./my.js":2343,"./nb":2344,"./nb.js":2344,"./ne":2345,"./ne.js":2345,"./nl":2346,"./nl-be":2347,"./nl-be.js":2347,"./nl.js":2346,"./nn":2348,"./nn.js":2348,"./pa-in":2349,"./pa-in.js":2349,"./pl":2350,"./pl.js":2350,"./pt":2351,"./pt-br":2352,"./pt-br.js":2352,"./pt.js":2351,"./ro":2353,"./ro.js":2353,"./ru":2354,"./ru.js":2354,"./sd":2355,"./sd.js":2355,"./se":2356,"./se.js":2356,"./si":2357,"./si.js":2357,"./sk":2358,"./sk.js":2358,"./sl":2359,"./sl.js":2359,"./sq":2360,"./sq.js":2360,"./sr":2361,"./sr-cyrl":2362,"./sr-cyrl.js":2362,"./sr.js":2361,"./ss":2363,"./ss.js":2363,"./sv":2364,"./sv.js":2364,"./sw":2365,"./sw.js":2365,"./ta":2366,"./ta.js":2366,"./te":2367,"./te.js":2367,"./tet":2368,"./tet.js":2368,"./tg":2369,"./tg.js":2369,"./th":2370,"./th.js":2370,"./tl-ph":2371,"./tl-ph.js":2371,"./tlh":2372,"./tlh.js":2372,"./tr":2373,"./tr.js":2373,"./tzl":2374,"./tzl.js":2374,"./tzm":2375,"./tzm-latn":2376,"./tzm-latn.js":2376,"./tzm.js":2375,"./ug-cn":2377,"./ug-cn.js":2377,"./uk":2378,"./uk.js":2378,"./ur":2379,"./ur.js":2379,"./uz":2380,"./uz-latn":2381,"./uz-latn.js":2381,"./uz.js":2380,"./vi":2382,"./vi.js":2382,"./x-pseudo":2383,"./x-pseudo.js":2383,"./yo":2384,"./yo.js":2384,"./zh-cn":2385,"./zh-cn.js":2385,"./zh-hk":2386,"./zh-hk.js":2386,"./zh-tw":2387,"./zh-tw.js":2387};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=2457},2462:function(e,t,n){var r=n(2463);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(112)(r,o);r.locals&&(e.exports=r.locals)},2463:function(e,t,n){(e.exports=n(111)(!1)).push([e.i,".rbc-month-view{position:initial;height:auto}.rbc-event-with-actions{position:relative}\n",""])},2508:function(e,t,n){"use strict";n.r(t);var r,o=n(2),i=n.n(o),u=n(10),a=n.n(u),c=n(4),s=n.n(c),l=n(5),f=n.n(l),p=n(1),d=n(11),m=n(38),b=n.n(m),h=n(6),O=n.n(h),j=n(13),v=n.n(j),g=n(39),y=n(15),w=n(2503),k=n(2448),T=n.n(k),E=n(2211),D=n(388),I=n(8),R=n.n(I),C=n(823),P=n(276),V=n(203),M=n.n(V),F=n(3),S=n(41),W=n(63),A=n(136),x=n(34),z=n(97),N=n(21),_=n(0),B=(n(2458),n(2460),n(424)),Z=n(58),q=n(44),$=n(137),G=n(287),H=n(26),L=n(417),U=n(51),J=n(1173),X=n(236),Y=n(837),K=n(822),Q=n(415),ee=function(e,t,n,r,o){return function(i,u){o.handleDialogClose(r);var a=g.v4();e.foreach((function(e){i(Object(K.b)(n)).foreach((function(n){var r=o.openDialog(u().i18n.t("Новая запись"),p.createElement(B.a,{formId:t,blockType:F.webRegistrationBlockTypeEdit,blockRendererId:a,rootBlockRendererId:Object(_.l)(a),formRecord:new _.b,formRecordId:new _.b,blockId:e,initialValues:n,initialValuesError:!1,getBlockComponent:L.a,onSave:function(){return new Promise((function(e,t){return t(new Error("onSave not implemented"))}))},onEdit:function(){return new Promise((function(e,t){return t(new Error("onEdit not implemented"))}))}}),[p.createElement(G.a,{blockRendererId:a,label:u().i18n.t("Сохранить"),onClick:function(){i(Object(Z.g)(e,a,new _.b)).then((function(){return i(Object(Z.b)(e,a,t))})).then((function(){return i(Object(q.N)(a)),i(Object(Z.c)(e,t,a)).then((function(n){return i(Object(Y.b)(n.id,e,a,o)).then((function(){!function(e,n){if(o.handleDialogClose(n),i(Object(U.f)(u().i18n.t("Запись успешно создана"))),i(Object(q.M)(a)),u().currentForm.data.filter((function(e){return F.FormType.isAnyDictionary(e.entity.formType)})).nonEmpty())return Object(X.e)(t),void i(Object(J.a)(t));i(Object(Q.a)(t,e))}(n.id,r)}))}))})).catch((function(t){i(Object(q.M)(a)),i(Object($.c)(t,o,a,e))}))}}),p.createElement(C.a,{variant:"contained",onClick:function(e){return o.handleDialogClose(r)},style:{marginRight:"10px"}},u().i18n.t("Закрыть"))])}))}))}},te=(n(2462),n(45)),ne=n(832),re=n(807),oe=n(808),ie=n(833),ue=n(834),ae=n(161),ce=n(62),se=n(27),le=n(42),fe=n(47),pe=n(212),de=function(e,t){return new Date(e.getTime()-6e4*(t-e.getTimezoneOffset()))},me=function(e,t){return new Date(e.getTime()+6e4*(t-e.getTimezoneOffset()))},be=function(e,t,n,r,o){return function(i,u){Object(_.l)(o).flatMap((function(o){return function(e){return Object(_.l)(e).filter((function(e){return Array.isArray(e)})).map((function(e){return e.filter((function(e){return e instanceof Date})).map((function(e){return e}))})).flatMap((function(e){return Object(_.g)(e).map((function(e){return{start:Object(re.a)(Object(ie.a)(e)),end:Object(oe.a)(Object(ue.a)(e))}}))}))}(o).matchWith((function(o){return i(Oe(e,t,n,r,o)),new _.b}),(function(){return Object(_.l)(o)}))})).flatMap((function(o){return function(e){return Object(_.l)(e).filter((function(e){return!Array.isArray(e)})).filter((function(e){return e.start&&e.start instanceof Date&&e.end&&e.end instanceof Date})).map((function(e){return{start:Object(re.a)(Object(ie.a)(e.start)),end:Object(oe.a)(Object(ue.a)(e.end))}}))}(o).matchWith((function(o){return i(Oe(e,t,n,r,o)),new _.b}),(function(){return Object(_.l)(o)}))})).foreach((function(e){console.error("Unknown range type",e)}))}},he=function(e,t,n,r,o){return Object(_.l)({startDateTime:e.entity.getFormFieldValue(n.startDateTime).matchWith((function(e){return e.value instanceof F.ValueDate?e.value.value:new Date}),(function(){return new Date})),endDateTime:e.entity.getFormFieldValue(n.endDateTime).matchWith((function(e){return e.value instanceof F.ValueDate?e.value.value:new Date}),(function(){return new Date}))}).map((function(e){return{start:e.startDateTime.getTime(),end:e.endDateTime.getTime()}})).matchWith((function(o){return{start:de(new Date(o.start),t),end:de(new Date(o.end),t),title:e.entity.getFormFieldValue(n.label).map((function(e){return e.value.toString()})).getOrElse((function(){return""})),formDataId:e.id,resourceId:r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).flatMap((function(e){return Object(_.g)(e.id)}))})).map((function(e){return e.value})).getOrUndefined()}}),(function(){return{start:de(Object(D.a)(new Date),t),end:de(Object(ne.a)(new Date),t),title:e.entity.getFormFieldValue(n.label).map((function(e){return e.value.toString()})).getOrElse((function(){return""})),formDataId:e.id,resourceId:r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).flatMap((function(e){return Object(_.g)(e.id)}))})).map((function(e){return e.value})).getOrUndefined()}}))},Oe=function(e,t,n,r,o){return function(i,u){t.dataOutput.foreach((function(a){Object(x.b)(u().fields,r,a.formField).foreach((function(r){return Object(_.g)(u().forms.list.filter((function(e){return e.id.value===r.entity.valueType.family.value}))).foreach((function(a){var c=n.eventProps.startDateTime,s=Object(se.e)(u().blockRendererContext,e).matchWith((function(e){return e.entity.getFormFieldValue(r.id).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).getOrElse((function(){return[]}))}),(function(){return[]})),l=new F.FilterGroupCondition((new Array).concat(n.eventProps.showAnothers?[]:[new F.RestrictedForm(a.id,s)]).concat([new F.FilterCondition(c,new F.FilterExpressionGt,new F.ValueDate(o.start.getTime())),new F.FilterCondition(c,new F.FilterExpressionLt,new F.ValueDate(o.end.getTime()))]),new F.FilterPredicateAnd);i(function(e,t,n,r,o,i,u){return function(a,c){a(Object(H.W)({blockRendererId:e,displayId:t.id})),Object(ae.a)(o,r).then((function(r){a(Object(H.V)({blockRendererId:e,displayId:t.id})),a(Object(H.R)({id:t.id,blockRendererId:e,display:r.list.map((function(e){return new H.N(e.id,Object.assign(Object.assign({},he(e,n.timeZoneOffset,n.eventProps,n.resourceProps,c().i18n.t)),{isOwn:u.filter((function(t){return t.value===e.id.value})).length>0}),e)})),range:i}))})).catch((function(e){return console.error("Failed to resolve input data",e)}))}}(e,t,n,Object(_.l)(l),a.id,o,s))}))}))}))}},je=(r={},O()(r,F.CalendarDateConstraintRange.$Type.value,(function(e,t){return{start:e.start.matchWith((function(e){return Object(D.a)(de(e,t))}),(function(){return Object(re.a)(Object(ie.a)(de(new Date,t)))})),end:e.end.matchWith((function(e){return Object(D.a)(de(e,t))}),(function(){return Object(oe.a)(Object(ue.a)(de(new Date,t)))}))}})),O()(r,F.CalendarDateConstraintList.$Type.value,(function(e,t){return Object(_.l)(e.dates).filter((function(e){return e.length>0})).map((function(e){return e.sort((function(e,t){return e.getTime()>=t.getTime()?1:-1}))})).matchWith((function(e){return{start:Object(D.a)(de(Object(_.f)(e),t)),end:Object(D.a)(de(Object(_.f)(e.reverse()),t))}}),(function(){return{start:Object(re.a)(Object(ie.a)(de(new Date,t))),end:Object(oe.a)(Object(ue.a)(de(new Date,t)))}}))})),r),ve=n(204),ge=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},ye=p.createContext(),we=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"render",value:function(){return p.createElement(ye.Provider,{value:this.props},this.props.children)}}]),t}(p.PureComponent);we=ge([y.autobind],we);var ke=ye.Consumer,Te=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},Ee=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"renderTitle",value:function(){return(this.props.event.isOwn||this.props.showAnothersLabel)&&this.props.title||p.createElement("span",null,"​")}},{key:"render",value:function(){return p.createElement("div",null,this.renderTitle())}}]),t}(p.Component);Ee=Te([y.autobind],Ee);var De,Ie,Re,Ce=Object(d.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})((De=Ee,function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"render",value:function(){var e=this;return p.createElement(ke,null,(function(t){return p.createElement(De,Object.assign({onDelete:t.onDelete,onEdit:t.onEdit,showAnothersLabel:t.showAnothersLabel,ref:function(t){return e.ref=t}},e.props))}))}}]),t}(p.Component))),Pe=n(2464),Ve=n.n(Pe),Me=n(857),Fe=n(28),Se=n(116),We=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},Ae=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},xe="PREV",ze="NEXT",Ne="TODAY",_e="month",Be="week",Ze="day",qe="agenda",$e=(Ie={},O()(Ie,_e,(function(e){return Object(ie.a)(e)})),O()(Ie,Be,(function(e){return Object(re.a)(e)})),O()(Ie,Ze,(function(e){return Object(D.a)(e)})),O()(Ie,qe,(function(e){return Object(D.a)(e)})),Ie),Ge=(Re={},O()(Re,_e,(function(e){return Object(ue.a)(e)})),O()(Re,Be,(function(e){return Object(oe.a)(e)})),O()(Re,Ze,(function(e){return Object(ne.a)(e)})),O()(Re,qe,(function(e){return Object(ne.a)(e)})),Re),He=(new F.Id(g.v4()),{padding:"10px 6px 11px"}),Le=function(e){function t(e){i()(this,t);var n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={datePickerOpen:!1},n}return f()(t,e),a()(t,[{key:"navigate",value:function(e){this.props.onNavigate(e)}},{key:"view",value:function(e){this.props.onView(e)}},{key:"viewNamesGroup",value:function(e){var t=this,n=this.props.views,r=this.props.view;if(Array.isArray(n)&&n.length>1)return n.map((function(n){return p.createElement("button",{type:"button",style:He,key:n,className:Ve()({"rbc-active":r===n}),onClick:t.view.bind(null,n)},e[n])}))}},{key:"openDatePickerModal",value:function(){}},{key:"onDateChoose",value:function(e){var t=this;this.setState(R()(this.state,{datePickerOpen:{$set:!1}}),(function(){t.props.onNavigate("DATE",e)}))}},{key:"getStartOfView",value:function(){var e=this;return Object(le.b)(this.props.view)($e).matchWith((function(t){return t(e.props.date)}),(function(){throw"unknown view type"}))}},{key:"getEndOfView",value:function(){var e=this;return Object(le.b)(this.props.view)(Ge).matchWith((function(t){return t(e.props.date)}),(function(){throw"unknown view type"}))}},{key:"isNextDisabled",value:function(){var e=this.getEndOfView().getTime();return Object(Fe.i)(this.props.range).filter((function(e){return Array.isArray(e)})).map((function(t){return t.filter((function(t){return Object(ne.a)(t).getTime()>=e})).length<=1})).getOrElse((function(){return!1}))||Object(Fe.i)(this.props.range).filter((function(e){return!Array.isArray(e)})).flatMap((function(t){return t.end.map((function(t){return Object(ne.a)(t).getTime()<=e}))})).getOrElse((function(){return!1}))}},{key:"isPrevDisabled",value:function(){var e=this.getStartOfView().getTime();return Object(Fe.i)(this.props.range).filter((function(e){return Array.isArray(e)})).map((function(t){return t.filter((function(t){return Object(D.a)(t).getTime()<=e})).length<=1})).getOrElse((function(){return!1}))||Object(Fe.i)(this.props.range).filter((function(e){return!Array.isArray(e)})).flatMap((function(t){return t.start.map((function(t){return Object(D.a)(t).getTime()>=e}))})).getOrElse((function(){return!1}))}},{key:"isTodayDisabled",value:function(){var e=Object(D.a)(new Date).getTime();return Object(Fe.i)(this.props.range).filter((function(e){return Array.isArray(e)})).map((function(t){return 0===t.filter((function(t){return Object(D.a)(t).getTime()===e})).length})).getOrElse((function(){return!1}))||Object(Fe.i)(this.props.range).filter((function(e){return!Array.isArray(e)})).map((function(t){return t.start.map((function(t){return t.getTime()>=e})).getOrElse((function(){return!1}))||t.end.map((function(t){return t.getTime()<=e})).getOrElse((function(){return!1}))})).getOrElse((function(){return!1}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.localizer.messages,r=t.label;return p.createElement("div",{className:"rbc-toolbar"},p.createElement("span",{className:"rbc-btn-group"},p.createElement("button",{type:"button",disabled:this.isTodayDisabled(),style:Object.assign(Object.assign({},He),this.isTodayDisabled()?{cursor:"not-allowed"}:{}),onClick:function(){return e.navigate(Ne)}},n.today),p.createElement("button",{type:"button",disabled:this.isPrevDisabled(),style:Object.assign(Object.assign({},He),this.isPrevDisabled()?{cursor:"not-allowed"}:{}),onClick:function(){return e.navigate(xe)}},n.previous),p.createElement("button",{type:"button",disabled:this.isNextDisabled(),style:Object.assign(Object.assign({},He),this.isNextDisabled()?{cursor:"not-allowed"}:{}),onClick:function(){return e.navigate(ze)}},n.next)),p.createElement("span",{className:"rbc-toolbar-label",onClick:this.openDatePickerModal},r),this.props.rightButtonsGroup&&p.createElement("span",{className:"rbc-btn-group"},this.props.rightButtonsGroup),p.createElement("span",{className:"rbc-btn-group"},this.viewNamesGroup(n)),p.createElement(Me.DatePicker,{open:this.state.datePickerOpen,autoOk:!0,value:this.props.date,onChange:this.onDateChoose,style:{display:"none"}}))}}]),t}(p.Component);Le=We([y.autobind,Ae("design:paramtypes",[Object])],Le);var Ue,Je,Xe,Ye=Object(d.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(W.a)(Object(Se.a)(Le))),Ke=function(e){return function(t){function n(){return i()(this,n),s()(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return f()(n,t),a()(n,[{key:"render",value:function(){return p.createElement(Ye,Object.assign({},this.props,{range:e}))}}]),n}(p.Component)},Qe=n(71),et=function(e,t,n,r,o){return function(i,u){if(!t.intersectionEnabled){var a=Object(N.h)(u().dataOutput,e,t.startDateTime),c=Object(N.h)(u().dataOutput,e,t.endDateTime),s=n.value.filter((function(e){return n.enabled})).map((function(e){return e.resource})).flatMap((function(t){return Object(N.h)(u().dataOutput,e,t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).getOrElse((function(){return[]})),l=a.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),f=c.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));if(r.filter((function(e){return o.filter((function(t){return t.value===e.id.value})).isEmpty()})).filter((function(e){return n.value.filter((function(e){return n.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).filter((function(e){return e.filter((function(e){return s.filter((function(t){return t.value===e.value})).length>0})).length>0})).nonEmpty()})).filter((function(e){var n=e.entity.getFormFieldValue(t.startDateTime),r=e.entity.getFormFieldValue(t.endDateTime),o=n.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),i=r.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));return o.filter((function(e){return l.getOrElse((function(){return 0}))<e&&f.getOrElse((function(){return 0}))>e})).nonEmpty()||i.filter((function(e){return l.getOrElse((function(){return 0}))<e&&f.getOrElse((function(){return 0}))>e})).nonEmpty()||o.getOrElse((function(){return 0}))<l.getOrElse((function(){return 0}))&&i.getOrElse((function(){return 0}))>f.getOrElse((function(){return 0}))})).length>0)throw new Qe.d}}},tt=function(e,t,n,r,o,i){return function(u,a){var c=n.value.filter((function(e){return n.enabled})).map((function(e){return e.getMilliseconds()})).getOrElse((function(){return 0})),s=Object(N.h)(a().dataOutput,e,t.startDateTime),l=Object(N.h)(a().dataOutput,e,t.endDateTime),f=r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return Object(N.h)(a().dataOutput,e,t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).getOrElse((function(){return[]})),p=s.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),d=l.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));return 0===o.filter((function(e){return i.filter((function(t){return t.value===e.id.value})).isEmpty()})).filter((function(e){return r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).filter((function(e){return e.filter((function(e){return f.filter((function(t){return t.value===e.value})).length>0})).length>0})).nonEmpty()})).filter((function(e){var n=e.entity.getFormFieldValue(t.startDateTime),r=e.entity.getFormFieldValue(t.endDateTime),o=n.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),i=r.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));return Math.abs(o.getOrElse((function(){return 0}))-d.getOrElse((function(){return 0})))<c||Math.abs(p.getOrElse((function(){return 0}))-i.getOrElse((function(){return 0})))<c})).length}},nt=function(e,t,n,r,o){return function(i,u){if(!i(tt(e,t,t.minInterval,n,r,o)))throw new Qe.f(t.minInterval.value.filter((function(e){return t.minInterval.enabled})).map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})))}},rt=function(e,t,n,r,o){return function(i,u){if(!i(tt(e,t,t.minOwnInterval,n,r,o)))throw new Qe.g(t.minOwnInterval.value.filter((function(e){return t.minOwnInterval.enabled})).map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})))}},ot=function(e,t,n,r){return function(o,i){var u=Object(N.h)(i().dataOutput,e,t.startDateTime),a=Object(N.h)(i().dataOutput,e,t.endDateTime),c=u.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return de(e.value,r)})).map((function(e){return e.getTime()})),s=a.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return de(e.value,r)})).map((function(e){return e.getTime()}));n.value.filter((function(e){return n.enabled})).flatMap((function(e){return e.min.map((function(e){return de(e,r)})).filter((function(e){return e.getTime()-Object(D.a)(e).getTime()<=c.getOrElse((function(){return 0}))-Object(D.a)(c.getOrElse((function(){return 0}))).getTime()})).matchWith((function(t){return e.max}),(function(){throw new Qe.h})).map((function(e){return de(e,r)})).filter((function(e){return e.getTime()-Object(D.a)(e).getTime()>=s.getOrElse((function(){return 0}))-Object(D.a)(s.getOrElse((function(){return 0}))).getTime()})).matchWith((function(t){return e.max}),(function(){throw new Qe.e}))}))}},it=function(e,t,n){return n.value.filter((function(e){return n.enabled})).filter((function(n){return Object(_.l)(e.resourceId).matchWith((function(e){return t.filter((function(t){return t.resourceId===e}))}),(function(){return t})).filter((function(t){return Object(D.a)(t.start).getTime()===Object(D.a)(e.start).getTime()||Object(D.a)(t.end).getTime()===Object(D.a)(e.end).getTime()})).filter((function(t){return Math.abs(e.start.getTime()-Object(D.a)(e.start).getTime()-(t.end.getTime()-Object(D.a)(t.end).getTime()))<n.getMilliseconds()||Math.abs(t.start.getTime()-Object(D.a)(t.start).getTime()-(e.end.getTime()-Object(D.a)(e.end).getTime()))<n.getMilliseconds()})).length>0})).isEmpty()},ut=n(963),at=n.n(ut),ct=n(2465),st=n.n(ct),lt=n(1169),ft=n(859),pt=n(2486),dt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},mt=function(e){return function(t){function n(){return i()(this,n),s()(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return f()(n,t),a()(n,[{key:"render",value:function(){var e=this.props,t=e.date,r=(dt(e,["date"]),n.range(t,{localizer:this.props.localizer}));return p.createElement(st.a,Object.assign({},this.props,{range:r,eventOffset:15}))}}],[{key:"range",value:function(t,n){n.localizer;return Object(_.l)(e).filter((function(e){return Array.isArray(e)})).matchWith((function(e){return e.filter((function(e){return Object(re.a)(e).getTime()===Object(re.a)(t).getTime()}))}),(function(){return Object(_.l)(e).matchWith((function(e){return Object(lt.a)({start:e.start.matchWith((function(e){return Object(re.a)(e).getTime()<Object(re.a)(t).getTime()?Object(re.a)(t):Object(re.a)(e)}),(function(){return Object(re.a)(t)})),end:e.end.matchWith((function(e){return Object(oe.a)(e).getTime()>Object(oe.a)(t).getTime()?Object(oe.a)(t):Object(oe.a)(e)}),(function(){return Object(oe.a)(t)}))})}),(function(){return Object(lt.a)({start:Object(re.a)(t),end:Object(oe.a)(t)})}))})).sort((function(e,t){return e.getTime()>=t.getTime()?1:-1}))}},{key:"navigate",value:function(e,t){switch(t){case xe:return Object(pt.a)(e,1);case ze:return Object(ft.a)(e,1);default:return e}}},{key:"title",value:function(e,t){var n=t.localizer,r=this.range(e,{localizer:n}),o=at()(r),i=o[0],u=o.slice(1);return n.format({start:i,end:u.pop()},"dayRangeHeaderFormat")}}]),n}(p.Component)},bt=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},ht=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ot=(Ue={},O()(Ue,F.CalendarDateConstraintList.$Type.value,(function(e){return Object(_.g)(e.dates)})),O()(Ue,F.CalendarDateConstraintRange.$Type.value,(function(e){return e.start})),Ue),jt=(Je={},O()(Je,F.CalendarDateConstraintList.$Type.value,(function(e,t){return e.dates.map((function(e){return de(e,t)}))})),O()(Je,F.CalendarDateConstraintRange.$Type.value,(function(e,t){return{start:e.start.map((function(e){return de(e,t)})),end:e.end.map((function(e){return de(e,t)}))}})),Je),vt=(Xe={},O()(Xe,F.CalendarViewDay.$Type.value,(function(){return Ze})),O()(Xe,F.CalendarViewMonth.$Type.value,(function(){return _e})),O()(Xe,F.CalendarViewWeek.$Type.value,(function(){return Be})),O()(Xe,F.CalendarViewAgenda.$Type.value,(function(){return qe})),Xe),gt=Object(w.b)(E),yt=T()(w.a),wt={flex:"1"},kt=function(e){function t(e){i()(this,t);var n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.weekView=new _.b,n.calendarToolbar=new _.b;var r=e.control.viewProps.dateConstraint.value.filter((function(t){return e.control.viewProps.dateConstraint.enabled})).map((function(t){return Object(le.b)(t.tpe.value)(jt).matchWith((function(n){return n(t,e.control.timeZoneOffset)}),(function(){throw"unknown date constraint type"}))}));return n.weekView=Object(_.l)(mt(r.getOrUndefined())),n.calendarToolbar=Object(_.l)(Ke(r.getOrUndefined())),n}return f()(t,e),a()(t,[{key:"rangeChangeHandler",value:function(e){var t=this;this.props.formId.foreach((function(n){t.props.dispatch(be(t.props.blockRendererId,t.props.display,t.props.control,n,e))}))}},{key:"onBlur",value:function(){this.props.onControlBlur()}},{key:"getEvents",value:function(){return this.props.displayValues.matchWith((function(e){return e.filter((function(e){return e instanceof H.N})).map((function(e){return e.event}))}),(function(){return[]}))}},{key:"openCreateDialog",value:function(e,t){var n=this,r=g.v4(),o=this.props.control.eventBlock,i=this.props.openDialog(this.props.i18n.t("Новое событие"),p.createElement(B.a,{formId:e,blockType:F.webRegistrationBlockTypeEdit,blockRendererId:r,rootBlockRendererId:Object(_.l)(r),formRecord:new _.b,formRecordId:new _.b,blockId:o,initialValues:t,initialValuesError:!1,getBlockComponent:L.a,onSave:function(){return new Promise((function(e,t){return t(new Error("onSave not implemented"))}))},onEdit:function(){return new Promise((function(e,t){return t(new Error("onEdit not implemented"))}))},onOpenBlock:function(e,t){return n.props.dispatch(ee(e,t,r,i,n.props))}}),[p.createElement(C.a,{variant:"contained",key:"close",onClick:function(e){n.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),p.createElement(G.a,{key:"save",blockRendererId:r,label:this.props.i18n.t("Сохранить"),onClick:function(){n.props.dispatch(Object(Z.g)(o,r,new _.b)).then((function(){return n.props.dispatch(Object(Z.b)(o,r,e))})).then((function(){n.props.dispatch(et(r,n.props.control.eventProps,n.props.control.resourceProps,n.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof H.N})).map((function(e){return e.formRecord})),new _.b))})).then((function(){n.props.dispatch(nt(r,n.props.control.eventProps,n.props.control.resourceProps,n.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof H.N})).map((function(e){return e.formRecord})),new _.b))})).then((function(){n.props.dispatch(rt(r,n.props.control.eventProps,n.props.control.resourceProps,n.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof H.N})).filter((function(e){return e.event.isOwn})).map((function(e){return e.formRecord})),new _.b))})).then((function(){n.props.dispatch(ot(r,n.props.control.eventProps,n.props.control.viewProps.timeConstraint,n.props.control.timeZoneOffset))})).then((function(){return n.props.dispatch(Object(q.N)(r)),n.childRegistration(o,e,r).then((function(t){return Object(te.g)(e,t.id)})).then((function(e){n.props.handleDialogClose(i),n.props.onChange(n.props.value.matchWith((function(t){return R()(t,{id:{$push:[e.record.id]}})}),(function(){return new F.ValueObjectRefs([e.record.id])})),n.props.output),n.props.dispatch(Object(H.T)({blockRendererId:n.props.blockRendererId,id:n.props.display.id,display:n.props.displayValues.getOrElse((function(){return[]})).concat(new H.N(e.record.id,Object.assign(Object.assign({},he(e.record,n.props.control.timeZoneOffset,n.props.control.eventProps,n.props.control.resourceProps,n.props.i18n.t)),{isOwn:!0}),e.record))}))}))})).catch((function(e){n.props.dispatch(Object(q.M)(r)),n.props.dispatch(Object($.c)(e,n.props,r,o))}))}})])}},{key:"childRegistration",value:function(e,t,n){var r=this;return this.props.dispatch(this.props.parentRecordId.matchWith((function(o){return Object(Z.d)(e,o,r.props.output.formField,t,n,new _.b)}),(function(){return Object(Z.c)(e,t,n)})))}},{key:"adjustSlotInfo",value:function(e){var t=this,n=this.props.control.eventProps.minInterval.value.filter((function(e){return t.props.control.eventProps.minInterval.enabled})).map((function(e){return e.getMilliseconds()})).getOrElse((function(){return 0})),r=Object(_.l)(e.resourceId).matchWith((function(e){return t.getEvents().filter((function(t){return t.resourceId===e}))}),(function(){return t.getEvents()})).filter((function(t){return Object(D.a)(t.start).getTime()===Object(D.a)(e.start).getTime()||Object(D.a)(t.end).getTime()===Object(D.a)(e.start).getTime()})),o=Object(_.g)(r.filter((function(t){return Math.abs(e.start.getTime()-t.end.getTime())<n}))).matchWith((function(e){return new Date(e.end.getTime()+n)}),(function(){return e.start})),i=Object(_.g)(r.filter((function(t){return Math.abs(t.start.getTime()-e.end.getTime())<n}))).matchWith((function(e){return new Date(e.start.getTime()-n)}),(function(){return e.end}));return R()(e,{start:{$set:o},end:{$set:i}})}},{key:"getInitialValues",value:function(e){var t,n=this,r=me(e.start,this.props.control.timeZoneOffset),o=me(e.end,this.props.control.timeZoneOffset),i=new F.Duration(o.getTime()-r.getTime(),F.TimeUnitType.Milliseconds);return Object.assign((t={},O()(t,this.props.control.eventProps.startDateTime.value,new F.FormFieldValue(this.props.control.eventProps.startDateTime,new F.ValueDate(r.getTime()))),O()(t,this.props.control.eventProps.endDateTime.value,new F.FormFieldValue(this.props.control.eventProps.endDateTime,this.props.control.eventProps.maxDuration.value.filter((function(e){return n.props.control.eventProps.maxDuration.enabled})).matchWith((function(e){return i.getMinutes()>e.getMinutes()?new F.ValueDate(r.getTime()+e.getMilliseconds()):new F.ValueDate(o.getTime())}),(function(){return new F.ValueDate(o.getTime())})))),t),this.props.control.resourceProps.value.filter((function(e){return n.props.control.resourceProps.enabled})).map((function(e){return e.resource})).matchWith((function(t){return F.Id.createId(e.resourceId).matchWith((function(e){return O()({},t.value,new F.FormFieldValue(t,new F.ValueObjectRefs([e])))}),(function(){return{}}))}),(function(){return{}})))}},{key:"handleSlotSelect",value:function(e){var t=this;this.props.control.viewProps.timeConstraint.value.flatMap((function(e){return e.max})).map((function(e){return de(e,t.props.control.timeZoneOffset)})).filter((function(t){return e.start.getTime()-Object(D.a)(e.start).getTime()<t.getTime()-Object(D.a)(t).getTime()})).isEmpty()&&this.props.control.viewProps.timeConstraint.enabled||Object(_.l)(e).flatMap((function(n){return t.checkSlotInfoIntersection(e,t.getEvents())})).flatMap((function(n){return t.checkMinOwnInterval(e,t.getEvents().filter((function(e){return e.isOwn})))})).foreach((function(e){Object(_.l)(e).filter((function(n){return function(e,t){return t.value.filter((function(e){return t.enabled})).filter((function(t){return t.getMilliseconds()<e.end.getTime()-e.start.getTime()})).isEmpty()}(e,t.props.control.eventProps.maxDuration)})).matchWith((function(e){t.props.field.filter((function(e){return e.entity.valueType instanceof F.ValueTypeObjectRefs})).foreach((function(n){t.openCreateDialog(n.entity.valueType.family,t.getInitialValues(t.adjustSlotInfo(e)))}))}),(function(){t.props.openSnackbar(p.createElement("span",null,t.props.i18n.t("Максимальная продолжительность")+" "+t.props.control.eventProps.maxDuration.value.map((function(e){return e.getMinutes().toString()})).getOrElse((function(){return""}))+" "+t.props.i18n.t("мин")+"."),new _.b)}))}))}},{key:"onDeleteRequested",value:function(e,t,n){var r=this,o=this.props.openDialog(this.props.i18n.t("Удаление"),p.createElement("p",null,this.props.i18n.t("Вы действительно хотите удалить? Это действие нельзя будет отменить")),[p.createElement(C.a,{key:"close",variant:"contained",onClick:function(){return r.props.handleDialogClose(o)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),p.createElement(C.a,{key:"delete",variant:"contained",color:"primary",onClick:function(){r.props.formId.foreach((function(i){r.props.parentRecordId.matchWith((function(n){return Object(te.n)([n],i,r.props.output.formField,e,[t])}),(function(){return new Promise((function(e,t){return e()}))})).then((function(n){return Object(te.q)(e,t,new F.FormDataStatusNominalDeleted)})).then((function(){r.props.handleDialogClose(o),r.props.handleDialogClose(n),r.props.onChange(r.props.value.map((function(e){return new F.ValueObjectRefs(e.id.filter((function(e){return e.value!==t.value})))})).getOrElse((function(){return new F.ValueObjectRefs([])})),r.props.output),r.props.dispatch(Object(H.T)({blockRendererId:r.props.blockRendererId,id:r.props.display.id,display:r.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e.id.value!==t.value}))}))})).catch((function(e){console.log("unable to delete event",e)}))}))}},this.props.i18n.t("Удалить"))])}},{key:"onFormRecordRequested",value:function(e,t){}},{key:"handleEventSelect",value:function(e){var t=this;e.isOwn&&Object(_.g)(this.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value===e.formDataId.value}))).filter((function(e){return e instanceof H.N})).map((function(e){return e})).map((function(e){return e.formRecord})).foreach((function(e){var n=g.v4(),r=t.props.control.eventBlock,o=t.props.openDialog(t.props.i18n.t("Новое событие"),p.createElement("div",null,p.createElement("div",{style:{position:"absolute",top:12,right:5}},p.createElement(P.a,{onClick:function(){return t.onDeleteRequested(e.entity.formId,e.id,o)}},p.createElement(M.a,null))),p.createElement(B.a,{formId:e.entity.formId,blockType:F.webRegistrationBlockTypeEdit,blockRendererId:n,rootBlockRendererId:Object(_.l)(n),formRecord:Object(_.l)(e),formRecordId:Object(_.l)(e).map((function(e){return e.id})),blockId:r,initialValues:e.entity.values,initialValuesError:!1,getBlockComponent:L.a,onSave:function(){return new Promise((function(e,t){return t(new Error("onSave not implemented"))}))},onEdit:function(){return new Promise((function(e,t){return t(new Error("onEdit not implemented"))}))},onOpenBlock:function(e,r){return t.props.dispatch(ee(e,r,n,o,t.props))}})),[p.createElement(C.a,{variant:"contained",key:"close",onClick:function(e){t.props.handleDialogClose(o)},style:{marginRight:"10px"}},t.props.i18n.t("Закрыть")),p.createElement(G.a,{key:"save",blockRendererId:n,label:t.props.i18n.t("Сохранить"),onClick:function(){t.props.dispatch(Object(Z.g)(r,n,new _.b)).then((function(){return t.props.dispatch(Object(Z.b)(r,n,e.entity.formId))})).then((function(){t.props.dispatch(et(n,t.props.control.eventProps,t.props.control.resourceProps,t.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof H.N})).map((function(e){return e.formRecord})),Object(_.l)(e.id)))})).then((function(){t.props.dispatch(nt(n,t.props.control.eventProps,t.props.control.resourceProps,t.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof H.N})).map((function(e){return e.formRecord})),Object(_.l)(e.id)))})).then((function(){t.props.dispatch(rt(n,t.props.control.eventProps,t.props.control.resourceProps,t.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof H.N})).filter((function(e){return e.event.isOwn})).map((function(e){return e.formRecord})),Object(_.l)(e.id)))})).then((function(){t.props.dispatch(ot(n,t.props.control.eventProps,t.props.control.viewProps.timeConstraint,t.props.control.timeZoneOffset))})).then((function(){t.props.dispatch(Object(q.N)(n)),t.props.dispatch(Object(ve.e)(r)).foreach((function(i){t.props.dispatch(Object(Z.f)(r,e.entity.formId,i.entity,n,e.id)).then((function(t){return Object(te.g)(e.entity.formId,e.id)})).then((function(e){t.props.handleDialogClose(o),t.props.dispatch(Object(H.T)({blockRendererId:t.props.blockRendererId,id:t.props.display.id,display:t.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value!==e.record.id.value})).concat(new H.N(e.record.id,Object.assign(Object.assign({},he(e.record,t.props.control.timeZoneOffset,t.props.control.eventProps,t.props.control.resourceProps,t.props.i18n.t)),{isOwn:!0}),e.record))}))}))}))})).catch((function(e){t.props.dispatch(Object(q.M)(n)),t.props.dispatch(Object($.c)(e,t.props,n,r))}))}})])}))}},{key:"getEventStyle",value:function(e){return Object.assign({},(e.isOwn?this.props.control.eventProps.colorOfOwns:this.props.control.eventProps.colorOfAnothers).matchWith((function(e){return{backgroundColor:e}}),(function(){return{}})))}},{key:"getEventProps",value:function(e){return{style:this.getEventStyle(e),className:"rbc-event-with-actions"}}},{key:"onMoveEvent",value:function(e){this.onDndEvent(e)}},{key:"onResizeEvent",value:function(e){this.onDndEvent(e)}},{key:"saveDndChanges",value:function(e){var t=this,n=me(e.start,this.props.control.timeZoneOffset),r=me(e.end,this.props.control.timeZoneOffset);Object(_.g)(this.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value===e.event.formDataId.value}))).filter((function(e){return e instanceof H.N})).foreach((function(o){Object(te.o)(o.formRecord.entity.formId,[new F.FormDataValues(o.formRecord.id,[new F.FormFieldValue(t.props.control.eventProps.startDateTime,new F.ValueDate(n.getTime())),new F.FormFieldValue(t.props.control.eventProps.endDateTime,new F.ValueDate(r.getTime()))].concat(b()(t.props.control.resourceProps.value.filter((function(e){return t.props.control.resourceProps.enabled})).map((function(e){return e.resource})).matchWith((function(t){return F.Id.createId(e.resourceId).matchWith((function(e){return[new F.FormFieldValue(t,new F.ValueObjectRefs([e]))]}),(function(){return[]}))}),(function(){return[]})))))]).then((function(e){return Object(te.g)(o.formRecord.entity.formId,o.formRecord.id)})).then((function(e){t.props.dispatch(Object(H.T)({blockRendererId:t.props.blockRendererId,id:t.props.display.id,display:t.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value!==e.record.id.value})).concat(new H.N(e.record.id,Object.assign(Object.assign({},he(e.record,t.props.control.timeZoneOffset,t.props.control.eventProps,t.props.control.resourceProps,t.props.i18n.t)),{isOwn:!0}),e.record))}))})).catch((function(e){console.error("cannot save changes")}))}))}},{key:"checkSlotInfoIntersection",value:function(e,t){var n=this;return Object(_.l)(e).filter((function(e){return n.props.control.eventProps.intersectionEnabled||function(e,t){return 0===Object(_.l)(e.resourceId).matchWith((function(e){return t.filter((function(t){return t.resourceId===e}))}),(function(){return t})).filter((function(t){return Object(D.a)(t.start).getTime()===Object(D.a)(e.start).getTime()||Object(D.a)(t.end).getTime()===Object(D.a)(e.end).getTime()})).filter((function(t){return e.start.getTime()-Object(D.a)(e.start).getTime()<t.start.getTime()-Object(D.a)(t.start).getTime()&&e.end.getTime()-Object(D.a)(e.end).getTime()>t.start.getTime()-Object(D.a)(t.start).getTime()||e.start.getTime()-Object(D.a)(e.start).getTime()<t.end.getTime()-Object(D.a)(t.end).getTime()&&e.end.getTime()-Object(D.a)(e.end).getTime()>t.end.getTime()-Object(D.a)(t.end).getTime()||t.start.getTime()-Object(D.a)(t.start).getTime()>=e.start.getTime()-Object(D.a)(e.start).getTime()&&t.end.getTime()-Object(D.a)(t.end).getTime()<=e.end.getTime()-Object(D.a)(e.end).getTime()})).length}(e,t)})).matchWith((function(e){return Object(_.l)(e)}),(function(){return n.props.openSnackbar(p.createElement("span",null,n.props.i18n.t("Данный временной слот уже занят")),new _.b),new _.b}))}},{key:"checkMinInterval",value:function(e,t){var n=this;return Object(_.l)(e).filter((function(e){return it(e,t,n.props.control.eventProps.minInterval)})).matchWith((function(e){return Object(_.l)(e)}),(function(){return n.props.openSnackbar(p.createElement("span",null,n.props.i18n.t("Интервал между событиями")+" "+n.props.control.eventProps.minInterval.value.map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})).toString()+" "+n.props.i18n.t("мин")),new _.b),new _.b}))}},{key:"checkMinOwnInterval",value:function(e,t){var n=this;return Object(_.l)(e).filter((function(e){return it(e,t,n.props.control.eventProps.minOwnInterval)})).matchWith((function(e){return Object(_.l)(e)}),(function(){return n.props.openSnackbar(p.createElement("span",null,n.props.i18n.t("Интервал между собственными событиями")+" "+n.props.control.eventProps.minOwnInterval.value.map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})).toString()+" "+n.props.i18n.t("мин")),new _.b),new _.b}))}},{key:"onDndEvent",value:function(e){var t=this;if(e.event.isOwn){var n=this.getEvents().filter((function(t){return t.formDataId.value!==e.event.formDataId.value}));Object(_.l)(e).flatMap((function(e){return t.checkSlotInfoIntersection(e,n)})).flatMap((function(e){return t.checkMinInterval(e,n)})).flatMap((function(e){return t.checkMinOwnInterval(e,n.filter((function(e){return e.isOwn})))})).foreach((function(e){t.saveDndChanges(e)}))}}},{key:"onEditClick",value:function(){}},{key:"onDeleteClick",value:function(){}},{key:"getDefaultDate",value:function(){var e=this;return this.props.control.viewProps.dateConstraint.value.filter((function(t){return e.props.control.viewProps.dateConstraint.enabled})).flatMap((function(e){return Object(le.b)(e.tpe.value)(Ot).flatMap((function(t){return t(e)}))})).matchWith((function(t){return de(t,e.props.control.timeZoneOffset)}),(function(){return new Date}))}},{key:"getDefaultView",value:function(){return Object(le.b)(this.props.control.viewProps.defaultView.tpe.value)(vt).matchWith((function(e){return e()}),(function(){throw"unknown calendar view type"}))}},{key:"render",value:function(){var e=this,t=this.props.display.elementCss.flatMap((function(e){return e.proportions.flatMap((function(e){return e.height}))})).getOrElse((function(){return"300px"}));return p.createElement(S.a,{display:this.props.display,style:wt,blockStyle:this.props.blockStyle},p.createElement("div",{style:{height:t}},p.createElement(we,{onEdit:this.onEditClick,onDelete:this.onDeleteClick,showAnothersLabel:this.props.control.eventProps.showAnothersLabel},p.createElement(yt,Object.assign({selectable:!0,components:{event:Ce,toolbar:this.calendarToolbar.getOrUndefined()}},{step:this.props.control.viewProps.slotProps.step.getMinutes(),timeslots:this.props.control.viewProps.slotProps.slots},{formats:{timeGutterFormat:"HH:mm",dayHeaderFormat:"dddd MMMM DD",eventTimeRangeFormat:function(e,t,n){var r=e.start,o=e.end;return n.format(r,"HH:mm",t)+" — "+n.format(o,"HH:mm",t)}},localizer:gt,defaultDate:this.getDefaultDate(),defaultView:this.getDefaultView(),events:this.getEvents()},this.props.control.resourceProps.value.filter((function(t){return e.props.control.resourceProps.enabled})).matchWith((function(t){return{resourceIdAccessor:"resourceId",resourceTitleAccessor:"resourceTitle",resources:e.props.dataInput.matchWith((function(e){return e.displayValues.map((function(e){return{resourceId:e.id.value,resourceTitle:e.toString()}}))}),(function(){return[]}))}}),(function(){return{}})),this.props.control.viewProps.timeConstraint.value.filter((function(t){return e.props.control.viewProps.timeConstraint.enabled})).flatMap((function(e){return e.min})).matchWith((function(t){return{min:de(t,e.props.control.timeZoneOffset)}}),(function(){return{}})),this.props.control.viewProps.timeConstraint.value.filter((function(t){return e.props.control.viewProps.timeConstraint.enabled})).flatMap((function(e){return e.max})).matchWith((function(t){return{max:de(t,e.props.control.timeZoneOffset)}}),(function(){return{}})),{onEventDrop:this.onMoveEvent,resizableAccessor:function(){return e.props.control.eventProps.resizable},onEventResize:this.onResizeEvent,onSelectEvent:this.handleEventSelect,onSelectSlot:this.handleSlotSelect,onRangeChange:this.rangeChangeHandler,eventPropGetter:this.getEventProps,culture:this.props.i18n.code,messages:{month:this.props.i18n.t("Месяц"),week:this.props.i18n.t("Неделя"),day:this.props.i18n.t("День"),today:this.props.i18n.t("Сегодня"),previous:this.props.i18n.t("Назад"),next:this.props.i18n.t("Вперед"),agenda:this.props.i18n.t("calendar|Мероприятия")},views:Object.assign(Object.assign(Object.assign(Object.assign({},this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewMonth})).length>0?{month:!0}:{}),this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewWeek})).length>0?this.weekView.map((function(e){return{week:e}})).getOrUndefined():{}),this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewDay})).length>0?{day:!0}:{}),this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewAgenda})).length>0?{agenda:!0}:{})})))))}}]),t}(p.Component);kt=bt([y.autobind,ht("design:paramtypes",[Object])],kt);var Tt=Object(d.connect)((function(e,t){return{field:t.formId.flatMap((function(n){return Object(x.e)(e,n,t.input.formField)})),value:Object(N.n)(e.dataOutput,t.blockRendererId,t.output).map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueObjectRefs})).map((function(e){return e})),displayValues:Object(N.k)(e.dataOutput,t.blockRendererId,t.display.id),dataInput:Object(z.c)(e.dataInputs,t.display.id).filter((function(e){return e instanceof fe.d})).map((function(e){return e})),error:Object(N.q)(e.dataOutput,t.blockRendererId,t.display.id),i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataInputs.input===t.dataInputs.input&&e.dataOutput===t.dataOutput&&e.fields.list===t.fields.list},areOwnPropsEqual:function(e,t){return Object(_.h)(e.formId,t.formId)&&e.display===t.display&&e.blockRendererId===t.blockRendererId&&e.blockStyle===t.blockStyle&&e.output===t.output&&e.input===t.input&&e.onChange===t.onChange&&e.onControlBlur===t.onControlBlur},areStatePropsEqual:function(e,t){return Object(_.h)(e.field,t.field)&&Object(_.h)(e.displayValues,t.displayValues)&&Object(_.h)(e.dataInput,t.dataInput)&&Object(_.h)(e.error,t.error)&&e.i18n===t.i18n}})(Object(W.a)(Object(A.a)(kt))),Et=n(86),Dt=n(79),It=n(54),Rt=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"renderDisplayControl",value:function(){var e=this;return this.props.display.dataInput.map((function(t){return p.createElement(Tt,{display:e.props.display,blockRendererId:e.props.blockRendererId,blockId:e.props.blockId,parentRecordId:e.props.parentRecordId,control:e.props.control,input:t,output:e.props.output,formId:e.props.formId,onControlBlur:e.props.onControlBlur,onChange:e.props.onChange,blockStyle:e.props.blockStyle})})).getOrElse((function(){return p.createElement("div",null,e.props.i18n.t("Не задано поле поставщик данных"))}))}},{key:"renderEditControl",value:function(){var e=this;return this.props.display.dataInput.map((function(t){return p.createElement(Tt,{display:e.props.display,blockRendererId:e.props.blockRendererId,blockId:e.props.blockId,parentRecordId:e.props.parentRecordId,control:e.props.control,input:t,output:e.props.output,formId:e.props.formId,onControlBlur:e.props.onControlBlur,onChange:e.props.onChange,blockStyle:e.props.blockStyle})})).getOrElse((function(){return p.createElement("div",null,e.props.i18n.t("Не задано поле поставщик данных"))}))}},{key:"renderEditByClickControl",value:function(){return p.createElement(Et.a,{display:this.props.display,blockRendererId:this.props.blockRendererId,output:this.props.output,displayComponent:this.renderDisplayControl(),editComponent:this.renderEditControl(),onChange:this.props.onChange})}}]),t}(Dt.a),Ct=function(e,t){return Object(_.h)(e.formId,t.formId)&&Object(_.h)(e.blockStyle,t.blockStyle)&&e.display===t.display&&e.blockType.tpe.value===t.blockType.tpe.value&&e.blockRendererId===t.blockRendererId&&e.blockStyle===t.blockStyle&&e.output===t.output&&e.onChange===t.onChange&&e.onControlBlur===t.onControlBlur};t.default=Object(d.connect)((function(e,t){return{i18n:e.i18n,initialDictionaries:Object(se.h)(e.blockRendererContext,t.blockRendererId)}}),(function(e){return{dispatch:function(t){return e(t)}}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.blockRendererContext===t.blockRendererContext},areOwnPropsEqual:Ct})(Object(It.a)([function(e){e.isTokenChecked&&e.formId.foreach((function(t){var n;e.dispatch(Oe(e.blockRendererId,e.display,e.control,t,(n=e.control).viewProps.dateConstraint.value.filter((function(e){return n.viewProps.dateConstraint.enabled})).matchWith((function(e){return Object(le.b)(e.tpe.value)(je).matchWith((function(t){return t(e,n.timeZoneOffset)}),(function(){throw"unknown date constraint type"}))}),(function(){return{start:Object(re.a)(Object(ie.a)(de(new Date,n.timeZoneOffset))),end:Object(oe.a)(Object(ue.a)(de(new Date,n.timeZoneOffset)))}})))),e.dispatch(function(e,t,n,r){return function(o,i){t.dataInput.foreach((function(u){Object(x.b)(i().fields,r,u.formField).filter((function(e){return e.entity.valueType instanceof F.ValueTypeObjectRefs})).map((function(e){return e.entity.valueType})).foreach((function(r){o(Object(X.c)(r.family)).then((function(){n.resourceProps.value.filter((function(e){return n.resourceProps.enabled})).map((function(e){return e.resource})).flatMap((function(e){return Object(x.b)(i().fields,r.family,e).filter((function(e){return e.entity.valueType instanceof F.ValueTypeObjectRefs}))})).foreach((function(r){Object(_.l)(r).map((function(e){return e.entity.valueType})).flatMap((function(e){return Object(ce.e)(i().forms,e.family)})).foreach((function(i){F.FormType.isAnyDictionary(i.entity.formType)?o(Object(pe.b)(e,i.id,r.entity.valueType,t)):Object(ae.a)(i.id,new _.b).then((function(e){return o(Object(fe.j)({displayId:t.id,value:o(Object(pe.c)(n,i.id,e.list,e.list.length,r.entity.valueType))}))})).catch((function(e){return console.error("Failed to resolve input data",e)}))}))}))}))}))}))}}(e.blockRendererId,e.display,e.control,t))}))}],[],[],[],(function(e,t){return!Ct(e,t)&&e.i18n!==t.i18n}))(Rt))}}]);