(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[9],{2212:function(e,t){function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;var t=n();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var c=o?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(r,i,c):r[i]=e[i]}}return r.default=e,t&&t.set(e,r),r}},2239:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(1)),i=(0,r(n(40)).default)(o.default.createElement("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"}),"CloudDownload");t.default=i},2418:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(1)),i=(0,r(n(40)).default)(o.default.createElement("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"AddCircleOutline");t.default=i},2419:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(1)),i=(0,r(n(40)).default)(o.default.createElement("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"}),"List");t.default=i},2420:function(e,t,n){var r=n(2421);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(112)(r,o);r.locals&&(e.exports=r.locals)},2421:function(e,t,n){(e.exports=n(111)(!1)).push([e.i,".ObjRefsTableEditor__button{border:1px solid grey;margin:2px 5px;padding:4px;border-radius:5px}.ObjRefsTableEditor__button:hover{cursor:pointer;background-color:#f2f2f2}\n",""])},2422:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(1)),i=(0,r(n(40)).default)(o.default.createElement("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"}),"LocalPrintshop");t.default=i},2423:function(e,t,n){"use strict";var r=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(1)),i=(0,r(n(40)).default)(o.default.createElement("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"}),"Adjust");t.default=i},2424:function(e,t,n){"use strict";var r=n(2212),o=n(32);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.styles=void 0;var i=o(n(122)),c=o(n(150)),a=o(n(1)),u=(o(n(14)),o(n(18))),s=o(n(107)),l=o(n(160)),p=r(n(1259)),f={root:{display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center"},filled:{"&$positionStart:not($hiddenLabel)":{marginTop:16}},positionStart:{marginRight:8},positionEnd:{marginLeft:8},disablePointerEvents:{pointerEvents:"none"},hiddenLabel:{},marginDense:{}};t.styles=f;var d=a.default.forwardRef((function(e,t){var n=e.children,r=e.classes,o=e.className,l=e.component,f=void 0===l?"div":l,d=e.disablePointerEvents,h=void 0!==d&&d,m=e.disableTypography,v=void 0!==m&&m,b=e.position,g=e.variant,O=(0,c.default)(e,["children","classes","className","component","disablePointerEvents","disableTypography","position","variant"]),y=(0,p.useFormControl)()||{},j=g;return g&&y.variant,y&&!j&&(j=y.variant),a.default.createElement(p.default.Provider,{value:null},a.default.createElement(f,(0,i.default)({className:(0,u.default)(r.root,o,h&&r.disablePointerEvents,y.hiddenLabel&&r.hiddenLabel,{filled:r.filled}[j],{start:r.positionStart,end:r.positionEnd}[b],{dense:r.marginDense}[y.margin]),ref:t},O),"string"!=typeof n||v?n:a.default.createElement(s.default,{color:"textSecondary"},n)))})),h=(0,l.default)(f,{name:"MuiInputAdornment"})(d);t.default=h},2507:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n.n(r),i=n(10),c=n.n(i),a=n(4),u=n.n(a),s=n(5),l=n.n(s),p=n(1),f=n(11),d=n(27),h=n(34),m=n(0),v=n(79),b=n(38),g=n.n(b),O=n(6),y=n.n(O),j=n(13),k=n.n(j),R=n(15),E=n(863),F=n(223),I=n(823),C=n(277),P=n(815),D=n(237),w=n.n(D),V=n(203),S=n.n(V),_=n(991),x=n.n(_),T=n(2422),$=n.n(T),A=n(2423),L=n.n(A),B=n(1056),M=n.n(B),H=n(610),q=function(e){return p.createElement(H.a,Object.assign({},e),p.createElement("path",{d:"M2,6H4V18H2V6M5,6H6V18H5V6M7,6H10V18H7V6M11,6H12V18H11V6M14,6H16V18H14V6M17,6H20V18H17V6M21,6H22V18H21V6Z"}))},z=function(e){return p.createElement(H.a,Object.assign({},e),p.createElement("path",{d:"M15,7H20.5L15,1.5V7M8,0H16L22,6V18A2,2 0 0,1 20,20H8C6.89,20 6,19.1 6,18V2A2,2 0 0,1 8,0M4,4V22H20V24H4A2,2 0 0,1 2,22V4H4Z"}))},W=n(2239),N=n.n(W),U=n(992),G=n.n(U),J=n(251),Z=n(3),K=n(90);var Q=function(e){if(!(e.hasOwnProperty("block")&&e.hasOwnProperty("i18n")&&e.hasOwnProperty("blockId")))return e;var t=e.block,n=e.i18n,r=e.blockId;return Object.assign(Object.assign({},e),{i18n:X(n,t,r)})};function X(e,t,n){return Object(K.b)(t,n).filter((function(e){return e.entity.languageConfig.enabled})).map((function(n){var r=n.entity.languageConfig.langs,o=t.settings.selectedLangOrderIndex;return{t:function(e){return Object(m.g)(r.filter((function(e){return e.order===o}))).flatMap((function(t){return Object(m.j)(t.translationMap,e)})).getOrElse((function(){return e}))},code:e.code}})).getOrElse((function(){return e}))}var Y=n(373),ee=n(26),te=n(552),ne=n(21),re=n(8),oe=n.n(re),ie=n(503),ce=n(58),ae=n(235),ue=n(45),se=n(39),le=n(51),pe=n(618),fe=n(16),de=n(19),he=function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","List",{pipelineId:e}))}return l()(t,e),t}(de.a),me=(function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Update",{operation:e}))}l()(t,e)}(de.a),function(e){function t(e,n){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Execute",{pipelineId:e,filter:n}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Delete",{operationId:e}))}l()(t,e)}(de.a),function(e){function t(e,n,r){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","ExecuteParent",{pipelineId:e,formDataList:n,refFieldId:r}))}return l()(t,e),t}(de.a)),ve=n(22),be=n(173),ge=(n(619),function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Printers","List",{}))}l()(t,e)}(de.a),function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Printers","Scan",{}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Printers","PrintFile",{fileId:e}))}return l()(t,e),t}(de.a)),Oe=n(507),ye=n(2162),je=n(1258),ke=n(187),Re=n(299),Ee=(function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","List",{}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListForm",{formId:e}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListFormDescriptions",{formId:e}))}return l()(t,e),t}(de.a)),Fe=(function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Update",{config:e}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Create",{config:e}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Delete",{configId:e}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Request",{configId:e}))}l()(t,e)}(de.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","CopyPipeline",{pipelineId:e}))}l()(t,e)}(de.a),n(68)),Ie=function(e){return function(t,n){return t(Object(Re.h)({form:e})),function(e){return fe.a.send(new Ee(e),(function(e){return e}))}(e).then((function(n){return t(Object(Re.i)({form:e,resolved:n})),n})).catch((function(n){throw t(Object(Re.g)({form:e,error:n})),n}))}},Ce=function(e){return function(t){return t(Object(Fe.b)((function(e){return!e.exportPipelines.descriptionsFetching&&e.exportPipelines.descriptionsFetching}),Ie(e)))}},Pe=n(962),De=n(2198),we=n(2197),Ve=function(e){function t(e){o()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={exporting:{}},n}return l()(t,e),c()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;Object(m.l)(0===this.getExports(this.props).length&&1===this.getExports(e).length).filter((function(e){return e})).foreach((function(){return Object(m.g)(t.getExports(e)).foreach((function(e){return e.foreach((function(e){return Z.Id.createId(e.id.toString()).foreach((function(e){return t.props.onSelect(e)}))}))}))}))}},{key:"getExports",value:function(e){return e.user.userRole.map((function(t){var n=t.entity.getExports(e.formId);return e.eventLine.data.map((function(e){return t.entity.canAdminEvent(e.id)})).getOrElse((function(){return!1}))?Object(Pe.b)(e.exportPipelines,e.formId).getOrElse((function(){return[]})).map((function(e){return Object(m.l)(e)})):n.map((function(t){return Object(m.g)(Object(Pe.b)(e.exportPipelines,e.formId).getOrElse((function(){return[]})).filter((function(e){return e.id.toString()===t.value})))}))})).getOrElse((function(){return[]}))}},{key:"exportInProccess",value:function(e,t){this.setState(oe()(this.state,{exporting:{$set:Object.assign(Object.assign({},this.state.exporting),y()({},e.value,t))}}))}},{key:"exportInProcess",value:function(e){return Object(m.j)(this.state.exporting,e.id.toString()).getOrElse((function(){return!1}))}},{key:"render",value:function(){var e=this;return Object(Pe.c)(this.props.exportPipelines,this.props.formId).getOrElse((function(){return!0}))?p.createElement(Oe.a,null):0===this.getExports(this.props).length?p.createElement("p",null,this.props.i18n.t("Нет доступных экспортов")):p.createElement(ye.a,null,this.getExports(this.props).map((function(t){return t.map((function(t){return p.createElement(je.a,{button:!0,disabled:e.exportInProcess(t),onClick:function(){return Z.Id.createId(t.id.toString()).foreach((function(t){return e.props.onSelect(t)}))}},e.exportInProcess(t)&&p.createElement(we.a,null,p.createElement(Oe.a,null)),p.createElement(De.a,{primary:t.name}))})).getOrNull()})))}}]),t}(p.Component),Se=Object(f.connect)((function(e){return{i18n:e.i18n,exportPipelines:e.exportPipelines,user:e.user,eventLine:e.eventLine}}))(Object(ke.a)((function(e){e.isTokenChecked&&Object(Pe.b)(e.exportPipelines,e.formId).isEmpty()&&e.dispatch(Ce(e.formId))}),(function(){}),(function(e,t){e.formId.value!==t.formId.value&&Object(Pe.b)(e.exportPipelines,e.formId).isEmpty()&&e.dispatch(Ce(e.formId)),e.formId.value===t.formId.value&&e.isTokenChecked&&!t.isTokenChecked&&Object(Pe.b)(e.exportPipelines,e.formId).isEmpty()&&e.dispatch(Ce(e.formId))}))(Ve)),_e=n(553),xe=function(e,t){return function(n,r){var o=n(Object(te.c)(e)).filter((function(e){return e instanceof Z.MembersLimitLinkedValues})),i=t.filter((function(e){return o.filter((function(t){return t.linkedFieldId.value===e.id.value})).length>0})).map((function(e){return e.entity.valueType.family})).map((function(e){return n(Object(_e.b)(e,new m.b))}));return Promise.all(i)}},Te=function(e,t){return function(n,r){return Object(m.l)(t.formRecord.entity.values[e.fileField.value]).flatMap((function(e){return Object(m.g)(e.value.files)})).map((function(e){r().user.terminal.flatMap((function(e){return Object(m.g)(r().terminals.list.filter((function(t){return t.id.value===e.value})))})).foreach((function(t){t.entity.printer.map((function(){(function(e){return fe.a.send(new ge(e),(function(e){return e}))})(e).then((function(){n(Object(le.f)(r().i18n.t("Файл успешно отправлен на печать")))})).catch((function(e){n(Object(le.f)(r().i18n.t("При печати файла произошла ошибка")))}))})).getOrElse((function(){r().auth.token.map((function(t){return Object(be.b)(e,t,r().config.cdnAddress)}))}))}))})).getOrElse((function(){n(Object(le.f)(r().i18n.t("Файл отсутствует")))}))}},$e=function(e,t,n,r,o){return function(i,c){var a=function(e){e.entity.file.map((function(e){return c().auth.token.map((function(t){Object(be.b)(e,t,c().config.cdnAddress)}))}))},u=r(c().i18n.t("Выберите экспорт"),p.createElement(Se,{formId:n,onSelect:function(n){e.foreach((function(e){var r,s,l;(r=n,s=[e],l=t.formField,fe.a.send(new me(r,s,l),Object(ve.f)())).then((function(e){o(u),i(function(e){return function(t){return t(Object(pe.b)()),fe.a.send(new he(e),Object(ve.g)()).then((function(e){return t(Object(pe.c)(e.list)),e})).catch((function(e){throw t(Object(pe.a)(e)),e}))}}(n)).then((function(t){Object(m.g)(t.list.filter((function(t){return t.id.value===e.id.value}))).map((function(e){return a(e)}))}))})).catch((function(e){o(u),i(Object(le.f)(c().i18n.t("Ошибка во время создания операции экспорта!")))}))}))}}),[])}},Ae=n(980),Le=n(456),Be=n(137),Me=n(589),He=n(204),qe=n(62),ze=n(502),We=n(135),Ne=n(417),Ue=n(2418),Ge=n.n(Ue),Je=n(2419),Ze=n.n(Je),Ke=n(247),Qe=n(54),Xe=n(63),Ye=n(596),et=n(369),tt=n(827),nt=n(218),rt=n(50),ot=function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},it=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),c()(t,[{key:"onSaveClick",value:function(e){var t=this;this.getDocumentPdfFileId(e).matchWith((function(e){t.props.dispatch(Object(nt.c)(e))}),(function(){t.props.dispatch(Object(le.f)(t.props.i18n.t("Файл в документе не найден")))}))}},{key:"getDocumentIssueDate",value:function(e){var t=this;return this.props.dateFormField.flatMap((function(t){return Object(m.j)(e.entity.values,t.id.value)})).matchWith((function(e){return e.value.toString()}),(function(){return t.props.i18n.t("Значение не найдено")}))}},{key:"getDocumentPdfFileId",value:function(e){return this.props.pdfFormField.flatMap((function(t){return Object(m.j)(e.entity.values,t.id.value)})).filter((function(e){return e.value.tpe.value===Z.ValueFileList.$Type.value})).flatMap((function(e){return Object(m.g)(e.value.files)}))}},{key:"getDocumentIssueTime",value:function(e){var t=this;return this.props.timeFormField.flatMap((function(t){return Object(m.j)(e.entity.values,t.id.value)})).matchWith((function(e){return e.value.toString()}),(function(){return t.props.i18n.t("Значение не найдено")}))}},{key:"getDocumentActiveStatus",value:function(e){var t=this;return this.props.activeStatusFormField.flatMap((function(t){return Object(m.j)(e.entity.values,t.id.value)})).matchWith((function(e){return e.value.toString()}),(function(){return t.props.i18n.t("Значение не найдено")}))}},{key:"render",value:function(){var e=this;return p.createElement(J.a,{showId:!1,fetching:this.props.isDocumentRecordsFetching,error:this.props.documentRecordsError,empty:0===this.props.documentRecords.getOrElse((function(){return[]})).length,withActions:!0,headers:[{id:"date",title:this.props.i18n.t("Дата")},{id:"time",title:this.props.i18n.t("Время")},{id:"status",title:this.props.i18n.t("Статус активности")}],rows:this.props.documentRecords.getOrElse((function(){return[]})).sort((function(e,t){return e.id.value>t.id.value?1:-1})).map((function(t,n){return{payload:t,id:n.toString(),fields:[e.getDocumentIssueDate(t),e.getDocumentIssueTime(t),e.getDocumentActiveStatus(t)],buttons:[p.createElement(C.a,{key:"download",style:rt.d,onClick:function(n){n.stopPropagation(),e.onSaveClick(t)}},p.createElement(N.a,{style:rt.e}))]}}))})}}]),t}(p.Component);it=ot([R.autobind],it);var ct=Object(f.connect)((function(e,t){var n=t.document.entity.logParams.refId.filter((function(e){return t.document.entity.logParams.enabled})).flatMap((function(n){return Object(h.e)(e,t.document.entity.form,n)})).filter((function(e){return e.entity.valueType.tpe.value===Z.ValueTypeObjectRefs.$Type.value})),r=n.map((function(e){return e.entity.valueType.family})).flatMap((function(t){return Object(h.f)(e.fields,t)})).getOrElse((function(){return[]}));return{i18n:e.i18n,documentRecords:Object(et.b)(e.documentRecords,t.formRecord.id,t.document.id),isDocumentRecordsFetching:Object(et.e)(e.documentRecords,t.formRecord.id,t.document.id),documentRecordsError:Object(et.c)(e.documentRecords,t.formRecord.id,t.document.id),documentLogFormField:n,dateFormField:Object(m.g)(r.filter((function(e){return"date"===e.entity.name}))),timeFormField:Object(m.g)(r.filter((function(e){return"time"===e.entity.name}))),pdfFormField:Object(m.g)(r.filter((function(e){return"pdf"===e.entity.name}))),activeStatusFormField:Object(m.g)(r.filter((function(e){return"active"===e.entity.name})))}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.documentRecords===t.documentRecords&&e.fields===t.fields&&e.i18n===t.i18n},areStatePropsEqual:function(e,t){return Object(m.h)(e.documentRecords,t.documentRecords)&&Object(m.h)(e.documentLogFormField,t.documentLogFormField)&&Object(m.h)(e.pdfFormField,t.pdfFormField)&&Object(m.h)(e.documentRecordsError,t.documentRecordsError)&&e.isDocumentRecordsFetching===t.isDocumentRecordsFetching&&e.i18n===t.i18n}})(Object(Qe.a)([function(e){e.documentLogFormField.foreach((function(t){Object(m.j)(e.formRecord.entity.values,t.id.value).foreach((function(n){e.dispatch(Object(tt.b)(t.entity.valueType.family,e.document.id,e.formRecord.id,n.value.id)),e.dispatch(Object(We.e)(t.entity.valueType.family))}))}))}])(it)),at=function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},ut=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),c()(t,[{key:"onIssueDocumentClick",value:function(e){var t=this;this.props.dispatch(Object(Ye.a)(this.props,this.props.formRecord.id,e,!1)).then((function(n){n.matchWith((function(n){t.openDocumentRecordsList(e)}),(function(e){t.props.dispatch(Object(le.f)(t.props.i18n.t("При генерации документа произошла ошибка")))}))}))}},{key:"openDocumentRecordsList",value:function(e){var t=this;Object(ue.g)(this.props.formRecord.entity.formId,this.props.formRecord.id).then((function(n){var r=t.props.openDialog(t.props.i18n.t("Сгенерированные документы"),p.createElement(ct,{formRecord:n.record,document:e}),[p.createElement(I.a,{key:"close",variant:"contained",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(r)}},t.props.i18n.t("Закрыть"))])}))}},{key:"onListClick",value:function(e){this.openDocumentRecordsList(e)}},{key:"render",value:function(){var e=this;return p.createElement(J.a,{showId:!1,fetching:this.props.isDocumentsFetching,error:this.props.documentsError,empty:0===this.props.documents.getOrElse((function(){return[]})).length,withActions:!0,headers:[{id:"documentName",title:this.props.i18n.t("Название документа")}],rows:this.props.documents.getOrElse((function(){return[]})).map((function(t,n){return{payload:t,id:n.toString(),fields:[t.entity.name],buttons:[p.createElement(C.a,{key:"generate",style:rt.d,onClick:function(n){n.stopPropagation(),e.onIssueDocumentClick(t)}},p.createElement(Ge.a,{style:rt.e})),p.createElement(C.a,{key:"list",style:rt.d,onClick:function(n){n.stopPropagation(),e.onListClick(t)}},p.createElement(Ze.a,{style:rt.e}))]}}))})}}]),t}(p.Component);ut=at([R.autobind],ut);var st=Object(f.connect)((function(e,t){return{i18n:e.i18n,documents:Object(Ke.b)(e.formDataDocuments,t.formRecord.id),isDocumentsFetching:Object(Ke.e)(e.formDataDocuments,t.formRecord.id),documentsError:Object(Ke.c)(e.formDataDocuments,t.formRecord.id)}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.formDataDocuments===t.formDataDocuments&&e.i18n===t.i18n},areStatePropsEqual:function(e,t){return Object(m.h)(e.documents,t.documents)&&Object(m.h)(e.documentsError,t.documentsError)&&e.isDocumentsFetching===t.isDocumentsFetching&&e.i18n===t.i18n}})(Object(Qe.a)([function(e){e.dispatch(Object(Ye.b)(e.formRecord.entity.formId,e.formRecord.id))}])(Object(Xe.a)(ut))),lt=n(136),pt=n(77),ft=n(2424),dt=n.n(ft),ht=(n(2420),n(177)),mt=n(87),vt=function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},bt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},gt=function(e){function t(e){o()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={saveBlock:!1,markedFormRecords:[],processedFormRecords:[],currentPage:0,rowPerPage:20,searchValue:"",requestedCloseEnabled:!0},n}return l()(t,e),c()(t,[{key:"fetchFormRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.b;return this.props.parentRecordId.map((function(n){return e.props.dispatch(Object(ie.a)(new Z.DataPageRequest(e.state.currentPage,e.state.rowPerPage,e.props.objRefFormId,t),new Z.ParentFormData(e.props.formId,n,e.props.output.formField),e.props.control,e.props.display.id,e.props.blockRendererId))}))}},{key:"onChange",value:function(e){this.props.onChange(e,this.props.output)}},{key:"sliceCurrentPage",value:function(e){return e.slice(this.state.currentPage*this.state.rowPerPage,(this.state.currentPage+1)*this.state.rowPerPage)}},{key:"convertDataOutputValuesToFormFieldValues",value:function(e){return e.map((function(e){return new Z.FormFieldValue(e.output.formField,e.value)})).filter((function(e){return""!==e.formFieldId.value})).reduce((function(e,t){return e[t.formFieldId.value]=t,e}),{})}},{key:"getLimitValue",value:function(e,t){var n=this;return Object(m.g)(this.props.dispatch(Object(te.c)(this.props.blockRendererId)).filter((function(n){return n.cfgId===e&&n instanceof Z.MembersLimitLinkedValues&&n.linkedValues.filter((function(e){return e.dictId.value===t.value})).length>0}))).flatMap((function(r){return Object(m.g)(n.props.dispatch(Object(ze.b)(n.props.blockRendererId)).getOrElse((function(){return[]})).filter((function(t){return t.cfgId===e}))).flatMap((function(e){return Object(m.l)(e.data.values.get(t.value))}))}))}},{key:"getInitialDictionaries",value:function(e){var t,n=this,r=this.props.dispatch((t=this.props.formId,function(e,n){return Object(qe.e)(n().forms,t)})).map((function(e){return e.entity.limits})).getOrElse((function(){return[]}));return this.props.dispatch(Object(ze.b)(this.props.blockRendererId)).map((function(t){return t.filter((function(e){return e.data instanceof Z.LimitDataLinkedValues})).reduce((function(t,o){return Object(m.g)(n.props.objRefFormFields.getOrElse((function(){return[]})).filter((function(e){return Object(m.g)(r.filter((function(e){return e.limitType.id===o.cfgId}))).filter((function(t){return t.limitType.memberTypeId.value===e.id.value})).nonEmpty()}))).map((function(r){return oe()(t,y()({},r.entity.valueType.family.value,{$set:n.props.dispatch(Object(_e.c)(r.entity.valueType.family)).map((function(t){return t.map((function(e){return{formRecord:e,limitValue:Object(m.l)(o.data.values.get(e.id.value))}})).map((function(t){return Object.assign(Object.assign({},t),{freeAmount:t.limitValue.map((function(e){return e.avail})).getOrElse((function(){return 0}))+e.flatMap((function(e){return Object(m.j)(e,r.id.value).filter((function(e){return e.value.tpe.value===Z.ValueObjectRefs.$Type.value})).map((function(e){return e.value.id.filter((function(e){return e.value===t.formRecord.id.value})).length>0?1:0}))})).getOrElse((function(){return 0}))})})).filter((function(e){return e.freeAmount>0&&e.limitValue.filter((function(e){return e.limitPresent})).nonEmpty()||!o.required&&e.limitValue.filter((function(e){return e.limitPresent})).isEmpty()})).map((function(e){return e.limitValue.filter((function(e){return e.limitPresent})).matchWith((function(t){return Object(m.g)(r.entity.valueType.displayFields).map((function(n){return oe()(e.formRecord,{entity:{values:{$set:Object.keys(e.formRecord.entity.values).reduce((function(n,r){return Z.Id.createId(r).flatMap((function(t){return e.formRecord.entity.getFormFieldValue(t)})).filter((function(e){return e.value instanceof Z.ValueStr})).matchWith((function(o){return oe()(n,y()({},r,{$set:oe()(o,{value:{$set:new Z.ValueStr(o.value.toString()+" "+e.freeAmount+"/"+t.all)}})}))}),(function(){return n}))}),e.formRecord.entity.values)}}})})).getOrElse((function(){return e.formRecord}))}),(function(){return e.formRecord}))}))})).getOrElse((function(){return[]}))}))})).getOrElse((function(){return t}))}),{})})).getOrElse((function(){return{}}))}},{key:"checkFormRecordLimits",value:function(){var e=this.props.dispatch(Object(ze.b)(this.props.blockRendererId)).getOrElse((function(){return[]}));if(0===e.length)return!0;if(e.filter((function(e){return e.data instanceof Z.LimitDataTotal&&(e.data.values.avail<1&&e.data.values.limitPresent&&e.required||!e.data.values.limitPresent&&e.required)})).length>0)return!1;var t=e.filter((function(e){return e.data instanceof Z.LimitDataLinkedValues}));return!(t.length>0&&0===t.filter((function(e){return[].concat(g()(e.data.values)).filter((function(t){return t[1].avail>0||!t[1].limitPresent&&!e.required})).length>0})).length)}},{key:"onCreateClick",value:function(){var e=this;this.fetchFormRecordLimits().foreach((function(t){t.then((function(){e.checkFormRecordLimits()?e.setState(oe()(e.state,{requestedCloseEnabled:{$set:!1}}),(function(){return e.onCreateWithLimitDictionariesRequested()})):e.showExceedLimitsDialog()})).catch((function(t){e.props.dispatch(Object(Be.b)(t))}))}))}},{key:"showExceedLimitsDialog",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Новая запись"),p.createElement("div",null,this.props.i18n.t("Создание новой записи невозможно, так как превышен лимит")),[p.createElement(I.a,{variant:"contained",onClick:function(n){return e.props.handleDialogClose(t)}},this.props.i18n.t("Закрыть"))])}},{key:"childRegistration",value:function(e,t,n){var r=this;return this.props.dispatch(this.props.parentRecordId.matchWith((function(o){return Object(ce.d)(e,o,r.props.output.formField,t,n,r.props.control.formDataRefOperations.parentFieldId.filter((function(){return r.props.control.formDataRefOperations.writingParentId})))}),(function(){return Object(ce.c)(e,t,n)})))}},{key:"getInitialValues",value:function(){var e,t,n=this;return this.props.dispatch((e=this.props.control,t=this.props.blockRendererId,function(n,r){return new Promise((function(n,o){var i=r().blockRendererContext;n(e.formDataRefOperations.fieldConnectionEnabled?e.formDataRefOperations.fieldConnections.reduce((function(e,n){return Object(d.i)(i,t,n.parentField).map((function(t){return e[n.childField.value]=new Z.FormFieldValue(n.childField,t),e})).getOrElse((function(){return e}))}),{}):{})}))})).then((function(e){return n.getChildFormFieldValue().matchWith((function(t){return Object.assign(e,y()({},t.formFieldId.value,t))}),(function(){return e}))}))}},{key:"onCreateWithLimitDictionariesRequested",value:function(){var e=this;this.props.dispatch(xe(this.props.blockRendererId,this.props.objRefFormFields.getOrElse((function(){return[]})))).then((function(){e.onCreateRequested()})).catch((function(t){e.props.dispatch(Object(le.f)(t))}))}},{key:"onEditWithLimitDictionariesRequested",value:function(e,t){var n=this;this.props.dispatch(xe(this.props.blockRendererId,this.props.objRefFormFields.getOrElse((function(){return[]})))).then((function(){n.onEditRequested(e,t)})).catch((function(e){n.props.dispatch(Object(le.f)(e))}))}},{key:"onCreateRequested",value:function(){var e=this,t=function(t,r){e.state.saveBlock||e.setState(oe()(e.state,{saveBlock:{$set:!0}}),(function(){e.props.dispatch(Object(ce.g)(t,n,new m.b)).then((function(){return e.props.dispatch(Object(ce.b)(t,n,e.props.objRefFormId))})).then((function(){return e.childRegistration(t,e.props.objRefFormId,n).then((function(t){return function(t,n){e.props.handleDialogClose(n),e.props.dispatch(Object(le.f)(e.props.i18n.t("Запись успешно создана"))),e.setState(oe()(e.state,{saveBlock:{$set:!1}})),e.onAddByCreating(t)}(t.id,r)})).catch((function(t){e.props.dispatch(Object(Be.c)(t,e.props,n,e.props.blockId)),e.setState(oe()(e.state,{saveBlock:{$set:!1}}))}))})).catch((function(t){e.props.dispatch(Object(Be.c)(t,e.props,n,e.props.blockId)),console.log("block invalid",t),e.setState(oe()(e.state,{saveBlock:{$set:!1}}))}))}))},n=se.v4();this.getInitialValues().then((function(r){e.props.control.formDataRefOperations.addingNewBlock.map((function(o){return e.props.getBlockComponent&&e.props.getBlockComponent(e.props.objRefFormId,new m.b,o,n,Z.webRegistrationBlockTypeEdit,e.props.rootBlockRendererId.matchWith((function(e){return Object(m.l)(e)}),(function(){return Object(m.l)(e.props.blockRendererId)})),(function(n){var r=e.props.openDialog(e.props.i18n.t("Новая запись"),n,e.props.control.viewProps.fullScreenProps.enabled?[]:[p.createElement(I.a,{key:"close",variant:"contained",onClick:function(t){return e.props.handleDialogClose(r)},style:{marginRight:"10px"}},e.props.i18n.t("Закрыть")),p.createElement(I.a,{key:"save",variant:"contained",onClick:function(){return t(o,r)},color:"primary"},e.props.i18n.t("Сохранить"))],{fullScreen:e.props.control.viewProps.fullScreenProps.enabled,hideTitle:e.props.control.viewProps.fullScreenProps.enabled});return r}),e.getInitialDictionaries(new m.b),r,(function(e){return t(o,e)}),(function(t){return e.props.handleDialogClose(t)}))})).getOrElse((function(){throw e.props.i18n.t("Ошибка - не выбран блок создания анкеты")}))})).catch((function(t){e.props.dispatch(Object(le.f)(t))}))}},{key:"onEditClick",value:function(e,t){var n=this;this.fetchFormRecordLimits().foreach((function(r){r.then((function(){n.setState(oe()(n.state,{requestedCloseEnabled:{$set:!1}}),(function(){return n.onEditWithLimitDictionariesRequested(e,t)}))})).catch((function(e){n.props.dispatch(Object(Be.b)(e))}))}))}},{key:"onEditRequested",value:function(e,t){var n=this,r=se.v4();t.block.map((function(t){return n.props.getBlockComponent&&n.props.getBlockComponent(n.props.objRefFormId,Object(m.l)(e.formRecord),t,r,Z.webRegistrationBlockTypeEdit,n.props.rootBlockRendererId.matchWith((function(e){return Object(m.l)(e)}),(function(){return Object(m.l)(n.props.blockRendererId)})),(function(o){var i=n.props.openDialog(n.props.i18n.t("Редактирование"),o,[p.createElement(I.a,{onClick:function(e){return n.props.handleDialogClose(i)},style:{marginRight:"10px"}},n.props.i18n.t("Закрыть")),p.createElement(I.a,{color:"primary",variant:"contained",onClick:function(){n.state.saveBlock||n.setState(oe()(n.state,{saveBlock:{$set:!0}}),(function(){n.props.dispatch(Object(He.e)(t)).foreach((function(o){n.props.dispatch(Object(ce.g)(t,r,new m.b)).then((function(){return n.props.dispatch(Object(ce.b)(t,r,n.props.objRefFormId))})).then((function(){return n.props.dispatch(Object(ce.f)(t,n.props.objRefFormId,o.entity,r,e.id))})).then((function(e){return function(e,t){n.props.handleDialogClose(t),n.props.dispatch(Object(le.f)(n.props.i18n.t("Запись успешно отредактирована"))),n.setState(oe()(n.state,{saveBlock:{$set:!1}})),n.onEditComplete(e)}(e,i)})).catch((function(e){n.props.dispatch(Object(Be.c)(e,n.props,r,t)),n.setState(oe()(n.state,{saveBlock:{$set:!1}}))}))}))}))}},n.props.i18n.t("Сохранить"))])}),n.getInitialDictionaries(Object(m.l)(e.formRecord.entity.values)),e.formRecord.entity.values)})).getOrElse((function(){n.props.dispatch(Object(le.f)(n.props.i18n.t("Ошибка - не выбран блок создания анкеты")))}))}},{key:"onOpenPageClick",value:function(e,t){this.props.dispatch(Object(mt.c)(this.props.objRefFormId,e.id,t.blockId))}},{key:"onOpenClick",value:function(e,t){var n=this,r=se.v4();t.block.map((function(o){return n.props.getBlockComponent&&n.props.getBlockComponent(n.props.objRefFormId,Object(m.l)(e.formRecord),o,r,Z.webRegistrationBlockTypeDisplay,n.props.rootBlockRendererId.matchWith((function(e){return Object(m.l)(e)}),(function(){return Object(m.l)(n.props.blockRendererId)})),(function(e){var r=n.props.openDialog(n.props.i18n.t("Просмотр"),e,t.fullScreen?[]:[p.createElement(I.a,{onClick:function(e){return n.props.handleDialogClose(r)},style:{marginRight:"10px"}},n.props.i18n.t("Закрыть"))],{fullScreen:t.fullScreen,withCloseButton:!0});return r}),{},e.formRecord.entity.values,void 0,(function(e){return n.props.handleDialogClose(e)}))})).getOrElse((function(){n.props.dispatch(Object(le.f)(n.props.i18n.t("Ошибка - не выбран блок просмотра анкеты")))}))}},{key:"onMassEditRequested",value:function(){var e=this,t=se.v4();this.props.control.formDataRefOperations.massEditBlock.map((function(n){return e.props.getBlockComponent&&e.props.getBlockComponent(e.props.objRefFormId,new m.b,n,t,Z.webRegistrationBlockTypeEdit,e.props.rootBlockRendererId.matchWith((function(e){return Object(m.l)(e)}),(function(){return Object(m.l)(e.props.blockRendererId)})),(function(r){var o=e.props.openDialog(e.props.i18n.t("Массовое редактирование"),r,[p.createElement(I.a,{onClick:function(t){return e.props.handleDialogClose(o)},style:{marginRight:"10px"}},e.props.i18n.t("Закрыть")),p.createElement(I.a,{color:"primary",variant:"contained",onClick:function(){e.props.dispatch(Object(He.e)(n)).foreach((function(r){var i=0===e.state.markedFormRecords.length?e.props.value.map((function(e){return e.id})).getOrElse((function(){return[]})):e.state.markedFormRecords;e.props.dispatch(Object(ce.g)(n,t,new m.b)).then((function(){return e.props.dispatch(Object(ce.e)(n,e.props.objRefFormId,r.entity,t,i)).then((function(t){e.handleGroupUpdating(o)})).catch((function(r){e.props.dispatch(Object(Be.c)(r,e.props,t,n)),e.handleRegisterFailed(o)}))}))}))}},e.props.i18n.t("Сохранить"))])}))})).getOrElse((function(){e.props.dispatch(Object(le.f)(e.props.i18n.t("Ошибка - не выбран блок массового редактирования анкеты")))}))}},{key:"onAddClick",value:function(){var e=this;this.props.control.formDataRefOperations.addingExisting&&this.fetchFormRecordLimits().foreach((function(t){t.then((function(){e.props.dispatch(Object(We.b)(e.props.formId,e.props.output.formField)).foreach((function(t){var r=e.props.openDialog(e.props.i18n.t("Добавление записи"),p.createElement(ht.a,{params:{},componentProps:{childFormId:e.props.objRefFormId,parentFormId:e.props.formId,objRefsField:t,displayFields:e.props.control.displayFields,displayFieldsForAdding:e.props.control.displayFieldsForAdding,blockRendererId:e.props.blockRendererId,display:e.props.display,output:e.props.output,input:e.props.input,onObjRefAdd:e.onAddValue,onObjRefsAdd:e.onAddValues,onObjRefDelete:e.onDeleteValue},load:function(){return n.e(0).then(n.bind(null,2506))}}),[p.createElement(I.a,{variant:"contained",key:"close",onClick:function(t){return e.props.handleDialogClose(r)},style:{marginRight:"10px"}},e.props.i18n.t("Закрыть"))])}))}))}))}},{key:"getChildFormFieldValue",value:function(){var e=this;return this.props.control.formDataRefOperations.parentFieldId.filter((function(){return e.props.control.formDataRefOperations.writingParentId})).flatMap((function(t){return e.props.parentRecordId.map((function(e){return new Z.FormFieldValue(t,new Z.ValueObjectRefs([e]))}))}))}},{key:"onAddValue",value:function(e){return this.onAddValues([e])}},{key:"fetchFormRecordLimits",value:function(){var e=this;return this.props.parentRecordId.map((function(t){return e.props.dispatch(Object(Me.b)(e.props.formId,t,e.props.blockRendererId))}))}},{key:"onAddValues",value:function(e){var t=this;if(!this.props.control.formDataRefOperations.addingExisting)return new Promise((function(e,t){return t()}));var n=this.props.control.formDataRefOperations.moveChildren?ue.m:ue.a;return this.props.parentRecordId.matchWith((function(r){return n([r],t.props.formId,t.props.output.formField,t.props.objRefFormId,e.map((function(e){return e.id})))}),(function(){return new Promise((function(e,t){t(new Error("Parent record id has not been provided"))}))})).then((function(){t.onChange(t.props.value.filter((function(e){return e.tpe.value===Z.ValueObjectRefs.$Type.value})).map((function(t){return new Z.ValueObjectRefs(t.id.concat(e.map((function(e){return e.id}))))})).getOrElse((function(){return new Z.ValueObjectRefs(e.map((function(e){return e.id})))}))),t.fetchFormRecords().foreach((function(e){return e.then((function(){return t.fetchFormRecordLimits()}))}))})).catch((function(e){throw t.props.dispatch(Object(Be.b)(e)),e}))}},{key:"onAddByCreating",value:function(e){var t=this,n=this.props.value.filter((function(e){return e.tpe.value===Z.ValueObjectRefs.$Type.value})).map((function(t){return t.id.filter((function(t){return t.value!==e.value}))})).map((function(t){return new Z.ValueObjectRefs(t.concat(e))})).getOrElse((function(){return new Z.ValueObjectRefs([e])}));this.onChange(n),this.fetchFormRecords().foreach((function(e){return e.then((function(){return t.fetchFormRecordLimits()}))}))}},{key:"onEditComplete",value:function(e){var t=this,n=this.props.value.filter((function(e){return e.tpe.value===Z.ValueObjectRefs.$Type.value})).map((function(t){return t.id.filter((function(t){return t.value!==e.value}))})).map((function(t){return new Z.ValueObjectRefs(t.concat(e))})).getOrElse((function(){return new Z.ValueObjectRefs([e])}));this.onChange(n),this.fetchFormRecords().foreach((function(e){return e.then((function(){return t.fetchFormRecordLimits()}))}))}},{key:"onDeleteValue",value:function(e){return this.deleteObjRef(e)}},{key:"deleteObjRef",value:function(e){var t=this;return this.props.parentRecordId.matchWith((function(n){return Object(ue.n)([n],t.props.formId,t.props.output.formField,t.props.objRefFormId,[e.id])}),(function(){return new Promise((function(e,t){return e()}))})).then((function(){t.onChange(t.props.value.map((function(t){return new Z.ValueObjectRefs(t.id.filter((function(t){return t.value!==e.id.value})))})).getOrElse((function(){return new Z.ValueObjectRefs([])}))),t.fetchFormRecords().foreach((function(e){return e.then((function(){return t.fetchFormRecordLimits()}))}))}))}},{key:"onViewValue",value:function(e){this.props.dispatch(Object(Ne.a)(this.props.objRefFormId,e.id))}},{key:"onRecordSelected",value:function(e){}},{key:"onSelectAll",value:function(){this.state.markedFormRecords.length===this.sliceCurrentPage(this.props.value.map((function(e){return e.id})).getOrElse((function(){return[]}))).length?this.setState(oe()(this.state,{markedFormRecords:{$set:[]}})):this.setState(oe()(this.state,{markedFormRecords:{$set:this.sliceCurrentPage(this.props.value.map((function(e){return e.id})).getOrElse((function(){return[]})))}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex((function(t){return t.value===e}));t>=0?this.setState(oe()(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(oe()(this.state,{markedFormRecords:{$push:[new Z.Id(e)]}}))}},{key:"handleRegisterFailed",value:function(e){this.props.handleDialogClose(e),this.props.dispatch(Object(le.f)(this.props.i18n.t("Сохранения изменений прервалось с ошибкой")))}},{key:"handleGroupUpdating",value:function(e){this.props.handleDialogClose(e),this.fetchFormRecords(),this.props.dispatch(Object(le.f)(this.props.i18n.t("Изменения успешно сохранены")))}},{key:"handleUpdating",value:function(e){this.props.handleDialogClose(e),this.fetchFormRecords(),this.props.dispatch(Object(le.f)(this.props.i18n.t("Изменения успешно сохранены"))),this.fetchFormRecordLimits()}},{key:"onOpenExports",value:function(){this.props.dispatch($e(this.props.parentRecordId,this.props.output,this.props.objRefFormId,this.props.openDialog,this.props.handleDialogClose))}},{key:"onFirstPage",value:function(){var e=this;this.setState(oe()(this.state,{currentPage:{$set:0},markedFormRecords:{$set:[]}}),(function(){return e.fetchFormRecords()}))}},{key:"onLastPage",value:function(){var e=this;this.setState(oe()(this.state,{currentPage:{$set:Math.ceil(this.props.value.map((function(e){return e.id.length})).getOrElse((function(){return 0}))/this.state.rowPerPage)-1},markedFormRecords:{$set:[]}}),(function(){return e.fetchFormRecords()}))}},{key:"onNextPage",value:function(){var e=this;this.setState(oe()(this.state,{currentPage:{$set:this.state.currentPage+1},markedFormRecords:{$set:[]}}),(function(){return e.fetchFormRecords()}))}},{key:"onPrevPage",value:function(){var e=this;this.setState(oe()(this.state,{currentPage:{$set:this.state.currentPage-1},markedFormRecords:{$set:[]}}),(function(){return e.fetchFormRecords()}))}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(oe()(this.state,{rowPerPage:{$set:e},markedFormRecords:{$set:this.state.rowPerPage<=e?this.state.markedFormRecords:[]}}),(function(){return t.fetchFormRecords()}))}},{key:"getActionButton",value:function(e,t){var n=this,r=e.display.enabled,o=e.display.value.getOrElse((function(){return""})),i=function(e){return p.createElement(F.a,{className:"ObjRefsTableEditor__button",variant:"caption",align:"center",onClick:e},o)};switch(e.tpe.value){case Z.ElementControlActionDownloadDocument.$Type.value:return r?i((function(){return n.onDownloadDocument(e,t)})):p.createElement(C.a,{style:rt.d,key:"download-document",onClick:function(){return n.onDownloadDocument(e,t)}},p.createElement(N.a,{style:rt.e}));case Z.ElementControlActionIssueDocument.$Type.value:return r?i((function(){return n.onIssueDocument(e,t)})):p.createElement(C.a,{style:rt.d,key:"issue",onClick:function(){return n.onIssueDocument(e,t)}},p.createElement(z,{style:rt.e}));case Z.ElementControlActionPrintFile.$Type.value:return r?i((function(){return n.onPrintFile(e,t)})):p.createElement(C.a,{style:rt.d,key:"print",onClick:function(){return n.onPrintFile(e,t)}},p.createElement($.a,{style:rt.e}));case Z.ElementControlActionDownloadFile.$Type.value:return r?i((function(){return n.onDownloadFile(e,t)})):p.createElement(C.a,{style:rt.d,key:"download-file",onClick:function(){return n.onDownloadFile(e,t)}},p.createElement(N.a,{style:rt.e}));case Z.ElementControlActionAssignBarcode.$Type.value:return r?i((function(){return n.onAssignBarcodes(e,t)})):p.createElement(C.a,{style:rt.d,key:"assignBarcode",onClick:function(){return n.onAssignBarcodes(e,t)}},p.createElement(q,{style:rt.e}));case Z.ElementControlActionSetFieldValue.$Type.value:var c=e;return Object(Y.e)(t.formRecord,c.filter)?r?i((function(){return n.onSetValue(c,t)})):p.createElement(C.a,{style:rt.d,key:"set",onClick:function(){return n.onSetValue(c,t)}},p.createElement(L.a,{style:rt.e})):p.createElement("div",null);case Z.ElementControlActionOpenPage.$Type.value:return r?i((function(){return n.onOpenPageClick(t,e)})):p.createElement(C.a,{style:rt.d,key:"open",onClick:function(){return n.onOpenPageClick(t,e)}},p.createElement(G.a,{style:rt.e}));case Z.ElementControlActionOpen.$Type.value:return r?i((function(){return n.onOpenClick(t,e)})):p.createElement(C.a,{style:rt.d,key:"open",onClick:function(){return n.onOpenClick(t,e)}},p.createElement(G.a,{style:rt.e}));case Z.ElementControlActionView.$Type.value:return r?i((function(){return n.onViewValue(t)})):p.createElement(C.a,{style:rt.d,key:"view",onClick:function(){return n.onViewValue(t)}},p.createElement(x.a,{style:rt.e}));case Z.ElementControlActionEdit.$Type.value:return r?i((function(){return n.onEditClick(t,e)})):p.createElement(C.a,{style:rt.d,key:"edit",onClick:function(){return n.onEditClick(t,e)}},p.createElement(w.a,{style:rt.e}));case Z.ElementControlActionDelete.$Type.value:return r?i((function(){return n.onDeleteValue(t)})):p.createElement(C.a,{style:rt.d,key:"delete",onClick:function(){return n.onDeleteValue(t)}},p.createElement(S.a,{style:rt.e}));default:throw"Unknown element control action type"}}},{key:"onSetValue",value:function(e,t){}},{key:"onPrintFile",value:function(e,t){this.props.dispatch(Te(e,t))}},{key:"onDownloadFile",value:function(e,t){this.props.dispatch(function(e,t){return function(n,r){return Object(m.l)(t.formRecord.entity.values[e.fileField.value]).flatMap((function(e){return Object(m.g)(e.value.files)})).map((function(e){r().auth.token.map((function(t){return Object(be.b)(e,t,r().config.cdnAddress)}))})).getOrElse((function(){n(Object(le.f)(r().i18n.t("Файл отсутствует")))}))}}(e,t))}},{key:"onDownloadDocument",value:function(e,t){this.props.dispatch(function(e,t){return function(n,r){return Object(m.l)(t.formRecord).flatMap((function(t){return Object(m.l)(t.entity.values[e.documentField.value]).map((function(e){return Object(m.g)(Object(h.f)(r().fields,t.entity.formId).getOrElse((function(){return[]})).filter((function(t){return t.id.value===e.formFieldId.value})).filter((function(e){return e.entity.valueType.tpe.value===Z.ValueTypeObjectRefs.$Type.value&&e.entity.valueType.tag.map((function(e){return e.tpe.value===Z.ValueTagDocumentRecordRefs.$Type.value})).getOrElse((function(){return!1}))}))).foreach((function(t){Object(m.g)(e.value.id).foreach((function(e){Object(ue.g)(t.entity.valueType.family,e).then((function(e){Object(m.g)(Object(h.f)(r().fields,t.entity.valueType.family).getOrElse((function(){return[]})).filter((function(e){return e.entity.valueType.tag.map((function(e){return e.tpe.value===Z.ValueTagPdf.$Type.value})).getOrElse((function(){return!1}))}))).foreach((function(t){Object(m.l)(e.record.entity.values[t.id.value]).foreach((function(e){Object(m.g)(e.value.files.reverse()).foreach((function(e){r().auth.token.map((function(t){return Object(be.b)(e,t,r().config.cdnAddress)}))}))}))}))}))}))}))}))}))}}(e,t))}},{key:"onIssueDocument",value:function(e,t){var n=this,r=this.props.openDialog(this.props.i18n.t("Генерация документа"),p.createElement(st,{formRecord:t.formRecord}),[p.createElement(I.a,{variant:"contained",key:"close",onClick:function(e){return n.props.handleDialogClose(r)}},this.props.i18n.t("Закрыть"))])}},{key:"onSearchValueChanged",value:function(e){this.setState(oe()(this.state,{searchValue:{$set:e.target.value}}))}},{key:"getFilteredValue",value:function(e,t){return Object(m.g)(this.props.objRefFormFields.getOrElse((function(){return[]})).filter((function(e){return e.id.value===t.value}))).map((function(e){return e.entity.valueType.tpe.value})).matchWith((function(t){switch(t){case Z.ValueTypeStr.$Type.value:return new Z.ValueStr(e);case Z.ValueTypeValuesList.$Type.value:return new Z.ValueList(e.split(",").map((function(e){return new Z.ValueStr(e.trim())})));default:return new Z.ValueStr(e)}}),(function(){return new Z.ValueStr(e)}))}},{key:"onSearchRecords",value:function(){var e=this,t=this.props.control.searchSettings.filter((function(t){return!!e.state.searchValue&&t.enabled})).map((function(t){return new Z.FilterCondition(t.field,new Z.FilterExpressionContains,e.getFilteredValue(e.state.searchValue,t.field))}));this.setState(oe()(this.state,{currentPage:{$set:0},markedFormRecords:{$set:[]}}),(function(){return e.fetchFormRecords(t)}))}},{key:"openAssignBarcodeDialog",value:function(e,t){var n=this,r=this.props.openDialog(this.props.i18n.t("Значение штрихкода"),p.createElement(Ae.a,{onChange:e,onSave:t,withRemoveOldValue:!1}),[p.createElement(I.a,{key:"close",variant:"contained",style:{marginRight:"5px"},onClick:function(){return n.props.handleDialogClose(r)}},this.props.i18n.t("Отмена")),p.createElement(I.a,{key:"save",variant:"contained",color:"primary",onClick:t},this.props.i18n.t("Сохранить"))]);return r}},{key:"onAssignBarcodes",value:function(e,t){var n=this,r="",o=this.openAssignBarcodeDialog((function(e,t){r=e,t}),(function(){Object(Le.a)(t.id,[new Z.AssignBarcode(new Z.BarcodeId(""),r)],e.removeOldCodes).then((function(){n.props.handleDialogClose(o),n.props.dispatch(Object(le.f)(n.props.i18n.t("Код успешно присвоен")))})).catch((function(e){n.props.dispatch(Object(Be.b)(e))}))}))}},{key:"isTemplate",value:function(e){return e.includes("$id")}},{key:"getFormattedValues",value:function(e){var t=this,n=e.formRecord,r=this.props.dispatch(Object(We.c)(this.props.objRefFormId)).getOrElse((function(){return[]}));return e.values.map((function(e){return t.isTemplate(e)?e.replace(/\[\[\$id\d+\]\]/gi,(function(e){return Object(m.j)(n.entity.values,Object(m.g)(r.filter((function(t){return t.entity.internalId.value.toString()===e.slice("[[$id".length,-2)}))).map((function(e){return e.id.value})).getOrElse((function(){return""}))).map((function(e){return e.value.toString()})).getOrElse((function(){return""}))})):e}))}},{key:"render",value:function(){var e=this,t=(this.props.error,this.props.objRefFormFields.getOrElse((function(){return[]}))),n=(Object(m.g)(t.filter((function(e){return e.entity.valueType.tag.map((function(e){return e.tpe.value===Z.ValueTagSimpleDictionaryPosition.$Type.value})).getOrElse((function(){return!1}))}))),this.props.control.displayFields.map((function(e,t){return{id:t.toString(),title:e.caption}}))),r=this.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof ee.O})).slice(0,this.state.rowPerPage),o=this.props.control.searchSettings.map((function(e){return e.enabled})).getOrElse((function(){return!1})),i=Object(m.g)(Object(E.a)(this.props.control.displayFields.map((function(e,t){return e.sort.enabled?t:void 0})).filter((function(e){return void 0!==e})))).getOrElse((function(){return-1})),c=this.props.control.displayFields.reduce((function(e,t,n){return Object.assign(Object.assign({},e),y()({},n,!t.sort.enabled||t.sort.value.map((function(e){return e.tpe.value===Z.SortOrderAsc.$Type.value})).getOrElse((function(){return!0}))))}),{}),a=this.props.control.formDataRefOperations,u=a.addingExisting,s=a.addingNew,l=a.massEdit;return p.createElement("div",null,p.createElement(ae.b,{leftButtonGroup:[].concat(g()(u?[p.createElement(I.a,{key:"add",variant:"contained",size:"small",onClick:this.onAddClick,style:{marginRight:"5px"}},this.props.i18n.t("Добавить"))]:[]),g()(s?[p.createElement(I.a,{key:"create",variant:"contained",size:"small",onClick:this.onCreateClick,style:{marginRight:"5px"}},this.props.i18n.t("Создать"))]:[]),g()(l?[p.createElement(I.a,{key:"edit",variant:"contained",size:"small",onClick:this.onMassEditRequested,style:{marginRight:"5px"}},0===this.state.markedFormRecords.length?this.props.i18n.t("Редактирование (все)"):this.props.i18n.t("Редактирование (выбранные)"))]:[]),g()(this.props.control.exportEnabled?[p.createElement(I.a,{key:"export",variant:"contained",size:"small",onClick:this.onOpenExports,style:{marginRight:"5px"}},this.props.i18n.t("Экспорт"))]:[]))}),o&&p.createElement("form",{onSubmit:function(t){t.preventDefault(),e.onSearchRecords()},style:{marginBottom:"22px"}},p.createElement(P.a,{style:{boxSizing:"border-box",paddingRight:14},variant:"outlined",fullWidth:!0,color:"primary",value:this.state.searchValue,placeholder:this.props.i18n.t("Поиск"),onChange:this.onSearchValueChanged,InputProps:{startAdornment:p.createElement(dt.a,{position:"start"},p.createElement(M.a,{style:{fill:"#BDBDBD"}}))}})),p.createElement(J.a,{showId:!1,error:new m.b,onSelectAll:this.props.control.formDataRefOperations.massEdit?this.onSelectAll:void 0,onRecordMarked:this.props.control.formDataRefOperations.massEdit?this.onRecordMarked:void 0,onRecordSelected:this.onRecordSelected,markedRecords:this.state.markedFormRecords.map((function(e){return e.value})),fetching:this.props.displayValuesFetching.getOrElse((function(){return!1})),empty:this.props.displayValues.isEmpty(),withActions:!0,headers:(this.props.control.orderNumberEnabled?[{id:"0",title:"№"}]:[]).concat(n),columnStyles:this.props.control.displayFields.map((function(e){return{flex:e.columnWidth}})),columnIndexSort:i,columnOrderAsc:c,rows:r.map((function(t,n){var r=t.formRecord.entity.attributes.status.tpe.value===Z.FormDataStatusDeleted.$Type.value||t.formRecord.entity.attributes.status.tpe.value===Z.FormDataStatusNominalDeleted.$Type.value;return{payload:t.id.value,id:t.id.value,deleted:r,fields:(e.props.control.orderNumberEnabled?[(n+e.state.currentPage*e.state.rowPerPage+1).toString()]:[]).concat(e.getFormattedValues(t)),buttons:e.props.control.objRefActions.map((function(n){return e.getActionButton(n,t)}))}}))}),p.createElement(pt.a,{display:this.props.display,error:this.props.error,blockStyle:this.props.blockStyle}),p.createElement(ae.a,{blockTableSearch:this.props.control.searchSettings.map((function(e){return e.enabled})).getOrElse((function(){return!1})),nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.props.total,shouldShowMassActions:!1,massActionsComponents:[],searchValue:this.state.searchValue,onSearchValueChange:this.onSearchValueChanged,onSearchRecords:this.onSearchRecords}))}}]),t}(p.Component);gt=vt([function(e){var t,n=p.createFactory(e);return(t=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),c()(t,[{key:"render",value:function(){return n(Q(this.props))}}]),t}(p.Component)).displayName="WithBlockLangs("+(e.displayName||e.name)+")",t},R.autobind,bt("design:paramtypes",[Object])],gt);var Ot=Object(f.connect)((function(e,t){var n=Object(ne.g)(e.dataOutput,t.blockRendererId,t.output);return{i18n:e.i18n,objRefFormFields:Object(h.f)(e.fields,t.objRefFormId),total:Object(ne.j)(e.dataOutput,t.blockRendererId,t.display.id).getOrElse((function(){return 0})),displayValues:Object(ne.k)(e.dataOutput,t.blockRendererId,t.display.id),value:n.map((function(e){return e.value})).filter((function(e){return e.tpe.value===Z.ValueObjectRefs.$Type.value})),displayValuesFetching:Object(ne.l)(e.dataOutput,t.blockRendererId,t.display.id),error:Object(ne.q)(e.dataOutput,t.blockRendererId,t.display.id),rootBlockRendererId:Object(d.n)(e.blockRendererContext,t.blockRendererId)}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataOutput===t.dataOutput&&e.fields.list===t.fields.list&&e.filtersForm===t.filtersForm&&e.blockRendererContext===t.blockRendererContext},areStatePropsEqual:function(e,t){return Object(m.h)(e.objRefFormFields,t.objRefFormFields)&&Object(m.h)(e.displayValues,t.displayValues)&&Object(m.h)(e.value,t.value)&&Object(m.h)(e.displayValuesFetching,t.displayValuesFetching)&&Object(m.h)(e.error,t.error)&&Object(m.h)(e.rootBlockRendererId,t.rootBlockRendererId)&&e.i18n===t.i18n}})(Object(Xe.a)(Object(lt.a)(gt))),yt=n(41),jt=n(140),kt=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),c()(t,[{key:"renderDisplayControl",value:function(){return this.renderEditControl()}},{key:"renderEditControl",value:function(){var e=this;return p.createElement(yt.a,{display:this.props.display,blockStyle:this.props.blockStyle},this.props.display.dataInput.map((function(t){return e.props.objRefFormId.map((function(n){return p.createElement(Ot,{display:e.props.display,blockRendererId:e.props.blockRendererId,blockId:e.props.blockId,objRefFormId:n,control:e.props.control,input:t,output:e.props.output,formId:e.props.formId,parentRecordId:e.props.parentRecordId,getBlockComponent:e.props.getBlockComponent,onChange:e.props.onChange,blockStyle:e.props.blockStyle})})).getOrElse((function(){return p.createElement("div",null,e.props.i18n.t("Форма не найдена"))}))})).getOrElse((function(){return p.createElement("div",null,e.props.i18n.t("Не задано поле поставщик данных"))})))}},{key:"renderEditByClickControl",value:function(){return p.createElement("div",null,this.props.i18n.t("Компонент для редактирования по клику не задан"))}}]),t}(v.a),Rt=function(e){e.parentRecordId.foreach((function(t){e.dispatch(Object(jt.e)(e.blockRendererId,e.formId,e.control,e.display,t))}))};t.default=Object(f.connect)((function(e,t){return{i18n:e.i18n,objRefFormId:Object(h.e)(e,t.formId,t.output.formField).map((function(e){return e.entity.valueType.family})),initialValues:Object(d.j)(e.blockRendererContext,t.blockRendererId)}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.fields.list===t.fields.list&&e.i18n===t.i18n&&e.dataOutput===t.dataOutput},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&Object(m.h)(e.objRefFormId,t.objRefFormId)},areOwnPropsEqual:function(e,t){return e.blockRendererId===t.blockRendererId&&e.formId.value===t.formId.value&&e.blockId.value===t.blockId.value&&e.display===t.display&&e.blockType===t.blockType&&e.control===t.control&&Object(m.h)(e.parentRecordId,e.parentRecordId)&&Object(m.h)(e.blockStyle,e.blockStyle)}})(Object(Qe.a)([Rt],[function(e,t){Object(m.h)(e.initialValues,t.initialValues)||Rt(e),Object(m.h)(e.initialValues,t.initialValues)&&e.isTokenChecked&&!t.isTokenChecked&&Rt(e)}],[],[],(function(e,t){return!function(e,t){return e.formId.value===t.formId.value&&Object(m.h)(e.blockStyle,t.blockStyle)&&e.display===t.display&&e.blockType.tpe.value===t.blockType.tpe.value&&e.blockRendererId===t.blockRendererId&&e.blockStyle===t.blockStyle&&e.output===t.output&&e.onChange===t.onChange&&e.onControlBlur===t.onControlBlur}(e,t)&&e.i18n!==t.i18n}))(kt))}}]);