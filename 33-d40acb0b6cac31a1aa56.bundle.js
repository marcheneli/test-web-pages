(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[33],{1470:function(e,t,n){"use strict";n.d(t,"c",function(){return a}),n.d(t,"a",function(){return o}),n.d(t,"b",function(){return s});var r=n(623),i=n(109),a=function(e){return function(t,n){return n().auth.token.foreach(function(t){Object(r.b)(e,t,n().config.cdnAddress)})}},o=function(e){return function(t,n){return Object(i.a)(n().auth,e,n().config.cdnAddress)}},s=function(e){return function(t){return e.settings.ui.defaultImg.map(function(e){return t(o(e)).getOrElse(function(){return n(622)})})}}},1477:function(e,t,n){"use strict";var r=n(17),i=n(21),a=n(6),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(18),d=function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","Create",{document:e}))}return p()(t,e),t}(u.a),f=function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","Update",{document:e}))}return p()(t,e),t}(u.a),m=function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","Delete",{id:e}))}return p()(t,e),t}(u.a),h=function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","List",{form:e}))}return p()(t,e),t}(u.a),g=function(e){function t(e,n){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","ListFormData",{formId:e,formDataId:n}))}return p()(t,e),t}(u.a),y=function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Documents","ListIds",{ids:e}))}return p()(t,e),t}(u.a),v=n(193);n.d(t,"c",function(){return b}),n.d(t,"d",function(){return O}),n.d(t,"e",function(){return E}),n.d(t,"f",function(){return I}),n.d(t,"a",function(){return C}),n.d(t,"b",function(){return T});var b=function(e){return function(t){return t(Object(v.q)(e)),r.a.send(new h(e),Object(i.g)()).then(function(n){return t(Object(v.r)({formId:e,documents:n.list})),n}).catch(function(n){throw t(Object(v.p)({formId:e,error:n})),n})}},O=function(e){return function(t){return t(Object(v.k)()),r.a.send(new y(e),Object(i.g)()).then(function(e){return t(Object(v.l)(e.list)),e}).catch(function(e){throw t(Object(v.j)(e)),e})}},E=function(e,t){return function(n){return n(Object(v.n)(t)),r.a.send(new g(e,t),Object(i.g)()).then(function(e){return n(Object(v.o)({formDataId:t,documents:e.list})),e}).catch(function(e){throw n(Object(v.m)({formDataId:t,error:e})),e})}},I=function(e){return r.a.send(new f(e),Object(i.f)())},C=function(e){return r.a.send(new d(e),Object(i.f)())},T=function(e){return r.a.send(new m(e),Object(i.f)())}},1487:function(e,t,n){"use strict";var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(4),d=n.n(u),f=n(2),m=n(24),h=n.n(m),g=n(38),y=n.n(g),v=n(1),b=n(46),O=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};function E(e){var t=e.selected?d()({},function(e){if(!e.tabsPosition)return"borderRight";switch(e.tabsPosition.tpe.value){case v.TabsPositionLeft.$Type.value:return"borderRight";case v.TabsPositionRight.$Type.value:return"borderLeft";default:return"borderRight"}}(e),"2px solid"):{};return{root:Object.assign({},t)}}var I=function(e){function t(){i()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.handleClick=function(t){t.preventDefault(),t.stopPropagation(),e.props.onClick&&e.props.onClick(e.props.value,t,e)},e.getColorByMuiTheme=function(e){var t=e.flatMap(function(e){return e.color}).getOrElse(function(){return"primary"}),n=e.flatMap(function(e){return e.palette}),r=e.flatMap(function(e){return e.selectable});switch(t){case"secondary":return[{color:n.map(function(e){return e.secondaryColor}).getOrElse(function(){return b.c})},{color:b.b}];case"custom":return[{color:r.map(function(e){return e.afterSelect}).getOrElse(function(){return b.a})},{color:r.map(function(e){return e.beforeSelect}).getOrElse(function(){return b.c})}];case"primary":default:return[{color:n.map(function(e){return e.primaryColor}).getOrElse(function(){return b.a})},{color:b.b}]}},e}return p()(t,e),o()(t,[{key:"render",value:function(){var e=this.props,t=e.icon,n=(e.index,e.onActive,e.onClick,e.selected),r=e.label,i=e.buttonStyle,a=e.style,o=(e.value,e.width,e.classes),s=(e.tabsPosition,e.elementMuiTheme),l=O(e,["icon","index","onActive","onClick","selected","label","buttonStyle","style","value","width","classes","tabsPosition","elementMuiTheme"]),c=E(this.props),p=void 0;if(t&&f.isValidElement(t)&&(p=f.cloneElement(t,{style:{fontSize:24,color:t.props&&t.props.style&&t.props.style.color?t.props.style.color:"#fff",marginBottom:r?5:0}})),s){var u=this.getColorByMuiTheme(s),d=n?u[0]:u[1];return f.createElement(h.a,Object.assign({},l,{style:Object.assign(c.root,a,d),onClick:this.handleClick}),f.createElement("div",{style:Object.assign({},i,d)},p,r))}return f.createElement(h.a,Object.assign({},l,{style:Object.assign(c.root,a),onClick:this.handleClick}),f.createElement("div",{style:i,className:n?o.root:o.default},p,r))}}]),t}(f.Component);I.muiName="Tab",I.propTypes={},I.contextTypes={},t.a=y()(function(e){return{default:{color:e.palette.text.secondary},root:{color:e.palette.primary.main}}})(I)},1488:function(e,t,n){"use strict";var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(4),d=n.n(u),f=n(2),m=n(62),h=n.n(m),g=n(1),y=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};function v(e){if(!e.tabsPosition)return"borderRight";switch(e.tabsPosition.tpe.value){case g.TabsPositionLeft.$Type.value:return"borderRight";case g.TabsPositionRight.$Type.value:return"borderLeft";default:return"borderRight"}}var b=function(e){function t(){i()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state={selectedIndex:0},e.handleTabClick=function(t,n,r){n.preventDefault();var i=e.getValueLink(e.props),a=r.props.index;(i.value&&i.value!==t||e.state.selectedIndex!==a)&&i.requestChange(t,n,r),e.setState({selectedIndex:a}),r.props.onActive&&r.props.onActive(r)},e}return p()(t,e),o()(t,[{key:"componentWillMount",value:function(){var e=this.getValueLink(this.props),t=this.props.initialSelectedIndex||0;this.setState({selectedIndex:void 0!==e.value?this.getSelectedIndex(this.props):t<this.getTabCount()?t:0})}},{key:"componentWillReceiveProps",value:function(e,t){}},{key:"getTabs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=[];return f.Children.forEach(e.children,function(e){f.isValidElement(e)&&t.push(e)}),t}},{key:"getTabCount",value:function(){return this.getTabs().length}},{key:"getValueLink",value:function(e){return e.valueLink||{value:e.value,requestChange:e.onChange}}},{key:"getSelectedIndex",value:function(e){var t=this.getValueLink(e),n=-1;return this.getTabs(e).forEach(function(e,r){t.value===e.props.value&&(n=r)}),n}},{key:"getSelected",value:function(e,t){var n=this.getValueLink(this.props);return n.value?n.value===e.props.value:this.state.selectedIndex===t}},{key:"getTabContent",value:function(e,t,n,r){return t.push(e.props.children?f.createElement(n||O,{key:r,selected:this.getSelected(e,r)},e.props.children):void 0)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.contentContainerClassName,i=n.contentContainerStyle,a=(n.initialSelectedIndex,n.onChange,n.style),o=n.tabItemContainerStyle,s=n.tabTemplate,l=n.prerenderTabContainers,c=n.menuTopChildren,p=n.menuBottomChildren,u=(n.tabsPosition,y(n,["contentContainerClassName","contentContainerStyle","initialSelectedIndex","onChange","style","tabItemContainerStyle","tabTemplate","prerenderTabContainers","menuTopChildren","menuBottomChildren","tabsPosition"])),m=(e=this.props,{wrapper:{display:"flex",height:"100%",width:"100%"},tabItemContainer:d()({display:"flex",flexDirection:"column",flex:"0 0 150px",margin:"4px 4px 4px 0"},v(e),"1px solid ".concat(h.a[300])),tabMenuItemContainer:{display:"flex",flexDirection:"column",flex:"0 0 150px",margin:"4px 4px 4px 0"},tabContentContainer:{flex:1,margin:"4px 0 4px 4px"}}),g=(this.getValueLink(this.props).value,[]),b=100/this.getTabCount(),O=this.getTabs().map(function(e,n){return l?t.getTabContent(e,g,s,n):t.getSelected(e,n)&&t.getTabContent(e,g,s,n),f.cloneElement(e,{key:n,index:n,selected:t.getSelected(e,n),width:b+"%",onClick:t.handleTabClick})});return f.createElement("div",Object.assign({style:Object.assign(m.wrapper,a)},u),!this.props.tabItemContainerOnRight&&f.createElement("div",{style:Object.assign(m.tabItemContainer,o)},f.createElement("div",null,c),O,f.createElement("div",null,p)),f.createElement("div",{style:Object.assign(m.tabContentContainer,i),className:r},g),this.props.tabItemContainerOnRight&&f.createElement("div",{style:Object.assign(m.tabItemContainer,o)},f.createElement("div",null,c),O,f.createElement("div",null,p)))}}]),t}(f.Component);b.defaultProps={initialSelectedIndex:0,onChange:function(){}},b.contextTypes={};var O=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.selected,r=e.style,i=Object.assign({},r,{display:"flex",height:"100%"});return n||(i.height=0,i.overflow="hidden"),f.createElement("div",{style:i},t)}}]),t}(f.PureComponent);t.a=b},1491:function(e,t,n){"use strict";var r=n(21),i=(n(221),n(6)),a=n.n(i),o=n(7),s=n.n(o),l=n(8),c=n.n(l),p=n(18),u=(function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","List",{form:e}))}c()(t,e)}(p.a),function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","ListDescriptions",{form:e}))}return c()(t,e),t}(p.a)),d=(function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","ListEventLineDescriptions",{id:e}))}c()(t,e)}(p.a),function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","ListEventLine",{id:e}))}c()(t,e)}(p.a),function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Create",{pipeline:e}))}return c()(t,e),t}(p.a)),f=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Update",{pipeline:e}))}return c()(t,e),t}(p.a),m=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Request",{id:e}))}return c()(t,e),t}(p.a),h=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Delete",{id:e}))}return c()(t,e),t}(p.a),g=n(17),y=n(644),v=n(82),b=n(428);n.d(t,"a",function(){return O}),n.d(t,"h",function(){return E}),n.d(t,"b",function(){return I}),n.d(t,"e",function(){return C}),n.d(t,"c",function(){return T}),n.d(t,"d",function(){return k}),n.d(t,"g",function(){return w}),n.d(t,"f",function(){return j});var O=function(e){return g.a.send(new d(e),Object(r.f)())},E=function(e){return g.a.send(new f(e),Object(r.f)())},I=function(e){return g.a.send(new h(e),Object(r.f)())},C=function(e){return g.a.send(new m(e),Object(r.e)())},T=function(e){return function(t){return t(Object(b.e)()),g.a.send(new m(e),Object(r.e)()).then(function(e){return t(Object(b.f)(e.record)),e}).catch(function(e){throw t(Object(b.d)(e)),e})}},k=function(e){return g.a.send(new u(e),function(e){return e})},w=function(e,t,n){var r=new FormData;return r.append("file",e),r.append("config",n),y.b(r,v.default.server_address+"/api/app/files/import",t,function(e){return e})},j=function(e,t,n){var r=new FormData;return r.append("file",e),y.b(r,v.default.server_address+"/api/app/files/import/"+n.value,t,function(e){return e})}},1492:function(e,t,n){"use strict";n.d(t,"e",function(){return l}),n.d(t,"b",function(){return d}),n.d(t,"c",function(){return g}),n.d(t,"a",function(){return y}),n.d(t,"d",function(){return v});var r,i=n(1),a=n(142),o=n(143),s=n(0),l=function(e,t){return t.map(function(t){return t instanceof i.FilterCondition?c(e,t):p(e,t)}).getOrElse(function(){return!0})},c=function(e,t){return Object(s.toOption)(e.entity.values[t.field.value]).map(function(e){return e.value}).map(function(e){return f(e,t.value,t.expression)}).getOrElse(function(){return!0})},p=function e(t,n){return 0===n.conditions.length||n.conditions.map(function(n){return n instanceof i.FilterCondition?c(t,n):e(t,n)}).reduce(function(e,t){return u(e,t,n.predicate)})},u=function(e,t,n){return n.tpe.value===i.FilterPredicateAnd.$Type.value?e&&t:e||t},d=function(e){switch(e.tpe){case i.ValueStr.$Type:var t=e.value;return""!==t&&void 0!==t;case i.ValueObjectRefs.$Type:return e.id.length>0;case i.ValueList.$Type:return e.values.length>0;case i.ValueFileList.$Type:return e.files.length>0;case i.ValueNumber.$Type:case i.ValueBool.$Type:return void 0!==e.value;default:return!0}},f=function(e,t,n){var r=e.tpe.value===i.ValueObjectRefs.$Type.value,s=!isNaN(parseInt(t.toString(),10));switch(n.tpe.value){case i.FilterExpressionEq.$Type.value:return r?m(e,t,a.a):e.toString()===t.toString();case i.FilterExpressionNotEq.$Type.value:return r?!m(e,t,a.a):e.toString()!==t.toString();case i.FilterExpressionContains.$Type.value:return r?m(e,t,o.a,!0):e.toString().includes(t.toString());case i.FilterExpressionGt.$Type.value:return e.toString().length>(s?parseInt(t.toString(),10):t.toString().length);case i.FilterExpressionLt.$Type.value:return e.toString().length<(s?parseInt(t.toString(),10):t.toString().length);case i.FilterExpressionMissing.$Type.value:case i.FilterExpressionPresent.$Type.value:return d(e);default:return!0}},m=function(e,t,n,r){var i=e.id.map(function(e){return e.value});return Object(s.headOption)(t.id.map(function(e){return e.value})).map(function(e){return n(i,r?e:[e])}).getOrElse(function(){return!0})};!function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(r||(r={}));var h=function(e,t,n,a){var l=a.flatMap(function(e){return Object(s.headOption)(e.entity.permissions.filter(function(e){return e.operation instanceof i.PermissionOperationFormProperties&&e.operation.formId.value===t.map(function(e){return e.value}).getOrElse(function(){return""})}))}).map(function(e){var t=e.operation.restricted.fields;switch(n){case r.view:return t.view;case r.edit:return t.edit;default:return[]}}).getOrElse(function(){return[]}).map(function(e){return e.value});return e.filter(function(e){return!Object(o.a)(l,e.value)})},g=function(e,t,n){return e.map(function(e){return h([e],t,r.view,n).length>0})},y=function(e,t,n){return e.map(function(e){return h([e],t,r.edit,n).length>0})},v=function(e,t,n){return h(e,t,r.view,n)}},1493:function(e,t,n){"use strict";var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(11),d=n.n(u),f=n(2),m=n(13),h=n(3),g=n(1620),y=n.n(g),v=n(1621),b=n.n(v),O=n(1622),E=n.n(O),I=n(93),C=n.n(I),T=n(24),k=n.n(T),w=n(38),j=n.n(w),F=n(163),D=n.n(F),R=n(548),P=n.n(R),x=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},S=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n},$=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={suggestions:[]},n}return p()(t,e),o()(t,[{key:"escapeRegexCharacters",value:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},{key:"getSuggestionsOnFocus",value:function(e){var t=this.escapeRegexCharacters(e.trim()),n=new RegExp("^"+t,"i");return this.props.suggestions.filter(function(e){return n.test(e)})}},{key:"getSuggestions",value:function(e){var t=e.trim().toLowerCase(),n=t.length,r=0;return 0===n?[]:this.props.suggestions.filter(function(e){var i=r<5&&e.toLowerCase().slice(0,n)===t;return i&&(r+=1),i})}},{key:"handleSuggestionsFetchRequested",value:function(e){var t=e.value;this.setState(h(this.state,{suggestions:{$set:this.props.showSuggestionsOnFocus?this.getSuggestionsOnFocus(t):this.getSuggestions(t)}}))}},{key:"handleSuggestionsClearRequested",value:function(){this.setState(h(this.state,{suggestions:{$set:[]}}))}},{key:"renderInput",value:function(e){e.classes,e.ref;var t=_(e,["classes","ref"]);return f.Children.map(this.props.children,function(e){return f.cloneElement(e,Object.assign({},t,{inputProps:Object.assign({},t)}))})}},{key:"shouldRenderSuggestions",value:function(){return!0}},{key:"renderSuggestion",value:function(e,t){var n=t.query,r=t.isHighlighted,i=b()(e,n),a=E()(e,i);return f.createElement(k.a,{selected:r,component:"div"},f.createElement("div",null,a.map(function(e,t){return e.highlight?f.createElement("span",{key:String(t),style:{fontWeight:500}},e.text):f.createElement("strong",{key:String(t),style:{fontWeight:300}},e.text)})))}},{key:"getSuggestionValue",value:function(e){return e}},{key:"render",value:function(){var e=this,t=this.props.classes,n={suggestions:this.state.suggestions,onSuggestionsFetchRequested:this.handleSuggestionsFetchRequested,onSuggestionsClearRequested:this.handleSuggestionsClearRequested,getSuggestionValue:this.getSuggestionValue,renderSuggestion:this.renderSuggestion};return f.createElement(y.a,Object.assign({},n,{inputProps:{classes:t,placeholder:"",value:this.props.value,onChange:function(t,n){var r=n.newValue;return e.props.onChange(r)},onBlur:this.props.onBlur,inputRef:function(t){return e.popperNode=t},InputLabelProps:{shrink:!0}},shouldRenderSuggestions:this.shouldRenderSuggestions,renderInputComponent:this.renderInput,theme:{suggestionsList:t.suggestionsList,suggestion:t.suggestion},renderSuggestionsContainer:function(t){return f.createElement(P.a,{anchorEl:e.popperNode,open:Boolean(t.children),style:{zIndex:5e3}},f.createElement(C.a,Object.assign({square:!0},t.containerProps,{style:{width:e.popperNode?e.popperNode.clientWidth:null}}),t.children))}}))}}]),t}(f.Component);$=x([m.autobind,S("design:paramtypes",[Object])],$),t.a=j()(function(e){return D()({root:{height:250,flexGrow:1},container:{position:"relative"},suggestionsContainerOpen:{position:"absolute",zIndex:1,marginTop:e.spacing.unit,left:0,right:0},suggestion:{display:"block"},suggestionsList:{margin:0,padding:0,listStyleType:"none"},divider:{height:2*e.spacing.unit}})})($)},1494:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return l});var r=n(221),i=n(1491),a=n(87),o=function(e){return function(t,n){return t(Object(r.k)(e)),i.d(e).then(function(n){return t(Object(r.l)({form:e,result:n})),n}).catch(function(n){throw t(Object(r.j)({form:e,error:n})),n})}},s=function(e){return function(t,n){return t(Object(a.b)(function(e){return!e.importPipelines.descriptionsFetching&&e.importPipelines.descriptionsFetching},o(e)))}},l=function(e){return function(t,n){return t(Object(a.b)(function(e){return!e.importPipelines.eventLineDescriptionsFetching&&e.importPipelines.eventLineDescriptionsFetching},function(e){return function(t,n){return t(Object(r.n)(e)),i.d(e).then(function(n){return t(Object(r.o)({eventLineId:e,result:n})),n}).catch(function(n){throw t(Object(r.m)({eventLineId:e,error:n})),n})}}(e)))}}},1509:function(e,t,n){"use strict";n(244);var r=n(17),i=n(6),a=n.n(i),o=n(7),s=n.n(o),l=n(8),c=n.n(l),p=n(18),u=(function(e){function t(){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","List",{}))}c()(t,e)}(p.a),function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListForm",{formId:e}))}c()(t,e)}(p.a),function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListFormDescriptions",{formId:e}))}return c()(t,e),t}(p.a)),d=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Update",{config:e}))}return c()(t,e),t}(p.a),f=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Create",{config:e}))}return c()(t,e),t}(p.a),m=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Delete",{configId:e}))}return c()(t,e),t}(p.a),h=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Request",{configId:e}))}return c()(t,e),t}(p.a),g=n(21);n.d(t,"c",function(){return y}),n.d(t,"e",function(){return v}),n.d(t,"d",function(){return b}),n.d(t,"a",function(){return O}),n.d(t,"b",function(){return E});var y=function(e){return r.a.send(new u(e),function(e){return e})},v=function(e){return r.a.send(new d(e),Object(g.f)())},b=function(e){return r.a.send(new h(e),Object(g.e)())},O=function(e){return r.a.send(new f(e),Object(g.f)())},E=function(e){return r.a.send(new m(e),g.d)}},1510:function(e,t,n){"use strict";n.d(t,"e",function(){return p}),n.d(t,"c",function(){return u}),n.d(t,"b",function(){return d}),n.d(t,"f",function(){return f}),n.d(t,"d",function(){return m}),n.d(t,"a",function(){return h});var r=n(6),i=n.n(r),a=n(7),o=n.n(a),s=n(8),l=n.n(s),c=n(18),p=function(e){function t(e){return i()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Request",{id:e}))}return l()(t,e),t}(c.a),u=function(e){function t(e){return i()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Delete",{templateId:e}))}return l()(t,e),t}(c.a),d=function(e){function t(e){return i()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Create",{documentTemplate:e}))}return l()(t,e),t}(c.a),f=function(e){function t(e){return i()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Update",{documentTemplate:e}))}return l()(t,e),t}(c.a),m=function(e){function t(e){return i()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","List",{form:e}))}return l()(t,e),t}(c.a),h=function(e){function t(e){return i()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Copy",{documentTemplateId:e}))}return l()(t,e),t}(c.a)},1512:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return s});var r=n(244),i=n(1509),a=n(87),o=function(e){return function(t,n){return t(Object(r.h)({form:e})),i.c(e).then(function(n){return t(Object(r.i)({form:e,resolved:n})),n}).catch(function(n){throw t(Object(r.g)({form:e,error:n})),n})}},s=function(e){return function(t){return t(Object(a.b)(function(e){return!e.exportPipelines.descriptionsFetching&&e.exportPipelines.descriptionsFetching},o(e)))}}},1517:function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return l}),n.d(t,"f",function(){return c}),n.d(t,"c",function(){return p}),n.d(t,"d",function(){return u}),n.d(t,"e",function(){return d});var r=n(21),i=n(1510),a=n(435),o=n(17),s=function(e){return o.a.send(new i.b(e),Object(r.f)())},l=function(e){return o.a.send(new i.a(e),Object(r.f)())},c=function(e){return o.a.send(new i.f(e),Object(r.f)())},p=function(e){return o.a.send(new i.c(e),Object(r.f)())},u=function(e){return o.a.send(new i.e(e),Object(r.e)())},d=function(e){return function(t){return t(Object(a.e)()),o.a.send(new i.d(e),Object(r.g)()).then(function(e){return t(Object(a.f)(e.list)),e}).catch(function(e){throw t(Object(a.d)(e)),e})}}},1518:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(2)),a=(0,r(n(44)).default)(i.default.createElement(i.default.Fragment,null,i.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),i.default.createElement("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})),"RemoveRedEye");t.default=a},1589:function(e,t,n){"use strict";var r=n(17),i=n(6),a=n.n(i),o=n(7),s=n.n(o),l=n(8),c=n.n(l),p=n(18),u=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"SocialConnections","List",{organisationId:e}))}return c()(t,e),t}(p.a),d=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"SocialConnections","Update",{connection:e}))}return c()(t,e),t}(p.a),f=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"SocialConnections","Create",{connection:e}))}return c()(t,e),t}(p.a),m=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"SocialConnections","Delete",{id:e}))}return c()(t,e),t}(p.a),h=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"SocialConnections","XeroConnect",{connectionId:e}))}return c()(t,e),t}(p.a),g=n(21);n.d(t,"d",function(){return y}),n.d(t,"e",function(){return v}),n.d(t,"b",function(){return b}),n.d(t,"c",function(){return O}),n.d(t,"a",function(){return E});var y=function(e){return r.a.send(new u(e),Object(g.g)())},v=function(e){return r.a.send(new d(e),Object(g.f)())},b=function(e){return r.a.send(new f(e),Object(g.c)())},O=function(e){return r.a.send(new m(e),Object(g.d)())},E=function(e){return r.a.send(new h(e),function(e){return e})}},1590:function(e,t,n){"use strict";var r=n(21),i=n(6),a=n.n(i),o=n(7),s=n.n(o),l=n(8),c=n.n(l),p=n(18),u=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","ListByEventLine",{eventLineId:e}))}return c()(t,e),t}(p.a),d=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Create",{generator:e}))}return c()(t,e),t}(p.a),f=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Update",{generator:e}))}return c()(t,e),t}(p.a),m=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Delete",{generatorId:e}))}return c()(t,e),t}(p.a),h=n(17),g=n(440);n.d(t,"a",function(){return y}),n.d(t,"d",function(){return v}),n.d(t,"b",function(){return b}),n.d(t,"c",function(){return O});var y=function(e){return h.a.send(new d(e),Object(r.c)())},v=function(e){return h.a.send(new f(e),Object(r.f)())},b=function(e){return h.a.send(new m(e),Object(r.d)())},O=function(e){return function(t){return t(Object(g.e)()),h.a.send(new u(e),Object(r.g)()).then(function(e){return t(Object(g.f)(e.list)),e}).catch(function(e){throw t(Object(g.d)(e)),e})}}},1597:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(2)),a=(0,r(n(44)).default)(i.default.createElement(i.default.Fragment,null,i.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),i.default.createElement("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"})),"CloudDownload");t.default=a},1599:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o});var r=n(446),i=n(1589),a=function(e){return function(t,n){return n().socialConnections.fetched?new Promise(function(e,t){e(n().socialConnections.list)}):t(o(e))}},o=function(e){return function(t,n){return t(Object(r.e)()),i.d(e).then(function(e){return t(Object(r.f)(e.list)),e.list}).catch(function(e){throw t(Object(r.d)(e)),e})}}},1615:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(2)),a=(0,r(n(44)).default)(i.default.createElement(i.default.Fragment,null,i.default.createElement("path",{d:"M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"}),i.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"})),"FilterList");t.default=a},1616:function(e,t,n){"use strict";var r=n(2),i=n(94),a=n.n(i);t.a=function(e){return r.createElement(a.a,Object.assign({},e),r.createElement("path",{d:"M3,2H21V2H21V4H20.92L14,10.92V22.91L10,18.91V10.91L3.09,4H3V2Z"}))}},1804:function(e,t,n){"use strict";var r=n(2),i=n(94),a=n.n(i);t.a=function(e){return r.createElement(a.a,Object.assign({},e),r.createElement("path",{d:"M3,2H21V2H21V4H20.92L15,9.92V22.91L9,16.91V9.91L3.09,4H3V2M11,16.08L13,18.08V9H13.09L18.09,4H5.92L10.92,9H11V16.08Z"}))}},1806:function(e,t,n){"use strict";var r=n(448),i=n(17),a=n(6),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(18),d=function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","List",{pipelineId:e}))}return p()(t,e),t}(u.a),f=(function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Update",{operation:e}))}p()(t,e)}(u.a),function(e){function t(e,n){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Execute",{pipelineId:e,filter:n}))}return p()(t,e),t}(u.a)),m=(function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Delete",{operationId:e}))}p()(t,e)}(u.a),function(e){function t(e,n,r){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","ExecuteParent",{pipelineId:e,formDataList:n,refFieldId:r}))}return p()(t,e),t}(u.a)),h=n(21);n.d(t,"c",function(){return g}),n.d(t,"a",function(){return y}),n.d(t,"b",function(){return v});var g=function(e){return function(t){return t(Object(r.b)()),i.a.send(new d(e),Object(h.g)()).then(function(e){return t(Object(r.c)(e.list)),e}).catch(function(e){throw t(Object(r.a)(e)),e})}},y=function(e,t){return i.a.send(new f(e,t),Object(h.f)())},v=function(e,t,n){return i.a.send(new m(e,t,n),Object(h.f)())}},1821:function(e,t,n){"use strict";var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(11),d=n.n(u),f=n(2),m=n(59),h=n(14),g=n(13),y=n(115),v=n.n(y),b=n(25),O=n.n(b),E=n(1615),I=n.n(E),C=n(24),T=n.n(C),k=n(19),w=n.n(k),j=n(64),F=n(0),D=n(83),R=n(1827),P=n(105),x=n(174),S=n(104),_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},$=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"onFilterTemplateEditRequest",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Пользовательские фильтры"),f.createElement(R.a,{formId:this.props.formId,showUserFilters:!0,actionsDisabled:!0}),[f.createElement(w.a,{key:"close",variant:"raised",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть"))]);this.props.closePopover()}},{key:"onFilterTemplateChanged",value:function(e){this.props.dispatch(Object(j.k)({filterId:this.props.filterId,filter:e})),this.props.closePopover()}},{key:"handleFiltersLibraryClick",value:function(e){var t=this,n=Object(S.e)(this.props.forms,this.props.formId).map(function(e){return e.entity.filters}).getOrElse(function(){return[]}).map(function(e){return f.createElement(T.a,{key:m.v4(),value:e.name,onClick:function(){return t.onFilterTemplateChanged(e.filter)}},e.name)}),r=this.props.userFilters.filters.filter(function(e){return Object(F.headOption)(e.filter.conditions).flatMap(function(e){return Object(S.e)(t.props.forms,t.props.formId).flatMap(function(n){return t.props.dispatch(Object(x.c)(n.id,e.field))})}).nonEmpty()}).map(function(e){return f.createElement(T.a,{key:m.v4(),value:e.name,onClick:function(){return t.onFilterTemplateChanged(e.filter)}},e.name)});this.props.openPopover(Object(F.toOption)(e.currentTarget),f.createElement(f.Fragment,null,f.createElement(T.a,null,f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Системные"),":")),n,f.createElement(T.a,null,f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Пользовательские"),":")),r,f.createElement(T.a,{onClick:this.onFilterTemplateEditRequest},f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Отредактировать")))))}},{key:"render",value:function(){return f.createElement(v.a,{title:this.props.i18n.t("Библиотека фильтров")},f.createElement(O.a,{onClick:this.handleFiltersLibraryClick},f.createElement(I.a,null)))}}]),t}(f.Component);$=_([g.autobind],$),t.a=Object(h.connect)(function(e,t){return{i18n:e.i18n,userFilters:e.userFilters,forms:e.forms}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.userFilters===t.userFilters&&e.currentForm===t.currentForm}})(Object(P.a)(Object(D.a)($)))},1827:function(e,t,n){"use strict";var r=n(43),i=n.n(r),a=n(6),o=n.n(a),s=n(10),l=n.n(s),c=n(7),p=n.n(c),u=n(8),d=n.n(u),f=n(11),m=n.n(f),h=n(2),g=n(14),y=n(13),v=n(59),b=n(25),O=n.n(b),E=n(19),I=n.n(E),C=n(86),T=n.n(C),k=n(414),w=n.n(k),j=n(415),F=n(216),D=n(1),R=n(104),P=n(137),x=n(46),S=n(95),_=n(0),$=n(161),L=n(26),M=n.n(L),V=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":m()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},N=function(e){function t(){return o()(this,t),p()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d()(t,e),l()(t,[{key:"render",value:function(){var e=this.props.fields.name;return h.createElement("form",null,h.createElement(M.a,{fullWidth:!0,autoFocus:!0,style:{marginBottom:"15px"},value:e.value,onChange:e.onChange,label:this.props.i18n.t("Название"),error:e.touched&&e.error,helperText:e.touched&&Object(_.toOption)(e.error).map(function(e){return e}).getOrNull()}),h.createElement($.a,{formId:this.props.formId,filterId:this.props.fields.filterId.value,initialValue:this.props.fields.filter.value?Object(_.toOption)(this.props.fields.filter.value):new _.None}))}}]),t}(h.Component);N=V([y.autobind],N);var A=Object(g.connect)(function(e){return{i18n:e.i18n}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(S.reduxForm)({form:"newFilterForm",fields:["name","filterId","filter"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение!")),n}})(N)),W=n(176),q=n(23),B=n(71),H=n(83),z=n(633),K=n(277),U=n(174),G=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":m()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Z=function(e){function t(){o()(this,t);var e=p()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.handleKeyDown=function(t){"Insert"===t.key&&e.onCreateRequest()},e}return d()(t,e),l()(t,[{key:"handleSubmit",value:function(e,t,n){var r=this;return new Promise(function(i,a){return e.then(function(e){i(e),r.props.dispatch(Object(B.h)(r.props.i18n.t(("create"===t?"Создание":"Сохранение")+" успешно завершено"))),r.props.dispatch(Object(W.e)()),r.handleClose(n)}).catch(function(e){a(e),r.props.dispatch(Object(B.h)(r.props.i18n.t(("create"===t?"Создание":"Сохранение")+" завершилось ошибкой")))})})}},{key:"openEditForm",value:function(e,t,n){var r=this,i=void 0,a=this.props.openDialog(e,h.createElement(A,{ref:function(e){return i=Object(q.toOption)(e).flatMap(function(e){return Object(q.toOption)(e.wrappedInstance)})},formId:this.props.formId,initialValues:n,onSubmit:t}),[h.createElement(I.a,{onClick:function(){return r.handleClose(a)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(z.a,{variant:"raised",color:"primary",onClick:function(){return i.map(function(e){return e.submit()})},formName:"newFilterForm"},this.props.i18n.t("Сохранить"))]);return a}},{key:"handleClose",value:function(e){this.props.handleDialogClose(e)}},{key:"onCreateRequest",value:function(){var e=this,t=this.openEditForm(this.props.i18n.t("Новый фильтр"),function(n){return e.handleSubmit(Object(P.b)(e.props.filtersForm,n.filterId).flatMap(function(t){return Object(R.e)(e.props.forms,e.props.formId).map(function(e){return Object(W.l)(e.id,[].concat(i()(e.entity.filters),[new D.FilterContainer(n.name,t)]))})}).getOrElse(function(){return new Promise(function(e,t){return t()})}),"create",t)},{filterId:new D.Id(v.v4())})}},{key:"onEditRequest",value:function(e,t){var n=this,r=this.openEditForm(this.props.i18n.t("Редактировать фильтр"),function(e){return n.handleSubmit(Object(P.b)(n.props.filtersForm,e.filterId).flatMap(function(r){return Object(R.e)(n.props.forms,n.props.formId).map(function(n){return Object(W.l)(n.id,[].concat(i()(n.entity.filters.slice(0,t)),[new D.FilterContainer(e.name,r)],i()(n.entity.filters.slice(t+1))))})}).getOrElse(function(){return new Promise(function(e,t){return t()})}),"update",r)},{name:e.name,filterId:new D.Id(v.v4()),filter:e.filter})}},{key:"onUserFilterCreateRequest",value:function(){var e=this,t=this.openEditForm(this.props.i18n.t("Новый фильтр"),function(n){return e.handleSubmit(Object(P.b)(e.props.filtersForm,n.filterId).map(function(t){return e.props.dispatch(Object(K.d)({filter:new D.FilterContainer(n.name,t)})),new Promise(function(e,t){return e()})}).getOrElse(function(){return new Promise(function(e,t){return t()})}),"create",t)},{filterId:new D.Id(v.v4())})}},{key:"onUserFilterEditRequest",value:function(e,t){var n=this,r=this.openEditForm(this.props.i18n.t("Редактировать фильтр"),function(e){return n.handleSubmit(Object(P.b)(n.props.filtersForm,e.filterId).map(function(r){return n.props.dispatch(Object(K.f)({idx:t,filter:new D.FilterContainer(e.name,r)})),new Promise(function(e,t){return e()})}).getOrElse(function(){return new Promise(function(e,t){return t()})}),"update",r)},{name:e.name,filterId:new D.Id(v.v4()),filter:e.filter})}},{key:"onDelete",value:function(e){var t=this;Object(R.e)(this.props.forms,this.props.formId).map(function(n){return Object(W.l)(n.id,[].concat(i()(n.entity.filters.slice(0,e)),i()(n.entity.filters.slice(e+1)))).then(function(e){return t.props.dispatch(Object(W.e)())})})}},{key:"onUserFilterDelete",value:function(e){this.props.dispatch(Object(K.e)(e))}},{key:"renderContents",value:function(){var e=this;if(this.props.showSystemFilters){var t=Object(R.e)(this.props.forms,this.props.formId).map(function(e){return e.entity.filters}).getOrElse(function(){return[]});return h.createElement(h.Fragment,null,h.createElement(F.b,null,h.createElement(I.a,{variant:"raised",onClick:this.onCreateRequest,color:"primary",disabled:this.props.actionsDisabled},this.props.i18n.t("Создать"))),h.createElement(j.a,{showId:!0,withActions:!0,error:this.props.forms.error,onRecordSelected:this.props.actionsDisabled?function(){}:this.onEditRequest,fetching:this.props.forms.fetching,empty:0===t.length,headers:[{id:"filterName",title:this.props.i18n.t("Название")}],rows:t.map(function(t,n){return{id:n.toString(),payload:t,fields:[t.name],buttons:[h.createElement(O.a,{disabled:e.props.actionsDisabled,style:x.f,key:"edit",onClick:function(r){r.stopPropagation(),e.onEditRequest(t,n)}},h.createElement(T.a,{style:x.g})),h.createElement(O.a,{disabled:e.props.actionsDisabled,style:x.f,key:"delete",onClick:function(t){t.stopPropagation(),e.onDelete(n)}},h.createElement(w.a,{style:x.g}))]}})}))}if(this.props.showUserFilters){var n=this.props.userFilters.filters.filter(function(t){return Object(q.headOption)(t.filter.conditions).flatMap(function(t){return Object(R.e)(e.props.forms,e.props.formId).flatMap(function(n){return e.props.dispatch(Object(U.c)(n.id,t.field))})}).nonEmpty()});return h.createElement(h.Fragment,null,h.createElement(F.b,null,h.createElement(I.a,{variant:"raised",onClick:this.onUserFilterCreateRequest,color:"primary"},this.props.i18n.t("Создать"))),h.createElement(j.a,{showId:!0,withActions:!0,error:new q.None,onRecordSelected:this.onUserFilterEditRequest,fetching:!1,empty:0===n.length,headers:[{id:"filterName",title:this.props.i18n.t("Название")}],rows:n.map(function(t,n){return{id:n.toString(),payload:t,fields:[t.name],buttons:[h.createElement(O.a,{style:x.f,key:"edit",onClick:function(r){r.stopPropagation(),e.onUserFilterEditRequest(t,n)}},h.createElement(T.a,{style:x.g})),h.createElement(O.a,{style:x.f,key:"delete",onClick:function(t){t.stopPropagation(),e.onUserFilterDelete(n)}},h.createElement(w.a,{style:x.g}))]}})}))}}},{key:"render",value:function(){return h.createElement("div",{onKeyDown:this.handleKeyDown,style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},this.renderContents())}}]),t}(h.Component);Z=G([y.autobind],Z);t.a=Object(g.connect)(function(e){return{i18n:e.i18n,forms:e.forms,filtersForm:e.filtersForm,userFilters:e.userFilters}})(Object(H.a)(Z))},1914:function(e,t,n){"use strict";var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(11),d=n.n(u),f=n(2),m=n(14),h=n(13),g=n(417),y=n(25),v=n.n(y),b=n(1597),O=n.n(b),E=n(99),I=n(139),C=n(0),T=n(626),k=n(1470),w=(n(1985),function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}),j=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.fetchFileMeta(this.props)}},{key:"componentWillReceiveProps",value:function(e){Object(C.isEqual)(this.props.fileId.map(function(e){return e.value}),e.fileId.map(function(e){return e.value}))||this.fetchFileMeta(e)}},{key:"fetchFileMeta",value:function(e){e.fileId.filter(function(t){return 0===e.fileMetas.list.filter(function(e){return e.id.value===t.value}).length}).foreach(function(t){Object(E.b)(t).then(function(t){e.dispatch(Object(I.e)([t.record]))})})}},{key:"onFilesDrop",value:function(e){var t=this;Object(C.headOption)(e).foreach(function(e){Object(E.h)(e,t.props.cdnAddress,t.props.auth.token,t.props.organisation.organisationId,t.props.eventLine.eventLineId,new C.None,new C.None).then(function(e){Object(E.b)(e).then(function(n){t.props.dispatch(Object(I.e)([n.record])),t.props.onFileIdChanged(e),t.props.openSnackbar(f.createElement("span",null,t.props.i18n.t("Файл успешно загружен")),new C.None)})})})}},{key:"onDownloadClick",value:function(){var e=this;this.props.fileId.foreach(function(t){e.props.dispatch(Object(k.c)(t))})}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement("p",null,this.props.label),f.createElement("div",{style:{display:"flex"}},f.createElement("p",{style:{flex:1}},this.props.fileId.flatMap(function(t){return Object(C.headOption)(e.props.fileMetas.list.filter(function(e){return e.id.value===t.value}))}).map(function(e){return e.entity.originalName}).getOrElse(function(){return e.props.i18n.t("Файл не найден")})),this.props.fileId.nonEmpty()&&f.createElement(v.a,{style:{alignSelf:"center",flexShrink:0},onClick:this.onDownloadClick},f.createElement(O.a,null))),f.createElement(g,{className:"DropZoneField__dropzone",onDrop:this.onFilesDrop},function(t){var n=t.isDragActive;return f.createElement("div",{className:n?"DropZoneField__dropzone-wrapper":""},f.createElement("div",{className:"DropZoneField__dropzone-message"},e.props.i18n.t("Нажмите для выбора файла либо перетащите файл в зону отмеченную пунктиром")))}))}}]),t}(f.Component);j=w([h.autobind],j),t.a=Object(m.connect)(function(e,t){return{i18n:e.i18n,fileMetas:e.fileMetas,auth:e.auth,eventLine:e.eventLine,organisation:e.organisation,cdnAddress:e.config.cdnAddress}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Object(T.a)(j))},1920:function(e,t,n){"use strict";var r=n(17),i=n(21),a=n(6),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(18),d=function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipeline.Operations","Start",{operation:e}))}return p()(t,e),t}(u.a),f=(function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipeline.Operations","Effects",{id:e}))}p()(t,e)}(u.a),function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipeline.Operations","List",{pipeline:e}))}return p()(t,e),t}(u.a)),m=(function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipeline.Operations","Reject",{operation:e}))}p()(t,e)}(u.a),function(e){function t(e){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipeline.Operations","Commit",{operation:e}))}p()(t,e)}(u.a),function(e){function t(e,n,r){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipeline.Operations","Limits",{fileId:e,formId:n,limitId:r}))}return p()(t,e),t}(u.a)),h=n(493);n.d(t,"b",function(){return g}),n.d(t,"a",function(){return y}),n.d(t,"c",function(){return v});var g=function(e){return r.a.send(new d(e),Object(i.f)())},y=function(e){return function(t){return t(Object(h.e)(e)),r.a.send(new f(e),Object(i.g)()).then(function(n){return t(Object(h.f)({pipeline:e,operations:n.list})),n}).catch(function(n){throw t(Object(h.d)({error:n,pipeline:e})),n})}},v=function(e,t,n){return r.a.send(new m(e,t,n),Object(i.f)())}},1981:function(e,t,n){"use strict";var r=n(685),i=1,a=4;t.a=function(e){return Object(r.default)(e,i|a)}},1985:function(e,t,n){var r=n(1986);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(r,i);r.locals&&(e.exports=r.locals)},1986:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".DropZoneField__dropzone {\n  position: relative;\n  width: 100%;\n  height: 200px;\n  border-width: 2px;\n  border-color: #666666;\n  border-style: dashed;\n  border-radius: 5px;\n  cursor: pointer; }\n\n.DropZoneField__dropzone-message {\n  position: absolute;\n  text-align: center;\n  display: inline-block;\n  top: 50%;\n  left: 50%;\n  width: 50%;\n  transform: translate(-50%, -50%); }\n\n.DropZoneField__dropzone-wrapper {\n  width: 100%;\n  height: 100%;\n  background-color: #f0f8ff; }\n",""])},1987:function(e,t,n){"use strict";n.d(t,"a",function(){return I});var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(11),d=n.n(u),f=n(2),m=n(14),h=n(13),g=n(24),y=n.n(g),v=n(71),b=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},O=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"showNotification",value:function(e){this.props.dispatch(Object(v.h)(e))}},{key:"isFeatureDisabled",value:function(){var e=this;return!this.props.organisation.data.map(function(t){return t.entity.payment.isFeatureAvailable(e.props.feature)}).getOrElse(function(){return!1})}},{key:"getChildrenWithDisabled",value:function(){var e=this,t=this.isFeatureDisabled();return t?[]:f.Children.map(this.props.children,function(n){return f.cloneElement(n,Object.assign({},n.props,{disabled:t,onClick:t?e.onClick:n.props.onClick}))})}},{key:"onClick",value:function(){this.isFeatureDisabled()&&this.showNotification(this.props.i18n.t("Данная услуга доступна только в бизнес-версии"))}},{key:"render",value:function(){return f.createElement("div",{style:this.props.style,className:this.props.className},this.getChildrenWithDisabled(),f.createElement("div",{style:{display:"none"}},this.props.children))}}]),t}(f.Component);O=b([h.autobind],O);var E=Object(m.connect)(function(e){return{i18n:e.i18n,organisation:e.organisation}})(O),I=function(e){function t(e,n){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return p()(t,e),o()(t,[{key:"render",value:function(){return f.createElement(E,{feature:this.props.feature},f.createElement(y.a,Object.assign({},this.props)))}}]),t}(f.Component);I.muiName="MenuItem",t.b=E},1988:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(2)),a=(0,r(n(44)).default)(i.default.createElement(i.default.Fragment,null,i.default.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),i.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"})),"Send");t.default=a},1989:function(e,t,n){"use strict";n.d(t,"b",function(){return $});var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(11),d=n.n(u),f=n(2),m=n(13),h=n(14),g=n(95),y=n(59),v=n(30),b=n.n(v),O=n(24),E=n.n(O),I=n(34),C=n.n(I),T=n(32),k=n.n(T),w=n(0),j=n(1),F=n(161),D=n(137),R=n(641),P=n(136),x=n(52),S=n.n(x),_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},$=new j.Id(y.v4()),L=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.templateId.foreach(function(t){return e.props.fields.templateId.onChange(t.value)})}},{key:"getFormDataCount",value:function(){var e=this,t=Object(D.b)(this.props.filtersForm,$);return t.nonEmpty()?t.map(function(t){return e.props.currentFormRecords.filter(function(e){return t.check(function(t){return e.entity.getFormFieldValue(t).map(function(e){return e.value})})})}).getOrElse(function(){return[]}).length:this.props.currentFormRecords.length}},{key:"render",value:function(){var e=this,t=this.props,n=t.notifyTemplatesDescriptionsList,r=t.fields.templateId,i=t.filter;return f.createElement("form",null,this.props.templateId.isEmpty()&&f.createElement(k.a,{fullWidth:!0},f.createElement(C.a,null,this.props.i18n.t("Шаблон уведомления")),f.createElement(b.a,Object.assign({fullWidth:!0},r,{value:r.value,errorText:r.touched&&r.error,onChange:r.onChange}),n.getOrElse(function(){return[]}).filter(function(e){return e.manualUse}).map(function(e,t){return f.createElement(E.a,{key:t,value:e.id.toString()},e.name)}))),f.createElement("p",null,this.props.i18n.t("Фильтр")),this.props.currentForm.data.map(function(e){return f.createElement(F.a,{initialValue:i,filterId:$,formId:e.id})}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}),this.props.templateId.isEmpty()&&f.createElement(S.a,{style:{marginTop:15}},this.props.i18n.t("Выбрано анкет"),": ",this.getFormDataCount()))}}]),t}(f.Component);L=_([m.autobind],L),t.a=Object(h.connect)(function(e,t){return{i18n:e.i18n,notifyTemplatesDescriptionsList:e.currentForm.data.map(function(t){return e.notifyTemplates.descriptionsList.filter(function(n){return e.user.userRole.map(function(e){return!e.entity.isNotifyTemplateRestricted(t.id,new j.Id(n.id))}).getOrElse(function(){return!1})})}),currentForm:e.currentForm,filtersForm:e.filtersForm,currentFormRecords:Object(w.liftKey)(e.formRecords.result,t.formId.value).flatMap(function(e){return e.map(function(e){return e.records})}).getOrElse(function(){return[]})}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(g.reduxForm)({form:"massNotificationsByFilterForm",fields:["templateId"]})(Object(P.a)(function(e){e.isTokenChecked&&e.dispatch(Object(R.b)(e.formId))})(L)))},2015:function(e,t,n){"use strict";var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(11),d=n.n(u),f=n(2),m=n(14),h=n(13),g=n(867),y=n.n(g),v=n(19),b=n.n(v),O=n(98),E=n.n(O),I=n(1),C=n(29),T=n(3),k=n(32),w=n.n(k),j=n(34),F=n.n(j),D=n(30),R=n.n(D),P=n(25),x=n.n(P),S=n(72),_=n.n(S),$=n(228),L=n(16),M=n(270),V=n(68),N=n(0),A=n(46),W=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},q=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"onAddressTypeChanged",value:function(e){this.props.onChange(T(this.props.addressType,{type:{$set:e.target.value}}),this.props.idx)}},{key:"onFormFieldIdChanged",value:function(e){this.props.onChange(T(this.props.addressType,{fieldId:{$set:e.map(function(e){return e.value}).getOrElse(function(){return""})}}),this.props.idx)}},{key:"onTemplateChanged",value:function(e){this.props.onChange(T(this.props.addressType,{template:{$set:Object(M.a)(Object(L.convertToRaw)(e.getCurrentContent()))}}),this.props.idx)}},{key:"onDeleteClick",value:function(e){this.props.onDelete(this.props.idx)}},{key:"render",value:function(){return f.createElement("div",{style:{position:"relative"}},f.createElement(w.a,{fullWidth:!0},f.createElement(F.a,{shrink:!0},this.props.i18n.t("Тип поля")),f.createElement(R.a,{fullWidth:!0,native:!0,value:this.props.addressType.type,onChange:this.onAddressTypeChanged},f.createElement("option",{value:I.EmailAddressTypeFieldId.$Type.value},this.props.i18n.t("Поле анкеты")),f.createElement("option",{value:I.EmailAddressTypeTemplate.$Type.value},this.props.i18n.t("Шаблон")))),this.props.addressType.type===I.EmailAddressTypeFieldId.$Type.value&&f.createElement(V.a,{native:!0,errorText:new N.None,labelText:Object(N.toOption)(this.props.i18n.t("Поле с email")),fullWidth:!0,fields:this.props.formFields.getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===I.ValueTypeStr.$Type.value}),onChanged:this.onFormFieldIdChanged,value:I.Id.createId(this.props.addressType.fieldId)}),this.props.addressType.type===I.EmailAddressTypeTemplate.$Type.value&&f.createElement("div",{style:{marginTop:10}},f.createElement($.a,{formId:this.props.formId,generators:[],onChange:this.onTemplateChanged,templateId:"",template:this.props.addressType.template,withRefFieldSelector:!0})),f.createElement(x.a,{style:Object.assign({},A.f,{position:"absolute",top:"5px",right:"5px"}),onClick:this.onDeleteClick},f.createElement(_.a,{style:A.g})))}}]),t}(f.Component);q=W([h.autobind],q);var B=Object(m.connect)(function(e,t){return{i18n:e.i18n,formFields:Object(C.e)(e.fields,t.formId)}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(q),H=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},z=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"getInitialValues",value:function(e){var t={addressType:e.tpe.value};switch(e.tpe.value){case I.EmailAddressTypeFieldId.$Type.value:return Object.assign({},t,{formFieldId:e.id.value});case I.EmailAddressTypeTemplate.$Type.value:return Object.assign({},t,{template:e.value});default:throw"unknown address type"}}},{key:"getAddressType",value:function(e){switch(e.addressType){case I.EmailAddressTypeFieldId.$Type.value:return new I.EmailAddressTypeFieldId(I.Id.createId(e.formFieldId).getOrElse(function(){throw"wrong form field id"}));case I.EmailAddressTypeTemplate.$Type.value:return new I.EmailAddressTypeTemplate(e.template);default:throw"unknown address type"}}},{key:"onAddAddressTypeButtonClick",value:function(){this.props.onChange(T(this.props.addressTypes,{$push:[{type:I.EmailAddressTypeFieldId.$Type.value,fieldId:"",template:""}]}))}},{key:"onAddressTypeRemove",value:function(e){this.props.onChange(T(this.props.addressTypes,{$splice:[[e,1]]}))}},{key:"onAddressTypeChanged",value:function(e,t){this.props.onChange(T(this.props.addressTypes,{$splice:[[t,1,e]]}))}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{marginBottom:"20px",marginTop:"20px"}},f.createElement(y.a,null,this.props.i18n.t("Список адресов отправки")),this.props.addressTypes.length>0&&f.createElement(E.a,null,this.props.addressTypes.map(function(t,n){return f.createElement(B,{idx:n,formId:e.props.formId,addressType:t,onChange:e.onAddressTypeChanged,onDelete:e.onAddressTypeRemove})})),f.createElement("div",null,f.createElement(b.a,{variant:"raised",onClick:this.onAddAddressTypeButtonClick,style:{marginRight:"10px"}},this.props.i18n.t("Добавить"))))}}]),t}(f.Component);z=H([h.autobind],z);t.a=Object(m.connect)(function(e,t){return{i18n:e.i18n,fields:Object(C.e)(e.fields,t.formId)}})(z)},2085:function(e,t,n){var r=n(2513);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(r,i);r.locals&&(e.exports=r.locals)},2511:function(e,t,n){var r=n(2512);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(r,i);r.locals&&(e.exports=r.locals)},2512:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".DocumentTemplateForm__dropzone {\n  position: relative;\n  width: 100%;\n  height: 100px;\n  margin-top: 15px;\n  border-width: 2px;\n  border-color: #666666;\n  border-style: dashed;\n  border-radius: 5px;\n  cursor: pointer; }\n\n.DocumentTemplateForm__dropzone-message {\n  position: absolute;\n  text-align: center;\n  display: inline-block;\n  top: 50%;\n  left: 50%;\n  width: 50%;\n  transform: translate(-50%, -50%); }\n\n.DocumentTemplateForm__dropzone-wrapper {\n  width: 100%;\n  height: 100%;\n  background-color: #f0f8ff; }\n",""])},2513:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".configSection {\n  padding: 16px; }\n  .configSection .blocksList {\n    display: flex;\n    flex-direction: column; }\n\n.FormConfig {\n  display: flex;\n  height: 100%; }\n\n.FormConfig__menu {\n  width: 256px;\n  margin: 4px 4px 4px 0;\n  height: fit-content; }\n\n.FormConfig__content {\n  flex: 1;\n  margin: 4px 0 4px 4px; }\n",""])},2514:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(2)),a=(0,r(n(44)).default)(i.default.createElement(i.default.Fragment,null,i.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),i.default.createElement("path",{d:"M10 20h4V4h-4v16zm-6 0h4v-8H4v8zM16 9v11h4V9h-4z"})),"Equalizer");t.default=a},2515:function(e,t,n){var r=n(2516);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(r,i);r.locals&&(e.exports=r.locals)},2516:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".ImportPipelinesList__dropzone {\n  position: relative;\n  width: 100%;\n  height: 200px;\n  border-width: 2px;\n  border-color: #666666;\n  border-style: dashed;\n  border-radius: 5px;\n  cursor: pointer; }\n\n.ImportPipelinesList__dropzone-message {\n  position: absolute;\n  text-align: center;\n  display: inline-block;\n  top: 50%;\n  left: 50%;\n  width: 50%;\n  transform: translate(-50%, -50%); }\n\n.ImportPipelinesList__dropzone-wrapper {\n  width: 100%;\n  height: 100%;\n  background-color: #f0f8ff; }\n",""])},2517:function(e,t,n){var r=n(2518);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(r,i);r.locals&&(e.exports=r.locals)},2518:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".FormPage__paper {\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  width: 100%; }\n\n.FormPage__tab {\n  height: calc(100% - 48px); }\n  .FormPage__tab > div {\n    height: 100%; }\n\n.FormPage {\n  display: flex;\n  height: 100%; }\n\n.FormPage__menu {\n  width: 256px;\n  margin: 0 4px 4px 0;\n  height: fit-content; }\n\n.FormPage__content {\n  flex: 1;\n  margin: 0 0 4px 4px; }\n",""])},2724:function(e,t,n){"use strict";n.r(t);var r=n(6),i=n.n(r),a=n(10),o=n.n(a),s=n(7),l=n.n(s),c=n(8),p=n.n(c),u=n(11),d=n.n(u),f=n(2),m=n(13),h=n(14),g=n(856),y=n.n(g),v=n(857),b=n.n(v),O=n(19),E=n.n(O),I=n(93),C=n.n(I),T=n(79),k=n(25),w=n.n(k),j=n(86),F=n.n(j),D=n(414),R=n.n(D),P=n(415),x=n(216),S=n(1531),_=n(1),$=n(84),L=n(1803),M=n(0),V=n(1492),N=n(201),A=n(71),W=function(){function e(){i()(this,e)}return o()(e,null,[{key:"submitHandler",value:function(t,n){var r=function(){return new Promise(function(e,r){Object($.f)(t.formId,new _.ME(n.id,new _.FormField(t.formId,n.name,n.caption,Object(L.b)(new M.TypeId(n.valueType),n)))).then(function(e){t.dispatch(Object($.c)(t.formId)),t.handleDialogClose(!0),t.dispatch(Object(A.h)(t.i18n.t("Успешно сохранено")))}).catch(r)}).catch(function(e){return t.dispatch(Object(N.a)(e))})};t.formField.entity.valueType.tpe.value!==Object(L.b)(new M.TypeId(n.valueType),n).tpe.value?t.openDialog(t.i18n.t("Подтверждение"),f.createElement("div",null,t.i18n.t("Изменение типа поля может привести к серьезным нарушениям в работе. Хотите продолжить?")),[f.createElement(E.a,{variant:"raised",onClick:r,style:{marginRight:"10px"}},t.i18n.t("Принять")),f.createElement(E.a,{variant:"raised",onClick:function(){return e.execute(t)},color:"primary"},t.i18n.t("Отмена"))],!0):r()}},{key:"getDateFormat",value:function(e){return e.generatorType.tpe.value===_.AttributeGeneratorTypeCreatedDate.$Type.value||e.generatorType.tpe.value===_.AttributeGeneratorTypeUpdatedDate.$Type.value?e.generatorType.format:""}},{key:"getInternalIdPrefix",value:function(e){return e.generatorType.tpe.value===_.AttributeGeneratorTypeInternalId.$Type.value?e.generatorType.prefix:""}},{key:"getInternalIdPostfix",value:function(e){return e.generatorType.tpe.value===_.AttributeGeneratorTypeInternalId.$Type.value?e.generatorType.postfix:""}},{key:"initialValues",value:function(e,t){var n,r=e.entity,i=r.name,a=r.caption,o=r.valueType,s={id:e.id,name:i,caption:a,valueType:o.tpe.value,valueTypeTag:o.tag.map(function(e){return e.tpe.value}).getOrElse(function(){return""})};switch(o.tpe){case _.ValueTypeValuesList.$Type:return Object.assign(s,{staticValues:o.values});case _.ValueTypeObjectRefs.$Type:return Object.assign(s,{valueType:(n=o.family,Object(M.headOption)(t.list.filter(function(e){return e.id.value===n.value})).map(function(e){return e.entity.formType}).map(function(e){return _.FormType.isAnyDictionary(e)?_.ValueTypeObjectRefsTypes.DICTIONARY:_.FormType.isForm(e)?_.ValueTypeObjectRefsTypes.FORM:_.FormType.isService(e)?_.ValueTypeObjectRefsTypes.SERVICE:o.tpe.value}).getOrElse(function(){return o.tpe.value})),referenceFamily:o.family.value,referenceFamilyDisplayField:Object(M.head)(o.displayFields).value});case _.ValueTypeFormDataAttribute.$Type:return Object.assign(s,{attributeGeneratorType:o.generatorType.tpe.value,dateFormat:this.getDateFormat(o),internalIdPrefix:this.getInternalIdPrefix(o),internalIdPostfix:this.getInternalIdPostfix(o)});case _.ValueTypeDate.$Type:return Object.assign(s,{dateType:o.dateType.tpe.value});default:return s}}},{key:"execute",value:function(t){var n=void 0;t.openDialog(t.i18n.t("Редактирование поля"),f.createElement(L.a,{disabled:!Object(V.a)(Object(M.toOption)(t.formField.id),Object(M.toOption)(t.formId),t.user.userRole).getOrElse(function(){return!0}),ref:function(e){return n=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},initialValues:e.initialValues(t.formField,t.forms),onSubmit:function(n){return e.submitHandler(t,n)}}),[f.createElement(E.a,{variant:"raised",onClick:function(){return t.handleDialogClose(!0)},style:{marginRight:"10px"}},t.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return n.map(function(e){return e.submit()})},color:"primary"},t.i18n.t("Сохранить"))],!0)}}]),e}(),q=n(29),B=n(46),H=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},z=function(e){function t(){i()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.handleKeyDown=function(t){"Insert"===t.key&&e.onCreateRequested()},e}return p()(t,e),o()(t,[{key:"onCreateRequested",value:function(){var e=this.props,t=e.i18n,n=e.openDialog,r=e.handleDialogClose,i=e.dispatch,a=(e.params,new _.Id(this.props.params.formId));Object(S.a)({openDialog:n,handleDialogClose:r,formId:a,i18n:t,dispatch:i},void 0,void 0,void 0,!0)}},{key:"onMassCreateRequested",value:function(){var e=this.props,t=e.i18n,n=e.openDialog,r=e.handleDialogClose,i=e.dispatch,a=(e.params,new _.Id(this.props.params.formId));Object(S.b)({openDialog:n,handleDialogClose:r,formId:a,i18n:t,dispatch:i})}},{key:"onEdit",value:function(e){var t=this.props,n=t.i18n,r=t.openDialog,i=t.handleDialogClose,a=t.dispatch,o=t.forms,s=t.params,l=new _.Id(this.props.params.formId);W.execute({formField:e,openDialog:r,handleDialogClose:i,formId:l,forms:o,i18n:n,dispatch:a,params:s,user:this.props.user})}},{key:"onDelete",value:function(e){var t=this;this.props.openDialog(this.props.i18n.t("Подтверждение удаления"),f.createElement("p",null,this.props.i18n.t("Вы действительно хотите удалить поле? Это действие нельзя будет отменить")),[f.createElement(E.a,{variant:"raised",onClick:function(){return t.props.handleDialogClose(!1)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),f.createElement(E.a,{variant:"raised",onClick:function(){return Object($.b)(e.id,e.entity.formId).then(function(){t.props.dispatch(Object($.c)(e.entity.formId)),t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Поле удалено")))}).catch(function(e){t.props.dispatch(Object(N.a)(e))})},color:"primary"},this.props.i18n.t("Удалить"))])}},{key:"onRefsClick",value:function(e,t){e.preventDefault(),e.stopPropagation(),this.props.dispatch(Object(T.J)(new _.Id(this.props.params.eventLineId),Object(M.headOption)(this.props.forms.list.filter(function(e){return e.id.value===t.value})).map(function(e){return e.entity.formType.getFormTypeId()}).getOrElse(function(){return new _.Id("1")}),t))}},{key:"displayValueType",value:function(e){var t=this;switch(e.tpe){case _.ValueTypeStr.$Type:return this.props.i18n.t("Текст");case _.ValueTypeBool.$Type:return this.props.i18n.t("Булевый");case _.ValueTypeNumber.$Type:return this.props.i18n.t("Числовое");case _.ValueTypeInterval.$Type:return this.props.i18n.t("Длительность");case _.ValueTypeImage.$Type:return this.props.i18n.t("Изображение");case _.ValueTypeUserRefs.$Type:return this.props.i18n.t("Пользователь");case _.ValueTypeMoney.$Type:return this.props.i18n.t("Деньги");case _.ValueTypeObjectRefs.$Type:var n=e;return f.createElement("a",{href:"#",style:{color:"#4285f4"},onClick:function(e){return t.onRefsClick(e,n.family)}},this.props.i18n.t("Ссылка %s").replace("%s",n.family.value));case _.ValueTypeValuesList.$Type:return this.props.i18n.t("Список значений");case _.ValueTypeFileList.$Type:return this.props.i18n.t("Список файлов");case _.ValueTypeDate.$Type:return this.props.i18n.t("Дата и время");case _.ValueTypeFormDataAttribute.$Type:return this.props.i18n.t("Атрибут");case _.ValueTypeGeoPoint.$Type:return this.props.i18n.t("Географическое местоположение");case _.ValueTypePassword.$Type:return this.props.i18n.t("Пароль");default:return"-- Неизвестный тип --"}}},{key:"render",value:function(){var e=this,t=this.props.params.formId,n=Object(q.e)(this.props.fields,new _.Id(t));return f.createElement("div",{onKeyDown:this.handleKeyDown,style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Создать")),f.createElement(E.a,{variant:"raised",style:{marginLeft:"10px"},onClick:this.onMassCreateRequested,color:"primary"},this.props.i18n.t("Массовое создание"))),f.createElement(P.a,{showId:!0,withActions:!0,error:Object(M.liftKey)(this.props.fields.error,t).getOrElse(function(){return new M.None}),onRecordSelected:this.onEdit,fetching:Object(M.liftKey)(this.props.fields.fetching,t).getOrElse(function(){return!1}),empty:n.map(function(e){return 0===e.length}).getOrElse(function(){return!0}),headers:[{id:"systemName",title:this.props.i18n.t("Системное имя")},{id:"fieldName",title:this.props.i18n.t("Название")},{id:"fieldType",title:this.props.i18n.t("Тип")}],columnStyles:[{flex:3},{flex:3},{flex:2}],rows:n.getOrElse(function(){return[]}).map(function(t){return{id:t.id.value,payload:t,fields:[t.entity.name,t.entity.caption,e.displayValueType(t.entity.valueType)],buttons:[f.createElement(w.a,{style:B.f,disabled:t.entity.valueType.tag.nonEmpty(),key:"edit",onClick:function(n){n.stopPropagation(),e.onEdit(t)}},f.createElement(F.a,{style:B.g})),f.createElement(w.a,{style:B.f,key:"delete",onClick:function(n){n.stopPropagation(),e.onDelete(t)}},f.createElement(R.a,{style:B.g}))]}})}))}}]),t}(f.Component);z=H([m.autobind],z);var K=Object(h.connect)(function(e){return{i18n:e.i18n,fields:e.fields,forms:e.forms,currentForm:e.currentForm,user:e.user}})(z),U=n(434),G=n(3),Z=n(650),Y=n(1517),J=n(95),X=n(26),Q=n.n(X),ee=n(324),te=n.n(ee),ne=n(556),re=n(32),ie=n.n(re),ae=n(34),oe=n.n(ae),se=n(30),le=n.n(se),ce=n(24),pe=n.n(ce),ue=n(82),de=(n(2511),n(1914)),fe=n(1493),me=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},he=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.auth.token.map(function(t){return e.props.dispatch(Object(ne.a)(t))})}},{key:"handleAddFonts",value:function(){this.props.handleDialogClose(!0),this.props.dispatch(Object(T.hb)())}},{key:"handleFilesDrop",value:function(e){this.props.fields.fileId.onChange(e.value)}},{key:"getErrorText",value:function(){if(this.props.fields.templateType.value===_.DocumentSchemaTypeDesigned.$Type.value){var e=0!==this.props.fonts.list.length,t=0!==this.props.fonts.blockFontsList.length,n=this.props.fonts.fetching,r=this.props.fonts.blockFontsFetching;if(!(!n&&e||!r&&t))return f.createElement("p",{style:{color:te.a[500]}},this.props.i18n.t("Обратите внимание, что для организации не добавленно ни одного шрифта, рекомендуем добавить хотя бы один прежде чем продолжить"))}}},{key:"render",value:function(){var e=this,t=this.props,n=t.handleSubmit,r=t.fields,i=r.name,a=r.templateType,o=r.fileId,s=r.tag;return f.createElement("form",{className:"form",onSubmit:n&&n(this.props.submitHandler)},f.createElement("div",{className:"field"},f.createElement(Q.a,{fullWidth:!0,autoFocus:!0,value:i.value,onChange:i.onChange,label:this.props.i18n.t("Название шаблона"),error:i.touched&&i.error,helperText:i.touched&&Object(M.toOption)(i.error).map(function(e){return e}).getOrNull()}),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Тип")),f.createElement(le.a,{value:a.value,onChange:a.onChange},f.createElement(pe.a,{value:_.DocumentSchemaTypeDesigned.$Type.value},this.props.i18n.t("Шаблон")),!ue.default.isA5000&&f.createElement(pe.a,{value:_.DocumentSchemaTypeTemplate.$Type.value},this.props.i18n.t("Документ Word")))),f.createElement(fe.a,{value:s.value,onChange:s.onChange,suggestions:this.props.tags,onBlur:function(){}},f.createElement(Q.a,{label:this.props.i18n.t("Группа"),error:s.touched&&s.error,fullWidth:!0,autoComplete:"off"})),a.value===_.DocumentSchemaTypeTemplate.$Type.value&&f.createElement(de.a,{label:this.props.i18n.t("Файл шаблона"),fileId:Object(M.toOption)(o.value).filter(function(e){return""!==e}).map(function(e){return new _.Id(e)}),onFileIdChanged:this.handleFilesDrop})),this.getErrorText(),f.createElement("div",{style:{margin:"10px -18px -18px 0",textAlign:"right"}},f.createElement(E.a,{variant:"raised",onClick:this.handleAddFonts,style:{marginRight:"10px"}},this.props.i18n.t("Добавить шрифты")),f.createElement(E.a,{variant:"raised",onClick:function(t){return e.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",type:"submit",disabled:this.props.submitting,color:"primary"},this.props.i18n.t("Сохранить"))))}}]),t}(f.Component);he=me([m.autobind],he);var ge=Object(h.connect)(function(e){return{i18n:e.i18n,fonts:e.fonts,auth:e.auth,organisationId:e.organisation.organisationId,eventLineId:e.eventLine.eventLineId}})(Object(J.reduxForm)({form:"document-template-form",fields:["name","templateType","fileId","tag"],validate:function(e){var t={};return e.name||(t.name="Обязательное значение"),t}})(he)),ye=n(136),ve=n(1590),be=n(50),Oe=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ee=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ie=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p()(t,e),o()(t,[{key:"getTags",value:function(){return Object(U.a)(this.props.documentTemplates.list.map(function(e){return e.entity.tag}).filter(function(e){return e.nonEmpty()}).map(function(e){return e.getOrElse(function(){return""})}))}},{key:"onCreateRequested",value:function(){var e=this,t=new _.Id(this.props.params.formId);this.props.openDialog(this.props.i18n.t("Новый шаблон"),f.createElement(ge,{ref:function(e){return Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},submitHandler:function(n){var r=Object(M.toOption)(n.templateType).filter(function(e){return e===_.DocumentSchemaTypeDesigned.$Type.value}).matchWith(function(){return new _.DocumentTemplate(n.name,t,new _.DocumentSchema(new M.Some(new _.DocumentSchemaDefinition([],new M.None,new M.None,new M.None,new _.DocumentSchemaTypeDesigned)),new _.ValueFileList([]),[]),""===n.tag?new M.None:Object(M.toOption)(n.tag))},function(){return new _.DocumentTemplate(n.name,t,new _.DocumentSchema(new M.Some(new _.DocumentSchemaDefinition([],new M.None,new M.None,Object(M.toOption)(new _.PdfTemplate(_.Id.createId(n.fileId).getOrElse(function(){throw"wrong user fileMeta id"}),!0)),new _.DocumentSchemaTypeTemplate)),new _.ValueFileList([]),[]))});return Object(Y.b)(r).then(function(n){return e.props.dispatch(Object(Y.e)(t)).then(function(){e.props.handleDialogClose(!1),e.props.dispatch(Object(A.h)(e.props.i18n.t("Шаблон документа успешно создан")))})}).catch(function(t){return e.props.dispatch(Object(N.a)(t))})},handleDialogClose:this.props.handleDialogClose,initialValues:{templateType:_.DocumentSchemaTypeDesigned.$Type.value},tags:this.getTags()}),[])}},{key:"onEditRequested",value:function(e){var t=this,n=new _.Id(this.props.params.formId),r=e.entity.documentSchema.definition.map(function(e){return e.schemaType.tpe.value}).getOrElse(function(){return _.DocumentSchemaTypeDesigned.$Type.value}),i=e.entity.documentSchema.definition.flatMap(function(e){return e.pdfTemplate.map(function(e){return e.fileId.value})}).getOrElse(function(){return""});this.props.openDialog(this.props.i18n.t("Редактирование шаблона"),f.createElement(ge,{ref:function(e){return Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},submitHandler:function(r){var i=Object(M.toOption)(r.templateType).filter(function(e){return e===_.DocumentSchemaTypeDesigned.$Type.value}).matchWith(function(){return G(e,{entity:{name:{$set:r.name}}})},function(){return G(e,{entity:{name:{$set:r.name},documentSchema:{$set:new _.DocumentSchema(new M.Some(new _.DocumentSchemaDefinition([],new M.None,new M.None,Object(M.toOption)(new _.PdfTemplate(_.Id.createId(r.fileId).getOrElse(function(){throw"wrong user fileMeta id"}),!0)),new _.DocumentSchemaTypeTemplate)),new _.ValueFileList([]),[])},tag:{$set:""===r.tag?new M.None:Object(M.toOption)(r.tag)}}})});return Object(Y.f)(i).then(function(e){return t.props.dispatch(Object(Y.e)(n)).then(function(){t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Шаблон документа успешно изменён")))})}).catch(function(e){return t.props.dispatch(Object(N.a)(e))})},initialValues:{name:e.entity.name,templateType:r,fileId:r===_.DocumentSchemaTypeTemplate.$Type.value?i:"",tag:e.entity.tag.getOrElse(function(){return""})},tags:this.getTags(),handleDialogClose:this.props.handleDialogClose}),[])}},{key:"onCellClickHandler",value:function(e){var t=this,n=this.getSchemaType(e);Object(M.toOption)(n===_.DocumentSchemaTypeTemplate.$Type.value).filter(function(e){return e}).matchWith(function(){return t.onEditRequested(e)},function(){return t.props.dispatch(Object(T.r)(new _.Id(t.props.params.eventLineId),new _.Id(t.props.params.formTypeId),e.entity.formId,e.id))})}},{key:"onCopy",value:function(e){var t=this,n=new _.Id(this.props.params.formId);Object(Y.a)(e.id).then(function(e){return t.props.dispatch(Object(Y.e)(n)).then(function(){t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Шаблон документа скопирован")))})}).catch(function(e){return t.props.dispatch(Object(A.h)(t.props.i18n.t("Ошибка - не удалось создать копию шаблона")))})}},{key:"onDeleteRequested",value:function(e){var t=this,n=new _.Id(this.props.params.formId);this.props.openDialog(this.props.i18n.t("Удаление шаблона"),f.createElement("div",null,this.props.i18n.t("Вы действительно хотите удалить шаблон? Это действие нельзя будет отменить.")),[f.createElement(E.a,{variant:"raised",onClick:function(){t.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Нет")),f.createElement(E.a,{variant:"raised",onClick:function(){Object(Y.c)(e.id).then(function(e){return t.props.dispatch(Object(Y.e)(n)).then(function(){t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Шаблон документа удёлен")))})}).catch(function(e){return t.props.dispatch(Object(N.a)(e))})}},this.props.i18n.t("Да"))])}},{key:"getSchemaType",value:function(e){return e.entity.documentSchema.definition.map(function(e){return e.schemaType.tpe.value}).getOrElse(function(){return _.DocumentSchemaTypeDesigned.$Type.value})}},{key:"renderTable",value:function(e){var t=this,n=this.props.documentTemplates.list.filter(function(t){return"!defaultTag"===e?t.entity.tag.isEmpty():t.entity.tag.map(function(t){return t===e}).getOrElse(function(){return!1})});return!(this.props.documentTemplates.list.length>0&&"!defaultTag"===e&&0===n.length)&&f.createElement(P.a,{showId:!0,error:this.props.documentTemplates.error,onRecordSelected:this.onCellClickHandler,fetching:this.props.documentTemplates.fetching,empty:!this.props.documentTemplates.fetching&&0==n.length,withActions:!0,headers:[{id:"documentTemplateName",title:this.props.i18n.t("Название")},{id:"documentTemplateType",title:this.props.i18n.t("Тип")},{id:"documentTemplateTag",title:this.props.i18n.t("Группа")}],rows:n.map(function(n){return{id:n.id.value,payload:n,fields:[n.entity.name,Object(be.v)(t.getSchemaType(n),t.props.i18n.t),""+("!defaultTag"===e?t.props.i18n.t("По умолчанию"):e)],buttons:[f.createElement(w.a,{key:"edit",style:B.f,onClick:function(e){e.stopPropagation(),t.onEditRequested(n)}},f.createElement(F.a,{style:B.g})),f.createElement(w.a,{key:"delete",style:B.f,onClick:function(e){e.stopPropagation(),t.onDeleteRequested(n)}},f.createElement(R.a,{style:B.g})),f.createElement(w.a,{key:"copy",style:B.f,onClick:function(e){e.stopPropagation(),t.onCopy(n)}},f.createElement(Z.a,{style:B.g}))]}})})}},{key:"render",value:function(){var e=this;return f.createElement(f.Fragment,null,f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Новый шаблон"))),this.getTags().map(function(t){return e.renderTable(t)}),this.renderTable("!defaultTag"))}}]),t}(f.Component);Ie=Oe([m.autobind,Ee("design:paramtypes",[Object])],Ie);var Ce=Object(h.connect)(function(e){return{documentTemplates:e.documentTemplates,i18n:e.i18n}})(Object(ye.a)(function(e){e.isTokenChecked&&(e.dispatch(Object(Y.e)(new _.Id(e.params.formId))),e.dispatch(Object(ve.c)(new _.Id(e.params.eventLineId))))},function(){},function(e,t){e.params.formId!==t.params.formId&&e.dispatch(Object(Y.e)(new _.Id(e.params.formId))),e.params.eventLineId!==t.params.eventLineId&&e.dispatch(Object(ve.c)(new _.Id(e.params.eventLineId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(Y.e)(new _.Id(e.params.formId))),e.params.eventLineId===t.params.eventLineId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(ve.c)(new _.Id(e.params.eventLineId)))})(Ie)),Te=n(651),ke=n(137),we=n(1477),je=n(59),Fe=n(557),De=n(190),Re=n.n(De),Pe=n(75),xe=n.n(Pe),Se=n(319),_e=n.n(Se),$e=n(416),Le=n.n($e),Me=n(33),Ve=n.n(Me),Ne=n(156),Ae=n.n(Ne),We=n(241),qe=n.n(We),Be=n(243),He=n.n(Be),ze=n(242),Ke=n.n(ze),Ue=n(261),Ge=n.n(Ue),Ze=n(161),Ye=n(68),Je=n(176),Xe=n(104),Qe=n(51),et=n(1479),tt=n(64),nt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},rt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},it=new _.Id(je.v4()),at=function(){},ot=0,st=function(e){function t(){i()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state={selectedIndex:ot,dialog:{open:!1,actions:[],title:new M.None,body:new M.None},submited:!1},e}return p()(t,e),o()(t,[{key:"componentWillMount",value:function(){at=this.props.i18n}},{key:"componentDidMount",value:function(){var e=this;this.props.filter.foreach(function(t){return e.props.dispatch(Object(tt.k)({filterId:it,filter:t}))})}},{key:"handleDialogClose",value:function(){this.setState(G(this.state,{dialog:{$set:G(this.state.dialog,{open:{$set:!1}})}}))}},{key:"openDialog",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.setState(G(this.state,{dialog:{$set:{open:!0,title:new M.Some(e),body:new M.Some(t),actions:n||[]}}}))}},{key:"handleCreateAnBound",value:function(e){Object(Je.d)(new _.Id(this.props.params.formId))}},{key:"onCreateNewTextField",value:function(){var e=this,t=Object(M.headOption)(this.props.eventLine.data.map(function(t){return Object(Xe.f)(e.props.forms,t.id)}).getOrElse(function(){return[]}).filter(function(e){return _.FormType.isDocument(e.entity.formType)})),n={caption:this.props.i18n.t("Документы"),name:"documents",valueTypeTag:_.ValueTagDocumentRecordRefs.$Type.value};t.foreach(function(e){n=Object.assign({},n,{referenceFamily:e.id.value})}),Object(S.d)({openDialog:this.openDialog,handleDialogClose:this.handleDialogClose,formId:new _.Id(this.props.params.formId),i18n:this.props.i18n,handleCreateAnBound:this.handleCreateAnBound,dispatch:this.props.dispatch},n)}},{key:"handleRfidChanged",value:function(e,t){this.props.fields.rfid.onChange(t)}},{key:"onSubmit",value:function(e){this.setState(G(this.state,{submited:{$set:!0}})),this.props.handleSubmit(this.props.submitHandler)(e)}},{key:"onSelected",value:function(e){this.setState(G(this.state,{selectedIndex:{$set:e}}))}},{key:"renderTabContents",value:function(){var e=this,t=this.props.fields,n=t.name,r=t.template,i=t.issueType,a=t.annulmentType,o=t.color,s=t.fontColor,l=t.rfid,c=t.logEnabled,p=t.logField;switch(this.state.selectedIndex){case ot:return f.createElement("div",null,f.createElement("div",{className:"field"},f.createElement(Q.a,{value:n.value,onChange:n.onChange,fullWidth:!0,placeholder:this.props.i18n.t("Название"),autoFocus:!0})),f.createElement("div",{className:"field"},f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Тип документа")),f.createElement(le.a,{fullWidth:!0,value:i.value,onChange:function(e){return i.onChange(e.target.value)}},_.IssueTypes.map(function(t){return f.createElement(pe.a,{key:t.tpe.value,value:t.tpe.value},Object(_.getIssueTypeName)(t.tpe,e.props.i18n.t))})))),(i.value===_.IssueTypePrint.$Type.value||i.value===_.IssueTypeEmail.$Type.value)&&f.createElement("div",{className:"field"},f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Шаблон документа")),f.createElement(le.a,{fullWidth:!0,value:r.value,onChange:function(e){return r.onChange(e.target.value)},error:r.error},this.props.documentTemplates.list.map(function(e){return f.createElement(pe.a,{key:e.id.value,value:e.id.value},e.entity.name)})),Object(M.toOption)(r.error).map(function(e){return f.createElement(Ae.a,null,e)}).getOrNull())),f.createElement("div",{className:"field"},f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Тип аннулирования")),f.createElement(le.a,{fullWidth:!0,value:a.value||_.AnnulmentModeNone.$Type.value,onChange:function(e){return a.onChange(e.target.value)}},_.AnnulmentModes.map(function(t){return f.createElement(pe.a,{key:t.tpe.value,value:t.tpe.value},Object(_.getAnnulmentModeName)(t.tpe,e.props.i18n.t))})))),f.createElement(Ve.a,{label:this.props.i18n.t("Логировать напечатанные документы"),control:f.createElement(xe.a,{checked:c.checked,onChange:function(e,t){return c.onChange(t)}})}),c.checked&&f.createElement("div",{style:{display:"flex",flexDirection:"column"}},f.createElement(Ye.a,{fullWidth:!0,native:!0,errorText:new M.None,fields:this.props.currentForm.data.flatMap(function(t){return Object(M.liftKey)(e.props.formFields.list,t.id.value)}).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===_.ValueTypeObjectRefs.$Type.value}),labelText:Object(M.toOption)(this.props.i18n.t("Поле для логирования")),value:Object(M.toOption)(new _.Id(p.value)),onChanged:function(e){return p.onChange(e.map(function(e){return e.value}).getOrElse(function(){throw new Error("can't be None")}))},emptyDisabled:!1}),f.createElement("div",null,f.createElement(E.a,{color:"primary",style:{margin:0},onClick:this.onCreateNewTextField},this.props.i18n.t("Или создать новое ссылочное поле")))),(i.value===_.IssueTypePrint.$Type.value||i.value===_.IssueTypeVirtual.$Type.value)&&f.createElement("div",{style:{margin:"10px 0"}},f.createElement("h4",null,this.props.i18n.t("RFID")),f.createElement(Le.a,{onChange:this.handleRfidChanged,value:l.value},f.createElement(Ve.a,{control:f.createElement(_e.a,null),label:this.props.i18n.t("Не использовать RFID"),value:_.RfidDisabled.$Type.value}),f.createElement(Ve.a,{control:f.createElement(_e.a,null),label:this.props.i18n.t("Использовать перед"),value:_.RfidBefore.$Type.value}),f.createElement(Ve.a,{control:f.createElement(_e.a,null),label:this.props.i18n.t("Использовать после"),value:_.RfidAfter.$Type.value}))));case 1:return f.createElement("div",null,this.props.currentForm.data.map(function(t){return f.createElement(Ze.a,{initialValue:e.props.filter,filterId:it,formId:t.id})}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}));case 2:return f.createElement("div",{style:{padding:"10px 0px"}},f.createElement(ct,{color:o.value||"#fff",label:this.props.i18n.t("Цвет фона"),onChange:function(e){return o.onChange(e)}}),f.createElement(ct,{color:s.value||"#000",label:this.props.i18n.t("Цвет текста"),onChange:function(e){return s.onChange(e)}}),f.createElement("div",{style:{marginBottom:"10px"}},f.createElement("div",{style:{marginBottom:"5px"}},this.props.i18n.t("Образец")),f.createElement("div",{style:{backgroundColor:o.value,color:s.value,padding:"10px",textAlign:"center"}},"AaBbCcDdEeFfGgHhIiJjKkLlMm")));default:return f.createElement("div",null,"unknown content")}}},{key:"render",value:function(){var e=this;return f.createElement("form",{onSubmit:this.onSubmit},f.createElement(b.a,{value:this.state.selectedIndex,onChange:function(t,n){return e.onSelected(n)},indicatorColor:"primary",textColor:"primary",fullWidth:!0,centered:!0},f.createElement(y.a,{value:ot,label:this.props.i18n.t("Основные данные")}),f.createElement(y.a,{value:1,label:this.props.i18n.t("Настройки фильтрации")}),f.createElement(y.a,{value:2,label:this.props.i18n.t("Цвет отображения")})),f.createElement(et.a,null,this.renderTabContents()),f.createElement("div",{style:{margin:"10px -18px -18px 0",textAlign:"right"}},f.createElement(E.a,{variant:"raised",onClick:function(t){return e.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",type:"submit",disabled:this.state.submited,color:"primary"},this.props.i18n.t("Сохранить"))),f.createElement(qe.a,{fullWidth:!0,open:this.state.dialog.open,onClose:this.handleDialogClose},f.createElement(Ge.a,{style:{borderBottom:"none"}},this.state.dialog.title.getOrElse(function(){return""})),f.createElement(Ke.a,null,this.state.dialog.body.getOrElse(function(){return f.createElement("div",null)})),f.createElement(He.a,{style:{borderTop:"none"}},this.state.dialog.actions)))}}]),t}(f.Component);st=nt([m.autobind],st);var lt=Object(h.connect)(function(e){return{i18n:e.i18n,currentForm:e.currentForm,documentTemplates:e.documentTemplates,formFields:e.fields,eventLine:e.eventLine,forms:e.forms}})(Object(J.reduxForm)({form:"documentForm",fields:["name","template","annulmentType","issueType","color","fontColor","rfid","logEnabled","logField"],validate:function(e){return function(e,t){var n={};return e.issueType!==_.IssueTypePrint.$Type.value&&e.issueType!==_.IssueTypeEmail.$Type.value||e.template||(n.template=t.t("Обязательное значение")),n}(e,at)}})(st)),ct=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={colorPopover:{open:!1,anchorElement:void 0}},n}return p()(t,e),o()(t,[{key:"onColorPopoverOpen",value:function(e){this.setState(G(this.state,{colorPopover:{$set:{open:!0,anchorElement:Object(Qe.findDOMNode)(e.currentTarget)}}}))}},{key:"onColorPopoverClose",value:function(){this.setState(G(this.state,{colorPopover:{$set:{open:!1,anchorElement:null}}}))}},{key:"onChange",value:function(e){this.props.onChange(Object(M.toOption)(e.hex).getOrElse(function(){throw"color has not been pass"}))}},{key:"render",value:function(){return f.createElement("div",{style:{marginBottom:"10px"}},f.createElement("div",{style:{marginBottom:"5px"}},this.props.label),f.createElement("div",{onClick:this.onColorPopoverOpen,style:{backgroundColor:this.props.color,height:"36px",cursor:"pointer"}}),f.createElement(Re.a,{open:this.state.colorPopover.open,anchorEl:this.state.colorPopover.anchorElement,anchorOrigin:{horizontal:"left",vertical:"bottom"},transformOrigin:{horizontal:"left",vertical:"top"},onClose:this.onColorPopoverClose},f.createElement(Fe.SketchPicker,{color:{hex:this.props.color},onChangeComplete:this.onChange})))}}]),t}(f.Component);ct=nt([m.autobind,rt("design:paramtypes",[Object])],ct);var pt=n(1981),ut=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},dt=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"convertFormValuesToDocument",value:function(e){var t=e.issueType===_.IssueTypePrint.$Type.value||e.issueType===_.IssueTypeEmail.$Type.value?Object(M.toOption)(new _.Id(e.template)):new M.None;return new _.Document(e.name,t,new _.Id(this.props.params.formId),Object(M.headOption)(_.IssueTypes.filter(function(t){return t.tpe.value===e.issueType})).getOrElse(function(){return new _.IssueTypePrint}),e.color,e.fontColor,Object(M.headOption)(_.AnnulmentModes.filter(function(t){return t.tpe.value===e.annulmentType})).getOrElse(function(){return new _.AnnulmentModeNone}),Object(ke.b)(this.props.filtersForm,it),this.getRfid(e.rfid),new _.LogParams(e.logEnabled,Object(M.toOption)(new _.Id(e.logField))))}},{key:"getRfid",value:function(e){switch(e){case _.RfidAfter.$Type.value:return new _.RfidAfter;case _.RfidBefore.$Type.value:return new _.RfidBefore;case _.RfidDisabled.$Type.value:return new _.RfidDisabled;default:throw"Unknown rfid type"}}},{key:"getInitialFormValues",value:function(e){return{name:e.entity.name,template:e.entity.template.map(function(e){return e.value}).getOrNull(),issueType:e.entity.issueType.tpe.value,annulmentType:e.entity.annulmentMode.tpe.value,color:e.entity.color,fontColor:e.entity.fontColor,rfid:e.entity.rfid.tpe.value,logEnabled:e.entity.logParams.enabled,logField:e.entity.logParams.refId.map(function(e){return e.value}).getOrElse(function(){return""})}}},{key:"submitHandler",value:function(e,t,n){e.logEnabled?t(e):this.props.openDialog(this.props.i18n.t("Редактирование документа"),f.createElement("p",null,this.props.i18n.t("Вы уверены, что хотите создать неотслеживаемый документ. Значения баркодов такого документа могут быть недоступны в целям поиска")),[f.createElement(E.a,{variant:"raised",onClick:function(t){return n(e)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),f.createElement(E.a,{variant:"raised",color:"primary",onClick:function(n){return t(e)}},this.props.i18n.t("Подтвердить"))])}},{key:"onEditRequested",value:function(e){var t=this,n=function(n){return Object(we.f)(G(e,{entity:{$set:t.convertFormValuesToDocument(n)}})).then(function(e){t.props.dispatch(Object(A.h)(t.props.i18n.t("Документ успешно сохранен"))),t.props.handleDialogClose(!1),t.props.dispatch(Object(we.c)(new _.Id(t.props.params.formId)))}).catch(function(e){return t.props.dispatch(Object(N.a)(e))})};!function r(i){return t.props.openDialog(t.props.i18n.t("Редактирование документа"),f.createElement(lt,{filter:e.entity.filter,submitHandler:function(e){return t.submitHandler(e,n,r)},handleDialogClose:t.props.handleDialogClose,initialValues:i,params:t.props.params}),[])}(this.getInitialFormValues(e))}},{key:"onCreateRequested",value:function(e){var t=this,n=function(e){return Object(we.a)(t.convertFormValuesToDocument(e)).then(function(e){t.props.dispatch(Object(we.c)(new _.Id(t.props.params.formId))),t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Документ успешно создан")))}).catch(function(e){return t.props.dispatch(Object(N.a)(e))})};!function e(r){return t.props.openDialog(t.props.i18n.t("Новый документ"),f.createElement(lt,{filter:new M.None,submitHandler:function(r){return t.submitHandler(r,n,e)},handleDialogClose:t.props.handleDialogClose,initialValues:r,params:t.props.params}),[])}({color:"#fff",fontColor:"#000",rfid:_.RfidDisabled.$Type.value,logEnabled:!1,logField:""})}},{key:"onCopy",value:function(e){var t=this,n=(new _.Id(this.props.params.formId),e.entity),r=n.name+" COPY",i=Object(pt.a)(n);return i.name=r,new Promise(function(e,n){return Object(we.a)(i).then(function(e){t.props.dispatch(Object(we.c)(new _.Id(t.props.params.formId))),t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Документ успешно скопирован")))}).catch(function(e){return t.props.dispatch(Object(A.h)(t.props.i18n.t("Ошибка - не удалось создать копию шаблона")))})})}},{key:"render",value:function(){var e=this,t=this.props,n=t.i18n,r=t.documents,i=Object(Te.b)(r,new _.Id(this.props.params.formId)).getOrElse(function(){return[]});return f.createElement(f.Fragment,null,f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},n.t("Новый документ"))),f.createElement(P.a,{showId:!0,error:Object(Te.c)(r,new _.Id(this.props.params.formId)),fetching:Object(Te.d)(r,new _.Id(this.props.params.formId)),onRecordSelected:this.onEditRequested,empty:!Object(Te.d)(r,new _.Id(this.props.params.formId))&&0==i.length,withActions:!0,headers:[{id:"badgeType",title:n.t("Тип выдачи")},{id:"documentNullType",title:n.t("Режим аннулирования")},{id:"documentTmplate",title:n.t("Шаблон")},{id:"documentName",title:n.t("Название")}],rows:i.map(function(t){return{id:t.id.value,payload:t,fields:[Object(_.getIssueTypeName)(t.entity.issueType.tpe,e.props.i18n.t),Object(_.getAnnulmentModeName)(t.entity.annulmentMode.tpe,e.props.i18n.t),t.entity.template.map(function(e){return e.value}).getOrElse(function(){return"-"}),t.entity.name],buttons:[f.createElement(w.a,{key:"edit",style:B.f,onClick:function(n){n.stopPropagation(),e.onEditRequested(t)}},f.createElement(F.a,{style:B.g})),f.createElement(w.a,{key:"delete",style:B.f,onClick:function(n){n.stopPropagation(),e.onDeleteRequested(t)}},f.createElement(R.a,{style:B.g})),f.createElement(w.a,{key:"copy",style:B.f,onClick:function(n){n.stopPropagation(),e.onCopy(t)}},f.createElement(Z.a,{style:B.g}))]}})}))}},{key:"onDeleteRequested",value:function(e){var t=this;this.props.openDialog(this.props.i18n.t("Удаление документа"),f.createElement("p",null,this.props.i18n.t("Вы действительно хотите удалить документ? Это действие нельзя будет отменить")),[f.createElement(E.a,{variant:"raised",onClick:function(){return t.props.handleDialogClose(!1)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),f.createElement(E.a,{variant:"raised",color:"primary",onClick:function(){Object(we.b)(e.id).then(function(){t.props.dispatch(Object(we.c)(new _.Id(t.props.params.formId))),t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Документ успешно удален")))}).catch(function(e){t.props.dispatch(Object(N.a)(e))})}},this.props.i18n.t("Удалить"))])}}]),t}(f.Component);dt=ut([m.autobind],dt);var ft=Object(h.connect)(function(e){return{filtersForm:e.filtersForm,fields:e.fields,forms:e.forms,documents:e.formDocuments,eventLine:e.eventLine,i18n:e.i18n}})(Object(ye.a)(function(e){e.isTokenChecked&&(e.dispatch(Object(Y.e)(new _.Id(e.params.formId))),e.dispatch(Object(we.c)(new _.Id(e.params.formId))))},function(){},function(e,t){e.params.formId!==t.params.formId&&e.dispatch(Object(we.c)(new _.Id(e.params.formId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(we.c)(new _.Id(e.params.formId)))})(dt)),mt=n(4),ht=n.n(mt),gt=n(72),yt=n.n(gt),vt=n(631),bt=n.n(vt),Ot=n(1616),Et=n(1804),It=n(543),Ct=n.n(It),Tt=n(103),kt=n(659),wt=(n(2085),n(99)),jt=n(1920),Ft=n(98),Dt=n.n(Ft),Rt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Pt=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"onRemoveClick",value:function(){this.props.onDelete(this.props.idx)}},{key:"getFormName",value:function(){return Object(Xe.e)(this.props.forms,this.props.item.formId).map(function(e){return e.entity.name})}},{key:"getFieldCaption",value:function(){return Object(q.b)(this.props.fields,this.props.item.formId,this.props.item.fieldId).map(function(e){return e.entity.caption})}},{key:"render",value:function(){return f.createElement("div",{style:{display:"flex",alignItems:"center"}},f.createElement("div",{style:{flex:1}},this.getFormName().getOrElse(function(){return""})+" - "+this.getFieldCaption().getOrElse(function(){return""})),f.createElement(w.a,{style:{alignSelf:"center",flexShrink:0},onClick:this.onRemoveClick},f.createElement(yt.a,null)))}}]),t}(f.Component);Pt=Rt([m.autobind],Pt);var xt=Object(h.connect)(function(e,t){return{i18n:e.i18n,fields:e.fields,forms:e.forms}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Pt),St=n(384),_t=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},$t=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Lt=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={formId:new M.None,fieldId:new M.None},n}return p()(t,e),o()(t,[{key:"onFieldDelete",value:function(e){this.props.onChange(this.props.fieldItems.filter(function(t,n){return e!==n}))}},{key:"onAddClick",value:function(){var e=this;this.state.formId.foreach(function(t){e.state.fieldId.foreach(function(n){e.props.onChange(e.props.fieldItems.concat({formId:t,fieldId:n}))})})}},{key:"onFormIdChanged",value:function(e){this.setState(G(this.state,{formId:{$set:e}}))}},{key:"onFormFieldIdChange",value:function(e){this.setState(G(this.state,{fieldId:{$set:e}}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(Dt.a,null,f.createElement("h3",null,this.props.label),f.createElement("div",null,0===this.props.fieldItems.length?f.createElement("span",null,this.props.i18n.t("Ни одно поле не добавлено. Для добавления выберите форму, поле и нажмите кнопку добавить.")):this.props.fieldItems.map(function(t,n){return f.createElement(xt,{key:t.fieldId.value,idx:n,item:t,onDelete:e.onFieldDelete})}))),f.createElement("div",{style:{display:"flex"}},f.createElement("div",{style:{flex:1}},f.createElement(St.a,{native:!0,errorText:new M.None,value:this.state.formId,onChange:this.onFormIdChanged})),f.createElement("div",{style:{flex:1}},f.createElement(Ye.a,{fullWidth:!0,errorText:new M.None,fields:this.state.formId.flatMap(function(t){return Object(q.e)(e.props.fields,t)}).getOrElse(function(){return[]}).filter(function(t){return 0!==e.props.fieldsFilter.filter(function(e){return t.entity.valueType instanceof e}).length}).filter(function(t){return 0===e.props.fieldItems.filter(function(e){return e.fieldId.value===t.id.value}).length}),labelText:Object(M.toOption)("Поле"),value:this.state.fieldId,onChanged:this.onFormFieldIdChange,emptyDisabled:!0})),f.createElement("div",{style:{flex:0,flexShrink:0}},f.createElement(E.a,{variant:"raised",style:{marginLeft:"10px"},onClick:this.onAddClick,disabled:this.state.fieldId.isEmpty()||this.state.formId.isEmpty()},this.props.i18n.t("Добавить")))))}}]),t}(f.Component);Lt=_t([m.autobind,$t("design:paramtypes",[Object])],Lt);var Mt=Object(h.connect)(function(e,t){return{i18n:e.i18n,forms:e.forms,fields:e.fields}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)})(Lt),Vt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Nt=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"onTemplateIdChange",value:function(e){this.props.fields.templateId.onChange(e.value)}},{key:"renderFormDataReport",value:function(){var e=this.props.fields.reportFormatType,t=this.props.fields.templateId,n=this.props.fields.refs,r=this.props.fields.contentType,i=this.props.fields.extension;return f.createElement("div",null,f.createElement(de.a,{label:this.props.i18n.t("Файл шаблона"),fileId:Object(M.toOption)(t.value).filter(function(e){return""!==e}).map(function(e){return new _.Id(e)}),onFileIdChanged:this.onTemplateIdChange}),f.createElement(Mt,{label:this.props.i18n.t("Поля"),fieldItems:n.value||[],fieldsFilter:[_.ValueTypeObjectRefs],onChange:n.onChange}),f.createElement(ie.a,{fullWidth:!0,error:e.touched&&e.error},f.createElement(oe.a,null,this.props.i18n.t("Тип файла отчета")),f.createElement(le.a,{onChange:e.onChange,value:e.value},f.createElement(pe.a,{value:_.ReportFormatExcel.$Type.value},this.props.i18n.t("Excel")),f.createElement(pe.a,{value:_.ReportFormatText.$Type.value},this.props.i18n.t("Текстовый"))),e.touched&&e.error&&f.createElement(Ae.a,null,e.error)),e.value===_.ReportFormatText.$Type.value&&f.createElement("div",null,f.createElement(Q.a,{fullWidth:!0,value:r.value||"text/plain",onChange:r.onChange,label:this.props.i18n.t("Тип содержимого файла"),error:r.touched&&r.error,helperText:r.touched&&Object(M.toOption)(r.error).map(function(e){return e}).getOrNull()}),f.createElement(Q.a,{fullWidth:!0,value:i.value||"txt",onChange:i.onChange,label:this.props.i18n.t("Расширение файла"),error:i.touched&&i.error,helperText:i.touched&&Object(M.toOption)(i.error).map(function(e){return e}).getOrNull()})))}},{key:"render",value:function(){var e=this,t=this.props.fields,n=t.name,r=t.params,i=t.simpleSumFieldId,a=t.categoriesCountFieldId,o=t.categoryField,s=t.numericField;return f.createElement("form",null,f.createElement(Q.a,{fullWidth:!0,autoFocus:!0,value:n.value,onChange:n.onChange,label:this.props.i18n.t("Название"),error:n.touched&&n.error,helperText:n.touched&&Object(M.toOption)(n.error).map(function(e){return e}).getOrNull()}),f.createElement("h5",null,this.props.i18n.t("Фильтрация")),this.props.currentForm.data.map(function(t){return f.createElement(Ze.a,{value:e.props.filterValue,filterId:e.props.filterId,formId:t.id})}).getOrElse(function(){return f.createElement("div",null,e.props.i18n.t("Форма не загрузилась"))}),f.createElement(ie.a,{fullWidth:!0,error:r.touched&&r.error},f.createElement(oe.a,null,this.props.i18n.t("Параметры")),f.createElement(le.a,{onChange:r.onChange,value:r.value},f.createElement(pe.a,{value:_.ReportParamsRecordsCount.$Type.value},this.props.i18n.t("Подсчет анкет")),f.createElement(pe.a,{value:_.ReportParamsSimpleSum.$Type.value},this.props.i18n.t("Сумма в поле")),f.createElement(pe.a,{value:_.ReportParamsCategoriesSum.$Type.value},this.props.i18n.t("Сумма в поле с группировкой")),f.createElement(pe.a,{value:_.ReportParamsCategoriesCount.$Type.value},this.props.i18n.t("Подсчет анкет с группировкой")),f.createElement(pe.a,{value:_.ReportParamsFormDataReport.$Type.value},this.props.i18n.t("Отчет по шаблону"))),r.touched&&r.error&&f.createElement(Ae.a,null,r.error)),r.value===_.ReportParamsSimpleSum.$Type.value&&f.createElement(ie.a,{fullWidth:!0,error:i.touched&&i.error},f.createElement(oe.a,null,this.props.i18n.t("Числовое поле")),f.createElement(le.a,{onChange:i.onChange,value:i.value},this.props.currentForm.data.flatMap(function(t){return Object(M.liftKey)(e.props.formFields.list,t.id.value).map(function(e){return e.filter(function(e){return e.entity.valueType.tpe.value===_.ValueTypeNumber.$Type.value})})}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.name)})),i.touched&&i.error&&f.createElement(Ae.a,null,i.error)),r.value===_.ReportParamsCategoriesCount.$Type.value&&f.createElement(ie.a,{fullWidth:!0,error:a.touched&&a.error},f.createElement(oe.a,null,this.props.i18n.t("Поле для группировки")),f.createElement(le.a,{onChange:a.onChange,value:a.value},this.props.currentForm.data.flatMap(function(t){return Object(M.liftKey)(e.props.formFields.list,t.id.value).map(function(e){return e.filter(function(e){return e.entity.valueType.tpe.value===_.ValueTypeObjectRefs.$Type.value})})}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.name)})),a.touched&&a.error&&f.createElement(Ae.a,null,a.error)),r.value===_.ReportParamsCategoriesSum.$Type.value&&f.createElement("div",null,f.createElement(ie.a,{fullWidth:!0,error:o.touched&&o.error},f.createElement(oe.a,null,this.props.i18n.t("Поле для группировки")),f.createElement(le.a,{onChange:o.onChange,value:o.value},this.props.currentForm.data.flatMap(function(t){return Object(M.liftKey)(e.props.formFields.list,t.id.value).map(function(e){return e.filter(function(e){return e.entity.valueType.tpe.value===_.ValueTypeObjectRefs.$Type.value})})}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.name)})),o.touched&&o.error&&f.createElement(Ae.a,null,o.error)),f.createElement(ie.a,{fullWidth:!0,error:s.touched&&s.error},f.createElement(oe.a,null,this.props.i18n.t("Числовое поле")),f.createElement(le.a,{onChange:s.onChange,value:s.value},this.props.currentForm.data.flatMap(function(t){return Object(M.liftKey)(e.props.formFields.list,t.id.value).map(function(e){return e.filter(function(e){return e.entity.valueType.tpe.value===_.ValueTypeNumber.$Type.value})})}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.name)})),s.touched&&s.error&&f.createElement(Ae.a,null,s.error))),r.value===_.ReportParamsFormDataReport.$Type.value&&this.renderFormDataReport())}}]),t}(f.Component);Nt=Vt([m.autobind],Nt);var At=Object(h.connect)(function(e){return{i18n:e.i18n}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(J.reduxForm)({form:"FormReportsEditForm",fields:["name","params","simpleSumFieldId","categoriesCountFieldId","categoryField","numericField","templateId","refs","reportFormatType","contentType","extension"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение")),e.params&&0!==e.params.trim().length||(n.params=t.i18n.t("Обязательное значение")),e.params&&e.params===_.ReportParamsSimpleSum.$Type.value&&(e.simpleSumFieldId&&0!==e.simpleSumFieldId.trim().length||(n.simpleSumFieldId=t.i18n.t("Обязательное значение"))),e.params&&e.params===_.ReportParamsCategoriesCount.$Type.value&&(e.categoriesCountFieldId&&0!==e.categoriesCountFieldId.trim().length||(n.categoriesCountFieldId=t.i18n.t("Обязательное значение"))),e.params&&e.params===_.ReportParamsCategoriesSum.$Type.value&&(e.categoryField&&0!==e.categoryField.trim().length||(n.categoryField=t.i18n.t("Обязательное значение")),e.numericField&&0!==e.numericField.trim().length||(n.numericField=t.i18n.t("Обязательное значение"))),n}})(Nt)),Wt=n(811),qt=n.n(Wt),Bt=n(2514),Ht=n.n(Bt),zt=n(115),Kt=n.n(zt),Ut=n(1470),Gt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Zt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Yt=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={tableView:!0},n}return p()(t,e),o()(t,[{key:"onViewChanged",value:function(){this.setState(G(this.state,{tableView:{$set:!this.state.tableView}}))}},{key:"typeToDisplayName",value:function(e){switch(e){case _.ReportParamsSimpleSum.$Type.value:return this.props.i18n.t("Сумма в поле");case _.ReportParamsRecordsCount.$Type.value:return this.props.i18n.t("Подсчет анкет");case _.ReportParamsCategoriesSum.$Type.value:return this.props.i18n.t("Сумма в поле с группировкой");case _.ReportParamsCategoriesCount.$Type.value:return this.props.i18n.t("Подсчет анкет с группировкой");case _.ReportParamsFormDataReport.$Type.value:return this.props.i18n.t("Отчет по шаблону");default:return this.props.i18n.t("Тип отчета не определен")}}},{key:"onDownloadReportClick",value:function(e){this.props.dispatch(Object(Ut.c)(e))}},{key:"render",value:function(){var e=this;return this.props.reports.result.map(function(t){return t.data.tpe.value===_.ReportDataSum.$Type.value?f.createElement("div",null,f.createElement(Kt.a,{id:"tooltip-view-icon",title:e.state.tableView?e.props.i18n.t("График"):e.props.i18n.t("Таблица"),placement:"right"},f.createElement(w.a,{key:"view",onClick:e.onViewChanged},e.state.tableView?f.createElement(Ht.a,null):f.createElement(qt.a,null))),e.state.tableView?f.createElement(P.a,{showId:!1,error:e.props.reports.resultError||new M.None,fetching:e.props.reports.resultFetching,empty:!e.props.reports.resultFetching&&!e.props.reports.result.nonEmpty(),withActions:!1,headers:[{id:"reportName",title:e.props.i18n.t("Название")},{id:"reportType",title:e.props.i18n.t("Тип")},{id:"reportResult",title:e.props.i18n.t("Результат")}],rows:[{id:e.props.report.id.value,payload:e.props.report,fields:[e.props.report.entity.name,e.typeToDisplayName(e.props.report.entity.params.tpe.value),t.data.value],buttons:[]}]}):f.createElement("div",null,"Graphic")):t.data.tpe.value===_.ReportDataGroupSum.$Type.value?f.createElement("div",null,f.createElement(Kt.a,{id:"tooltip-view-icon",title:e.state.tableView?e.props.i18n.t("График"):e.props.i18n.t("Таблица"),placement:"right"},f.createElement(w.a,{key:"view",onClick:e.onViewChanged},e.state.tableView?f.createElement(Ht.a,null):f.createElement(qt.a,null))),e.state.tableView?f.createElement(P.a,{showId:!1,error:e.props.reports.resultError||new M.None,fetching:e.props.reports.resultFetching,empty:!e.props.reports.resultFetching&&!e.props.reports.result.nonEmpty(),withActions:!1,headers:[{id:"reportResult",title:e.props.i18n.t("Категория")},{id:"reportResult",title:e.props.i18n.t("Результат")}],rows:t.data.xs.map(function(t){return{id:e.props.report.id.value,payload:e.props.report,fields:[Object(M.liftKey)(e.props.formDataIdtoNameMapping,t[0].value).getOrElse(function(){return""}),Object(M.lift)(t,1).getOrElse(function(){return""})],buttons:[]}})}):f.createElement("div",null,"Graphic")):t.data.tpe.value===_.ReportDataReportFile.$Type.value?f.createElement(E.a,{onClick:function(n){return e.onDownloadReportClick(t.data.meta.id)}},t.data.meta.entity.originalName):void 0}).getOrNull()}}]),t}(f.Component);Yt=Gt([m.autobind,Zt("design:paramtypes",[Object])],Yt);var Jt=Object(h.connect)(function(e,t){return{i18n:e.i18n}})(Yt),Xt=n(653),Qt=n(146),en=n(443),tn=n(294),nn=n(188),rn=n(902),an=n.n(rn),on=n(901),sn=n.n(on),ln=n(43),cn=n.n(ln),pn=n(83),un=n(437),dn=n.n(un),fn=n(432),mn=n.n(fn),hn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},gn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"render",value:function(){var e=this.props.fields,t=e.blockId,n=e.filter,r=e.filterId;return f.createElement("form",null,f.createElement(Ze.a,{formId:this.props.formId,filterId:r.value,initialValue:""===n.value?new M.None:n.value}),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,{shrink:!0},this.props.i18n.t("Блок")),f.createElement(le.a,{native:!0,value:t.value,onChange:t.onChange},f.createElement("option",null),this.props.blockDesc.map(function(e){return f.createElement("option",{key:e.id.toString(),value:e.id.toString()},e.name)})),t.touched&&t.error&&f.createElement(Ae.a,null,t.error)))}}]),t}(f.Component);gn=hn([m.autobind],gn);var yn=Object(h.connect)(function(e){return{i18n:e.i18n}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(J.reduxForm)({form:"blockFilterConfigurationForm",fields:["filterId","filter","blockId"],validate:function(e,t){var n={};return e.blockId&&0!==e.blockId.trim().length||(n.blockId=t.i18n.t("Обязательное значение")),n}})(Object(pn.a)(gn))),vn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},bn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"onBlockFilterConfigurationDialogOpen",value:function(e,t,n){var r=this,i=void 0,a=this.props.openDialog(e,f.createElement(yn,{ref:function(e){return i=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},formId:this.props.formId,blockDesc:this.props.blockDesc,onSubmit:function(e){return t(e,a)},initialValues:n}),[f.createElement(E.a,{variant:"raised",onClick:function(){r.props.handleDialogClose(a)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),f.createElement(E.a,{variant:"raised",onClick:function(){return i.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"onCreateRequested",value:function(){var e=this;this.onBlockFilterConfigurationDialogOpen(this.props.i18n.t("Создание фильтра"),function(t,n){var r=e.props.fields.blockFilters;Object(ke.b)(e.props.filtersForm,t.filterId).map(function(e){return r.onChange([].concat(cn()(r.value),[new _.BlockFilter(new _.Id(t.blockId),e)]))}),e.props.handleDialogClose(n)},{filterId:new _.Id(je.v4())})}},{key:"onEdit",value:function(e,t){var n=this;this.onBlockFilterConfigurationDialogOpen(this.props.i18n.t("Редактирование фильтра"),function(e,r){var i=n.props.fields.blockFilters;Object(ke.b)(n.props.filtersForm,e.filterId).map(function(n){return i.onChange([].concat(cn()(i.value.slice(0,t)),[new _.BlockFilter(new _.Id(e.blockId),n)],cn()(i.value.slice(t+1))))}),n.props.handleDialogClose(r)},{blockId:e.id.value,filter:Object(M.toOption)(e.filter),filterId:new _.Id(je.v4())})}},{key:"onDelete",value:function(e){var t=this.props.fields.blockFilters;t.onChange([].concat(cn()(t.value.slice(0,e)),cn()(t.value.slice(e+1))))}},{key:"onSwapActions",value:function(e,t){var n=this.props.fields.blockFilters.value;if(void 0!==n[e]&&void 0!==n[t]){var r=e>t?t:e,i=e>t?e:t,a=[].concat(cn()(n.slice(0,r)),[n[i]],cn()(n.slice(r+1,i)),[n[r]],cn()(n.slice(i+1)));this.props.fields.blockFilters.onChange(a)}}},{key:"render",value:function(){var e=this;return f.createElement("form",null,f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Создать"))),f.createElement(P.a,{showId:!0,error:new M.None,fetching:!1,onRecordSelected:this.onEdit,empty:0===this.props.fields.blockFilters.value.length,withActions:!0,headers:[{id:"blockName",title:this.props.i18n.t("Блок")}],rows:this.props.fields.blockFilters.value.map(function(t,n){return{id:n.toString(),payload:t,fields:[Object(M.headOption)(e.props.blockDesc.filter(function(e){return e.id===t.id.value})).map(function(e){return e.name}).getOrElse(function(){return""})],buttons:[f.createElement(w.a,{style:B.f,key:"edit",onClick:function(){return e.onEdit(t,n)}},f.createElement(F.a,{style:B.g})),f.createElement(w.a,{style:B.f,key:"delete",onClick:function(){return e.onDelete(n)}},f.createElement(R.a,{style:B.g})),f.createElement(w.a,{style:B.f,onClick:function(){return e.onSwapActions(n,n-1)}},f.createElement(dn.a,{style:B.g})),f.createElement(w.a,{style:B.f,onClick:function(){return e.onSwapActions(n,n+1)}},f.createElement(mn.a,{style:B.g}))]}})}))}}]),t}(f.Component);bn=vn([m.autobind],bn);var On=Object(h.connect)(function(e){return{i18n:e.i18n,filtersForm:e.filtersForm}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(J.reduxForm)({form:"blockFilterListConfigurationForm",fields:["blockFilters"],validate:function(e,t){return{}}})(Object(pn.a)(bn))),En=n(45),In=n.n(En),Cn=n(48),Tn=n(105),kn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},wn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},jn=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={required:e.limit.limitType.required,emptyCategoryAllowed:e.limit.limitType instanceof _.LimitTypeLinkedFieldType&&e.limit.limitType.emptyCategoryAllowed},n}return p()(t,e),o()(t,[{key:"handleLimitRequiredChanged",value:function(e,t){var n=this;this.setState(G(this.state,{required:{$set:t}}),function(){n.props.onChange(G(n.props.limit,{limitType:Object.assign({required:{$set:t}},n.props.limit.limitType instanceof _.LimitTypeLinkedFieldType?{emptyCategoryAllowed:{$set:n.state.emptyCategoryAllowed}}:{})}),n.props.idx)})}},{key:"handleLimitEmptyCategoryAllowedChanged",value:function(e,t){var n=this;this.setState(G(this.state,{emptyCategoryAllowed:{$set:t}}),function(){n.props.onChange(G(n.props.limit,{limitType:{required:{$set:n.state.required},emptyCategoryAllowed:{$set:t}}}),n.props.idx)})}},{key:"render",value:function(){return f.createElement("div",{style:{margin:10}},f.createElement("div",null,f.createElement(Ve.a,{label:this.props.i18n.t("Запрещать при отсутствии значения лимита"),labelPlacement:"start",control:f.createElement(xe.a,{checked:this.state.required,onChange:this.handleLimitRequiredChanged})})),this.props.limit.limitType instanceof _.LimitTypeLinkedFieldType&&f.createElement("div",null,f.createElement(Ve.a,{label:this.props.i18n.t("Не проверять при отсутствии значения поля"),labelPlacement:"start",control:f.createElement(xe.a,{checked:this.state.emptyCategoryAllowed,onChange:this.handleLimitEmptyCategoryAllowedChanged})})))}}]),t}(f.Component);jn=kn([m.autobind,wn("design:paramtypes",[Object])],jn);var Fn=Object(h.connect)(function(e,t){return{i18n:e.i18n}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,n,t)},{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(jn),Dn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Rn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Pn=0,xn="!not_display",Sn=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.fileInput=new M.None,n.state={loaded:!1,changed:!1,editBlock:new M.None,createBlock:new M.None,viewBlock:new M.None,groupEditBlock:new M.None,groupTableConfig:new M.None,dataListConfigId:new M.None,dataListTableId:new M.None,dataListKanbanId:new M.None,dataListCalendarId:new M.None,dataListTasksId:new M.None,showModeIcons:!1,selectedIndex:Pn,limits:[],uploadLimitId:new M.None,defaultTable:!1},n}return p()(t,e),o()(t,[{key:"fileInputHandler",value:function(e){this.fileInput=Object(M.toOption)(e)}},{key:"componentDidMount",value:function(){this.props.dispatch(Object(Xt.d)(new _.Id(this.props.params.formId))),this.props.dispatch(Object(nn.b)(new _.Id(this.props.params.formId)))}},{key:"componentDidUpdate",value:function(e,t){var n=this;e.form.fetching||this.state.loaded||e.form.data.foreach(function(e){return n.setState(G(n.state,{loaded:{$set:!0},createBlock:{$set:e.entity.createBlock},editBlock:{$set:e.entity.editBlock},viewBlock:{$set:e.entity.viewBlock},groupEditBlock:{$set:e.entity.groupEditBlock},groupTableConfig:{$set:e.entity.groupTableConfig},dataListConfigId:{$set:e.entity.dataListView.currentConfigId.map(function(e){return e.id})},limits:{$set:e.entity.limits},dataListTableId:{$set:e.entity.dataListView.dataListMode.tableId.map(function(e){return e.id})},dataListKanbanId:{$set:e.entity.dataListView.dataListMode.kanbanId.map(function(e){return e.id})},dataListCalendarId:{$set:e.entity.dataListView.dataListMode.calendarId.map(function(e){return e.id})},dataListTasksId:{$set:e.entity.dataListView.dataListMode.tasksId.map(function(e){return e.id})},showModeIcons:{$set:e.entity.dataListView.dataListMode.showModeIcons.getOrElse(function(){return!1})},defaultTable:{$set:e.entity.dataListView.dataListMode.defaultTable}}))})}},{key:"blockSelector",value:function(e,t,n){var r=this,i=this.state.editBlock.map(function(e){return e.filters}).getOrElse(function(){return[]}),a=this.state.viewBlock.map(function(e){return e.filters}).getOrElse(function(){return[]}),o=i.length>0?f.createElement(Ot.a,{style:{fill:"#E91E63"}}):f.createElement(Et.a,null),s=a.length>0?f.createElement(Ot.a,{style:{fill:"#E91E63"}}):f.createElement(Et.a,null);return f.createElement("div",{style:{display:"flex",flexWrap:"nowrap"}},f.createElement(ie.a,{style:{width:"90%",marginRight:10}},f.createElement(oe.a,null,t),f.createElement(le.a,{native:!0,value:e.map(function(e){return e.value}).getOrElse(function(){return""}),onChange:n},f.createElement("option",null),Object(Tt.c)(this.props.blocks,new _.Id(this.props.params.formId)).getOrElse(function(){return[]}).map(function(e){return f.createElement("option",{key:e.id.toString(),value:e.id.toString()},e.name)}))),(n===this.onEditBlockChanged||n===this.onViewBlockChanged)&&!ue.default.isA5000&&f.createElement("div",null,f.createElement(w.a,{style:{margin:"25px 10px 0 0"},onClick:function(){return r.onBlockFilterConfigurationAdd(n)}},n===this.onEditBlockChanged?o:s)))}},{key:"onBlockFilterConfigurationDialogOpen",value:function(e,t,n){var r=this,i=void 0;this.props.openDialog(e,f.createElement(On,{ref:function(e){return i=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},formId:new _.Id(this.props.params.formId),blockDesc:Object(Tt.c)(this.props.blocks,new _.Id(this.props.params.formId)).getOrElse(function(){return[]}),onSubmit:function(e){return t(e)},initialValues:n}),[f.createElement(E.a,{variant:"raised",onClick:function(){r.props.handleDialogClose(!1)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),f.createElement(E.a,{variant:"raised",onClick:function(){return i.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"onBlockFilterConfigurationAdd",value:function(e){var t=this;this.onBlockFilterConfigurationDialogOpen(function(e){return e===t.onEditBlockChanged?t.props.i18n.t("Настройка фильтра блока редактирования"):t.props.i18n.t("Настройка фильтра блока просмотра")}(e),function(n){e===t.onEditBlockChanged&&t.setState(G(t.state,{editBlock:{$set:t.state.editBlock.map(function(e){return G(e,{filters:{$set:n.blockFilters}})})},changed:{$set:!0}}),function(){return t.onSaved()}),e===t.onViewBlockChanged&&t.setState(G(t.state,{viewBlock:{$set:t.state.viewBlock.map(function(e){return G(e,{filters:{$set:n.blockFilters}})})},changed:{$set:!0}}),function(){return t.onSaved()}),t.props.handleDialogClose(!1)},{blockFilters:function(e){return e===t.onEditBlockChanged?t.state.editBlock.map(function(e){return e.filters}).getOrElse(function(){return[]}):t.state.viewBlock.map(function(e){return e.filters}).getOrElse(function(){return[]})}(e)})}},{key:"onEditBlockChanged",value:function(e){this.setState(G(this.state,{editBlock:{$set:Object(M.toOption)(this.state.editBlock.map(function(t){return G(t,{defaultId:{$set:new _.Id(e.target.value)}})}).getOrElse(function(){return new _.BlockFilterList([],new _.Id(e.target.value))}))},changed:{$set:!0}}))}},{key:"onCreateBlockChanged",value:function(e){this.setState(G(this.state,{createBlock:{$set:new M.Some(new _.Id(e.target.value))},changed:{$set:!0}}))}},{key:"onViewBlockChanged",value:function(e){this.setState(G(this.state,{viewBlock:{$set:Object(M.toOption)(this.state.viewBlock.map(function(t){return G(t,{defaultId:{$set:new _.Id(e.target.value)}})}).getOrElse(function(){return new _.BlockFilterList([],new _.Id(e.target.value))}))},changed:{$set:!0}}))}},{key:"onGroupEditBlockChanged",value:function(e){this.setState(G(this.state,{groupEditBlock:{$set:new M.Some(new _.Id(e.target.value))},changed:{$set:!0}}))}},{key:"onGroupTableConfigEnabledChanged",value:function(e,t){var n=this;this.state.groupTableConfig.map(function(e){return n.setState(G(n.state,{groupTableConfig:{$set:new M.Some(G(e,{enabled:{$set:t}}))},changed:{$set:!0}}))}).getOrElse(function(){return n.setState(G(n.state,{groupTableConfig:{$set:new M.Some(new _.FormGroupTableConfig(t,new _.Id(""),[]))},changed:{$set:!0}}))})}},{key:"onGroupTableConfigGroupFieldChanged",value:function(e){var t=this;e.foreach(function(e){return t.state.groupTableConfig.map(function(n){return t.setState(G(t.state,{groupTableConfig:{$set:new M.Some(G(n,{groupField:{$set:e}}))},changed:{$set:!0}}))}).getOrElse(function(){return t.setState(G(t.state,{groupTableConfig:{$set:new M.Some(new _.FormGroupTableConfig(!1,new _.Id(""),[]))},changed:{$set:!0}}))})})}},{key:"onGroupTableConfigFieldsChanged",value:function(e){var t=this;this.state.groupTableConfig.map(function(n){return t.setState(G(t.state,{groupTableConfig:{$set:new M.Some(G(n,{fields:{$set:e.map(function(e){return e.fieldId})}}))},changed:{$set:!0}}))}).getOrElse(function(){return t.setState(G(t.state,{groupTableConfig:{$set:new M.Some(new _.FormGroupTableConfig(!1,new _.Id(""),e.map(function(e){return e.fieldId})))},changed:{$set:!0}}))})}},{key:"ondataListConfigIdChanged",value:function(e){this.setState(G(this.state,{dataListConfigId:{$set:"!empty"===e.target.value?new M.None:Object(M.toOption)(e.target.value)},changed:{$set:!0}}))}},{key:"onDataListTableIdChanged",value:function(e){this.setState(G(this.state,{dataListTableId:{$set:e.target.value===xn?new M.None:Object(M.toOption)(e.target.value)},changed:{$set:!0}}))}},{key:"onDataListKanbanIdChanged",value:function(e){this.setState(G(this.state,{dataListKanbanId:{$set:e.target.value===xn?new M.None:Object(M.toOption)(e.target.value)},changed:{$set:!0}}))}},{key:"onDataListCalendarIdChanged",value:function(e){this.setState(G(this.state,{dataListCalendarId:{$set:e.target.value===xn?new M.None:Object(M.toOption)(e.target.value)},changed:{$set:!0}}))}},{key:"onDataListTasksIdChanged",value:function(e){this.setState(G(this.state,{dataListTasksId:{$set:e.target.value===xn?new M.None:Object(M.toOption)(e.target.value)},changed:{$set:!0}}))}},{key:"handleUserCurrentCofigId",value:function(e){var t=this;this.props.form.data.foreach(function(n){n.entity.dataListView.currentConfigId.foreach(function(r){return t.props.dispatch(Object(Cn.cb)({formId:n.id,configId:new _.OptionalValue(!0,Object(M.toOption)(r).filter(function(t){return e}))}))})})}},{key:"onShowModeIconsChanged",value:function(e){this.handleUserCurrentCofigId(e.target.checked),this.setState(G(this.state,{showModeIcons:{$set:e.target.checked},changed:{$set:!0}}))}},{key:"onDefaultTableChanged",value:function(e){this.setState(G(this.state,{changed:{$set:!0},defaultTable:{$set:e.target.checked}}))}},{key:"handleLimitAdded",value:function(){var e=this;Object(M.headOption)(Object(q.e)(this.props.fields,new _.Id(this.props.params.formId)).getOrElse(function(){return[]})).foreach(function(t){e.setState(G(e.state,{limits:{$push:[new _.MembersLimitType(t.id,new _.LimitTypeTotalLimitType(je.v4()))]},changed:{$set:!0}}))})}},{key:"handleMemberFieldIdChanged",value:function(e,t,n){var r=this;e.foreach(function(e){r.setState(G(r.state,{limits:{$splice:[[t,1,G(n,{memberFieldId:{$set:e},limitType:{$set:r.updateLimitTypeIdByFieldId(n,e)}})]]},changed:{$set:!0}}))})}},{key:"updateLimitTypeIdByFieldId",value:function(e,t){var n=e.limitType;return G(n,{id:{$set:this.props.params.formId+"-"+t.value+(n.tpe.value===_.LimitTypeLinkedFieldType.$Type.value?"-"+n.memberTypeId.value:"")}})}},{key:"handleLimitTypeChanged",value:function(e,t,n){this.setState(G(this.state,{limits:{$splice:[[t,1,G(e,{limitType:{$set:this.getLimitType(n,e)}})]]},changed:{$set:!0}}))}},{key:"handleLimitLinkedFieldIdChanged",value:function(e,t,n){this.setState(G(this.state,{limits:{$splice:[[t,1,G(e,{limitType:{memberTypeId:{$set:n},id:{$set:this.props.params.formId+"-"+e.memberFieldId.value+"-"+n.value}}})]]},changed:{$set:!0}}))}},{key:"handleLimitDeleted",value:function(e){this.setState(G(this.state,{limits:{$splice:[[e,1]]},changed:{$set:!0}}))}},{key:"getLimitTypeLabel",value:function(e){switch(e.value){case _.LimitTypeLinkedFieldType.$Type.value:return this.props.i18n.t("Ограничение по связанному поле");case _.LimitTypeTotalLimitType.$Type.value:return this.props.i18n.t("Ограничение по всем значениям");default:throw"Unknown limit type"}}},{key:"getLimitType",value:function(e,t){switch(e){case _.LimitTypeLinkedFieldType.$Type.value:return new _.LimitTypeLinkedFieldType(this.props.params.formId+"-"+t.memberFieldId.value+"-",new _.Id(""));case _.LimitTypeTotalLimitType.$Type.value:return new _.LimitTypeTotalLimitType(this.props.params.formId+"-"+t.memberFieldId.value);default:throw"Unknown limit type"}}},{key:"onSaved",value:function(){var e=this;this.props.form.data.foreach(function(t){return Object(Je.n)(t.id,t.entity.formType,t.entity.name,t.entity.eventLineId,e.state.editBlock,e.state.createBlock,e.state.viewBlock,e.state.groupEditBlock,e.state.groupTableConfig,e.state.dataListConfigId.map(function(e){return new _.DataListConfigId(e)}),G(t.entity.dataListView.dataListMode,{tableId:{$set:e.state.dataListTableId.map(function(e){return new _.DataListConfigId(e)})},kanbanId:{$set:e.state.dataListKanbanId.map(function(e){return new _.DataListConfigId(e)})},calendarId:{$set:e.state.dataListCalendarId.map(function(e){return new _.DataListConfigId(e)})},tasksId:{$set:e.state.dataListTasksId.map(function(e){return new _.DataListConfigId(e)})},showModeIcons:{$set:Object(M.toOption)(e.state.showModeIcons)},defaultTable:{$set:e.state.defaultTable}})).then(function(n){e.setState(G(e.state,{changed:{$set:!1}}),function(){Object(Je.m)(t.id,e.state.limits).then(function(){return e.props.dispatch(Object(Je.e)())})})})})}},{key:"selectPage",value:function(e){this.setState(G(this.state,{selectedIndex:{$set:e}}))}},{key:"onUploadLimitsClick",value:function(e){var t=this;this.fileInput.foreach(function(n){n.click(),t.setState(G(t.state,{uploadLimitId:{$set:Object(M.toOption)(e)}}))})}},{key:"onLimitChanged",value:function(e,t){this.setState(G(this.state,{limits:{$splice:[[t,1,e]]},changed:{$set:!0}}))}},{key:"onLimitSettingsRequested",value:function(e,t,n){this.props.openPopover(Object(M.toOption)(e.currentTarget),f.createElement(Fn,{idx:n,limit:t,onChange:this.onLimitChanged}))}},{key:"importLimitsFileChanged",value:function(e){var t=this,n=e.target.files[e.target.files.length-1];Object(wt.h)(n,this.props.cdnAddress,this.props.auth.token,this.props.organisation.organisationId,this.props.eventLine.eventLineId,new M.None,new M.None).then(function(e){t.state.uploadLimitId.map(function(n){Object(jt.c)(e,new _.Id(t.props.params.formId),n).then(function(){t.props.dispatch(Object(A.h)(t.props.i18n.t("Лимиты были успешно загружены")))}).catch(function(){t.props.dispatch(Object(A.h)(t.props.i18n.t("Лимиты не удалось применить")))})})}).catch(function(e){t.props.dispatch(Object(A.h)(t.props.i18n.t("Файл лимитов не удалось загрузить"))),console.log("File uploaded with error",e)})}},{key:"onReportCreateRequest",value:function(){var e=this,t=new _.Id(je.v4()),n=void 0;this.props.openDialog(this.props.i18n.t("Создание отчета"),f.createElement(At,{ref:function(e){return n=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},onSubmit:function(n){return function(n){return new Promise(function(r,i){return Object(Xt.a)(new _.ReportConfig(n.name,new _.Id(e.props.params.formId),Object(M.liftKey)(e.props.filtersForm.filter,t.value),e.typeToReportParams(n))).then(function(t){r(t),e.props.dispatch(Object(Qt.g)(t)),e.props.dispatch(Object(Xt.d)(new _.Id(e.props.params.formId))),e.props.dispatch(Object(A.h)(e.props.i18n.t("Отчет успешно создан"))),e.props.handleDialogClose(!1)}).catch(function(e){i(e)})}).catch(function(t){return e.props.dispatch(Object(N.b)(t))})}(n)},formFields:this.props.fields,currentForm:this.props.form,filterId:t,filterValue:new M.None}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return e.props.handleDialogClose(!1)}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return n.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"paramsTypeToInitialValues",value:function(e){switch(e.entity.params.tpe.value){case _.ReportParamsSimpleSum.$Type.value:return{simpleSumFieldId:e.entity.params.fieldId.value};case _.ReportParamsRecordsCount.$Type.value:return{};case _.ReportParamsCategoriesSum.$Type.value:return{categoryField:e.entity.params.categoryField.value,numericField:e.entity.params.numericField.value};case _.ReportParamsCategoriesCount.$Type.value:return{categoriesCountFieldId:e.entity.params.fieldId.value};case _.ReportParamsFormDataReport.$Type.value:return{templateId:e.entity.params.templateId.value,reportFormatType:e.entity.params.format.tpe.value,refs:e.entity.params.refs||[],contentType:e.entity.params.format instanceof _.ReportFormatText?e.entity.params.format.contentType:"",extension:e.entity.params.format instanceof _.ReportFormatText?e.entity.params.format.extension:""};default:return{}}}},{key:"getReportFormat",value:function(e){switch(e.reportFormatType){case _.ReportFormatExcel.$Type.value:return new _.ReportFormatExcel;case _.ReportFormatText.$Type.value:return new _.ReportFormatText(e.contentType,e.extension);default:return new _.ReportFormatExcel}}},{key:"getReportParamsFormData",value:function(e){return new _.ReportParamsFormDataReport(new _.Id(e.templateId),(e.refs||[]).map(function(e){return new _.ReportRefField(e.formId,e.fieldId)}),this.getReportFormat(e))}},{key:"typeToReportParams",value:function(e){switch(e.params){case _.ReportParamsSimpleSum.$Type.value:return new _.ReportParamsSimpleSum(new _.Id(e.simpleSumFieldId));case _.ReportParamsRecordsCount.$Type.value:return new _.ReportParamsRecordsCount;case _.ReportParamsCategoriesSum.$Type.value:return new _.ReportParamsCategoriesSum(new _.Id(e.categoryField),new _.Id(e.numericField));case _.ReportParamsCategoriesCount.$Type.value:return new _.ReportParamsCategoriesCount(new _.Id(e.categoriesCountFieldId));case _.ReportParamsFormDataReport.$Type.value:return this.getReportParamsFormData(e);default:return new _.ReportParamsRecordsCount}}},{key:"onReportEditRequest",value:function(e){var t=this,n=new _.Id(je.v4()),r=void 0;this.props.openDialog(this.props.i18n.t("Редактирование отчета"),f.createElement(At,{ref:function(e){return r=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},onSubmit:function(r){return function(r){return new Promise(function(i,a){return Object(Xt.f)(G(e,{entity:{name:{$set:r.name},filter:{$set:Object(M.liftKey)(t.props.filtersForm.filter,n.value)},params:{$set:t.typeToReportParams(r)}}})).then(function(e){i(e),t.props.dispatch(Object(Qt.l)(e)),t.props.dispatch(Object(Xt.d)(new _.Id(t.props.params.formId))),t.props.dispatch(Object(A.h)(t.props.i18n.t("Изменения в отчете успешно сохранены"))),t.props.handleDialogClose(!1)}).catch(function(e){a(e)})}).catch(function(e){return t.props.dispatch(Object(N.b)(e))})}(r)},formFields:this.props.fields,currentForm:this.props.form,filterId:n,filterValue:e.entity.filter,initialValues:Object.assign({name:e.entity.name,params:e.entity.params.tpe.value},this.paramsTypeToInitialValues(e))}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(!1)}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return r.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"onReportDeleteRequested",value:function(e){var t=this;this.props.openDialog(this.props.i18n.t("Удаление отчета"),f.createElement("div",null,this.props.i18n.t("Вы действительно хотите удалить отчет, это действие нельзя будет отменить?")),[f.createElement(E.a,{variant:"raised",onClick:function(){t.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Нет")),f.createElement(E.a,{variant:"raised",onClick:function(){Object(Xt.b)(e.id).then(function(e){t.props.dispatch(Object(Qt.h)(e)),t.props.dispatch(Object(Xt.d)(new _.Id(t.props.params.formId))),t.props.handleDialogClose(!0),t.props.dispatch(Object(A.h)(t.props.i18n.t("Отчет успешно удалён")))}).catch(function(e){t.props.dispatch(Object(N.b)(e))})},color:"primary"},this.props.i18n.t("Да"))])}},{key:"onReportResultsOpenRequest",value:function(e){var t=this;this.props.dispatch(Object(Xt.c)(e.id)).then(function(n){t.props.reports.result.map(function(n){if(n.data.tpe.value!==_.ReportDataSum.$Type.value&&n.data.tpe.value!==_.ReportDataReportFile.$Type.value||t.props.openDialog(t.props.i18n.t("Просмотр отчета"),f.createElement(Jt,{report:e,formDataIdtoNameMapping:{},reports:t.props.reports}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(!1)}},t.props.i18n.t("Закрыть"))]),n.data.tpe.value===_.ReportDataGroupSum.$Type.value){var r=e.entity.params.tpe.value===_.ReportParamsCategoriesSum.$Type.value?"categoryField":"fieldId",i=Object(M.headOption)(Object(q.e)(t.props.fields,new _.Id(t.props.params.formId)).getOrElse(function(){return[]}).filter(function(t){return t.id.value===e.entity.params[r].value})).map(function(e){return e.entity.valueType.family.value}).getOrElse(function(){throw new Error("ref field form was not found")}),a=t.props.reports.result.map(function(e){return e.data.xs.map(function(e){return e[0]})}).getOrElse(function(){return[]});t.props.dispatch(Object(tn.b)(new _.Id(i),a,new M.None,a.length)).then(function(n){var r=Object(M.liftKey)(t.props.formRecords.result,i).flatMap(function(e){return e}).map(function(e){return e.records}).getOrElse(function(){return[]}).reduce(function(e,t){return Object.assign(e,ht()({},t.id.value,Object(M.headOption)(Object(en.a)(t.entity.values)).map(function(e){return e.value.toString()}).getOrElse(function(){return""})))},{});t.props.openDialog(t.props.i18n.t("Просмотр отчета"),f.createElement(Jt,{report:e,formDataIdtoNameMapping:r,reports:t.props.reports}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(!1)}},t.props.i18n.t("Закрыть"))])})}})})}},{key:"renderLimits",value:function(){var e=this,t=this.props.i18n;return f.createElement("div",{style:{display:"flex",flex:1,flexDirection:"column"}},f.createElement("div",{style:{flex:1,overflowY:"auto"}},this.state.limits.map(function(t,n){return f.createElement("div",{key:n,style:{display:"flex",marginTop:"10px"}},f.createElement("div",{style:{width:"50%",marginRight:"10px"}},f.createElement(Ye.a,{fullWidth:!0,errorText:new M.None,fields:Object(q.e)(e.props.fields,new _.Id(e.props.params.formId)).getOrElse(function(){return[]}),labelText:new M.Some(e.props.i18n.t("Поле")),onChanged:function(r){return e.handleMemberFieldIdChanged(r,n,t)},value:Object(M.toOption)(t.memberFieldId)})),f.createElement("div",{style:{width:"50%",marginRight:"10px"}},f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,e.props.i18n.t("Тип ограничения")),f.createElement(le.a,{onChange:function(r){return e.handleLimitTypeChanged(t,n,r.target.value)},value:t.limitType.tpe.value},_.limitTypes.map(function(t,n){return f.createElement(pe.a,{key:n,value:t.value},e.getLimitTypeLabel(t))})))),t.limitType instanceof _.LimitTypeLinkedFieldType&&Object(M.headOption)(Object(q.e)(e.props.fields,new _.Id(e.props.params.formId)).getOrElse(function(){return[]}).filter(function(e){return e.id.value===t.memberFieldId.value})).filter(function(e){return e.entity.valueType instanceof _.ValueTypeObjectRefs}).map(function(r){return f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,{htmlFor:"linked-field"},e.props.i18n.t("Поле связанной формы")),f.createElement(le.a,{value:t.limitType.memberTypeId.value,onChange:function(r){return e.handleLimitLinkedFieldIdChanged(t,n,new _.Id(r.target.value))}},Object(q.e)(e.props.fields,r.entity.valueType.family).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeObjectRefs}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.caption)})))}).getOrElse(function(){return f.createElement("div",null)}),f.createElement(w.a,{style:{alignSelf:"center"},onClick:function(r){e.onLimitSettingsRequested(r,t,n)}},f.createElement(Ct.a,null)),f.createElement(w.a,{style:{alignSelf:"center"},onClick:function(){return e.onUploadLimitsClick(t.limitType.id)}},f.createElement(bt.a,null)),f.createElement(w.a,{style:{alignSelf:"center"},onClick:function(){return e.handleLimitDeleted(n)}},f.createElement(yt.a,null)))})),f.createElement("div",null,f.createElement(E.a,{variant:"raised",onClick:this.handleLimitAdded},this.props.i18n.t("Добавить поле"))),f.createElement("div",null,f.createElement(E.a,{variant:"raised",disabled:!this.state.changed,onClick:this.onSaved},t.t("Сохранить"))))}},{key:"renderListConfigs",value:function(){return ue.default.isA5000?f.createElement(f.Fragment,null):f.createElement(f.Fragment,null,f.createElement("h4",null,this.props.i18n.t("Настройки переключения режимов списка")),f.createElement(ie.a,{style:{width:"90%",marginTop:0}},f.createElement(oe.a,{htmlFor:"list-config-table"},this.props.i18n.t("Таблица")),f.createElement(le.a,{value:this.state.dataListTableId.getOrElse(function(){return xn}),onChange:this.onDataListTableIdChanged,disabled:this.state.defaultTable},f.createElement(pe.a,{key:"notDispay",value:xn},this.props.i18n.t(this.state.defaultTable?"":"Не отображать")),this.props.form.data.map(function(e){return e.entity.dataListView.configs}).getOrElse(function(){return[]}).filter(function(e){return e instanceof _.DataListConfigTable}).map(function(e){return f.createElement(pe.a,{key:e.id.id,value:e.id.id},e.name)}))),f.createElement(Ve.a,{label:this.props.i18n.t("По умолчанию"),control:f.createElement(In.a,{checked:this.state.defaultTable,onChange:this.onDefaultTableChanged})}),f.createElement(ie.a,{style:{width:"90%"}},f.createElement(oe.a,{htmlFor:"list-config-kanban"},this.props.i18n.t("Канбан")),f.createElement(le.a,{value:this.state.dataListKanbanId.getOrElse(function(){return xn}),onChange:this.onDataListKanbanIdChanged},f.createElement(pe.a,{key:"default",value:xn},this.props.i18n.t("Не отображать")),this.props.form.data.map(function(e){return e.entity.dataListView.configs}).getOrElse(function(){return[]}).filter(function(e){return e instanceof _.DataListConfigKanban}).map(function(e){return f.createElement(pe.a,{key:e.id.id,value:e.id.id},e.name)}))),f.createElement(ie.a,{style:{width:"90%"}},f.createElement(oe.a,{htmlFor:"list-config-calendar"},this.props.i18n.t("Календарь")),f.createElement(le.a,{value:this.state.dataListCalendarId.getOrElse(function(){return xn}),onChange:this.onDataListCalendarIdChanged},f.createElement(pe.a,{key:"default",value:xn},this.props.i18n.t("Не отображать")),this.props.form.data.map(function(e){return e.entity.dataListView.configs}).getOrElse(function(){return[]}).filter(function(e){return e instanceof _.DataListConfigCalendar}).map(function(e){return f.createElement(pe.a,{key:e.id.id,value:e.id.id},e.name)}))),f.createElement(ie.a,{style:{width:"90%"}},f.createElement(oe.a,{htmlFor:"list-config-calendar"},this.props.i18n.t("Задачи")),f.createElement(le.a,{value:this.state.dataListTasksId.getOrElse(function(){return xn}),onChange:this.onDataListTasksIdChanged},f.createElement(pe.a,{key:"default",value:xn},this.props.i18n.t("Не отображать")),this.props.form.data.map(function(e){return e.entity.dataListView.configs}).getOrElse(function(){return[]}).filter(function(e){return e instanceof _.DataListConfigTasks}).map(function(e){return f.createElement(pe.a,{key:e.id.id,value:e.id.id},e.name)}))),f.createElement(Ve.a,{label:this.props.i18n.t("Отображать кнопки переключения"),control:f.createElement(In.a,{checked:this.state.showModeIcons,onChange:this.onShowModeIconsChanged})}))}},{key:"renderContent",value:function(){var e=this.props.i18n;switch(this.state.selectedIndex){case Pn:return f.createElement(f.Fragment,null,Object(Tt.g)(this.props.blocks,new _.Id(this.props.params.formId))&&f.createElement("div",{className:"blocksList"},this.blockSelector(this.state.createBlock,e.t("Схема создания"),this.onCreateBlockChanged),this.blockSelector(this.state.viewBlock.map(function(e){return e.defaultId}),e.t("Схема отображения"),this.onViewBlockChanged),this.blockSelector(this.state.editBlock.map(function(e){return e.defaultId}),e.t("Схема редактирования"),this.onEditBlockChanged),this.blockSelector(this.state.groupEditBlock,e.t("Схема массового редактирования"),this.onGroupEditBlockChanged)),f.createElement("div",null,f.createElement(ie.a,{style:{width:"90%",marginRight:10}},f.createElement(oe.a,{htmlFor:"list-config"},e.t("Конфигурация списка")),f.createElement(le.a,{inputProps:{id:"list-config"},value:this.state.dataListConfigId.getOrElse(function(){return"!empty"}),onChange:this.ondataListConfigIdChanged},f.createElement(pe.a,{key:"default",value:"!empty"},e.t("По умолчанию")),this.props.form.data.map(function(e){return e.entity.dataListView.configs}).getOrElse(function(){return[]}).filter(function(e){return e.tpe.value===_.DataListConfigKanban.$Type.value&&!ue.default.isA5000||e.tpe.value===_.DataListConfigCalendar.$Type.value&&!ue.default.isA5000||e.tpe.value===_.DataListConfigTasks.$Type.value&&!ue.default.isA5000||e.tpe.value===_.DataListConfigTable.$Type.value}).map(function(e){return f.createElement(pe.a,{key:e.id.id,value:e.id.id},e.name)}))),this.renderListConfigs()),f.createElement("div",null,f.createElement(E.a,{variant:"raised",disabled:!this.state.changed,onClick:this.onSaved},e.t("Сохранить"))));case 2:return f.createElement(f.Fragment,null,f.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},f.createElement(Ve.a,{label:this.props.i18n.t("Отображение по группам"),control:f.createElement(xe.a,{checked:this.state.groupTableConfig.map(function(e){return e.enabled}).getOrElse(function(){return!1}),onChange:this.onGroupTableConfigEnabledChanged})}),f.createElement(Ye.a,{fullWidth:!0,labelText:Object(M.toOption)(this.props.i18n.t("Поле для группировки")),errorText:new M.None,fields:Object(M.liftKey)(this.props.fields.list,this.props.params.formId).getOrElse(function(){return[]}),value:this.state.groupTableConfig.map(function(e){return e.groupField}),onChanged:this.onGroupTableConfigGroupFieldChanged}),f.createElement(kt.a,{errorText:"",label:this.props.i18n.t("Экспортируемые поля"),exportPipelineFields:this.state.groupTableConfig.map(function(e){return e.fields.map(function(e,t){return new _.ExportConfigField(e,t,new M.None)})}).getOrElse(function(){return[]}),formId:this.props.params.formId,onChange:this.onGroupTableConfigFieldsChanged})),f.createElement("div",null,f.createElement(E.a,{variant:"raised",disabled:!this.state.changed,onClick:this.onSaved},e.t("Сохранить"))));default:return f.createElement("div",null,"unknown blocks content")}}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",flex:1,overflow:"auto"}},f.createElement("input",{ref:this.fileInputHandler,type:"file",onChange:this.importLimitsFileChanged,style:{display:"none"}}),this.props.renderLimits?this.renderLimits():f.createElement("div",{style:{flex:1}},f.createElement(an.a,{onChange:function(t,n){return e.selectPage(n)},indicatorColor:"primary",textColor:"primary",fullWidth:!0,value:this.state.selectedIndex},f.createElement(sn.a,{value:Pn,label:this.props.i18n.t("Блоки/Списки")}),",",f.createElement(sn.a,{value:2,label:this.props.i18n.t("Прочее")})),this.renderContent()))}}]),t}(f.Component);Sn=Dn([m.autobind,Rn("design:paramtypes",[Object])],Sn);var _n=Object(h.connect)(function(e){return{i18n:e.i18n,form:e.currentForm,blocks:e.blocks,fields:e.fields,auth:e.auth,eventLine:e.eventLine,organisation:e.organisation,reports:e.reports,filtersForm:e.filtersForm,formRecords:e.formRecords,cdnAddress:e.config.cdnAddress}})(Object(Tn.a)(Sn)),$n=n(418),Ln=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.props.onMounted(this._ref),this.nameInput.focus()}},{key:"render",value:function(){var e=this,t=this.props,n=t.i18n,r=t.fields,i=r.name,a=r.tag,o=t.handleSubmit,s=t.submitHandler;return f.createElement("form",{ref:function(t){return Object(M.toOption)(t).foreach(function(t){return e._ref=t})},onSubmit:o&&o(s),className:"form"},f.createElement("div",{className:"field"},f.createElement(Q.a,Object.assign({},i,{inputRef:function(t){Object(M.toOption)(t).foreach(function(t){return e.nameInput=t})},label:n.t("Название блока"),error:i.touched&&i.error,fullWidth:!0,autoComplete:"off",autoFocus:!0})),f.createElement(fe.a,{value:a.value,onChange:a.onChange,suggestions:this.props.tags,onBlur:function(){}},f.createElement(Q.a,{label:n.t("Группа"),error:a.touched&&a.error,fullWidth:!0,autoComplete:"off"}))),f.createElement("div",{style:{margin:"10px -18px -18px 0",textAlign:"right"}},f.createElement(E.a,{variant:"raised",onClick:function(t){return e.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",type:"submit",color:"primary"},this.props.i18n.t("Сохранить"))))}}]),t}(f.Component),Mn=Object(h.connect)(function(e){return{i18n:e.i18n}})(Object(J.reduxForm)({form:"formBlockEditForm",fields:["name","tag"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение")),n}})(Ln)),Vn=n(323),Nn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},An=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Wn=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p()(t,e),o()(t,[{key:"openEditForm",value:function(e,t,n){new M.None;this.props.openDialog(e,f.createElement(Mn,{onMounted:function(e){return new M.Some(e)},initialValues:n,handleDialogClose:this.props.handleDialogClose,submitHandler:t,tags:this.getTags()}),[])}},{key:"onCreateRequested",value:function(){var e=this;this.openEditForm(this.props.i18n.t("Новый блок"),function(t){return Object(Vn.b)(G(new _.WebRegistrationBlock(t.name,new _.Id(e.props.params.formId),!1,!1),{ui:{tag:{$set:Object(M.toOption)(t.tag)}}})).then(function(t){return e.props.dispatch(Object(nn.d)(new _.Id(e.props.params.formId))),e.props.handleDialogClose(!1),e.props.dispatch(Object(A.h)(e.props.i18n.t("Блок успешно создан"))),t}).catch(function(t){e.props.dispatch(Object(N.a)(t))})})}},{key:"onCopy",value:function(e){var t=this;return new Promise(function(n,r){return Object(Vn.a)(new _.Id(e.id.toString())).then(function(e){t.props.dispatch(Object(nn.d)(new _.Id(t.props.params.formId))),t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Блок успешно скопирован")))}).catch(function(e){r(e)})}).catch(function(e){return t.props.dispatch(Object(N.a)(e))})}},{key:"onConfigureRequested",value:function(e){this.props.dispatch(Object(T.k)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId),new _.Id(e.id.toString())))}},{key:"onOpenTooltip",value:function(){var e=this;this.props.openDialog(this.props.i18n.t("Подсказка"),f.createElement("div",{className:"Tooltip_content"},this.props.i18n.t("текст подсказки")),[f.createElement(E.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(!0)}},this.props.i18n.t("Закрыть"))])}},{key:"onDeleteRequested",value:function(e){var t=this;this.props.openDialog(this.props.i18n.t("Удаление блока"),f.createElement("div",null,this.props.i18n.t("Вы действительно хотите удалить данный блок, это действие нельзя будет отменить?")),[f.createElement(E.a,{variant:"raised",onClick:function(){return t.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Нет")),f.createElement(E.a,{variant:"raised",onClick:function(){Object(Vn.c)(new _.Id(e.id.toString())).then(function(){t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Блок был успешно удален"))),t.props.dispatch(Object(nn.d)(new _.Id(t.props.params.formId)))}).catch(function(e){t.props.dispatch(Object(N.a)(e))})},color:"primary"},this.props.i18n.t("Да"))])}},{key:"getTags",value:function(){return Object(U.a)(Object(Tt.c)(this.props.blocks,new _.Id(this.props.params.formId)).getOrElse(function(){return[]}).map(function(e){return e.tag}).filter(function(e){return e.nonEmpty()}).map(function(e){return e.getOrElse(function(){return""})}))}},{key:"renderTable",value:function(e){var t=this;return f.createElement("div",{style:{marginBottom:15}},f.createElement(P.a,{showId:!0,error:Object(Tt.f)(this.props.blocks,new _.Id(this.props.params.formId)),onRecordSelected:this.onConfigureRequested,fetching:Object(Tt.j)(this.props.blocks,new _.Id(this.props.params.formId)),empty:!Object(Tt.j)(this.props.blocks,new _.Id(this.props.params.formId))&&0==Object(Tt.c)(this.props.blocks,new _.Id(this.props.params.formId)).getOrElse(function(){return[]}).length,withActions:!0,headers:[{id:"blockName",title:this.props.i18n.t("Группа")+": "+("!defaultTag"===e?this.props.i18n.t("По умолчанию"):e)}],rows:Object(Tt.c)(this.props.blocks,new _.Id(this.props.params.formId)).getOrElse(function(){return[]}).filter(function(t){return"!defaultTag"===e?t.tag.isEmpty():t.tag.map(function(t){return t===e}).getOrElse(function(){return!1})}).map(function(e){return{id:e.id.toString(),payload:e,fields:[e.name],buttons:[f.createElement(w.a,{key:"copy",style:B.f,onClick:function(n){n.stopPropagation(),t.onCopy(e)}},f.createElement(Z.a,{style:B.g})),f.createElement(w.a,{key:"delete",style:B.f,disabled:e.isDefault,onClick:function(n){n.stopPropagation(),t.onDeleteRequested(e)}},f.createElement(R.a,{style:B.g}))]}})}))}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Создать")),f.createElement(w.a,{style:{marginLeft:"10px",marginTop:"5px",width:"15px",height:"15px",padding:0,zIndex:5e3},onClick:this.onOpenTooltip},f.createElement($n.a,null))),this.getTags().map(function(t){return e.renderTable(t)}),this.renderTable("!defaultTag"))}}]),t}(f.Component);Wn=Nn([m.autobind,An("design:paramtypes",[Object])],Wn);var qn=Object(h.connect)(function(e){return{blocks:e.blocks,i18n:e.i18n}})(Object(ye.a)(function(e){e.isTokenChecked&&e.dispatch(Object(nn.b)(new _.Id(e.params.formId)))},function(){},function(e,t){e.params.formId!==t.params.formId&&e.dispatch(Object(nn.b)(new _.Id(e.params.formId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(nn.b)(new _.Id(e.params.formId)))})(Wn)),Bn=n(54),Hn=n.n(Bn),zn=n(265),Kn=n.n(zn),Un=n(1987),Gn=n(2116),Zn=n(2086),Yn=n(345),Jn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Xn=[{feature:_.OrganisationFeatures.Table,menuItemValue:_.DataListConfigTable.$Type.value},{feature:_.OrganisationFeatures.Kanban,menuItemValue:_.DataListConfigKanban.$Type.value},{feature:_.OrganisationFeatures.Calendar,menuItemValue:_.DataListConfigCalendar.$Type.value},{feature:_.OrganisationFeatures.Tasks,menuItemValue:_.DataListConfigTasks.$Type.value}],Qn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.nameInput.focus()}},{key:"onDatalistConfigTypeSelect",value:function(e){this.onDataListConfigTypeChange(e.target.value)}},{key:"onDataListConfigTypeChange",value:function(e){this.props.fields.dataListConfigTypeSelectValue.onChange(Object(M.headOption)(Xn.filter(function(t){return t.menuItemValue===e})).getOrElse(function(){return Xn[0]})),this.props.fields.dataListConfigType.onChange(e)}},{key:"onColumnFieldIdChange",value:function(e){this.props.fields.columnFieldId.onChange(e.target.value)}},{key:"onOrderFieldIdChange",value:function(e){this.props.fields.orderFieldId.onChange(e.target.value)}},{key:"onBlockIdChange",value:function(e){this.props.fields.blockId.onChange(e.target.value)}},{key:"getValue",value:function(e){var t=this;return Object(M.toOption)(e.value.menuItemValue).getOrElse(function(){var e=Object(M.headOption)(Xn).map(function(e){return e.menuItemValue}).getOrElse(function(){return _.DataListConfigTable.$Type.value});return t.onDataListConfigTypeChange(e),e})}},{key:"renderCalendar",value:function(){var e=this,t=this.props,n=t.i18n,r=t.fields,i=r.date,a=r.startTime,o=r.duration,s=r.label,l=r.decorations;return f.createElement("div",null,f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Заголовок")),f.createElement(le.a,{fullWidth:!0,value:s.value,onChange:s.onChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeStr}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Дата")),f.createElement(le.a,{fullWidth:!0,value:i.value,onChange:i.onChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeDate}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Время начала")),f.createElement(le.a,{fullWidth:!0,value:a.value,onChange:a.onChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeDate}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Продолжительность")),f.createElement(le.a,{fullWidth:!0,value:o.value,onChange:o.onChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeInterval}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),this.props.currentForm.data.map(function(t){return f.createElement("div",{style:{marginTop:15}},f.createElement(Ze.a,{initialValue:e.props.fields.filter.value?Object(M.toOption)(e.props.fields.filter.value):new M.None,filterId:e.props.fields.filterId.value,formId:t.id}))}).getOrNull(),f.createElement("h4",null,this.props.i18n.t("Оформление")),f.createElement(Gn.a,{decorations:l.value,formId:this.props.formId,onDecorationsChange:l.onChange}))}},{key:"onNewColumnOrderFieldCreateRequest",value:function(){Object(S.c)({openDialog:this.props.openDialog,handleDialogClose:this.props.handleDialogClose,formId:this.props.formId,i18n:this.props.i18n,dispatch:this.props.dispatch},{valueType:_.ValueTypeNumber.$Type.value},!0,this.props.i18n.t("Новое ссылочное поле"))}},{key:"onColumnsVisibilityMarkedChange",value:function(e){this.props.fields.hiddenColumns.onChange(e)}},{key:"onColumnsVisibilitySettings",value:function(){var e=this;_.Id.createId(this.props.fields.columnFieldId.value).foreach(function(t){var n=e.props.openDialog(e.props.i18n.t("Настройка видимости колонок"),f.createElement(Zn.a,{columnFormFieldId:t,hiddenColumns:e.props.fields.hiddenColumns.value,onColumnsVisibilityMarkedChange:e.onColumnsVisibilityMarkedChange}),[f.createElement(E.a,{key:"close",variant:"raised",onClick:function(){return e.props.handleDialogClose(n)}},e.props.i18n.t("Закрыть"))])})}},{key:"renderKanban",value:function(){var e=this,t=this.props,n=t.i18n,r=t.fields,i=r.columnFieldId,a=r.orderFieldId,o=r.blockId,s=r.columnOrderFieldId,l=r.swimlaneFieldId,c=r.showUncategorized,p=r.swimlaneOrderFieldId,u=_.Id.createId(i.value).flatMap(function(t){return Object(q.c)(e.props.formFields,t)}).getOrNull(),d=_.Id.createId(l.value).flatMap(function(t){return Object(q.c)(e.props.formFields,t)}).getOrNull();return f.createElement("div",null,f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Поле колонки")),f.createElement(le.a,{fullWidth:!0,value:i.value,onChange:this.onColumnFieldIdChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeObjectRefs}).filter(function(t){return Object(Xe.e)(e.props.forms,t.entity.valueType.family).map(function(e){return _.FormType.isAnyDictionary(e.entity.formType)}).getOrElse(function(){return!1})}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),""!==i.value&&f.createElement(E.a,{onClick:this.onColumnsVisibilitySettings},this.props.i18n.t("Настройка видимости колонок")),u&&f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Поле для порядка колонок")),f.createElement(le.a,{fullWidth:!0,value:a.value,onChange:this.onOrderFieldIdChange},Object(q.e)(this.props.formFields,u.entity.valueType.family).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Блок отображения карточки")),f.createElement(le.a,{fullWidth:!0,value:o.value,onChange:this.onBlockIdChange},Object(Tt.c)(this.props.blocks,this.props.formId).getOrElse(function(){return[]}).map(function(e){return f.createElement(pe.a,{key:e.id.toString(),value:e.id.toString()},f.createElement(Hn.a,{primary:e.name}))}))),f.createElement("div",{style:{display:"flex",alignItems:"baseline"}},f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Поле порядкового номера в колонке")),f.createElement(le.a,{fullWidth:!0,value:s.value,onChange:s.onChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeNumber}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement("div",null,f.createElement(w.a,{onClick:this.onNewColumnOrderFieldCreateRequest},f.createElement(Kn.a,null)))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Поле swimlane")),f.createElement(le.a,{fullWidth:!0,value:l.value,onChange:l.onChange},f.createElement(pe.a,{value:Yn.a},f.createElement(Hn.a,{primary:this.props.i18n.t("Не выбрано")})),Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeObjectRefs}).filter(function(t){return Object(Xe.e)(e.props.forms,t.entity.valueType.family).map(function(e){return _.FormType.isAnyDictionary(e.entity.formType)}).getOrElse(function(){return!1})}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),d&&f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Поле порядкого номера в swimlane")),f.createElement(le.a,{fullWidth:!0,value:p.value,onChange:p.onChange},f.createElement(pe.a,{value:Yn.a},f.createElement(Hn.a,{primary:this.props.i18n.t("Не выбрано")})),Object(q.e)(this.props.formFields,d.entity.valueType.family).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),l.value&&f.createElement(Ve.a,{label:this.props.i18n.t("Отображать задачи без категории группой внизу"),control:f.createElement(In.a,{checked:c.value,onChange:c.onChange})}))}},{key:"renderTasks",value:function(){var e=this,t=this.props,n=t.i18n,r=t.fields,i=r.orderFieldId,a=r.blockId,o=r.swimlaneFieldId,s=r.swimlaneOrderFieldId,l=r.taskName,c=r.completedFieldId,p=_.Id.createId(o.value).flatMap(function(t){return Object(q.c)(e.props.formFields,t)}).getOrNull();return f.createElement("div",null,f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Блок отображения карточки")),f.createElement(le.a,{fullWidth:!0,value:a.value,onChange:this.onBlockIdChange},Object(Tt.c)(this.props.blocks,this.props.formId).getOrElse(function(){return[]}).map(function(e){return f.createElement(pe.a,{key:e.id.toString(),value:e.id.toString()},f.createElement(Hn.a,{primary:e.name}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Поле имени задачи")),f.createElement(le.a,{fullWidth:!0,value:l.value,onChange:l.onChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeStr}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Поле порядка задачи")),f.createElement(le.a,{fullWidth:!0,value:i.value,onChange:this.onOrderFieldIdChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeNumber}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Поле статуса задачи")),f.createElement(le.a,{fullWidth:!0,value:c.value,onChange:c.onChange},Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeBool}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Поле swimlane")),f.createElement(le.a,{fullWidth:!0,value:o.value,onChange:o.onChange},f.createElement(pe.a,{value:Yn.a},f.createElement(Hn.a,{primary:this.props.i18n.t("Не выбрано")})),Object(q.e)(this.props.formFields,this.props.formId).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType instanceof _.ValueTypeObjectRefs}).filter(function(t){return Object(Xe.e)(e.props.forms,t.entity.valueType.family).map(function(e){return _.FormType.isAnyDictionary(e.entity.formType)}).getOrElse(function(){return!1})}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))),p&&f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Поле порядкого номера в swimlane")),f.createElement(le.a,{fullWidth:!0,value:s.value,onChange:s.onChange},f.createElement(pe.a,{value:Yn.a},f.createElement(Hn.a,{primary:this.props.i18n.t("Не выбрано")})),Object(q.e)(this.props.formFields,p.entity.valueType.family).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},f.createElement(Hn.a,{primary:e.entity.caption}))}))))}},{key:"render",value:function(){var e=this,t=this.props,n=t.i18n,r=t.fields,i=r.name,a=r.dataListConfigType,o=r.dataListConfigTypeSelectValue;return f.createElement("form",null,f.createElement(Q.a,{fullWidth:!0,autoFocus:!0,value:i.value,onChange:i.onChange,label:this.props.i18n.t("Название"),error:i.touched&&i.error,helperText:i.touched&&Object(M.toOption)(i.error).map(function(e){return e}).getOrNull(),inputRef:function(t){return Object(M.toOption)(t).foreach(function(t){e.nameInput=t})}}),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,n.t("Тип конфигурации")),f.createElement(le.a,{value:this.getValue(o),onChange:this.onDatalistConfigTypeSelect},Xn.map(function(t,n){return f.createElement(Un.a,{key:n,feature:t.feature,value:t.menuItemValue},f.createElement(Hn.a,{primary:Object(be.p)(new M.TypeId(t.menuItemValue),e.props.i18n.t)}))}))),a.value===_.DataListConfigKanban.$Type.value&&this.renderKanban(),a.value===_.DataListConfigCalendar.$Type.value&&this.renderCalendar(),a.value===_.DataListConfigTasks.$Type.value&&this.renderTasks())}}]),t}(f.Component);Qn=Jn([m.autobind],Qn);var er=Object(h.connect)(function(e){return{i18n:e.i18n,formFields:e.fields,blocks:e.blocks,currentForm:e.currentForm,forms:e.forms}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(J.reduxForm)({form:"DataListConfigForm",fields:["name","dataListConfigType","dataListConfigTypeSelectValue","columnFieldId","orderFieldId","blockId","dataListConfigId","date","startTime","duration","label","filterId","filter","decorations","columnOrderFieldId","swimlaneFieldId","showUncategorized","swimlaneOrderFieldId","hiddenColumns","taskName","completedFieldId"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение")),n}})(Object(pn.a)(Qn))),tr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},nr=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},rr=(new _.Id(je.v4()),function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p()(t,e),o()(t,[{key:"openEditForm",value:function(e,t,n){var r=this,i=void 0;this.props.openDialog(e,f.createElement(er,{ref:function(e){return i=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},initialValues:n,onSubmit:t,formId:new _.Id(this.props.params.formId)}),[f.createElement(E.a,{variant:"raised",onClick:function(){return r.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){i.foreach(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"getDataListConfigInitialValues",value:function(e){var t={name:e.name,dataListConfigType:e.tpe.value,dataListConfigId:e.id.id};switch(e.tpe.value){case _.DataListConfigKanban.$Type.value:var n=e;t=Object.assign(t,{columnFieldId:n.columnFieldId.value,blockId:n.blockId.value});break;case _.DataListConfigTable.$Type.value:case _.DataListConfigTasks.$Type.value:break;default:throw"Unknown form list config type"}return t}},{key:"getDataListConfig",value:function(e){switch(e.dataListConfigType){case _.DataListConfigKanban.$Type.value:return new _.DataListConfigKanban(e.name,new _.Id(e.columnFieldId),new _.Id(e.blockId),new _.DataListConfigId(e.dataListConfigId),new _.Id(e.orderFieldId),new _.Id(e.columnOrderFieldId),Object(M.toOption)(e.swimlaneFieldId).filter(function(e){return e!==Yn.a}).flatMap(function(e){return _.Id.createId(e)}),!!e.swimlaneFieldId&&e.showUncategorized,Object(M.toOption)(e.swimlaneOrderFieldId).filter(function(e){return e!==Yn.a}).flatMap(function(e){return _.Id.createId(e)}),""===e.hiddenColumns?[]:e.hiddenColumns);case _.DataListConfigTable.$Type.value:return new _.DataListConfigTable(e.name,new _.DataListConfigId(e.dataListConfigId),[],[],[],[],[]);case _.DataListConfigCalendar.$Type.value:return new _.DataListConfigCalendar(new _.DataListConfigId(e.dataListConfigId),e.name,new _.Id(e.label),new _.Id(e.date),new _.Id(e.startTime),new _.Id(e.duration),Object(ke.b)(this.props.filtersForm,e.filterId),e.decorations);case _.DataListConfigTasks.$Type.value:return new _.DataListConfigTasks(new _.DataListConfigId(e.dataListConfigId),e.name,new _.Id(e.blockId),new _.Id(e.taskName),new _.Id(e.orderFieldId),new _.Id(e.completedFieldId),Object(M.toOption)(e.swimlaneFieldId).filter(function(e){return e!==Yn.a}).flatMap(function(e){return _.Id.createId(e)}),Object(M.toOption)(e.swimlaneOrderFieldId).filter(function(e){return e!==Yn.a}).flatMap(function(e){return _.Id.createId(e)}));default:throw"Unknown form list config type"}}},{key:"onCreateRequested",value:function(){var e=this;this.openEditForm(this.props.i18n.t("Новая конфигурация отображения списка"),function(t){return new Promise(function(n,r){e.props.form.data.map(function(r){Object(Je.k)(r.id,[].concat(cn()(r.entity.dataListView.configs),[e.getDataListConfig(t)])).then(function(){e.props.handleDialogClose(!1),e.props.dispatch(Object(A.h)(e.props.i18n.t("Конфигурация была успешно создана"))),e.props.dispatch(Object(Je.i)(r.id)),n()}).catch(function(){e.props.handleDialogClose(!1),e.props.dispatch(Object(A.h)(e.props.i18n.t("При создании конфигурации произошла ошибка")))})}).getOrElse(function(){return r()})})},{dataListConfigId:this.props.form.data.map(function(e){return e.entity.dataListView.configs.length+1}).getOrElse(function(){return 1}).toString(),filterId:new _.Id(je.v4()),decorations:[],hiddenColumns:[]})}},{key:"onTableEditRequested",value:function(e,t){var n=this;this.openEditForm(this.props.i18n.t("Редактирование конфигурации отображения списка"),function(e){return new Promise(function(r,i){n.props.form.data.map(function(i){Object(Je.k)(i.id,G(i.entity.dataListView.configs,{$splice:[[t,1,n.getDataListConfig(e)]]})).then(function(){n.props.handleDialogClose(!1),n.props.dispatch(Object(A.h)(n.props.i18n.t("Конфигурация была успешно создана"))),n.props.dispatch(Object(Je.i)(i.id)),r()}).catch(function(){n.props.handleDialogClose(!1),n.props.dispatch(Object(A.h)(n.props.i18n.t("При создании конфигурации произошла ошибка")))})}).getOrElse(function(){return i()})})},Object.assign({dataListConfigId:e.id.id,name:e.name,dataListConfigType:e.tpe.value,dataListConfigTypeSelectValue:Object(M.headOption)(Xn.filter(function(t){return t.menuItemValue===e.tpe.value})).getOrElse(function(){return Xn[0]}),date:e.date.value,startTime:e.startTime.value,label:e.label.value,duration:e.duration.value,filterId:new _.Id(je.v4())},e.filter.map(function(e){return{filter:e}}).getOrElse(function(){return""}),{decorations:e.decorations}))}},{key:"onOpenTooltip",value:function(){var e=this;this.props.openDialog(this.props.i18n.t("Подсказка"),f.createElement("div",{className:"Tooltip_content"},this.props.i18n.t("текст подсказки")),[f.createElement(E.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(!0)}},this.props.i18n.t("Закрыть"))])}},{key:"onDeleteRequested",value:function(e,t){var n=this;this.props.openDialog(this.props.i18n.t("Удаление конфигурации"),f.createElement("div",null,this.props.i18n.t("Вы действительно хотите удалить даннаю конфигурацию, это действие нельзя будет отменить?")),[f.createElement(E.a,{variant:"raised",onClick:function(){return n.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Нет")),f.createElement(E.a,{variant:"raised",onClick:function(){n.props.form.data.map(function(e){Object(Je.k)(e.id,G(e.entity.dataListView.configs,{$splice:[[t,1]]})).then(function(){n.props.handleDialogClose(!1),n.props.dispatch(Object(A.h)(n.props.i18n.t("Конфигурация была успешно удалена"))),n.props.dispatch(Object(Je.i)(e.id))}).catch(function(e){n.props.dispatch(Object(N.a)(e))})})},color:"primary"},this.props.i18n.t("Да"))])}},{key:"onSettingsRequested",value:function(e,t){switch(e.tpe.value){case _.DataListConfigKanban.$Type.value:case _.DataListConfigTable.$Type.value:case _.DataListConfigTasks.$Type.value:this.props.dispatch(Object(T.V)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId),new _.Id(e.id.id)));break;case _.DataListConfigCalendar.$Type.value:this.onTableEditRequested(e,t)}}},{key:"render",value:function(){var e=this;return f.createElement(f.Fragment,null,f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Создать")),f.createElement(w.a,{style:{marginLeft:"10px",marginTop:"5px",width:"15px",height:"15px",padding:0,zIndex:5e3},onClick:this.onOpenTooltip},f.createElement($n.a,null))),f.createElement(P.a,{showId:!0,error:this.props.form.error,fetching:this.props.form.fetching,onRecordSelected:this.onSettingsRequested,empty:!this.props.form.fetching&&0==this.props.form.data.map(function(e){return e.entity.dataListView.configs}).getOrElse(function(){return[]}).length,withActions:!0,headers:[{id:"listConfigName",title:this.props.i18n.t("Название конфигурации")},{id:"listConfigType",title:this.props.i18n.t("Тип")}],rows:this.props.form.data.map(function(e){return e.entity.dataListView.configs}).getOrElse(function(){return[]}).map(function(t,n){return{id:t.id.id,payload:t,fields:[t.name,Object(be.p)(t.tpe,e.props.i18n.t)],buttons:[f.createElement(w.a,{key:"settings",style:B.f,onClick:function(r){r.stopPropagation(),e.onSettingsRequested(t,n)}},f.createElement(Ct.a,{style:B.g})),f.createElement(w.a,{key:"delete",style:B.f,onClick:function(r){r.stopPropagation(),e.onDeleteRequested(t,n)}},f.createElement(R.a,{style:B.g}))]}})}))}}]),t}(f.Component));rr=tr([m.autobind,nr("design:paramtypes",[Object])],rr);var ir=Object(h.connect)(function(e,t){return{blocks:e.blocks,form:e.currentForm,i18n:e.i18n,filtersForm:e.filtersForm}})(rr),ar=n(1491),or=n(1494),sr=n(203),lr=n.n(sr),cr=n(1988),pr=n.n(cr),ur=n(380),dr=n.n(ur),fr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},mr=function(e){function t(){i()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state={submited:!1},e}return p()(t,e),o()(t,[{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.setState({submited:!0},function(){return t.props.handleSubmit(t.props.submitHandler)(e)})}},{key:"render",value:function(){var e=this,t=this.props.fields.name;return f.createElement("form",{className:"form",onSubmit:this.onSubmit},f.createElement("div",{className:"field"},f.createElement(Q.a,{fullWidth:!0,autoFocus:!0,value:t.value,onChange:t.onChange,label:this.props.i18n.t("Название конфигурации"),error:t.touched&&t.error,helperText:t.touched&&Object(M.toOption)(t.error).map(function(e){return e}).getOrNull()})),f.createElement("div",{style:{margin:"10px -18px -18px 0",textAlign:"right"}},f.createElement(E.a,{variant:"raised",onClick:function(t){return e.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",color:"primary",type:"submit",disabled:this.state.submited},this.props.i18n.t("Создать"))))}}]),t}(f.Component);mr=fr([m.autobind],mr);var hr=Object(h.connect)(function(e){return{i18n:e.i18n}})(Object(J.reduxForm)({form:"import-pipeline-create-form",fields:["name"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение")),n}})(mr)),gr=(n(2515),n(417)),yr=n(646),vr=n.n(yr),br=n(428),Or=(n(799),function(e){return function(t){return t(Object(br.e)()),ar.e(e).then(function(e){return t(Object(br.f)(e.record)),e.record}).catch(function(e){throw t(Object(br.d)(e)),e})}}),Er=n(1589),Ir=function(e){return new Promise(function(t,n){var r=function r(i){i.data.data.error?(e.close(),n()):(e.close(),t(i.data.data)),window.removeEventListener("message",r)};e.onclose=function(){window.removeEventListener("message",r)},window.addEventListener("message",r)})},Cr=function(e,t){return function(n,r){return Object(M.toOption)(t).filter(function(e){return e.entity.params instanceof _.ImportParamsFormDataStages}).map(function(e){return e.entity.params}).filter(function(e){return e.fetchStage.resource instanceof _.ImportOperationResourceXeroResource}).map(function(e){return e.fetchStage.resource}).matchWith(function(t){return Object(Er.a)(t.connection).then(function(e){return e instanceof _.XeroAuthUrl?(t=e.url,n=Math.min(window.innerHeight-100,500),r=Math.min(window.innerWidth-100,800),i=(window.innerWidth-r)/2,a=(window.innerHeight-n)/2,Object(M.toOption)(window.open(t,"_blank","toolbar=yes,scrollbars=yes,resizable=yes,top="+a+",left="+i+",width="+r+",height="+n)).matchWith(function(e){return Ir(e)},function(){return new Promise(function(e,t){return t("windows has not been provided")})})):e;var t,n,r,i,a}).then(function(){return Object(jt.b)(e)})},function(){return Object(jt.b)(e)})}},Tr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},kr=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},wr=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={operationMenu:{anchorEl:new M.None,pipelineId:new M.None}},n}return p()(t,e),o()(t,[{key:"onCreateRequested",value:function(){var e=this;this.props.openDialog(this.props.i18n.t("Настройка конфигурации импорта"),f.createElement(hr,{initialValues:{},handleDialogClose:this.props.handleDialogClose,submitHandler:function(t){var n=new _.Id(e.props.params.formId);return Object(ar.a)(new _.ImportPipeline(n,t.name,e.getImportPipelineProps(),[])).then(function(t){switch(e.props.importType.value){case _.ImportParamsFormDataStages.$Type.value:e.props.dispatch(Object(T.M)(new _.Id(e.props.params.eventLineId),new _.Id(e.props.params.formTypeId),new _.Id(e.props.params.formId),t.id));break;case _.ImportParamsFileStages.$Type.value:e.props.dispatch(Object(T.N)(new _.Id(e.props.params.eventLineId),new _.Id(e.props.params.formTypeId),new _.Id(e.props.params.formId),t.id))}e.props.dispatch(Object(or.a)(n)),e.props.handleDialogClose(!1)}).catch(function(t){return e.props.dispatch(Object(N.a)(t))})}}),[])}},{key:"getImportPipelineProps",value:function(){var e=this;switch(this.props.importType.value){case _.ImportParamsFormDataStages.$Type.value:return new _.ImportParamsFormDataStages(new _.ImportPipelineStageFetch(new _.ImportOperationResourceUriResource("",new _.HttpMethodGET,[new _.HttpHeader("","")]),Object(M.toOption)(new _.TokenFetch(!1,new _.ImportOperationResourceUriResource("",new _.HttpMethodGET,[new _.HttpHeader("","")]),""))),new _.ImportPipelineStageRead(new _.DataFormatExcel),new _.ImportPipelineStageFormat([]),new _.ImportPipelineStageMaterialize(new _.IdentityTypeFull,new M.None,new M.None),new M.None);case _.ImportParamsFileStages.$Type.value:return this.props.organisation.organisationId.map(function(t){return new _.ImportParamsFileStages(t,new M.None,new _.FileFetchStageDummy,new _.ImportFileStageHydrate(new _.Id(e.props.params.formId),new _.Id(""),new _.Id("")))}).getOrElse(function(){throw"Organisation id has not been provided"});default:throw"Unknown import params type"}}},{key:"onEditClick",value:function(e){var t=this;this.props.dispatch(Or(new _.Id(e.id.toString()))).then(function(e){t.onEditRequested(e)})}},{key:"onEditRequested",value:function(e){var t=this;this.props.openDialog(this.props.i18n.t("Настройка конфигурации импорта"),f.createElement(hr,{initialValues:e.entity,handleDialogClose:this.props.handleDialogClose,submitHandler:function(n){var r=new _.Id(t.props.params.formId);return Object(ar.h)(G(e,{entity:{$set:new _.ImportPipeline(r,n.name,e.entity.params,e.entity.actions)}})).then(function(e){t.props.dispatch(Object(or.a)(r)),t.props.handleDialogClose(!1)}).catch(function(e){return t.props.dispatch(Object(N.a)(e))})}}),[])}},{key:"onOpenPageClick",value:function(e){var t=this;this.props.dispatch(Or(new _.Id(e.id.toString()))).then(function(e){t.onEdit(e)})}},{key:"onEdit",value:function(e){switch(e.entity.params.tpe.value){case _.ImportParamsFormDataStages.$Type.value:this.props.dispatch(Object(T.M)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId),e.id));break;case _.ImportParamsFileStages.$Type.value:this.props.dispatch(Object(T.N)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId),e.id))}}},{key:"onDeleteRequested",value:function(e){var t=this;this.props.openDialog(this.props.i18n.t("Удаление конфигурацим импорта"),f.createElement("p",null,this.props.i18n.t("Вы уверены? Данное действие нельзя отменить")),[f.createElement(E.a,{variant:"raised",onClick:function(){t.props.handleDialogClose(!1)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),f.createElement(E.a,{variant:"raised",color:"primary",onClick:function(){Object(ar.b)(e).then(function(){t.props.dispatch(Object(or.a)(new _.Id(t.props.params.formId))),t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Удаление успешно завершено")))}).catch(function(e){t.props.dispatch(Object(N.a)(e))})}},this.props.i18n.t("Удалить"))])}},{key:"onOperationClick",value:function(e,t){var n=this;this.props.dispatch(Or(new _.Id(e.id.toString()))).then(function(e){n.onOperationRequested(e,t)})}},{key:"onOperationRequested",value:function(e,t){var n=this;switch(t){case"fileMode":this.props.openDialog(this.props.i18n.t("Запуск импорта"),f.createElement(gr,{onDrop:function(t){if(0===t.length)throw"There are not files to process";var r=t[t.length-1];Object(wt.h)(r,n.props.cdnAddress,n.props.auth.token,n.props.organisation.organisationId,n.props.eventLine.eventLineId,new M.None,new M.Some(new _.FileTypeImport)).then(function(t){n.props.dispatch(Cr(new _.ImportPipelineOperation(e.id,new _.ImportOperationStatusCreated(new M.Some(new _.ImportOperationResourceFileResource(t)),(new Date).getTime())),e)).then(function(e){n.props.handleDialogClose(!1),n.props.dispatch(Object(A.h)(n.props.i18n.t("Создание успешно завершено")))}).catch(function(e){n.props.dispatch(Object(N.a)(e))})}).catch(function(e){n.props.dispatch(Object(N.a)(e))})},accept:".xls, .xlsx, .csv, .json, .txt",className:"ImportPipelinesList__dropzone"},function(e){var t=e.isDragActive;return f.createElement("div",{className:t?"ImportPipelinesList__dropzone-wrapper":""},f.createElement("div",{className:"ImportPipelinesList__dropzone-message"},n.props.i18n.t("Нажмите для выбора файла либо перетащите файл в зону отмеченную пунктиром")))}),[f.createElement(E.a,{variant:"raised",onClick:function(){return n.props.handleDialogClose(!0)}},this.props.i18n.t("Закрыть"))]);break;case"fileArchiveMode":this.props.openDialog(this.props.i18n.t("Запуск импорта файлов"),f.createElement(gr,{onDrop:function(t){if(0===t.length)throw"There are no files to process";var r=t[t.length-1];n.props.auth.token.foreach(function(t){return Object(ar.f)(r,t,e.id).then(function(e){n.props.handleDialogClose(!1)}).catch(function(e){n.props.dispatch(Object(N.a)(e))})})},accept:".zip, .7z",className:"ImportPipelinesList__dropzone"},function(e){var t=e.isDragActive;return f.createElement("div",{className:t?"ImportPipelinesList__dropzone-wrapper":""},f.createElement("div",{className:"ImportPipelinesList__dropzone-message"},n.props.i18n.t("Нажмите для выбора файла либо перетащите файл в зону отмеченную пунктиром")))}),[f.createElement(E.a,{variant:"raised",onClick:function(){return n.props.handleDialogClose(!0)}},this.props.i18n.t("Закрыть"))]);break;case"instantMode":this.props.dispatch(Cr(new _.ImportPipelineOperation(e.id,new _.ImportOperationStatusCreated(new M.Some(e.entity.params.fetchStage.resource),(new Date).getTime())),e)).then(function(e){n.props.dispatch(Object(A.h)(n.props.i18n.t("Создание успешно завершено")))}).catch(function(e){n.props.dispatch(Object(A.h)(n.props.i18n.t("Создание завершилось ошибкой")))})}}},{key:"onMenuClosed",value:function(){this.setState(G(this.state,{operationMenu:{anchorEl:{$set:new M.None},pipelineId:{$set:new M.None}}}))}},{key:"onMenuRequested",value:function(e,t){this.setState(G(this.state,{operationMenu:{anchorEl:{$set:new M.Some(Object(Qe.findDOMNode)(e.currentTarget))},pipelineId:{$set:Object(M.toOption)(new _.Id(t.id.toString()))}}}))}},{key:"render",value:function(){var e=this;return f.createElement(f.Fragment,null,f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Создать"))),f.createElement(P.a,{showId:!0,error:this.props.importPipelines.descriptionsError,onRecordSelected:this.onEdit,fetching:this.props.importPipelines.descriptionsFetching,empty:!this.props.importPipelines.descriptionsFetching&&this.props.importPipelines.descriptionsError.isEmpty()&&0==this.props.importPipelines.descriptionsList.filter(function(t){return t.params===e.props.importType.value}).length,withActions:!0,headers:[{id:"systemName",title:this.props.i18n.t("Конфигурация")},{id:"fieldName",title:this.props.i18n.t("Операций")}],rows:this.props.importPipelines.descriptionsList.filter(function(t){return t.params===e.props.importType.value}).map(function(t){return{id:t.id.toString(),fields:[t.name,""],payload:t,buttons:[f.createElement(f.Fragment,null,t.params===_.ImportParamsFormDataStages.$Type.value&&f.createElement("span",{style:{display:t.repeat?"flex":"none",color:vr.a[500]}},e.props.i18n.t("активен")),f.createElement(Kt.a,{title:e.props.i18n.t("Запустить"),placement:"right",style:B.g},f.createElement(w.a,{style:B.f,onClick:function(n){return e.onMenuRequested(n,t)}},f.createElement(pr.a,{style:B.g}))),f.createElement(lr.a,{onClose:e.onMenuClosed,anchorEl:e.state.operationMenu.anchorEl.getOrUndefined(),open:e.state.operationMenu.pipelineId.map(function(e){return e.value}).getOrNull()===t.id.toString()},function(){switch(e.props.importType){case _.ImportParamsFormDataStages.$Type:return[f.createElement(pe.a,{value:"fileMode",onClick:function(){return e.onOperationClick(t,"fileMode")}},e.props.i18n.t("С файлом")),f.createElement(pe.a,{value:"instantMode",onClick:function(){return e.onOperationClick(t,"instantMode")}},e.props.i18n.t("Запустить без файла"))];case _.ImportParamsFileStages.$Type:return[f.createElement(pe.a,{value:"fileArchiveMode",onClick:function(){return e.onOperationClick(t,"fileArchiveMode")}},e.props.i18n.t("Загрузить файл"))];default:return[]}}())),f.createElement(Kt.a,{title:e.props.i18n.t("Список импортов"),placement:"right",style:B.g},f.createElement(w.a,{key:"menu",style:B.f,onClick:function(n){return e.props.dispatch(Object(T.Q)(new _.Id(e.props.params.eventLineId),new _.Id(e.props.params.formTypeId),new _.Id(e.props.params.formId),new _.Id(t.id.toString())))}},f.createElement(dr.a,{style:B.g}))),f.createElement(Kt.a,{style:B.g,title:e.props.i18n.t("Настройки"),placement:"right"},f.createElement(w.a,{key:"config",style:B.f,onClick:function(n){n.stopPropagation(),e.onOpenPageClick(t)}},f.createElement(Ct.a,{style:B.g}))),f.createElement(Kt.a,{title:e.props.i18n.t("Изменить название"),placement:"right",style:B.g},f.createElement(w.a,{key:"edit",style:B.f,onClick:function(n){n.stopPropagation(),e.onEditClick(t)}},f.createElement(F.a,{style:B.g}))),f.createElement(Kt.a,{title:e.props.i18n.t("Удалить"),placement:"right",style:B.g},f.createElement(w.a,{key:"delete",style:B.f,onClick:function(n){n.stopPropagation(),e.onDeleteRequested(new _.Id(t.id.toString()))}},f.createElement(R.a,{style:B.g})))]}})}))}}]),t}(f.Component);wr=Tr([m.autobind,kr("design:paramtypes",[Object])],wr);var jr=Object(h.connect)(function(e){return{i18n:e.i18n,auth:e.auth,importPipelines:e.importPipelines,eventLine:e.eventLine,organisation:e.organisation,cdnAddress:e.config.cdnAddress}})(Object(ye.a)(function(e){e.isTokenChecked&&e.dispatch(Object(or.b)(new _.Id(e.params.formId)))},function(){},function(e,t){e.params.formId!==t.params.formId&&e.dispatch(Object(or.b)(new _.Id(e.params.formId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(or.b)(new _.Id(e.params.formId)))})(wr)),Fr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"render",value:function(){return f.createElement(jr,Object.assign({},this.props,{importType:_.ImportParamsFormDataStages.$Type}))}}]),t}(f.Component),Dr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"render",value:function(){return f.createElement(jr,Object.assign({},this.props,{importType:_.ImportParamsFileStages.$Type}))}}]),t}(f.Component),Rr=n(1989),Pr=n(377),xr=n(641),Sr=n(1599),_r=n(2015),$r=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Lr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.initSenderField()}},{key:"initSenderField",value:function(){var e=this;Object(M.headOption)(this.props.formFields.getOrElse(function(){return[]}).filter(function(e){var t=e.entity.caption.toLocaleLowerCase();return"email"===t||"e-mail"===t||"mail"===t})).foreach(function(t){return e.props.fields.senderFieldId.onChange(t.id.value)})}},{key:"getSenderFieldLabel",value:function(){switch(this.props.fields.type.value){case _.MessageParamsDataSmsData.$Type.value:return Object(M.toOption)(this.props.i18n.t("Поле с номером телефона"));case _.MessengerParamsData.$Type.value:return Object(M.toOption)(this.props.i18n.t("Поле с ид чата"));default:throw"Unknown message params data type"}}},{key:"render",value:function(){var e=this.props.fields,t=e.name,n=e.type,r=e.senderFieldId,i=e.socialConnectionId,a=e.facebookPageId,o=e.postType,s=e.facebookGroupId,l=e.linkedInCompanyPageId,c=e.addressTypes,p=e.tag;return f.createElement("form",null,f.createElement(Q.a,{value:t.value,onChange:t.onChange,fullWidth:!0,label:this.props.i18n.t("Название"),autoFocus:!0}),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Тип рассылки")),f.createElement(le.a,Object.assign({fullWidth:!0,native:!0},n,{value:n.value,error:n.touched&&n.error,onChange:function(e){return n.onChange(e.target.value)},onBlur:void 0}),f.createElement("option",{value:"!empty"}),f.createElement("option",{value:_.EmailDataEditorTypeSimple.$Type.value},this.props.i18n.t("Email")),!ue.default.isA5000&&f.createElement("option",{value:_.EmailDataEditorTypeAdvanced.$Type.value},this.props.i18n.t("Email (Шаблонизатор)")),f.createElement("option",{value:_.MessageParamsDataSmsData.$Type.value},this.props.i18n.t("SMS")),!ue.default.isA5000&&f.createElement("option",{value:_.MessengerParamsData.$Type.value},this.props.i18n.t("Мессенджер")),!ue.default.isA5000&&f.createElement("option",{value:_.MessageParamsDataFacebookData.$Type.value},this.props.i18n.t("Facebook")),!ue.default.isA5000&&f.createElement("option",{value:_.MessageParamsDataLinkedInData.$Type.value},this.props.i18n.t("LinkedIn")),f.createElement("option",{value:_.MessageParamsDataWebPushData.$Type.value},this.props.i18n.t("Пуш уведомление"))),Object(M.toOption)(n.error).map(function(e){return f.createElement(Ae.a,null,e)}).getOrNull()),f.createElement(fe.a,{value:p.value,onChange:p.onChange,suggestions:this.props.tags,onBlur:function(){}},f.createElement(Q.a,{label:this.props.i18n.t("Группа"),error:p.touched&&p.error,fullWidth:!0,autoComplete:"off"})),(n.value===_.EmailDataEditorTypeSimple.$Type.value||n.value===_.EmailDataEditorTypeAdvanced.$Type.value)&&f.createElement(_r.a,{formId:this.props.formId,addressTypes:c.value||[],onChange:c.onChange}),n.value&&(n.value===_.MessageParamsDataSmsData.$Type.value||n.value===_.MessengerParamsData.$Type.value)&&f.createElement(Ye.a,{native:!0,errorText:new M.None,labelText:this.getSenderFieldLabel(),fullWidth:!0,fields:this.props.formFields.getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===_.ValueTypeStr.$Type.value}),onChanged:function(e){return r.onChange(e.map(function(e){return e.value}).getOrElse(function(){return""}))},value:new M.Some(new _.Id(r.value))}),n.value===_.MessageParamsDataFacebookData.$Type.value&&f.createElement("div",null,f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Соединение")),f.createElement(le.a,{fullWidth:!0,value:i.value,onChange:function(e){return i.onChange(e.target.value)}},this.props.socialConnections.list.filter(function(e){return e.entity.connector.tpe.value===_.FacebookPagesApp.$Type.value}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.name)}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Тип назначения")),f.createElement(le.a,{fullWidth:!0,value:o.value,onChange:function(e){return o.onChange(e.target.value)}},f.createElement(pe.a,{value:_.FacebookPostTypeGroup.$Type.value},this.props.i18n.t("Группа")),f.createElement(pe.a,{value:_.FacebookPostTypePage.$Type.value},this.props.i18n.t("Страница")),f.createElement(pe.a,{value:_.FacebookPostTypeUserFeed.$Type.value},this.props.i18n.t("Стена пользователя")))),!!i&&o.value===_.FacebookPostTypePage.$Type.value&&f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Страница")),f.createElement(le.a,{fullWidth:!0,value:a.value,onChange:function(e){return a.onChange(e.target.value)}},Object(M.headOption)(this.props.socialConnections.list.filter(function(e){return e.entity.connector.tpe.value===_.FacebookPagesApp.$Type.value}).filter(function(e){return e.id.value===i.value})).map(function(e){return e.entity.connector.pages}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id},e.name)}))),!!i&&o.value===_.FacebookPostTypeGroup.$Type.value&&f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Группа")),f.createElement(le.a,{fullWidth:!0,value:s.value,onChange:function(e){return s.onChange(e.target.value)}},Object(M.headOption)(this.props.socialConnections.list.filter(function(e){return e.entity.connector.tpe.value===_.FacebookPagesApp.$Type.value}).filter(function(e){return e.id.value===i.value})).map(function(e){return e.entity.connector.groups}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id},e.name)}),this.props.socialConnections.list.map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.name)})))),n.value===_.MessageParamsDataLinkedInData.$Type.value&&f.createElement("div",null,f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Соединение")),f.createElement(le.a,{fullWidth:!0,value:i.value,onChange:function(e){return i.onChange(e.target.value)}},this.props.socialConnections.list.filter(function(e){return e.entity.connector.tpe.value===_.LinkedInApp.$Type.value}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id.value},e.entity.name)}))),f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Тип назначения")),f.createElement(le.a,{fullWidth:!0,value:o.value,onChange:function(e){return o.onChange(e.target.value)}},f.createElement(pe.a,{value:_.LinkedInPostTypeCompanyPage.$Type.value},this.props.i18n.t("Страница организации")),f.createElement(pe.a,{value:_.FacebookPostTypeUserFeed.$Type.value},this.props.i18n.t("Страница пользователя")))),!!i&&o.value===_.LinkedInPostTypeCompanyPage.$Type.value&&f.createElement(ie.a,{fullWidth:!0},f.createElement(oe.a,null,this.props.i18n.t("Страницы организации")),f.createElement(le.a,{fullWidth:!0,value:l.value,onChange:function(e){return l.onChange(e.target.value)}},Object(M.headOption)(this.props.socialConnections.list.filter(function(e){return e.entity.connector.tpe.value===_.LinkedInApp.$Type.value}).filter(function(e){return e.id.value===i.value})).map(function(e){return e.entity.connector.companies}).getOrElse(function(){return[]}).map(function(e,t){return f.createElement(pe.a,{key:t,value:e.id},e.name)})))))}}]),t}(f.Component);Lr=$r([m.autobind],Lr);var Mr=Object(h.connect)(function(e,t){return{i18n:e.i18n,formFields:Object(q.e)(e.fields,t.formId),socialConnections:e.socialConnections}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(J.reduxForm)({form:"notifyTemplateForm",fields:["name","type","senderFieldId","socialConnectionId","facebookPageId","facebookGroupId","linkedInCompanyPageId","postType","addressTypes","templateValue","tag"]})(Lr)),Vr=n(1821),Nr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ar=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Wr=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p()(t,e),o()(t,[{key:"getTags",value:function(){return Object(U.a)(this.props.notifyTemplatesDescriptionsList.map(function(e){return e.tag}).filter(function(e){return e.nonEmpty()}).map(function(e){return e.getOrElse(function(){return""})}))}},{key:"openEditForm",value:function(e,t,n){var r=this,i=void 0;this.props.openDialog(e,f.createElement(Mr,{ref:function(e){return i=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},formId:_.Id.createId(this.props.params.formId).getOrElse(function(){throw"wrong form id"}),initialValues:n,onSubmit:t,tags:this.getTags()}),[f.createElement(E.a,{variant:"raised",onClick:function(){return r.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return i.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"getMessageParamsData",value:function(e){switch(e.type){case _.EmailDataEditorTypeSimple.$Type.value:return new _.MessageParamsDataEmailData([],"","","","","<div></div>\n","",[],"",!1,new _.EmailDataEditorTypeSimple,"",(new Array).concat(e.addressTypes||[]).map(function(e){return Object(be.D)(e)}));case _.EmailDataEditorTypeAdvanced.$Type.value:return new _.MessageParamsDataEmailData([],"","","","","<div></div>\n","",[],"",!1,new _.EmailDataEditorTypeAdvanced,"",(new Array).concat(e.addressTypes||[]).map(function(e){return Object(be.D)(e)}));case _.MessageParamsDataSmsData.$Type.value:return new _.MessageParamsDataSmsData(new _.Id(e.senderFieldId),"");case _.MessageParamsDataWebPushData.$Type.value:return new _.MessageParamsDataWebPushData("");case _.MessengerParamsData.$Type.value:return new _.MessengerParamsData(new _.Id(""),new _.Id(e.senderFieldId),"",new _.MessengerTypeFacebook);case _.MessageParamsDataFacebookData.$Type.value:return new _.MessageParamsDataFacebookData(new _.Id(e.socialConnectionId),Object(be.J)(e),"");case _.MessageParamsDataLinkedInData.$Type.value:return new _.MessageParamsDataLinkedInData(new _.Id(e.socialConnectionId),Object(be.J)(e),"");default:throw"Unknown message params data type"}}},{key:"onCreateRequested",value:function(){var e=this;this.openEditForm(this.props.i18n.t("Новый шаблон рассылки"),function(t){return new Promise(function(n,r){var i=e.getMessageParamsData(t),a=G(new _.NotifyTemplate(t.name,new _.Id(e.props.params.formId),!0,[],i),{tag:{$set:""===t.tag?new M.None:Object(M.toOption)(t.tag)}});return Object(Pr.b)(a).then(function(t){n(t),e.props.dispatch(Object(A.h)(e.props.i18n.t("Создание успешно завершено"))),e.props.handleDialogClose(!1),e.props.dispatch(Object(T.bb)(new _.Id(e.props.params.eventLineId),new _.Id(e.props.params.formTypeId),new _.Id(e.props.params.formId),t.id)),e.props.dispatch(Object(xr.a)(new _.Id(e.props.params.formId)))}).catch(function(e){r(e)})}).catch(function(t){e.props.dispatch(Object(N.a)(t))})},{addressTypes:[{type:_.EmailAddressTypeFieldId.$Type.value,fieldId:"",template:""}]})}},{key:"onEdit",value:function(e){this.props.dispatch(Object(T.bb)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId),new _.Id(e.id.toString())))}},{key:"onDelete",value:function(e){var t=this,n=this.props.i18n;this.props.openDialog(n.t("Удаление шаблона рассылки"),f.createElement("div",null,n.t("Вы уверены? Данное действие нельзя отменить")),[f.createElement(E.a,{variant:"raised",onClick:function(){t.props.handleDialogClose(!0)},style:{marginRight:"10px"}},n.t("Нет")),f.createElement(E.a,{variant:"raised",onClick:function(){Object(Pr.c)(new _.Id(e.id.toString())).then(function(e){t.props.dispatch(Object(A.h)(t.props.i18n.t("Удаление успешно завершено"))),t.props.handleDialogClose(!1),t.props.dispatch(Object(xr.a)(new _.Id(t.props.params.formId)))}).catch(function(e){t.props.dispatch(Object(N.a)(e))})},color:"primary"},n.t("Да"))])}},{key:"onCopy",value:function(e){var t=this;Object(Pr.a)(new _.Id(e.id.toString())).then(function(e){return t.props.dispatch(Object(xr.a)(new _.Id(t.props.params.formId))).then(function(){t.props.handleDialogClose(!1),t.props.dispatch(Object(A.h)(t.props.i18n.t("Шаблон рассылки скопирован")))})}).catch(function(e){return t.props.dispatch(Object(A.h)(t.props.i18n.t("Ошибка - не удалось создать копию шаблона рассылки")))})}},{key:"getTypeLabel",value:function(e){switch(e){case _.MessageParamsDataEmailData.$Type.value:return this.props.i18n.t("Email");case _.MessageParamsDataSmsData.$Type.value:return this.props.i18n.t("SMS");case _.MessageParamsDataWebPushData.$Type.value:return this.props.i18n.t("Пуш уведомление");case _.MessengerParamsData.$Type.value:return this.props.i18n.t("Мессенджер");case _.MessageParamsDataFacebookData.$Type.value:return this.props.i18n.t("Facebook");case _.MessageParamsDataLinkedInData.$Type.value:return this.props.i18n.t("LinkedIn");default:throw"Unknown message params data type"}}},{key:"onOpenNotificationsFilter",value:function(e){var t=this,n=void 0,r=this.props.openDialog(this.props.i18n.t("Рассылка по фильтру"),f.createElement("div",null,f.createElement("div",{style:{position:"absolute",right:0,top:0,zIndex:10}},f.createElement(Vr.a,{filterId:Rr.b,formId:_.Id.createId(this.props.params.formId).getOrElse(function(){throw"wrong form id"})})),f.createElement(Rr.a,{formId:_.Id.createId(this.props.params.formId).getOrElse(function(){throw"wrong form id"}),ref:function(e){return n=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},templateId:_.Id.createId(e.id),onSubmit:function(e){return function(e,n){return new Promise(function(r,i){Object(Pr.i)(new _.Id(e),Object(ke.b)(t.props.filtersForm,Rr.b)).then(function(e){t.props.handleDialogClose(n),t.props.dispatch(Object(A.h)(t.props.i18n.t("Уведомления отправлены"))),r()}).catch(function(e){console.error(e),i()})})}(e.templateId,r)},onClose:function(){return t.props.handleDialogClose(r)},filter:new M.None})),[f.createElement(E.a,{variant:"raised",onClick:function(){return n.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Отправить")),f.createElement(E.a,{variant:"raised",onClick:function(){return t.props.handleDialogClose(r)}},this.props.i18n.t("Закрыть"))])}},{key:"renderTable",value:function(e){var t=this,n=this.props.notifyTemplatesDescriptionsList.filter(function(t){return"!defaultTag"===e?t.tag.isEmpty():t.tag.map(function(t){return t===e}).getOrElse(function(){return!1})});return!(this.props.notifyTemplatesDescriptionsList.length>0&&"!defaultTag"===e&&0===n.length)&&f.createElement("div",{style:{marginBottom:15}},f.createElement(P.a,{showId:!0,error:this.props.descriptionsError,onRecordSelected:this.onEdit,fetching:this.props.descriptionsFetching,empty:!this.props.descriptionsFetching&&0==this.props.notifyTemplatesDescriptionsList.length,withActions:!0,headers:[{id:"notifyTemplateName",title:this.props.i18n.t("table|Название")},{id:"notifyTemplateType",title:this.props.i18n.t("table|Тип")},{id:"notifyTemplateDelivered",title:this.props.i18n.t("table|Отправлено")},{id:"notifyTemplateOpened",title:this.props.i18n.t("table|Прочитано")},{id:"notifyTemplateOpened",title:this.props.i18n.t("table|Не доставлено")},{id:"documentTemplateTag",title:this.props.i18n.t("Группа")}],rows:this.props.descriptionsFetching?[]:n.map(function(n){return{payload:n,id:n.id.toString(),fields:[n.name,t.getTypeLabel(n.params),n.delivered,n.opened,n.bounced,""+("!defaultTag"===e?t.props.i18n.t("По умолчанию"):e)],buttons:[f.createElement(Kt.a,{placement:"bottom",title:t.props.i18n.t("Рассылка по фильтру")},f.createElement(w.a,{key:"filter",style:B.f,onClick:function(e){e.stopPropagation(),t.onOpenNotificationsFilter(n)}},f.createElement(Et.a,{style:B.g}))),f.createElement(w.a,{key:"edit",style:B.f,onClick:function(e){e.stopPropagation(),t.onEdit(n)}},f.createElement(F.a,{style:B.g})),f.createElement(w.a,{key:"delete",style:B.f,onClick:function(e){e.stopPropagation(),t.onDelete(n)}},f.createElement(R.a,{style:B.g})),f.createElement(w.a,{key:"copy",style:B.f,onClick:function(e){e.stopPropagation(),t.onCopy(n)}},f.createElement(Z.a,{style:B.g}))]}})}))}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Создать"))),this.getTags().map(function(t){return e.renderTable(t)}),this.renderTable("!defaultTag"))}}]),t}(f.Component);Wr=Nr([m.autobind,Ar("design:paramtypes",[Object])],Wr);var qr=Object(h.connect)(function(e,t){return{descriptionsError:e.notifyTemplates.descriptionsError,descriptionsFetching:e.notifyTemplates.descriptionsFetching,notifyTemplatesDescriptionsList:e.notifyTemplates.descriptionsList.filter(function(n){return e.user.userRole.map(function(e){return!e.entity.isNotifyTemplateRestricted(new _.Id(t.params.formId),new _.Id(n.id))}).getOrElse(function(){return!1})}),organisation:e.organisation,i18n:e.i18n,filtersForm:e.filtersForm}})(Object(ye.a)(function(e){e.isTokenChecked&&(e.dispatch(Object(xr.b)(new _.Id(e.params.formId))),e.organisation.organisationId.foreach(function(t){e.dispatch(Object(Sr.b)(t))}))},function(){},function(e,t){e.params.formId!==t.params.formId&&e.dispatch(Object(xr.b)(new _.Id(e.params.formId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(xr.b)(new _.Id(e.params.formId))),Object(M.isEqual)(e.organisation.organisationId,t.organisation.organisationId)||e.organisation.organisationId.foreach(function(t){e.dispatch(Object(Sr.a)(t))}),Object(M.isEqual)(e.organisation.organisationId,t.organisation.organisationId)&&e.isTokenChecked&&!t.isTokenChecked&&e.organisation.organisationId.foreach(function(t){e.dispatch(Object(Sr.a)(t))})})(Object(pn.a)(Wr))),Br=n(1509),Hr=n(1512),zr=n(1806),Kr=n(652),Ur=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Gr=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Zr=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p()(t,e),o()(t,[{key:"convertFields",value:function(e){return e.map(function(e){return new _.ExportConfigField(new _.Id(e.fieldId.value),e.position,e.displayField)})}},{key:"onCreateRequested",value:function(){switch(this.props.exportType.value){case _.ExportPipelineStages.$Type.value:this.props.dispatch(Object(T.B)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId)));break;case _.ExportFileArchive.$Type.value:this.props.dispatch(Object(T.z)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId)))}}},{key:"onEdit",value:function(e){switch(e.params){case _.ExportPipelineStages.$Type.value:this.props.dispatch(Object(T.x)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId),new _.Id(e.id.toString())));break;case _.ExportFileArchive.$Type.value:this.props.dispatch(Object(T.y)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId),new _.Id(e.id.toString())))}}},{key:"onDelete",value:function(e){var t=this,n=this.props.i18n;this.props.openDialog(n.t("Удаление конфигурации"),f.createElement("div",null,n.t("Вы действительно хотите удалить данную конфигурацию, это действие нельзя будет отменить?")),[f.createElement(E.a,{variant:"raised",onClick:function(){t.props.handleDialogClose(!0)},style:{marginRight:"10px"}},n.t("Нет")),f.createElement(E.a,{variant:"raised",onClick:function(){Object(Br.b)(new _.Id(e.id.toString())).then(function(e){t.props.dispatch(Object(A.h)(t.props.i18n.t("Конфигурация была успешно удалена!"))),t.props.handleDialogClose(!1),t.props.dispatch(Object(Hr.b)(new _.Id(t.props.params.formId)))}).catch(function(e){t.props.dispatch(Object(N.a)(e))})},color:"primary"},n.t("Да"))])}},{key:"onAddOperation",value:function(e){var t=this;Object(zr.a)(e.id,Object(M.liftKey)(this.props.formRecordsTable.filters,this.props.params.formId)).then(function(e){t.props.dispatch(Object(A.h)(t.props.i18n.t("Операция экспорта создана!")))}).catch(function(e){t.props.dispatch(Object(A.h)(t.props.i18n.t("Ошибка во время создания операции экспорта!")))})}},{key:"render",value:function(){var e=this,t=this.props,n=t.exportPipelines,r=t.i18n,i=new _.Id(this.props.params.formId),a=Object(Kr.f)(n,i).getOrElse(function(){return!0}),o=Object(Kr.e)(n,i),s=Object(Kr.d)(n,i).getOrElse(function(){return[]}).filter(function(t){return t.params===e.props.exportType.value});return f.createElement(f.Fragment,null,f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},r.t("Создать"))),f.createElement(P.a,{showId:!0,error:o,fetching:a,empty:!a&&0==s.length,withActions:!0,headers:[{id:"formName",title:r.t("Название")}],rows:a?[]:s.map(function(t){return{payload:t,id:t.id.toString(),fields:[t.name],buttons:[f.createElement(Kt.a,{style:B.g,placement:"right",title:e.props.i18n.t("Список экспортов")},f.createElement(w.a,{key:"menu",style:B.f,onClick:function(n){return e.props.dispatch(Object(T.C)(new _.Id(e.props.params.eventLineId),new _.Id(e.props.params.formTypeId),new _.Id(e.props.params.formId),new _.Id(t.id.toString())))}},f.createElement(dr.a,{style:B.g}))),f.createElement(Kt.a,{style:B.g,placement:"right",title:e.props.i18n.t("Настройки")},f.createElement(w.a,{key:"edit",style:B.f,onClick:function(n){n.stopPropagation(),e.onEdit(t)}},f.createElement(Ct.a,{style:B.g}))),f.createElement(Kt.a,{style:B.g,placement:"right",title:e.props.i18n.t("Удалить")},f.createElement(w.a,{key:"delete",style:B.f,onClick:function(n){n.stopPropagation(),e.onDelete(t)}},f.createElement(R.a,{style:B.g})))]}})}))}}]),t}(f.Component);Zr=Ur([m.autobind,Gr("design:paramtypes",[Object])],Zr);var Yr=Object(h.connect)(function(e){return{exportPipelines:e.exportPipelines,formRecordsTable:e.formRecordsTable,i18n:e.i18n}})(Zr),Jr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"render",value:function(){return f.createElement(Yr,Object.assign({},this.props,{exportType:_.ExportFileArchive.$Type}))}}]),t}(f.Component),Xr=Object(ye.a)(function(e){e.isTokenChecked&&e.dispatch(Object(Hr.b)(new _.Id(e.params.formId)))},function(){},function(e,t){e.params.formId!==t.params.formId&&e.dispatch(Object(Hr.b)(new _.Id(e.params.formId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(Hr.b)(new _.Id(e.params.formId)))})(Jr),Qr=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"render",value:function(){return f.createElement(Yr,{params:this.props.params,openDialog:this.props.openDialog,handleDialogClose:this.props.handleDialogClose,exportType:_.ExportPipelineStages.$Type})}}]),t}(f.Component),ei=Object(h.connect)()(Object(ye.a)(function(e){e.isTokenChecked&&e.dispatch(Object(Hr.b)(new _.Id(e.params.formId)))},function(){},function(e,t){e.params.formId!==t.params.formId&&e.dispatch(Object(Hr.b)(new _.Id(e.params.formId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(Hr.b)(new _.Id(e.params.formId)))})(Qr)),ti=n(627),ni=n(1467),ri=(n(2517),n(1478)),ii=n(1461),ai=n(1488),oi=n(1487),si=n(1518),li=n.n(si),ci=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},pi=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(Xt.d)(this.props.formId))}},{key:"onReportCreateRequest",value:function(){var e=this,t=new _.Id(je.v4()),n=void 0;this.props.openDialog(this.props.i18n.t("Создание отчета"),f.createElement(At,{ref:function(e){return n=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},onSubmit:function(n){return function(n){return new Promise(function(r,i){return Object(Xt.a)(new _.ReportConfig(n.name,e.props.formId,Object(M.liftKey)(e.props.filtersForm.filter,t.value),e.typeToReportParams(n))).then(function(t){r(t),e.props.dispatch(Object(Qt.g)(t)),e.props.dispatch(Object(Xt.d)(e.props.formId)),e.props.dispatch(Object(A.h)(e.props.i18n.t("Отчет успешно создан"))),e.props.handleDialogClose(!1)}).catch(function(e){i(e)})}).catch(function(t){return e.props.dispatch(Object(N.b)(t))})}(n)},formFields:this.props.fields,currentForm:this.props.form,filterId:t,filterValue:new M.None}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return e.props.handleDialogClose(!1)}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return n.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"paramsTypeToInitialValues",value:function(e){switch(e.entity.params.tpe.value){case _.ReportParamsSimpleSum.$Type.value:return{simpleSumFieldId:e.entity.params.fieldId.value};case _.ReportParamsRecordsCount.$Type.value:return{};case _.ReportParamsCategoriesSum.$Type.value:return{categoryField:e.entity.params.categoryField.value,numericField:e.entity.params.numericField.value};case _.ReportParamsCategoriesCount.$Type.value:return{categoriesCountFieldId:e.entity.params.fieldId.value};case _.ReportParamsFormDataReport.$Type.value:return{templateId:e.entity.params.templateId.value,reportFormatType:e.entity.params.format.tpe.value,refs:e.entity.params.refs||[],contentType:e.entity.params.format instanceof _.ReportFormatText?e.entity.params.format.contentType:"",extension:e.entity.params.format instanceof _.ReportFormatText?e.entity.params.format.extension:""};default:return{}}}},{key:"getReportFormat",value:function(e){switch(e.reportFormatType){case _.ReportFormatExcel.$Type.value:return new _.ReportFormatExcel;case _.ReportFormatText.$Type.value:return new _.ReportFormatText(e.contentType,e.extension);default:return new _.ReportFormatExcel}}},{key:"getReportParamsFormData",value:function(e){return new _.ReportParamsFormDataReport(new _.Id(e.templateId),(e.refs||[]).map(function(e){return new _.ReportRefField(e.formId,e.fieldId)}),this.getReportFormat(e))}},{key:"typeToReportParams",value:function(e){switch(e.params){case _.ReportParamsSimpleSum.$Type.value:return new _.ReportParamsSimpleSum(new _.Id(e.simpleSumFieldId));case _.ReportParamsRecordsCount.$Type.value:return new _.ReportParamsRecordsCount;case _.ReportParamsCategoriesSum.$Type.value:return new _.ReportParamsCategoriesSum(new _.Id(e.categoryField),new _.Id(e.numericField));case _.ReportParamsCategoriesCount.$Type.value:return new _.ReportParamsCategoriesCount(new _.Id(e.categoriesCountFieldId));case _.ReportParamsFormDataReport.$Type.value:return this.getReportParamsFormData(e);default:return new _.ReportParamsRecordsCount}}},{key:"onReportEditRequest",value:function(e){var t=this,n=new _.Id(je.v4()),r=void 0;this.props.openDialog(this.props.i18n.t("Редактирование отчета"),f.createElement(At,{ref:function(e){return r=Object(M.toOption)(e).flatMap(function(e){return Object(M.toOption)(e.wrappedInstance)})},onSubmit:function(r){return function(r){return new Promise(function(i,a){return Object(Xt.f)(G(e,{entity:{name:{$set:r.name},filter:{$set:Object(M.liftKey)(t.props.filtersForm.filter,n.value)},params:{$set:t.typeToReportParams(r)}}})).then(function(e){i(e),t.props.dispatch(Object(Qt.l)(e)),t.props.dispatch(Object(Xt.d)(t.props.formId)),t.props.dispatch(Object(A.h)(t.props.i18n.t("Изменения в отчете успешно сохранены"))),t.props.handleDialogClose(!1)}).catch(function(e){a(e)})}).catch(function(e){return t.props.dispatch(Object(N.b)(e))})}(r)},formFields:this.props.fields,currentForm:this.props.form,filterId:n,filterValue:e.entity.filter,initialValues:Object.assign({name:e.entity.name,params:e.entity.params.tpe.value},this.paramsTypeToInitialValues(e))}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(!1)}},this.props.i18n.t("Закрыть")),f.createElement(E.a,{variant:"raised",onClick:function(){return r.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"onReportDeleteRequested",value:function(e){var t=this;this.props.openDialog(this.props.i18n.t("Удаление отчета"),f.createElement("div",null,this.props.i18n.t("Вы действительно хотите удалить отчет, это действие нельзя будет отменить?")),[f.createElement(E.a,{variant:"raised",onClick:function(){t.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Нет")),f.createElement(E.a,{variant:"raised",onClick:function(){Object(Xt.b)(e.id).then(function(e){t.props.dispatch(Object(Qt.h)(e)),t.props.dispatch(Object(Xt.d)(t.props.formId)),t.props.handleDialogClose(!0),t.props.dispatch(Object(A.h)(t.props.i18n.t("Отчет успешно удалён")))}).catch(function(e){t.props.dispatch(Object(N.b)(e))})},color:"primary"},this.props.i18n.t("Да"))])}},{key:"onReportResultsOpenRequest",value:function(e){var t=this;this.props.dispatch(Object(Xt.c)(e.id)).then(function(n){t.props.reports.result.map(function(n){if(n.data.tpe.value!==_.ReportDataSum.$Type.value&&n.data.tpe.value!==_.ReportDataReportFile.$Type.value||t.props.openDialog(t.props.i18n.t("Просмотр отчета"),f.createElement(Jt,{report:e,formDataIdtoNameMapping:{},reports:t.props.reports}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(!1)}},t.props.i18n.t("Закрыть"))]),n.data.tpe.value===_.ReportDataGroupSum.$Type.value){var r=e.entity.params.tpe.value===_.ReportParamsCategoriesSum.$Type.value?"categoryField":"fieldId",i=Object(M.headOption)(Object(q.e)(t.props.fields,t.props.formId).getOrElse(function(){return[]}).filter(function(t){return t.id.value===e.entity.params[r].value})).map(function(e){return e.entity.valueType.family.value}).getOrElse(function(){throw new Error("ref field form was not found")}),a=t.props.reports.result.map(function(e){return e.data.xs.map(function(e){return e[0]})}).getOrElse(function(){return[]});t.props.dispatch(Object(tn.b)(new _.Id(i),a,new M.None,a.length)).then(function(n){var r=Object(M.liftKey)(t.props.formRecords.result,i).flatMap(function(e){return e}).map(function(e){return e.records}).getOrElse(function(){return[]}).reduce(function(e,t){return Object.assign(e,ht()({},t.id.value,Object(M.headOption)(Object(en.a)(t.entity.values)).map(function(e){return e.value.toString()}).getOrElse(function(){return""})))},{});t.props.openDialog(t.props.i18n.t("Просмотр отчета"),f.createElement(Jt,{report:e,formDataIdtoNameMapping:r,reports:t.props.reports}),[f.createElement(E.a,{variant:"raised",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(!1)}},t.props.i18n.t("Закрыть"))])})}})})}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},f.createElement(x.b,null,f.createElement(E.a,{variant:"raised",color:"primary",onClick:this.onReportCreateRequest},this.props.i18n.t("Создать"))),f.createElement(P.a,{showId:!1,error:this.props.reports.error,fetching:this.props.reports.fetching,empty:!this.props.reports.fetching&&0==this.props.reports.list.length,withActions:!0,headers:[{id:"fontFamily",title:this.props.i18n.t("Название")}],rows:this.props.reports.list.map(function(t,n){return{id:t.id.value,payload:t,fields:[t.entity.name],buttons:[f.createElement(w.a,{key:"edit",style:B.f,onClick:function(n){n.stopPropagation(),e.onReportResultsOpenRequest(t)}},f.createElement(li.a,{style:B.g})),f.createElement(w.a,{key:"edit",style:B.f,onClick:function(n){n.stopPropagation(),e.onReportEditRequest(t)}},f.createElement(F.a,{style:B.g})),f.createElement(w.a,{key:"delete",style:B.f,onClick:function(n){n.stopPropagation(),e.onReportDeleteRequested(t)}},f.createElement(R.a,{style:B.g}))]}})}))}}]),t}(f.Component);pi=ci([m.autobind],pi);var ui,di=Object(h.connect)(function(e){return{i18n:e.i18n,form:e.currentForm,fields:e.fields,reports:e.reports,filtersForm:e.filtersForm,formRecords:e.formRecords}})(pi),fi=n(1827),mi=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},hi=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},gi=ui=function(e){function t(e){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Object.assign(ni.a.screenInitialState(),{selectedIndex:ui.selectedIndex(e),nestedSelectedIndex:ui.nestedSelectedIndex()})))}return p()(t,e),o()(t,[{key:"renderNavigation",value:function(){return f.createElement(ti.a,null)}},{key:"onSelected",value:function(e){var t=new _.Id(this.props.params.formId),n=new _.Id(this.props.params.eventLineId),r=new _.Id(this.props.params.formTypeId);switch(e){case 10:this.props.dispatch(Object(T.F)(n,r,t));break;case 0:this.props.dispatch(Object(T.E)(n,r,t));break;case 2:this.props.dispatch(Object(T.s)(n,r,t));break;case 3:this.props.dispatch(Object(T.t)(n,r,t));break;case 4:this.props.dispatch(Object(T.P)(n,r,t));break;case 5:this.props.dispatch(Object(T.O)(n,r,t));break;case 6:this.props.dispatch(Object(T.D)(n,r,t));break;case 7:this.props.dispatch(Object(T.A)(n,r,t));break;case 12:this.props.dispatch(Object(T.D)(n,r,t));break;case 8:this.props.dispatch(Object(T.n)(n,r,t));break;case 9:this.props.dispatch(Object(T.W)(n,r,t));break;case 11:this.props.dispatch(Object(T.cb)(n,r,t));break;case 13:this.props.dispatch(Object(T.U)(n,r,t));break;case 14:this.props.dispatch(Object(T.K)(n,r,t));break;case 15:this.props.dispatch(Object(T.G)(n,r,t))}this.setState(G(this.state,{selectedIndex:{$set:ui.nestedSelectedIndexToSelectedIndex(e)},nestedSelectedIndex:{$set:ui.selectedIndexToNestedSelectedIndex(e)}}))}},{key:"onDictionariesListRequested",value:function(){this.props.dispatch(Object(T.L)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId)))}},{key:"onEntriesListRequested",value:function(){this.props.dispatch(Object(T.J)(new _.Id(this.props.params.eventLineId),new _.Id(this.props.params.formTypeId),new _.Id(this.props.params.formId)))}},{key:"renderImportExport",value:function(){switch(this.state.nestedSelectedIndex){case 4:return f.createElement(Fr,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose});case 5:return f.createElement(Dr,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose});case 6:return f.createElement(ei,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose});case 7:return f.createElement(Xr,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose})}}},{key:"renderBlocksContent",value:function(){switch(this.state.nestedSelectedIndex){case 8:return f.createElement(qn,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose});case 9:return f.createElement(ir,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose});default:return f.createElement("div",null,"unknown blocks content")}}},{key:"renderDocumentsContent",value:function(){switch(this.state.nestedSelectedIndex){case 1:return f.createElement(ft,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose});case 2:return f.createElement(Ce,{params:this.props.params,openDialog:this.openDialog,handleDialogClose:this.handleDialogClose});default:return f.createElement("div",null,"unknown documents content")}}},{key:"render",value:function(){var e=this,t=_.Id.createId(this.props.params.formId).getOrElse(function(){throw"wrong form id"}),n=_.FormType.getFormType(new _.Id(this.props.params.formTypeId));return this.renderScreenBody({className:"formPage"},this.props.role.map(function(r){return f.createElement("div",{style:{display:"flex",flex:1,flexDirection:"column",minHeight:"0px"}},e.props.params.formTypeId===_.FormType.DICTIONARY&&f.createElement(ri.a,{title:e.props.currentForm.data.map(function(e){return e.entity.name}).getOrElse(function(){return e.props.i18n.t("Загрузка...")}),onGoBackRequested:e.onDictionariesListRequested,rightButtonGroup:[f.createElement(E.a,{onClick:e.onEntriesListRequested,style:{margin:"0px 15px",flexShrink:0}},e.props.i18n.t("К анкетам"))]}),f.createElement(C.a,{style:{display:"flex",flex:1,minHeight:"0px"}},f.createElement(ai.a,{value:e.state.selectedIndex,onChange:e.onSelected},!n.filter(function(e){return _.FormType.isAccessZonePasses(e)}).nonEmpty()&&[r.entity.isFormServicePermitted(t,_.AdminFormServiceFormEdit.$Type.value)&&f.createElement(oi.a,{value:0,label:e.props.i18n.t("Настройки"),key:"general"},f.createElement(_n,{params:e.props.params,openDialog:e.openDialog,handleDialogClose:e.handleDialogClose})),r.entity.isFormServicePermitted(t,_.AdminFormServiceLimits.$Type.value)&&!n.filter(function(e){return _.FormType.isDictionary(e)}).nonEmpty()&&!n.filter(function(e){return _.FormType.isAccessZonePasses(e)}).nonEmpty()&&!n.filter(function(e){return _.FormType.isDocument(e)}).nonEmpty()&&!n.filter(function(e){return _.FormType.isEmail(e)}).nonEmpty()&&!n.filter(function(e){return _.FormType.isSimpleDictionary(e)}).nonEmpty()&&f.createElement(oi.a,{value:13,label:e.props.i18n.t("Лимиты"),key:"limits"},f.createElement(_n,{renderLimits:!0,params:e.props.params,openDialog:e.openDialog,handleDialogClose:e.handleDialogClose}))],r.entity.isFormServicePermitted(t,_.AdminFormServiceFields.$Type.value)&&f.createElement(oi.a,{value:10,label:e.props.i18n.t("Поля")},f.createElement(K,{params:e.props.params,openDialog:e.openDialog,handleDialogClose:e.handleDialogClose})),r.entity.isFormServicePermitted(t,_.AdminFormServiceImports.$Type.value)&&r.entity.isFormServicePermitted(t,_.AdminFormServiceExports.$Type.value)&&f.createElement(oi.a,{value:12,label:e.props.i18n.t("Импорт/Экспорт")},f.createElement("div",{style:{display:"flex",flexDirection:"column",flex:1}},f.createElement(b.a,{onChange:function(t,n){return e.onSelected(n)},indicatorColor:"primary",textColor:"primary",fullWidth:!0,value:e.state.nestedSelectedIndex},f.createElement(y.a,{value:4,label:e.props.i18n.t("Импорт")}),",",f.createElement(y.a,{value:5,label:e.props.i18n.t("Импорт файлов")}),f.createElement(y.a,{value:6,label:e.props.i18n.t("Экспорт")}),",",f.createElement(y.a,{value:7,label:e.props.i18n.t("Экспорт файлов")})),e.renderImportExport())),!n.filter(function(e){return _.FormType.isDictionary(e)}).nonEmpty()&&!n.filter(function(e){return _.FormType.isAccessZonePasses(e)}).nonEmpty()&&!n.filter(function(e){return _.FormType.isDocument(e)}).nonEmpty()&&!n.filter(function(e){return _.FormType.isEmail(e)}).nonEmpty()&&[r.entity.isFormServicePermitted(t,_.AdminFormServiceNotifies.$Type.value)&&f.createElement(oi.a,{value:11,label:e.props.i18n.t("Рассылки"),key:"emails_notifications"},f.createElement(qr,{params:e.props.params,openDialog:e.openDialog,handleDialogClose:e.handleDialogClose})),r.entity.isFormServicePermitted(t,_.AdminFormServiceDocuments.$Type.value)&&f.createElement(oi.a,{value:3,label:e.props.i18n.t("Документы"),key:"documents-templates"},f.createElement("div",{style:{display:"flex",flexDirection:"column",flex:1}},f.createElement(b.a,{onChange:function(t,n){return e.onSelected(n)},indicatorColor:"primary",textColor:"primary",fullWidth:!0,value:e.state.nestedSelectedIndex},f.createElement(y.a,{value:1,label:e.props.i18n.t("Документы")}),f.createElement(y.a,{value:2,label:e.props.i18n.t("Шаблоны документов")})),e.renderDocumentsContent()))],r.entity.isFormServicePermitted(t,_.AdminFormServiceBlocks.$Type.value)&&r.entity.isFormServicePermitted(t,_.AdminFormServiceDataListViewEdit.$Type.value)&&f.createElement(oi.a,{value:8,label:e.props.i18n.t("Блоки/Списки")},f.createElement("div",{style:{display:"flex",flexDirection:"column",flex:1}},f.createElement(b.a,{onChange:function(t,n){return e.onSelected(n)},indicatorColor:"primary",textColor:"primary",fullWidth:!0,value:e.state.nestedSelectedIndex},f.createElement(y.a,{value:8,label:e.props.i18n.t("Блоки")}),",",f.createElement(y.a,{value:9,label:e.props.i18n.t("Списки")})),e.renderBlocksContent())),r.entity.isFormServicePermitted(t,_.AdminFormServiceReports.$Type.value)&&f.createElement(oi.a,{value:14,label:e.props.i18n.t("Отчеты")},f.createElement(di,{formId:new _.Id(e.props.params.formId),openDialog:e.openDialog,handleDialogClose:e.handleDialogClose})),r.entity.isFormServicePermitted(t,_.AdminFormServiceFiltersEdit.$Type.value)&&f.createElement(oi.a,{value:15,label:e.props.i18n.t("Системные фильтры")},f.createElement(fi.a,{formId:new _.Id(e.props.params.formId),showSystemFilters:!0,actionsDisabled:!1})))))}).getOrNull())}}],[{key:"selectedIndex",value:function(e){return-1!==location.href.indexOf("/fields")?10:-1!==location.href.indexOf("/documentTemplates")?3:-1!==location.href.indexOf("/documents")?3:-1!==location.href.indexOf("/import")?12:-1!==location.href.indexOf("/importFiles")?12:-1!==location.href.indexOf("/export")?12:-1!==location.href.indexOf("/exportFiles")?12:-1!==location.href.indexOf("/blocks")?8:-1!==location.href.indexOf("/listConfigs")?8:-1!==location.href.indexOf("/general")?0:-1!==location.href.indexOf("/notifyTemplates")?11:-1!==location.href.indexOf("/limits")?13:-1!==location.href.indexOf("/reports")?14:-1!==location.href.indexOf("/filters")?15:_.FormType.getFormType(new _.Id(e.params.formTypeId)).filter(function(e){return _.FormType.isAccessZonePasses(e)}).matchWith(function(){return 12},function(){return 0})}},{key:"nestedSelectedIndex",value:function(){return-1!==location.href.indexOf("/documentTemplates")?2:-1!==location.href.indexOf("/documents")?1:-1!==location.href.indexOf("/importFiles")?5:-1!==location.href.indexOf("/import")?4:-1!==location.href.indexOf("/exportFiles")?7:-1!==location.href.indexOf("/export")?6:-1!==location.href.indexOf("/blocks")?8:-1!==location.href.indexOf("/listConfigs")?9:0}},{key:"nestedSelectedIndexToSelectedIndex",value:function(e){switch(e){case 1:case 2:return 3;case 4:case 5:case 6:case 7:return 12;case 8:case 9:return 8;default:return e}}},{key:"selectedIndexToNestedSelectedIndex",value:function(e){switch(e){case 12:return 6;default:return e}}}]),t}(ni.a);gi=ui=mi([m.autobind,hi("design:paramtypes",[Object])],gi);t.default=Object(h.connect)(function(e){return{i18n:e.i18n,currentForm:e.currentForm,forms:e.forms,role:e.user.userRole}})(Object(ii.a)(Object(ye.a)(function(e){e.isTokenChecked&&(e.forms.fetching||e.dispatch(Object(Je.h)(new _.Id(e.params.formId))))},function(){},function(e,t){!e.forms.fetching&&t.forms.fetching&&e.dispatch(Object(Je.h)(new _.Id(e.params.formId))),e.params.formId!==t.params.formId&&e.dispatch(Object(Je.h)(new _.Id(e.params.formId))),e.params.formId===t.params.formId&&e.isTokenChecked&&!t.isTokenChecked&&e.dispatch(Object(Je.h)(new _.Id(e.params.formId)))})(gi)))}}]);