(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[1],{2372:function(e,t,n){var r=n(2373);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(116)(r,i);r.locals&&(e.exports=r.locals)},2373:function(e,t,n){(e.exports=n(115)(!1)).push([e.i,".ActionTemplateEditor__toolbar{margin-bottom:10px;background-color:#fff !important;flex-shrink:0}.public-DraftEditor-content{min-height:60px}.public-DraftEditorPlaceholder-root{padding:16px 18px}\n",""])},2397:function(e,t,n){"use strict";n.r(t);var r=n(2),i=n.n(r),o=n(10),a=n.n(o),s=n(4),l=n.n(s),u=n(5),p=n.n(u),c=n(12),d=n.n(c),f=n(1),h=n(11),m=n(15),y=n(723),v=n(253),g=n(463),b=n(467),O=n.n(b),E=n(3),F=n(31),T=n(759),j=n(22),C=n(554),k=function(e){return f.createElement(C.a,Object.assign({},e),f.createElement("path",{d:"M3,2H21V2H21V4H20.92L14,10.92V22.91L10,18.91V10.91L3.09,4H3V2Z"}))},R=function(e){return f.createElement(C.a,Object.assign({},e),f.createElement("path",{d:"M3,2H21V2H21V4H20.92L15,9.92V22.91L9,16.91V9.91L3.09,4H3V2M11,16.08L13,18.08V9H13.09L18.09,4H5.92L10.92,9H11V16.08Z"}))},I=function(e){return f.createElement(C.a,Object.assign({},e),f.createElement("path",{d:"M3,2H21V2H21V4H20.92L14,10.92V22.91L10,18.91V10.91L3.09,4H3V2M18,14C17.87,14 17.76,14.09 17.74,14.21L17.55,15.53C17.25,15.66 16.96,15.82 16.7,16L15.46,15.5C15.35,15.5 15.22,15.5 15.15,15.63L14.15,17.36C14.09,17.47 14.11,17.6 14.21,17.68L15.27,18.5C15.25,18.67 15.24,18.83 15.24,19C15.24,19.17 15.25,19.33 15.27,19.5L14.21,20.32C14.12,20.4 14.09,20.53 14.15,20.64L15.15,22.37C15.21,22.5 15.34,22.5 15.46,22.5L16.7,22C16.96,22.18 17.24,22.35 17.55,22.47L17.74,23.79C17.76,23.91 17.86,24 18,24H20C20.11,24 20.22,23.91 20.24,23.79L20.43,22.47C20.73,22.34 21,22.18 21.27,22L22.5,22.5C22.63,22.5 22.76,22.5 22.83,22.37L23.83,20.64C23.89,20.53 23.86,20.4 23.77,20.32L22.7,19.5C22.72,19.33 22.74,19.17 22.74,19C22.74,18.83 22.73,18.67 22.7,18.5L23.76,17.68C23.85,17.6 23.88,17.47 23.82,17.36L22.82,15.63C22.76,15.5 22.63,15.5 22.5,15.5L21.27,16C21,15.82 20.73,15.65 20.42,15.53L20.23,14.21C20.22,14.09 20.11,14 20,14M19,17.5A1.5,1.5 0 0,1 20.5,19A1.5,1.5 0 0,1 19,20.5C18.16,20.5 17.5,19.83 17.5,19A1.5,1.5 0 0,1 19,17.5Z"}))},w=n(29),S=n(6),$=n.n(S),P=n(34),V=n.n(P),x=n(764),D=n(8),L=n(2137),G=n.n(L),A=n(111),N=n(27),M=n(0),_=n(288),q=n(40),B=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"isValueDisable",value:function(e){return this.props.value.filter((function(e){return e.value.tpe.value===E.ValueObjectRefs.$Type.value})).map((function(t){return t.value.id.findIndex((function(t){return t.value===e.id.value}))>-1})).getOrElse((function(){return!1}))||this.isValueDeleted(e)}},{key:"isValueDeleted",value:function(e){return e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusDeleted.$Type.value||e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusNominalDeleted.$Type.value}},{key:"isProcessed",value:function(e){return this.props.processedFormRecords.filter((function(t){return t.value===e.id.value})).length>0}},{key:"checkLimit",value:function(e){var t=this;return this.props.limits.flatMap((function(n){return Object(M.g)(t.props.forms.list.filter((function(e){return e.id.value===t.props.parentFormId.value}))).map((function(e){return e.entity.limits.filter((function(e){return e.memberFieldId.value===t.props.output.formField.value}))})).flatMap((function(t){return Object(M.g)(t.map((function(t){var r=Object(M.g)(n.filter((function(e){return e.cfgId===t.limitType.id})));return(!r.isEmpty()||!t.limitType.required||t.limitType.tpe.value!==E.LimitTypeTotalLimitType.$Type.value)&&(r.isEmpty()&&t.limitType.required&&t.limitType.tpe.value===E.LimitTypeLinkedFieldType.$Type.value?e.formRecord.entity.getFormFieldValue(t.limitType.memberTypeId).filter((function(e){return e.value.id.length>0})).nonEmpty():r.map((function(n){switch(n.data.tpe.value){case E.LimitDataTotal.$Type.value:if(n.data.values.avail<0)return!1;break;case E.LimitDataLinkedValues.$Type.value:var r=n.data;return!Object(M.g)([].concat(V()(r.values)).filter((function(n){return e.formRecord.entity.getFormFieldValue(t.limitType.memberTypeId).flatMap((function(e){return Object(M.g)(e.value.id)})).filter((function(e){return e.value===n[0]})).nonEmpty()&&n[1].avail<1}))).nonEmpty()&&(!e.formRecord.entity.getFormFieldValue(t.limitType.memberTypeId).filter((function(e){return e.value.id.filter((function(e){return 0===[].concat(V()(r.values.keys())).filter((function(t){return t===e.value})).length})).length>0})).nonEmpty()||!t.limitType.required);default:throw"Unknown MembersLimit type"}return!0})).getOrElse((function(){return!0})))})).filter((function(e){return!e})))}))})).isEmpty()}},{key:"getValues",value:function(){return this.props.inputValue.map((function(e){return D(e,{displayValues:{$set:e.displayValuesAdding.map((function(t,n){return t instanceof w.B?t:new w.B(t.id,[t.value.toString()],e.formRecords[n])}))},displayValuesMap:{$set:Object.keys(e.displayValuesMap).reduce((function(t,n,r){var i=e.displayValuesMap[n];return Object(M.g)(e.formRecords.filter((function(e){return e.id.value===n}))).map((function(e){return Object.assign(Object.assign({},t),$()({},n,i instanceof w.B?i:new w.B(i.id,[i.value.toString()],e)))})).getOrElse((function(){return{}}))}),{})}})})).map((function(e){return e.displayValuesAdding})).getOrElse((function(){return[]})).filter((function(e){return e instanceof w.B}))}},{key:"onOnlyOneChoiceRecordSelect",value:function(e,t){var n=this;Object(M.g)(this.getValues().filter((function(t){return t.id.value===e}))).foreach((function(e){return n.props.onObjRefAdd(e)}))}},{key:"getEnhancedTableProps",value:function(){return this.props.onlyOneChoice?{onRecordSelected:this.onOnlyOneChoiceRecordSelect.bind(this)}:{onRecordMarked:this.props.onRecordMarked,onSelectAll:this.props.onSelectAll}}},{key:"getRows",value:function(){var e=this;return this.getValues().map((function(t){var n=e.isValueDisable(t),r=e.isProcessed(t),i=e.isValueDisable(t)||r||!e.checkLimit(t);return{payload:t.id.value,id:t.id.value,fields:t.values,deleted:n||!e.checkLimit(t),selectDisabled:i,buttons:e.props.onlyOneChoice?[]:(new Array).concat(r?[f.createElement(g.a,{size:30})]:(new Array).concat(n||e.props.onlyOneChoice?[]:[f.createElement(v.a,{key:"add",style:Object.assign(Object.assign({},q.d),{padding:"4px"}),onClick:function(n){return e.props.onObjRefAdd(t)},disabled:n||!e.checkLimit(t)},f.createElement(O.a,{style:q.e}))]).concat(e.props.onObjRefDelete&&n?[f.createElement(v.a,{key:"delete",style:Object.assign(Object.assign({},q.d),{padding:"4px"}),onClick:function(n){return e.props.onObjRefDelete&&e.props.onObjRefDelete(t)},disabled:!n},f.createElement(G.a,{style:q.e}))]:[]))}}))}},{key:"render",value:function(){var e=this.props.fields.getOrElse((function(){return[]})),t=(Object(M.g)(e.filter((function(e){return e.entity.valueType.tag.map((function(e){return e.tpe.value===E.ValueTagSimpleDictionaryPosition.$Type.value})).getOrElse((function(){return!1}))}))),this.props.displayFieldsForAdding.map((function(e){switch(e.tpe.value){case E.DisplayFieldByField.$Type.value:return{id:e.fieldId.value,title:e.caption};case E.DisplayFieldByTemplate.$Type.value:return{id:e.template,title:e.caption};default:return{id:e.fieldId.value,title:e.caption}}}))),n=Object(M.g)(Object(x.a)(this.props.displayFieldsForAdding.map((function(e,t){return e.sort.enabled?t:void 0})).filter((function(e){return void 0!==e})))).getOrElse((function(){return-1})),r=this.props.displayFieldsForAdding.reduce((function(e,t,n){return Object.assign(Object.assign({},e),$()({},n,!t.sort.enabled||t.sort.value.map((function(e){return e.tpe.value===E.SortOrderAsc.$Type.value})).getOrElse((function(){return!0}))))}),{});return f.createElement(_.a,Object.assign({showId:!1,error:new M.b},this.getEnhancedTableProps(),{markedRecords:this.props.markedFormRecords.map((function(e){return e.value})),fetching:this.props.dataInputFetching.getOrElse((function(){return!1})),empty:!1,columnStyles:this.props.displayFieldsForAdding.map((function(e){return{flex:e.columnWidth}})),columnIndexSort:n,columnOrderAsc:r,withActions:!0,headers:t,maxBodyHeight:Object(M.l)("50"),rows:this.getRows()}))}}]),t}(f.Component),U=Object(h.connect)((function(e,t){return{i18n:e.i18n,dataInputFetching:Object(M.j)(e.dataInputs.fetching,t.display.id.value),fields:Object(F.f)(e.fields,t.childFormId),inputValue:Object(A.b)(e.dataInputs,t.display.id),value:Object(j.e)(e.dataOutput,t.blockRendererId,t.output),limits:Object(N.k)(e.blockRendererContext,t.blockRendererId),forms:e.forms,formRecord:Object(N.e)(e.blockRendererContext,t.blockRendererId)}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataInputs.input===t.dataInputs.input&&e.dataOutput===t.dataOutput&&e.blockRendererContext===t.blockRendererContext&&e.fields.list===t.fields.list&&e.forms===t.forms},areStatePropsEqual:function(e,t){return Object(M.h)(e.fields,t.fields)&&Object(M.h)(e.value,t.value)&&Object(M.h)(e.inputValue,t.inputValue)&&Object(M.h)(e.limits,t.limits)&&Object(M.h)(e.formRecord,t.formRecord)&&e.i18n===t.i18n&&e.forms===t.forms}})(B),W=n(162),H=n(459),z=n(218),Z=n(98),J=n(260),K=n(219),Y=n(195),Q=n(52),X=n(722),ee=n(758),te=n(602),ne=n(1903),re=n(724),ie=n(609),oe=n(1028),ae=n(1029),se=n(299),le=n.n(se),ue=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},pe=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onSubstFieldChange",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:D(this.props.condition,{valueField:{$set:new E.Id(e.target.value)}})}))}},{key:"render",value:function(){var e=this.props.sourceFormId?Object(F.f)(this.props.fields,this.props.sourceFormId).getOrElse((function(){return[]})):[];return f.createElement(oe.a,null,f.createElement(ae.a,null,this.props.i18n.t("Поле значения")),f.createElement(ie.a,{native:!0,value:this.props.condition.valueField.value,onChange:this.onSubstFieldChange},e.map((function(e){return f.createElement("option",{key:e.id.value,value:e.id.value},e.entity.caption)}))))}}]),t}(f.Component);pe=ue([m.autobind],pe);var ce=Object(h.connect)((function(e,t){return{i18n:e.i18n,fields:e.fields}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(pe),de=n(67),fe=n(744),he=n(55),me=n(2283),ye=n(2376),ve=n(1896),ge=n(757),be=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Oe=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ee=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={generatorId:e.value},n}return p()(t,e),a()(t,[{key:"onGeneratorChanged",value:function(e){var t=this;this.setState(D(this.state,{generatorId:{$set:e}}),(function(){t.props.onChanged(e)}))}},{key:"onGeneratorSelect",value:function(e){var t=e.target.value;"!noValuesGenerator"===t?this.onGeneratorChanged(new M.b):this.onGeneratorChanged(Object(M.l)(t).map((function(e){return parseInt(e)})).filter((function(e){return!isNaN(e)})).map((function(e){return new E.InternalId(e)})))}},{key:"render",value:function(){return f.createElement(oe.a,{fullWidth:!0},f.createElement(ae.a,null,this.props.labelText.getOrElse((function(){return""}))),f.createElement(ie.a,{error:this.props.errorText.nonEmpty(),onChange:this.onGeneratorSelect,fullWidth:this.props.fullWidth||!1,value:this.state.generatorId.map((function(e){return e.value.toString()})).getOrElse((function(){return"!noValuesGenerator"})),displayEmpty:!1},this.props.generators.map((function(e){return f.createElement(ee.a,{value:e.entity.internalId.value.toString(),key:e.id.value},f.createElement(ve.a,{primary:e.entity.name}))}))),this.props.errorText.map((function(e){return f.createElement(ge.a,null,e)})).getOrNull())}}]),t}(f.Component);Ee=be([m.autobind,Oe("design:paramtypes",[Object])],Ee);var Fe,Te=Object(h.connect)((function(e){return{i18n:e.i18n}}))(Ee),je=n(53),Ce=(n(2372),n(2374),n(107)),ke=n(39),Re=n(126),Ie=n(61),we=n.n(Ie),Se=n(958),$e=n(737),Pe=n(738),Ve=n(380),xe=n(222),De=n(918),Le=n(952),Ge=n(917),Ae=n(273),Ne=n(919),Me=n(272),_e=n(920),qe=n(223),Be=n(921),Ue=n(224),We=n(225),He=n(923),ze=n(922),Ze=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Je=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ke=(Fe={},$()(Fe,xe.a,(function(e){return f.createElement(De.a,Object.assign({},e.attributes,{inline:e.node}))})),$()(Fe,Ae.a,(function(e){return f.createElement(Ne.a,Object.assign({},e.attributes,{inline:e.node}))})),$()(Fe,Me.a,(function(e){return f.createElement(_e.a,Object.assign({},e.attributes,{inline:e.node}))})),$()(Fe,qe.a,(function(e){return f.createElement(Be.a,Object.assign({},e.attributes,{inline:e.node}))})),$()(Fe,Ue.a,(function(e){return f.createElement(ze.a,Object.assign({},e.attributes,{inline:e.node}))})),$()(Fe,We.a,(function(e){return f.createElement(He.a,Object.assign({},e.attributes,{inline:e.node}))})),Fe),Ye=new me.CompositeDecorator([]),Qe=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={value:he.n.fromJSON(Object($e.a)(e.template)),editorState:me.EditorState.createEmpty(Ye),generatorId:new M.b},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchTemplateForms()}},{key:"onChange",value:function(e){var t=this;this.setState(D(this.state,{value:{$set:e.value}}),(function(){return t.updateTemplate(e.value)}))}},{key:"updateTemplate",value:function(e){var t=this;setTimeout((function(){t.state.value===e&&t.props.onChange(Object(Pe.b)(e.toJSON()))}),100)}},{key:"renderInline",value:function(e,t,n){return Object(ke.b)(e.node.type)(Ke).matchWith((function(t){return t(e)}),(function(){return n()}))}},{key:"openAddFieldPopover",value:function(e){var t=this;Object(je.e)(this.props.forms,this.props.formId).foreach((function(n){t.props.openPopover(Object(M.l)(Object(Q.findDOMNode)(e.currentTarget)),f.createElement(Se.a,{form:n,fields:t.props.fields,withRefFieldSelector:t.props.withRefFieldSelector,onAddField:t.onAddField}))}))}},{key:"fetchTemplateForms",value:function(){var e=this;Object(ye.a)(Object(M.l)(this.props.template.match(/form_id\d+/gi)).getOrElse((function(){return[]})).map((function(e){return e.replace("form_id","")}))).forEach((function(t){return e.props.dispatch(Object(Re.e)(E.Id.createId(t).getOrElse((function(){throw"wrong form id"}))))}))}},{key:"getFormFields",value:function(e){return Object(F.f)(e.fields,e.formId).getOrElse((function(){return[]}))}},{key:"onAddField",value:function(e){this.editor.foreach((function(t){t.insertInline(Object(Le.a)(e)).moveToStartOfNextText().focus()})),this.props.closePopover()}},{key:"openAddGeneratorPopover",value:function(e){var t=this;this.props.openPopover(Object(M.l)(Object(Q.findDOMNode)(e.currentTarget)),f.createElement("div",{style:{padding:15}},f.createElement(Te,{errorText:new M.b,labelText:new M.c(this.props.i18n.t("Генератор")),fullWidth:!0,generators:this.props.generators,onChanged:this.onGeneratorIdChange,value:this.state.generatorId}),f.createElement("div",{style:{textAlign:"right"}},f.createElement(y.a,{variant:"contained",onClick:this.onAddGenerator},this.props.i18n.t("Вставить")))),(function(){t.setState(D(t.state,{generatorId:{$set:new M.b}}))}))}},{key:"onGeneratorIdChange",value:function(e){this.setState(D(this.state,{generatorId:{$set:e}}))}},{key:"onAddGenerator",value:function(){var e=this;this.state.generatorId.foreach((function(t){e.setState(D(e.state,{generatorId:{$set:new M.b}}),(function(){e.editor.foreach((function(e){e.insertInline({type:Ae.a,data:{generatorId:t.value.toString()}}).moveToStartOfNextText().focus()})),e.props.closePopover()}))}))}},{key:"onAddData",value:function(){this.editor.foreach((function(e){e.insertInline({type:Me.a,data:{}}).moveToStartOfNextText().focus()}))}},{key:"ref",value:function(e){this.editor=Object(M.l)(e)}},{key:"render",value:function(){return f.createElement("div",null,f.createElement("div",{className:"ActionTemplateEditor__toolbar"},this.props.generators.length>0&&f.createElement(y.a,{onClick:this.openAddGeneratorPopover,style:{marginRight:"10px"}},this.props.i18n.t("Генератор")),this.getFormFields(this.props).length>0&&f.createElement(v.a,{onClick:this.openAddFieldPopover,style:q.d},f.createElement(O.a,{style:q.e})),this.props.useData&&f.createElement(y.a,{onClick:this.onAddData},this.props.i18n.t("Данные"))),f.createElement("div",{style:{border:"1px solid ".concat(we.a[300]),borderRadius:4,padding:"18.5px 14px"}},f.createElement(Ve.b,{formId:this.props.formId},f.createElement(fe.a,{placeholder:this.props.i18n.t("Шаблон заполнения поля"),ref:this.ref,value:this.state.value,schema:Ge.a,onChange:this.onChange,renderInline:this.renderInline}))))}}]),t}(f.Component);Qe=Ze([m.autobind,Je("design:paramtypes",[Object])],Qe);var Xe=Object(h.connect)((function(e){return{i18n:e.i18n,fields:e.fields,forms:e.forms}}))(Object(Ce.a)(Qe)),et=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},tt=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onTemplateEditorStateChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:D(this.props.condition,{template:{$set:e}})}))}},{key:"onTemplateSettingsClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Настройка шаблона"),f.createElement(Xe,{formId:this.props.sourceFormId,templateId:this.props.filterId.value,generators:[],template:this.props.condition.template,onChange:this.onTemplateEditorStateChanged}),[f.createElement(y.a,{variant:"contained",onClick:function(){return e.props.handleDialogClose(t)}},this.props.i18n.t("Закрыть"))])}},{key:"render",value:function(){return f.createElement(y.a,{variant:"contained",size:"small",onClick:this.onTemplateSettingsClick},this.props.i18n.t("Настроить шаблон"))}}]),t}(f.Component);tt=et([m.autobind],tt);var nt=Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(de.a)(tt)),rt=n(538),it=n(2394),ot=n(1906),at=n(1864),st=n(2379),lt=n.n(st),ut=n(1938),pt=n.n(ut),ct=n(1939),dt=n.n(ct),ft=n(2377),ht=n.n(ft),mt=n(2378),yt=n.n(mt),vt=n(763),gt=n(875),bt=n(733),Ot=n(1543),Et=n(1895),Ft=n(1904),Tt=n(407),jt=n.n(Tt),Ct=n(30),kt=n(192),Rt=n.n(kt),It=n(54),wt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},St=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},$t=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={currentPage:0,rowPerPage:20,displayValues:[],formRecordIds:e.formRecordIds,formRecords:[],markedFormRecords:[],displayValuesFetching:!1,displayValuesError:new M.b,sorting:[],searchValue:"",searchField:new M.b,totalRecords:0},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchFormRecords()}},{key:"fetchFormRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M.b;Object(It.i)(new E.DataPageRequest(this.state.currentPage,this.state.rowPerPage,this.props.formId,t,this.state.sorting.map((function(e){return e.sortType})))).then((function(t){e.setState(D(e.state,{displayValues:{$set:t.page.records.map((function(t){return{id:t.id,formRecord:t,values:e.props.displayFields.map((function(e){return Object(M.j)(t.entity.values,e.id.value).map((function(e){return e.value.toString()})).getOrElse((function(){return""}))}))}}))},formRecords:{$set:t.page.records},displayValuesFetching:{$set:!1},markedFormRecords:{$set:[]}}))})).catch((function(t){e.setState(D(e.state,{displayValuesFetching:{$set:!1},displayValuesError:{$set:Object(M.l)(t)}}))}))}},{key:"onMarkedAddClick",value:function(){var e=this;if(0!==this.state.markedFormRecords.length){var t=this.state.markedFormRecords;this.setState(D(this.state,{markedFormRecords:{$set:[]},formRecordIds:{$push:t}}),(function(){e.props.onObjRefsAdd(e.state.displayValues.filter((function(e){return t.filter((function(t){return t.value===e.id.value})).length>0})))}))}}},{key:"onAddClick",value:function(e){var t=this;this.setState(D(this.state,{markedFormRecords:{$set:this.state.markedFormRecords.filter((function(t){return t.value!==e.id.value}))},formRecordIds:{$push:[e.id]}}),(function(){t.props.onObjRefsAdd([e])}))}},{key:"onDeleteClick",value:function(e){var t=this;this.setState(D(this.state,{formRecordIds:{$set:this.state.formRecordIds.filter((function(t){return t.value!==e.id.value}))}}),(function(){t.props.onObjRefsDelete([e])}))}},{key:"onSelectAll",value:function(){this.state.markedFormRecords.length===this.state.formRecords.length?this.setState(D(this.state,{markedFormRecords:{$set:[]}})):this.setState(D(this.state,{markedFormRecords:{$set:this.state.formRecords.map((function(e){return e.id}))}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex((function(t){return t.value===e}));t>=0?this.setState(D(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(D(this.state,{markedFormRecords:{$push:[new E.Id(e)]}}))}},{key:"onRecordSelected",value:function(e){}},{key:"onNextPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:this.state.currentPage+1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPrevPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:this.state.currentPage-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onFirstPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:0},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onLastPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:Math.ceil(this.state.totalRecords/this.state.rowPerPage)-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(D(this.state,{rowPerPage:{$set:e},markedFormRecords:{$set:this.state.rowPerPage<=e?this.state.markedFormRecords:[]}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchValueChanged",value:function(e){this.setState(D(this.state,{searchValue:{$set:e.target.value}}))}},{key:"onSearchRecords",value:function(){var e=this,t=this.state.searchField.map((function(t){return new E.FilterCondition(t,new E.FilterExpressionContains,new E.ValueStr(e.state.searchValue))}));this.setState(D(this.state,{currentPage:{$set:0},markedFormRecords:{$set:[]}}),(function(){return e.fetchFormRecords(t)}))}},{key:"getFormSortType",value:function(e){return this.props.dispatch(Object(Re.d)(this.props.formId,e))}},{key:"sortRecords",value:function(e,t,n){var r=this;this.setState(D(this.state,e.matchWith((function(e){var i=r.state.sorting.findIndex((function(e){return e.fieldId.value===t.value}));return-1===i?{sorting:{$push:[{fieldId:t,asc:n,sortType:e}]}}:{sorting:{$splice:[[i,1,{fieldId:t,asc:n,sortType:e}]]}}}),(function(){return{sorting:{$set:r.state.sorting.filter((function(e){return e.fieldId.value!==t.value}))}}}))),(function(){r.fetchFormRecords()}))}},{key:"onSortRequest",value:function(e){var t=this;Object(M.l)(this.state.sorting.find((function(t){return t.fieldId.value===e.value}))).map((function(n){n.asc?t.sortRecords(Object(M.l)(D(n.sortType,{asc:{$set:!1}})),e,!1):t.sortRecords(new M.b,e,!0)})).getOrElse((function(){t.sortRecords(t.getFormSortType(e),e,!0)}))}},{key:"onSearchFieldChange",value:function(e){this.setState(D(this.state,{searchField:{$set:new M.c(new E.Id(e.target.value))}}))}},{key:"isValueAdded",value:function(e){return this.state.formRecordIds.filter((function(t){return t.value===e.id.value})).length>0}},{key:"isValueDeleted",value:function(e){return e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusDeleted.$Type.value||e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusNominalDeleted.$Type.value}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(z.b,{leftButtonGroup:[f.createElement(y.a,{key:"add",variant:"contained",size:"small",onClick:this.onMarkedAddClick},this.props.i18n.t("Добавить"))]}),f.createElement(_.a,{showId:!1,error:this.state.displayValuesError,onSelectAll:this.onSelectAll,onRecordMarked:this.onRecordMarked,onRecordSelected:this.onRecordSelected,markedRecords:this.state.markedFormRecords.map((function(e){return e.value})),fetching:this.state.displayValuesFetching,empty:0===this.state.displayValues.length,withActions:!0,headers:this.props.displayFields.map((function(e){return{id:e.id.value,title:e.entity.caption}})),onSort:this.onSortRequest,sortedFieldIds:this.state.sorting,rows:this.state.displayValues.map((function(t){var n=e.isValueAdded(t),r=e.isValueDeleted(t);return{payload:t.id.value,id:t.id.value,fields:t.values,selectDisabled:r,buttons:[n?f.createElement(v.a,{key:"delete",style:q.d,onClick:function(n){return e.onDeleteClick(t)}},f.createElement(G.a,{style:q.e})):f.createElement(v.a,{key:"add",style:q.d,onClick:function(n){return e.onAddClick(t)},disabled:r},f.createElement(O.a,{style:q.e}))]}}))}),f.createElement(z.a,{blockTableSearch:!0,nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.state.totalRecords,shouldShowMassActions:!1,massActionsComponents:[],searchValue:this.state.searchValue,searchField:this.state.searchField.map((function(e){return e.value})).getOrNull(),searchFields:this.props.displayFields,onSearchValueChange:this.onSearchValueChanged,onSearchRecords:this.onSearchRecords,onSearchFieldChange:this.onSearchFieldChange}))}}]),t}(f.Component);$t=wt([m.autobind,St("design:paramtypes",[Object])],$t);var Pt=Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})($t),Vt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},xt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Dt=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={currentPage:0,rowPerPage:20,displayValues:[],formRecords:[],formRecordIds:e.formRecordIds,markedFormRecords:[],displayValuesFetching:!1,displayValuesError:new M.b},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.fetchFormRecords()}},{key:"fetchFormRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M.b,n=Object(M.l)(new E.FilterGroupCondition([new E.RestrictedForm(this.props.valueType.family,this.state.formRecordIds)].concat(t?t.map((function(e){return[e]})).getOrElse((function(){return[]})):[]),new E.FilterPredicateAnd));Object(It.i)(new E.DataPageRequest(this.state.currentPage,this.state.rowPerPage,this.props.valueType.family,n,[])).then((function(t){e.setState(D(e.state,{displayValues:{$set:t.page.records.map((function(t){return{id:t.id,values:e.props.displayFields.map((function(e){return Object(M.j)(t.entity.values,e.id.value).map((function(e){return e.value.toString()})).getOrElse((function(){return""}))}))}}))},formRecords:{$set:t.page.records},displayValuesFetching:{$set:!1}}))})).catch((function(t){e.setState(D(e.state,{displayValuesFetching:{$set:!1},displayValuesError:{$set:Object(M.l)(t)}}))}))}},{key:"onObjRefsAdd",value:function(e){var t=this;this.setState(D(this.state,{formRecordIds:{$push:e.map((function(e){return e.id}))}}),(function(){t.props.onChange(t.state.formRecordIds.concat(e.map((function(e){return e.id}))),t.state.formRecords.filter((function(t){return e.map((function(e){return e.id})).filter((function(e){return e.value===t.id.value})).length>0})))}))}},{key:"onObjRefsDelete",value:function(e){var t=this,n=this.state.formRecordIds.filter((function(t){return 0===e.filter((function(e){return e.id.value===t.value})).length}));this.setState(D(this.state,{formRecordIds:{$set:n}}),(function(){t.props.onChange(n,[])}))}},{key:"onAddClick",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Добавление анкеты"),f.createElement(Pt,{formId:this.props.valueType.family,formRecordIds:this.state.formRecordIds,displayFields:this.props.displayFields,onObjRefsAdd:this.onObjRefsAdd,onObjRefsDelete:this.onObjRefsDelete}),[f.createElement(y.a,{variant:"contained",key:"close",onClick:function(n){e.props.handleDialogClose(t),e.setState(D(e.state,{displayValuesFetching:{$set:!0}}),(function(){e.fetchFormRecords()}))}},this.props.i18n.t("Закрыть"))])}},{key:"sliceCurrentPage",value:function(e){return e.slice(this.state.currentPage*this.state.rowPerPage,(this.state.currentPage+1)*this.state.rowPerPage)}},{key:"onSelectAll",value:function(){this.state.markedFormRecords.length===this.sliceCurrentPage(this.state.formRecordIds).length?this.setState(D(this.state,{markedFormRecords:{$set:[]}})):this.setState(D(this.state,{markedFormRecords:{$set:this.sliceCurrentPage(this.state.formRecordIds)}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex((function(t){return t.value===e.value}));t>=0?this.setState(D(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(D(this.state,{markedFormRecords:{$push:[e]}}))}},{key:"onRecordSelected",value:function(e){}},{key:"onNextPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:this.state.currentPage+1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPrevPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:this.state.currentPage-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onFirstPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:0},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onLastPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:Math.ceil(this.state.formRecordIds.length/this.state.rowPerPage)-1},displayValuesFetching:{$set:!0}}),(function(){return e.fetchFormRecords()}))}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(D(this.state,{rowPerPage:{$set:e},markedFormRecords:{$set:this.state.rowPerPage<=e?this.state.markedFormRecords:[]}}),(function(){return t.fetchFormRecords()}))}},{key:"onDeleteValue",value:function(e){var t=this,n=this.state.formRecordIds.filter((function(t){return t.value!==e.id.value}));this.setState(D(this.state,{formRecordIds:{$set:n},displayValuesFetching:{$set:!0}}),(function(){t.props.onChange(n,[]),t.fetchFormRecords()}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,f.createElement(z.b,{leftButtonGroup:[f.createElement(y.a,{key:"add",variant:"contained",size:"small",onClick:this.onAddClick},this.props.i18n.t("Добавить"))]}),f.createElement(_.a,{showId:!1,error:this.state.displayValuesError,onSelectAll:this.onSelectAll,onRecordMarked:this.onRecordMarked,onRecordSelected:this.onRecordSelected,markedRecords:this.state.markedFormRecords.map((function(e){return e.value})),fetching:this.state.displayValuesFetching,empty:0===this.state.displayValues.length,withActions:!0,headers:this.props.displayFields.map((function(e){return{id:e.id.value,title:e.entity.caption}})),rows:this.state.displayValues.map((function(t){return{payload:t.id,id:t.id.value,fields:t.values,buttons:[f.createElement(v.a,{style:q.d,key:"delete",onClick:function(n){return e.onDeleteValue(t)}},f.createElement(Rt.a,{style:q.e}))]}}))}),f.createElement(z.a,{blockTableSearch:!1,nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.state.formRecordIds.length,shouldShowMassActions:!1,massActionsComponents:[]}))}}]),t}(f.Component);Dt=Vt([m.autobind,xt("design:paramtypes",[Object])],Dt);var Lt=Object(h.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(de.a)(Dt)),Gt=n(387),At=n(76),Nt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Mt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_t=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={timeZoneOffset:(new Date).getTimezoneOffset()},n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.formFieldType(this.props.condition.field).map((function(e){return e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))&&this.props.dispatch(Object(Gt.a)())}},{key:"componentWillReceiveProps",value:function(e){this.formFieldType(e.condition.field).map((function(e){return e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))&&!this.formFieldType(this.props.condition.field).map((function(e){return e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))&&e.dispatch(Object(Gt.a)())}},{key:"onConditionValueChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:D(this.props.condition,{value:{$set:e}})}))}},{key:"onListValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueList([n.values[e.target.index]]))}))}},{key:"onContainsListValueChanged",value:function(e){this.onConditionValueChanged(new E.ValueList([new E.ValueStr(e.target.value)]))}},{key:"onLatitudeChanged",value:function(e){this.onConditionValueChanged(this.props.condition.value.updateLatitude(e.target.value))}},{key:"onLongitudeChanged",value:function(e){this.onConditionValueChanged(this.props.condition.value.updateLongitude(e.target.value))}},{key:"onRegExpChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.condition,newPredicate:D(this.props.condition,{expression:{expr:{$set:e.target.value}}})}))}},{key:"onObjRefsValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueObjectRefs([new E.Id(e)]))}))}},{key:"onUserRefsValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueUserRefs([new E.EntityRef(E.Id.createId(e).getOrElse((function(){throw"wrong user id"})),E.User.$Type.value)]))}))}},{key:"onOneOfUserRefsValueChanged",value:function(e){var t=this;this.formFieldType(this.props.condition.field).foreach((function(n){return t.onConditionValueChanged(new E.ValueUserRefs(e.map((function(e){return new E.EntityRef(E.Id.createId(e).getOrElse((function(){throw"wrong user id"})),E.User.$Type.value)}))))}))}},{key:"onObjRefsValueToggled",value:function(e,t){var n=this;this.formFieldType(this.props.condition.field).foreach((function(r){return n.onConditionValueChanged(D(t,{id:{$set:Object(rt.a)(t.id,[new E.Id(e)],Z.a)}}))}))}},{key:"onStringValueChanged",value:function(e){this.onConditionValueChanged(new E.ValueStr(e.target.value))}},{key:"onNumberValueChanged",value:function(e){var t=this;Object(Ct.b)(e.target.value,this.props.condition.value.toString(),!0,(function(e){return t.onConditionValueChanged(new E.ValueNumber(e))}))}},{key:"onBoolValueChanged",value:function(e){this.onConditionValueChanged(new E.ValueBool(e))}},{key:"formFieldType",value:function(e){return Object(M.j)(this.props.fields.list,this.props.formId.value).flatMap((function(t){return Object(M.g)(t.filter((function(t){return t.id.value===e.value}))).map((function(e){return e.entity.valueType}))}))}},{key:"onObjRefsIdsChanged",value:function(e){this.onConditionValueChanged(new E.ValueObjectRefs(e))}},{key:"setObjectRefsValue",value:function(e){var t=this,n=this.props.openDialog(this.props.i18n.t("Настройка значения"),f.createElement(Lt,{formRecordIds:this.props.condition.value.id,valueType:e,displayFields:Object(F.f)(this.props.fields,e.family).getOrElse((function(){return[]})).filter((function(t){return e.displayFields.filter((function(e){return e.value===t.id.value})).length>0})),onChange:this.onObjRefsIdsChanged}),[f.createElement(y.a,{variant:"contained",key:"close",onClick:function(e){return t.props.handleDialogClose(n)}},this.props.i18n.t("Закрыть"))])}},{key:"onDateValueChange",value:function(e){var t=this;Object(M.l)(e).foreach((function(e){t.onConditionValueChanged(new E.ValueDate(e.getTime()))}))}},{key:"onTimeValueChange",value:function(e){var t=this;Object(M.l)(e).foreach((function(e){t.onConditionValueChanged(new E.ValueDate(e.getTime()+6e4*t.state.timeZoneOffset))}))}},{key:"onTimeZoneChange",value:function(e){this.setState({timeZoneOffset:e.target.value})}},{key:"getDateTypePicker",value:function(e){switch(e.dateType.tpe.value){case E.DateTypeDate.$Type.value:return f.createElement(vt.DatePicker,{value:this.props.condition.value.value,onChange:this.onDateValueChange,leftArrowIcon:f.createElement(pt.a,null),rightArrowIcon:f.createElement(dt.a,null),cancelLabel:this.props.i18n.t("Отмена"),okLabel:this.props.i18n.t("ОК"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),format:"dd.MM.yyyy"});case E.DateTypeTime.$Type.value:return f.createElement(bt.TimePicker,{cancelLabel:this.props.i18n.t("Отмена"),okLabel:this.props.i18n.t("ОК"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),onChange:this.onTimeValueChange,value:new Date(this.props.condition.value.value.getTime()-6e4*this.state.timeZoneOffset)});case E.DateTypeDateTime.$Type.value:return f.createElement(gt.DateTimePicker,{cancelLabel:this.props.i18n.t("Отмена"),okLabel:this.props.i18n.t("ОК"),clearLabel:this.props.i18n.t("Очистить"),todayLabel:this.props.i18n.t("Сегодня"),value:new Date(this.props.condition.value.value.getTime()-6e4*this.state.timeZoneOffset),onChange:this.onTimeValueChange,leftArrowIcon:f.createElement(pt.a,null),rightArrowIcon:f.createElement(dt.a,null),dateRangeIcon:f.createElement(ht.a,null),timeIcon:f.createElement(yt.a,null)})}}},{key:"render",value:function(){var e=this;return this.props.condition.expression.tpe===E.FilterExpressionRegExp.$Type?f.createElement(re.a,{style:{flex:1,marginTop:15},value:this.props.condition.expression.expr,onChange:this.onRegExpChanged}):this.formFieldType(this.props.condition.field).map((function(t){switch(t.tpe){case E.ValueTypeStr.$Type:return f.createElement(re.a,{style:{flex:1,marginTop:15},value:Object(M.l)(e.props.condition.value).map((function(e){return e})).map((function(e){return e.value})).getOrElse((function(){return""})),onChange:e.onStringValueChanged});case E.ValueTypeNumber.$Type:return f.createElement(re.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onNumberValueChanged});case E.ValueTypeBool.$Type:return f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{native:!0,value:e.props.condition.value.toString(),onChange:function(t){return e.onBoolValueChanged("true"===t.target.value)}},f.createElement("option",{value:"true",key:0},"True"),f.createElement("option",{value:"false",key:1},"False")));case E.ValueTypeValuesList.$Type:return e.props.condition.expression.tpe.value===E.FilterExpressionContains.$Type.value||e.props.condition.expression.tpe.value===E.FilterExpressionNotContains.$Type.value?f.createElement(re.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onContainsListValueChanged}):f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{native:!0,value:Object(M.l)(e.props.condition.value).filter((function(e){return e instanceof E.ValueList})).flatMap((function(t){return Object(M.g)(e.props.condition.value.values)})).map((function(e){return e.toString()})).getOrElse((function(){return""})),onChange:e.onListValueChanged},t.values.map((function(e,t){return f.createElement("option",{value:e.toString(),key:t},e.value)}))));case E.ValueTypeGeoPoint.$Type:return f.createElement("div",{style:{flex:1,display:"flex"}},f.createElement(re.a,{type:"number",style:{flex:1,marginTop:15},value:e.props.condition.value.lat,label:e.props.i18n.t("Широта"),onChange:e.onLatitudeChanged}),f.createElement(re.a,{type:"number",style:{flex:1,marginTop:15},value:e.props.condition.value.lng,label:e.props.i18n.t("Долгота"),onChange:e.onLongitudeChanged}));case E.ValueTypeObjectRefs.$Type:return e.props.condition.expression.tpe.value===E.FilterExpressionGt.$Type.value||e.props.condition.expression.tpe.value===E.FilterExpressionLt.$Type.value?f.createElement(re.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onNumberValueChanged}):Object(je.e)(e.props.forms,t.family).map((function(e){return E.FormType.isForm(e.entity.formType)})).getOrElse((function(){return!1}))?f.createElement(y.a,{onClick:function(n){return e.setObjectRefsValue(t)}},e.props.i18n.t("Настроить значение")):e.props.condition.expression.tpe.value===E.FilterExpressionOneOf.$Type.value?f.createElement("div",{style:{flex:1,margin:"0px 5px",height:"8em",overflowY:"auto"}},Object(M.j)(e.props.dictionaries.list,t.family.value).map((function(n){return n.map((function(n){return f.createElement(at.a,{label:Object(M.g)(t.displayFields).flatMap((function(e){return Object(M.l)(n.entity.values[e.value]).map((function(e){return e.value.toString()}))})).getOrElse((function(){return e.props.i18n.t("Значение отсутствует")})),control:f.createElement(ot.a,{key:n.id.value,onClick:function(){return e.onObjRefsValueToggled(n.id.value,e.props.condition.value)},checked:Object(it.a)(e.props.condition.value.id,n.id)})})}))})).getOrElse((function(){return[]}))):f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{id:e.props.condition.expression.tpe.value,native:!0,value:Object(M.g)(e.props.condition.value.id).map((function(e){return e.value})).getOrElse((function(){return""})),onChange:function(t){return"string"==typeof t.target.value&&e.onObjRefsValueChanged(t.target.value)}},Object(M.j)(e.props.dictionaries.list,t.family.value).map((function(n){return n.map((function(n){return f.createElement("option",{key:n.id.value,value:n.id.value},Object(M.g)(t.displayFields).flatMap((function(e){return Object(M.j)(n.entity.values,e.value).map((function(e){return e.value.toString()}))})).getOrElse((function(){return e.props.i18n.t("Значение отсутствует")})))}))})).getOrElse((function(){return[]}))));case E.ValueTypeUserRefs.$Type:return e.props.condition.expression.tpe.value===E.FilterExpressionGt.$Type.value||e.props.condition.expression.tpe.value===E.FilterExpressionLt.$Type.value?f.createElement(re.a,{style:{flex:1,marginTop:15},value:e.props.condition.value.toString(),onChange:e.onNumberValueChanged}):e.props.condition.expression.tpe.value===E.FilterExpressionOneOf.$Type.value?f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{fullWidth:!0,multiple:!0,value:e.props.condition.value.refs.map((function(e){return e.id.value})),onChange:function(t){return e.onOneOfUserRefsValueChanged(t.target.value)},renderValue:function(t){return t instanceof Array?e.props.users.descriptionsList.filter((function(e){return t.filter((function(t){return e.id===t})).length>0})).map((function(e){return e.name})).join(", "):""}},e.props.users.descriptionsList.map((function(t){return f.createElement(lt.a,{value:t.id,key:t.id},t.avatarId.flatMap((function(e){return E.Id.createId(e.toString())})).flatMap((function(t){return e.props.token.map((function(n){return Object(At.b)(n,t,e.props.cdnAddress)}))})).matchWith((function(e){return f.createElement(Ft.a,null,f.createElement(Ot.a,{alt:t.name,src:e}))}),(function(){return f.createElement(Et.a,null,f.createElement(jt.a,null))})),f.createElement(ve.a,{primary:t.name}))})))):f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{fullWidth:!0,value:Object(M.g)(e.props.condition.value.refs).map((function(e){return e.id.value})).getOrElse((function(){return""})),onChange:function(t){return"string"==typeof t.target.value&&e.onUserRefsValueChanged(t.target.value)},SelectDisplayProps:{style:{display:"flex"}}},e.props.users.descriptionsList.map((function(t){return f.createElement(lt.a,{value:t.id,key:t.id},t.avatarId.flatMap((function(e){return E.Id.createId(e.toString())})).flatMap((function(t){return e.props.token.map((function(n){return Object(At.b)(n,t,e.props.cdnAddress)}))})).matchWith((function(e){return f.createElement(Ft.a,null,f.createElement(Ot.a,{alt:t.name,src:e}))}),(function(){return f.createElement(Et.a,null,f.createElement(jt.a,null))})),f.createElement(ve.a,{primary:t.name}))}))));case E.ValueTypeFileList.$Type:return f.createElement("div",null);case E.ValueTypeDate.$Type:return f.createElement("div",null,f.createElement(oe.a,{style:{marginTop:0}},e.getDateTypePicker(t)),f.createElement(oe.a,null,f.createElement(ie.a,{value:e.state.timeZoneOffset,onChange:e.onTimeZoneChange},E.TimeZones.map((function(e,t){return f.createElement(lt.a,{key:t,value:e.offset},e.name)})))));default:return f.createElement("div",{style:{marginTop:15}},e.props.i18n.t("Тип поля не поддерживается"))}})).getOrElse((function(){return f.createElement("div",null," ")}))}}]),t}(f.Component);_t=Nt([m.autobind,Mt("design:paramtypes",[Object])],_t);var qt=Object(h.connect)((function(e,t){return{i18n:e.i18n,fields:e.fields,forms:e.forms,dictionaries:e.dictionaries,users:e.users,token:e.auth.token,cdnAddress:e.config.cdnAddress}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.users===t.users},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.users===t.users}})(Object(de.a)(_t)),Bt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Ut=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getOperationName",value:function(e){switch(e.tpe.value){case E.FilterExpressionEq.$Type.value:return this.props.i18n.t("Равно");case E.FilterExpressionNotEq.$Type.value:return this.props.i18n.t("Не равно");case E.FilterExpressionGt.$Type.value:return this.props.i18n.t("Больше");case E.FilterExpressionLt.$Type.value:return this.props.i18n.t("Меньше");case E.FilterExpressionContains.$Type.value:return this.props.i18n.t("Включает");case E.FilterExpressionNotContains.$Type.value:return this.props.i18n.t("Не включает");case E.FilterExpressionPresent.$Type.value:return this.props.i18n.t("Заполнено");case E.FilterExpressionMissing.$Type.value:return this.props.i18n.t("Не заполнено");case E.FilterExpressionOneOf.$Type.value:return this.props.i18n.t("Одно из");case E.FilterExpressionRegExp.$Type.value:return this.props.i18n.t("Регулярное выражение");case E.FilterExpressionNearestPoints.$Type.value:return this.props.i18n.t("Находится в радиусе");case E.FilterExpressionCaseInsensitiveEq.$Type.value:return this.props.i18n.t("Равно (регистронезависимый)");case E.FilterExpressionCaseInsensitiveNotEq.$Type.value:return this.props.i18n.t("Не равно (регистронезависимый)");default:return"-"}}},{key:"onConditionValueChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:D(this.props.predicate,{value:{$set:e}})}))}},{key:"onConditionOperationChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:D(this.props.predicate,Object.assign({expression:{$set:e}},this.props.predicate.tpe.value===E.FilterCondition.$Type.value?{value:{$set:this.getPredicateValue(e)}}:{}))}))}},{key:"getPredicateValue",value:function(e){return e.tpe.value!==E.FilterExpressionGt.$Type.value&&e.tpe.value!==E.FilterExpressionLt.$Type.value||!this.formFieldType(this.props.fieldId).map((function(e){return e.tpe.value===E.ValueTypeObjectRefs.$Type.value||e.tpe.value===E.ValueTypeUserRefs.$Type.value})).getOrElse((function(){return!1}))?this.props.predicate.value:new E.ValueNumber(0)}},{key:"onConditionClick",value:function(e){e.target===Q.findDOMNode(this)&&this.props.dispatch(Object(J.j)({filterId:this.props.filterId,selectedCondition:this.props.predicate}))}},{key:"onConditionDelete",value:function(){this.props.dispatch(Object(J.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate}))}},{key:"onOperationSelected",value:function(e){Object(M.g)(E.FilterExpressions.filter((function(t){return t.tpe.value===e.target.value}))).foreach(this.onConditionOperationChanged)}},{key:"getFields",value:function(){var e=E.Role.getCurrentConfigId(this.props.user.userRole,this.props.currentForm.data,this.props.userCurrentConfigId).getOrNull(),t=this.props.currentForm.data.flatMap((function(t){return Object(M.g)(t.entity.dataListView.configs.filter((function(t){return t.id.id===e})))})).map((function(e){return e instanceof E.DataListConfigTable})).getOrElse((function(){return!1})),n=Object(M.j)(this.props.fields.list,this.props.formId.value).getOrElse((function(){return[]})).filter((function(e){return e.entity.valueType.tpe.value!==E.ValueTypeFormDataAttribute.$Type.value}));if(t){var r=this.props.currentForm.data.map((function(t){return Object(M.g)(t.entity.dataListView.configs.filter((function(t){return t.id.id===e})).map((function(e){return e.filterableFieldIds}))).getOrElse((function(){return[]}))})).getOrElse((function(){return[]})).map((function(e,t){return Object.assign(Object.assign({},e),{position:t})}));return n.filter((function(e){return Object(M.l)(r.find((function(t){return t.fieldId.value===e.id.value}))).getOrNull()})).map((function(e){return Object.assign(Object.assign({},e),{position:Object(M.l)(r.find((function(t){return t.fieldId.value===e.id.value}))).map((function(e){return e.position})).getOrElse((function(){return 0}))})})).sort((function(e,t){return e.position-t.position}))}return n}},{key:"getFieldFromCondition",value:function(){var e=this.props.predicate;switch(e.tpe.value){case E.FilterCondition.$Type.value:return Object(M.l)(e.field);case E.FilterSubstCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:return Object(M.l)(e.searchField);default:return new M.b}}},{key:"getFilterCondition",value:function(){var e=this;return this.getFieldFromCondition().flatMap((function(t){return e.formFieldType(Object(M.l)(t)).map((function(n){return new E.FilterCondition(t,e.props.predicate.expression,n.getDefaultValue())}))}))}},{key:"getTemplateCondition",value:function(){var e=this;return this.getFieldFromCondition().map((function(t){return new E.FilterTemplateCondition(e.props.predicate.expression,t,"")}))}},{key:"getSubstCondition",value:function(){var e=this;return this.getFieldFromCondition().flatMap((function(t){return e.formFieldType(Object(M.l)(t)).flatMap((function(n){return Object(M.l)(e.props.sourceFormId).flatMap((function(t){return Object(M.g)(Object(F.f)(e.props.fields,t).getOrElse((function(){return[]})).filter((function(e){return e.entity.valueType.tpe.value===n.tpe.value})))})).map((function(n){return new E.FilterSubstCondition(e.props.predicate.expression,t,n.id)}))}))}))}},{key:"getCondition",value:function(e){switch(e){case E.FilterCondition.$Type.value:return this.getFilterCondition();case E.FilterSubstCondition.$Type.value:return this.getSubstCondition();case E.FilterTemplateCondition.$Type.value:return this.getTemplateCondition();default:return new M.b}}},{key:"onConditionTypeChange",value:function(e){var t=this;this.props.predicate.tpe.value!==e.target.value&&this.getCondition(e.target.value).foreach((function(e){t.props.dispatch(Object(J.i)({filterId:t.props.filterId,parentGroups:t.props.parentGroups,predicate:t.props.predicate,newPredicate:e}))}))}},{key:"onGeoPointDistanceChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:D(this.props.predicate,{expression:{distance:{$set:e.target.value}}})}))}},{key:"renderSubstValueEditor",value:function(){return this.props.sourceFormId&&f.createElement(ce,{sourceFormId:this.props.sourceFormId,condition:this.props.predicate,filterId:this.props.filterId,parentGroups:this.props.parentGroups})}},{key:"renderTemplateValueEditor",value:function(){return this.props.sourceFormId&&f.createElement(nt,{sourceFormId:this.props.sourceFormId,condition:this.props.predicate,filterId:this.props.filterId,parentGroups:this.props.parentGroups})}},{key:"renderFieldValueEditor",value:function(){return f.createElement(qt,{condition:this.props.predicate,formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups})}},{key:"renderValueEditor",value:function(){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return this.renderFieldValueEditor();case E.FilterSubstCondition.$Type.value:return this.renderSubstValueEditor();case E.FilterTemplateCondition.$Type.value:return this.renderTemplateValueEditor();default:return this.renderFieldValueEditor()}}},{key:"render",value:function(){var e=this;return this.props.filterExpressions&&0===this.props.filterExpressions.length?f.createElement(X.a,{style:{display:"flex",padding:"10px 10px 10px 25px",flexWrap:"wrap"},onClick:this.onConditionClick},this.props.children,f.createElement(v.a,{onClick:this.onConditionDelete},f.createElement(le.a,null))):f.createElement(X.a,{style:{display:"flex",padding:"10px 10px 10px 25px",flexWrap:"nowrap"},onClick:this.onConditionClick},this.props.children,f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{native:!0,value:this.props.predicate.expression.tpe.value,onChange:this.onOperationSelected},E.FilterExpressions.filter((function(t){return!e.props.displayFieldElements||t.tpe!==E.FilterExpressionNearestPoints.$Type})).filter((function(t){return e.formFieldType(e.props.fieldId).map((function(e){switch(e.tpe.value){case E.ValueTypeValuesList.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionContains.$Type||t.tpe===E.FilterExpressionNotContains.$Type;case E.ValueTypeBool.$Type.value:return t.tpe===E.FilterExpressionEq.$Type||t.tpe===E.FilterExpressionNotEq.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionMissing.$Type;case E.ValueTypeFileList.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type;case E.ValueTypeGeoPoint.$Type.value:return t.tpe===E.FilterExpressionNearestPoints.$Type;case E.ValueTypeObjectRefs.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionNotContains.$Type||t.tpe===E.FilterExpressionContains.$Type||t.tpe===E.FilterExpressionOneOf.$Type||t.tpe===E.FilterExpressionGt.$Type||t.tpe===E.FilterExpressionLt.$Type||t.tpe===E.FilterExpressionEq.$Type||t.tpe===E.FilterExpressionNotEq.$Type;case E.ValueTypeUserRefs.$Type.value:return t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type||t.tpe===E.FilterExpressionContains.$Type||t.tpe===E.FilterExpressionNotContains.$Type||t.tpe===E.FilterExpressionOneOf.$Type||t.tpe===E.FilterExpressionGt.$Type||t.tpe===E.FilterExpressionLt.$Type||t.tpe===E.FilterExpressionEq.$Type||t.tpe===E.FilterExpressionNotEq.$Type;case E.ValueTypeDate.$Type.value:return t.tpe===E.FilterExpressionGt.$Type||t.tpe===E.FilterExpressionLt.$Type||t.tpe===E.FilterExpressionMissing.$Type||t.tpe===E.FilterExpressionPresent.$Type;case E.ValueTypeStr.$Type.value:return t.tpe!==E.FilterExpressionGt.$Type&&t.tpe!==E.FilterExpressionLt.$Type&&t.tpe!==E.FilterExpressionOneOf.$Type&&t.tpe!==E.FilterExpressionNearestPoints.$Type;default:return t.tpe!==E.FilterExpressionOneOf.$Type}})).getOrElse((function(){return!0}))})).map((function(t){return f.createElement("option",{value:t.tpe.value,key:t.tpe.value},e.getOperationName(t))})))),this.props.predicate.expression instanceof E.FilterExpressionNearestPoints&&f.createElement(re.a,{type:"number",style:{flex:1},value:this.props.predicate.expression.distance,label:this.props.i18n.t("Расстояние"),onChange:this.onGeoPointDistanceChanged}),this.props.sourceFormId&&f.createElement(oe.a,null,f.createElement(ae.a,null,this.props.i18n.t("Источник значения")),f.createElement(ie.a,{native:!0,value:this.props.predicate.tpe.value,onChange:this.onConditionTypeChange},f.createElement("option",{value:E.FilterCondition.$Type.value},this.props.i18n.t("Статический")),f.createElement("option",{value:E.FilterSubstCondition.$Type.value},this.props.i18n.t("Источник события, поле")),this.formFieldType(this.props.fieldId).map((function(e){return e.tpe.value===E.ValueTypeStr.$Type.value})).getOrElse((function(){return!1}))&&f.createElement("option",{value:E.FilterTemplateCondition.$Type.value},this.props.i18n.t("Источник события, шаблон")))),this.props.predicate.expression.tpe!==E.FilterExpressionMissing.$Type&&this.props.predicate.expression.tpe!==E.FilterExpressionPresent.$Type&&this.renderValueEditor(),f.createElement(v.a,{onClick:this.onConditionDelete},f.createElement(le.a,null)))}},{key:"formFieldType",value:function(e){return Object(M.j)(this.props.fields.list,this.props.formId.value).flatMap((function(t){return Object(M.g)(t.filter((function(t){return t.id.value===e.map((function(e){return e.value})).getOrNull()}))).map((function(e){return e.entity.valueType}))}))}}]),t}(f.Component);Ut=Bt([m.autobind],Ut);var Wt=Object(h.connect)((function(e){return{fields:e.fields,dictionaries:e.dictionaries,i18n:e.i18n,currentForm:e.currentForm,user:e.user,userCurrentConfigId:e.formRecordsTable.currentConfigId}}))(Ut),Ht=n(103),zt=n(535),Zt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Jt=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getExpressionFromField",value:function(e,t){return this.getFormFieldType(e).map((function(e){switch(e.tpe){case E.ValueTypeFileList.$Type:return t.tpe!==E.FilterExpressionMissing.$Type||t.tpe!==E.FilterExpressionPresent.$Type?new E.FilterExpressionPresent:t;case E.ValueTypeGeoPoint.$Type:return new E.FilterExpressionNearestPoints(0);case E.ValueTypeDate.$Type:return new E.FilterExpressionGt;case E.ValueTypeValuesList.$Type:return new E.FilterExpressionPresent;default:return t}})).getOrElse((function(){throw"FormField has not been found"}))}},{key:"updateCondition",value:function(e,t){var n=this;return new E.FilterCondition(e,this.getExpressionFromField(e,t),this.getFormFieldType(e).map((function(e){switch(e.tpe){case E.ValueTypeStr.$Type:return new E.ValueStr("");case E.ValueTypeBool.$Type:return new E.ValueBool(!1);case E.ValueTypeNumber.$Type:return new E.ValueNumber(0);case E.ValueTypeGeoPoint.$Type:return new E.ValueGeoPoint(45.5,45.5);case E.ValueTypeValuesList.$Type:return Object(M.g)(e.values).map((function(e){return new E.ValueList([e])})).getOrElse((function(){return new E.ValueList([])}));case E.ValueTypeObjectRefs.$Type:return n.props.predicate.tpe.value===E.FilterExpressionGt.$Type.value||n.props.predicate.tpe.value===E.FilterExpressionLt.$Type.value?new E.ValueNumber(0):new E.ValueObjectRefs(Object(M.g)(Object(Ht.b)(n.props.dictionaries,e.family).getOrElse((function(){return[]}))).map((function(e){return[e.id]})).getOrElse((function(){return[]})));case E.ValueTypeUserRefs.$Type:return new E.ValueUserRefs([]);case E.ValueTypeFileList.$Type:return new E.ValueFileList([]);case E.ValueTypeDate.$Type:return new E.ValueDate((new Date).getTime());default:throw"Unknown value type: "+e.tpe.value}})).getOrElse((function(){throw"FormField has not been found"})),this.getFormFieldType(e).map((function(e){return e.tpe.value})))}},{key:"getFormFieldType",value:function(e){return Object(F.f)(this.props.fields,this.props.formId).flatMap((function(t){return Object(M.g)(t.filter((function(t){return t.id.value===e.value}))).map((function(e){return e.entity.valueType}))}))}},{key:"updateSubstCondition",value:function(e,t){return D(this.props.predicate,{searchField:{$set:e},expression:{$set:this.getExpressionFromField(e,t)}})}},{key:"updateTemplateCondition",value:function(e,t){return D(this.props.predicate,{searchField:{$set:e},expression:{$set:this.getExpressionFromField(e,t)}})}},{key:"updatePredicate",value:function(e){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return this.updateCondition(e,this.props.predicate.expression);case E.FilterSubstCondition.$Type.value:return this.updateSubstCondition(e,this.props.predicate.expression);case E.FilterTemplateCondition.$Type.value:return this.updateTemplateCondition(e,this.props.predicate.expression);default:return this.updateCondition(e,new E.FilterExpressionPresent)}}},{key:"onConditionFieldChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:this.updatePredicate(e)}))}},{key:"onNotifyTemplateChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:new E.NotifyTemplateId(e,!1,new M.b)}))}},{key:"onByFieldSourceChanged",value:function(e){var t=this;return Object(M.l)(e).filter((function(e){return 0===e.indexOf("ByField")})).flatMap((function(t){return Object(M.l)(e.substring(e.indexOf("-")+1))})).flatMap((function(e){return E.Id.createId(e)})).matchWith((function(e){return t.onConditionFieldChanged(e),new M.b}),(function(){return Object(M.l)(e)}))}},{key:"onByTemplateSourceChanged",value:function(e){var t=this;return Object(M.l)(e).filter((function(e){return 0===e.indexOf("ByNotifyTemplate")})).flatMap((function(e){return Object(M.g)(t.props.notifyTemplatesDescriptionsList).map((function(e){return e.id}))})).flatMap((function(e){return E.Id.createId(e)})).matchWith((function(e){return t.onNotifyTemplateChanged(e),new M.b}),(function(){return Object(M.l)(e)}))}},{key:"onValueSourceSelected",value:function(e){var t=this;Object(M.l)(e.target.value).flatMap((function(e){return t.onByFieldSourceChanged(e)})).flatMap((function(e){return t.onByTemplateSourceChanged(e)}))}},{key:"getFields",value:function(){var e=this,t=E.Role.getCurrentConfigId(this.props.user.userRole,this.props.form,this.props.userCurrentConfigId).getOrNull(),n=this.props.form.flatMap((function(e){return Object(M.g)(e.entity.dataListView.configs.filter((function(e){return e.id.id===t})))})).map((function(e){return e instanceof E.DataListConfigTable})).getOrElse((function(){return!1})),r=Object(F.f)(this.props.fields,this.props.formId).getOrElse((function(){return[]})).filter((function(e){return e.entity.valueType.tpe.value!==E.ValueTypeFormDataAttribute.$Type.value}));if(n){var i=this.props.form.map((function(e){return Object(M.g)(e.entity.dataListView.configs.filter((function(e){return e.id.id===t})).map((function(e){return e.filterableFieldIds}))).getOrElse((function(){return[]}))})).getOrElse((function(){return[]})).map((function(e,t){return Object.assign(Object.assign({},e),{position:t})}));return r.filter((function(t){return!e.props.displayFieldElements||e.props.displayFieldElements.filter((function(e){return e.dataOutput.map((function(e){return e.formField.value})).getOrNull()===t.id.value})).length>0})).filter((function(e){return Object(M.l)(i.find((function(t){return t.fieldId.value===e.id.value}))).getOrNull()})).map((function(e){return Object.assign(Object.assign({},e),{position:Object(M.l)(i.find((function(t){return t.fieldId.value===e.id.value}))).map((function(e){return e.position})).getOrElse((function(){return 0}))})})).sort((function(e,t){return e.position-t.position}))}return r}},{key:"getSelectValue",value:function(){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return"ByField-"+this.props.predicate.field.value;case E.FilterSubstCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:return"ByField-"+this.props.predicate.searchField.value;case E.NotifyTemplateId.$Type.value:return"ByNotifyTemplate";default:throw"unknown predicate type"}}},{key:"render",value:function(){var e=this;return this.props.filterExpressions&&0===this.props.filterExpressions.length?f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{native:!0,value:this.getSelectValue(),onChange:this.onValueSourceSelected},this.getFields().map((function(e){return f.createElement("option",{key:e.id.value,value:e.id.value},e.entity.caption)})))):f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{native:!0,value:this.getSelectValue(),onChange:this.onValueSourceSelected},f.createElement("optgroup",{label:this.props.i18n.t("По полю")},this.getFields().map((function(e){return f.createElement("option",{key:e.id.value,value:"ByField-"+e.id.value},e.entity.caption)}))),f.createElement("optgroup",{label:this.props.i18n.t("Специальный")},(new Array).concat(Object(M.l)(this.props.notifyTemplatesDescriptionsList).filter((function(e){return e.length>0})).matchWith((function(t){return[f.createElement("option",{key:"ByNotifyTemplate",value:"ByNotifyTemplate"},e.props.i18n.t("по письму"))]}),(function(){return new Array}))))))}}]),t}(f.Component);Jt=Zt([m.autobind],Jt);var Kt=Object(h.connect)((function(e,t){return{i18n:e.i18n,form:Object(je.e)(e.forms,t.formId),user:e.user,fields:e.fields,userCurrentConfigId:e.formRecordsTable.currentConfigId,notifyTemplatesDescriptionsList:e.notifyTemplates.descriptionsList.filter((function(n){return e.user.userRole.map((function(e){return!e.entity.isNotifyTemplateRestricted(t.formId,new E.Id(n.id))})).getOrElse((function(){return!1}))})),dictionaries:e.dictionaries}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplates===t.notifyTemplates},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplatesDescriptionsList===t.notifyTemplatesDescriptionsList}})(Object(Y.a)((function(e){e.isTokenChecked&&e.dispatch(Object(zt.a)(e.formId,new E.ActiveStatusAll))}))(Jt)),Yt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Qt=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"getFieldId",value:function(){switch(this.props.predicate.tpe.value){case E.FilterCondition.$Type.value:return Object(M.l)(this.props.predicate.field);case E.FilterSubstCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:return Object(M.l)(this.props.predicate.searchField);default:return new M.b}}},{key:"render",value:function(){return f.createElement(Wt,{formId:this.props.formId,sourceFormId:this.props.sourceFormId,fieldId:this.getFieldId(),filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements,filterExpressions:this.props.filterExpressions},f.createElement(Kt,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements}))}}]),t}(f.Component);Qt=Yt([m.autobind],Qt);var Xt,en=Object(h.connect)((function(e){return{i18n:e.i18n}}))(Qt),tn=n(417),nn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},rn=function(e,t){return new E.NotifyTemplateId(e,!1,Object(M.l)(new E.EmailFilterCondition(t,new E.EmailFilterOperatorEq)))},on=(Xt={},$()(Xt,"isSent",(function(e){return new E.NotifyTemplateId(e,!1,new M.b)})),$()(Xt,"isNotSent",(function(e){return new E.NotifyTemplateId(e,!0,new M.b)})),$()(Xt,E.EmailOpenedStateOpened.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionOpenedStatus(new E.EmailOpenedStateOpened))})),$()(Xt,E.EmailOpenedStateNotOpened.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionOpenedStatus(new E.EmailOpenedStateNotOpened))})),$()(Xt,E.EmailStatusInbox.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionStatus(new E.EmailStatusInbox))})),$()(Xt,E.EmailStatusSent.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionStatus(new E.EmailStatusSent))})),$()(Xt,E.EmailStatusDraft.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionStatus(new E.EmailStatusDraft))})),$()(Xt,E.EmailStatusRejected.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionStatus(new E.EmailStatusRejected))})),$()(Xt,E.EmailStatusDelivered.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionStatus(new E.EmailStatusDelivered))})),$()(Xt,E.EmailStatusBounce.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionStatus(new E.EmailStatusBounce))})),$()(Xt,E.EmailStatusComplaint.$Type.value,(function(e){return rn(e,new E.EmailFilterExpressionStatus(new E.EmailStatusComplaint))})),Xt),an=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onNotifyTemplateChanged",value:function(e){this.props.dispatch(Object(J.i)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,newPredicate:D(this.props.predicate,{tplId:{$set:E.Id.createId(e.target.value).getOrElse((function(){throw"wrong notify template id"}))}})}))}},{key:"onDelete",value:function(){this.props.dispatch(Object(J.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate}))}},{key:"getOperationValue",value:function(){return!this.props.predicate.idNegation&&this.props.predicate.emailFilter.isEmpty()?"isSent":this.props.predicate.idNegation&&this.props.predicate.emailFilter.isEmpty()?"isNotSent":this.props.predicate.emailFilter.filter((function(e){return e instanceof E.EmailFilterCondition})).filter((function(e){return e.expr instanceof E.EmailFilterExpressionOpenedStatus})).map((function(e){return e.expr})).map((function(e){return e.state.tpe.value})).getOrUndefined()||this.props.predicate.emailFilter.filter((function(e){return e instanceof E.EmailFilterCondition})).filter((function(e){return e.expr instanceof E.EmailFilterExpressionStatus})).map((function(e){return e.expr})).map((function(e){return e.value.tpe.value})).getOrUndefined()}},{key:"onOperationChange",value:function(e){var t=this;Object(ke.b)(e.target.value)(on).map((function(e){return e(t.props.predicate.tplId)})).foreach((function(e){t.props.dispatch(Object(J.i)({filterId:t.props.filterId,parentGroups:t.props.parentGroups,predicate:t.props.predicate,newPredicate:e}))}))}},{key:"renderOperationSelect",value:function(){return f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{native:!0,value:this.getOperationValue(),onChange:this.onOperationChange},f.createElement("optgroup",{label:this.props.i18n.t("по статусу отправки")},f.createElement("option",{value:"isSent"},this.props.i18n.t("Отправлено")),f.createElement("option",{value:"isNotSent"},this.props.i18n.t("Не отправлено"))),f.createElement("optgroup",{label:this.props.i18n.t("по статусу доставки")},f.createElement("option",{value:E.EmailStatusInbox.$Type.value},Object(tn.b)(E.EmailStatusInbox.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusSent.$Type.value},Object(tn.b)(E.EmailStatusSent.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusDraft.$Type.value},Object(tn.b)(E.EmailStatusDraft.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusRejected.$Type.value},Object(tn.b)(E.EmailStatusRejected.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusDelivered.$Type.value},Object(tn.b)(E.EmailStatusDelivered.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusBounce.$Type.value},Object(tn.b)(E.EmailStatusBounce.$Type,this.props.i18n.t)),",",f.createElement("option",{value:E.EmailStatusComplaint.$Type.value},Object(tn.b)(E.EmailStatusComplaint.$Type,this.props.i18n.t))),f.createElement("optgroup",{label:this.props.i18n.t("по статусу открытия")},f.createElement("option",{value:E.EmailOpenedStateOpened.$Type.value},this.props.i18n.t("Открыто")),f.createElement("option",{value:E.EmailOpenedStateNotOpened.$Type.value},this.props.i18n.t("Не открыто")))))}},{key:"renderNotifyTemplateSelect",value:function(){return f.createElement(oe.a,{style:{flex:1}},f.createElement(ie.a,{native:!0,value:this.props.predicate.tplId.value,onChange:this.onNotifyTemplateChanged},this.props.notifyTemplatesDescriptionsList.map((function(e){return f.createElement("option",{key:e.id,value:e.id},e.name)}))))}},{key:"render",value:function(){return f.createElement("div",{style:{flex:1,display:"flex",alignItems:"center"}},f.createElement(Kt,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.predicate,displayFieldElements:this.props.displayFieldElements}),this.renderOperationSelect(),this.renderNotifyTemplateSelect(),f.createElement(v.a,{onClick:this.onDelete},f.createElement(le.a,null)))}}]),t}(f.Component);an=nn([m.autobind],an);var sn,ln=Object(h.connect)((function(e,t){return{i18n:e.i18n,notifyTemplatesDescriptionsList:e.notifyTemplates.descriptionsList.filter((function(n){return e.user.userRole.map((function(e){return!e.entity.isNotifyTemplateRestricted(t.formId,new E.Id(n.id))})).getOrElse((function(){return!1}))}))}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplates===t.notifyTemplates},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&e.notifyTemplatesDescriptionsList===t.notifyTemplatesDescriptionsList}})(an),un=n(43),pn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},cn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},dn=sn=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={menuAnchorElement:new M.b},n}return p()(t,e),a()(t,[{key:"onGroupAdd",value:function(){this.props.dispatch(Object(J.n)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,group:this.props.group,predicate:new E.FilterGroupCondition([],new E.FilterPredicateAnd)}))}},{key:"onGroupDelete",value:function(){this.props.dispatch(Object(J.o)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,predicate:this.props.group}))}},{key:"getInitialValue",value:function(e){switch(e.valueType.tpe.value){case E.ValueTypeStr.$Type.value:return new E.ValueStr("");case E.ValueTypeNumber.$Type.value:return new E.ValueNumber(0);case E.ValueTypeValuesList.$Type.value:return new E.ValueList([Object(M.i)(e.valueType.values,0).getOrElse((function(){return new E.ValueStr("")}))]);case E.ValueTypeFileList.$Type.value:return new E.ValueList([]);case E.ValueTypeObjectRefs.$Type.value:return new E.ValueObjectRefs([]);default:throw"Unknown value type"}}},{key:"getInitialExpression",value:function(e){switch(e.valueType.tpe.value){case E.ValueTypeValuesList.$Type.value:return new E.FilterExpressionContains;default:return new E.FilterExpressionEq}}},{key:"valueTypeFilter",value:function(e){return e.valueType.tpe.value===E.ValueTypeStr.$Type.value||e.valueType.tpe.value===E.ValueTypeNumber.$Type.value||e.valueType.tpe.value===E.ValueTypeValuesList.$Type.value||e.valueType.tpe.value===E.ValueTypeFileList.$Type.value||e.valueType.tpe.value===E.ValueTypeObjectRefs.$Type.value}},{key:"addConditionElement",value:function(){var e=this;Object(F.f)(this.props.fields,this.props.formId).foreach((function(t){return Object(M.g)(t.filter((function(t){return e.valueTypeFilter(t.entity)}))).map((function(t){e.props.dispatch(Object(J.n)({filterId:e.props.filterId,parentGroups:e.props.parentGroups,group:e.props.group,predicate:new E.FilterCondition(t.id,e.getInitialExpression(t.entity),e.getInitialValue(t.entity),new M.c(t.entity.valueType.tpe.value.replace("forms.ValueType.","forms.package$ValueType$")))}))})).getOrElse((function(){e.props.dispatch(Object(un.f)(e.props.i18n.t("Отсутствуют доступные для фильтрации поля")))}))}))}},{key:"onConditionAdd",value:function(){this.addConditionElement()}},{key:"onGroupClick",value:function(e){0!==this.props.parentGroups.length&&e.target===Q.findDOMNode(this)&&this.props.dispatch(Object(J.m)({filterId:this.props.filterId,selectedGroup:this.props.group}))}},{key:"onOperandAndSelect",value:function(){this.props.dispatch(Object(J.l)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,group:this.props.group,expression:new E.FilterPredicateAnd}))}},{key:"onOperandOrSelect",value:function(){this.props.dispatch(Object(J.l)({filterId:this.props.filterId,parentGroups:this.props.parentGroups,group:this.props.group,expression:new E.FilterPredicateOr}))}},{key:"renderPredicate",value:function(e){switch(e.tpe.value){case E.FilterGroupCondition.$Type.value:return f.createElement(fn,{formId:this.props.formId,sourceFormId:this.props.sourceFormId,filterId:this.props.filterId,parentGroups:[].concat(V()(this.props.parentGroups),[this.props.group]),group:e,selectedGroup:this.props.selectedGroup,selectedCondition:this.props.selectedCondition,displayFieldElements:this.props.displayFieldElements,filterExpressions:this.props.filterExpressions});case E.FilterCondition.$Type.value:case E.FilterTemplateCondition.$Type.value:case E.FilterSubstCondition.$Type.value:return f.createElement(en,{formId:this.props.formId,sourceFormId:this.props.sourceFormId,filterId:this.props.filterId,parentGroups:[].concat(V()(this.props.parentGroups),[this.props.group]),predicate:e,selectedCondition:this.props.selectedCondition,displayFieldElements:this.props.displayFieldElements,filterExpressions:this.props.filterExpressions});case E.NotifyTemplateId.$Type.value:return f.createElement(ln,{formId:this.props.formId,filterId:this.props.filterId,parentGroups:[].concat(V()(this.props.parentGroups),[this.props.group]),predicate:e,displayFieldElements:this.props.displayFieldElements});default:return f.createElement("div",null,this.props.i18n.t("Неизвестный тип предиката"))}}},{key:"onMenuClosed",value:function(){this.setState({menuAnchorElement:new M.b})}},{key:"onMenuRequested",value:function(e){this.setState({menuAnchorElement:Object(M.l)(Object(Q.findDOMNode)(e.currentTarget))})}},{key:"render",value:function(){var e=this,t=0===this.props.parentGroups.length?{boxShadow:"none",paddingTop:"3px"}:{padding:"10px 10px 10px 40px"};return f.createElement(X.a,{style:t,onClick:this.onGroupClick},this.props.group.conditions.map((function(t,n,r){return f.createElement("div",{key:n,style:{position:"relative",marginBottom:"10px"}},e.renderPredicate(t),r.length>1&&n!==r.length-1&&f.createElement(X.a,{square:!1,style:{position:"absolute",left:"-28px",bottom:"-30px",width:"56px",height:"56px",zIndex:1,textAlign:"center",lineHeight:"50px",backgroundColor:sn.getOperandColor(e.props.group.predicate)}},f.createElement(v.a,{onClick:e.onMenuRequested},f.createElement(ne.a,{style:{color:"#fff"}},sn.getOperandCaption(e.props.group.predicate))),f.createElement(te.a,{anchorEl:e.state.menuAnchorElement.getOrUndefined(),open:e.state.menuAnchorElement.nonEmpty(),onClose:e.onMenuClosed},f.createElement(ee.a,{onClick:e.onOperandAndSelect},e.props.i18n.t("&")),f.createElement(ee.a,{onClick:e.onOperandOrSelect},e.props.i18n.t("|")))))})),f.createElement("div",{style:{position:"relative"}},f.createElement(y.a,{variant:"contained",onClick:this.onGroupAdd},this.props.i18n.t("Добавить группу")),f.createElement(y.a,{variant:"contained",onClick:this.onConditionAdd,style:{marginLeft:"10px"}},this.props.i18n.t("Добавить условие")),0!==this.props.parentGroups.length&&f.createElement(y.a,{variant:"contained",onClick:this.onGroupDelete,style:{position:"absolute",right:0}},this.props.i18n.t("Удалить"))))}}],[{key:"getOperandCaption",value:function(e){switch(e.tpe){case E.FilterPredicateAnd.$Type:return"&";case E.FilterPredicateOr.$Type:return"|"}}},{key:"getOperandColor",value:function(e){switch(e.tpe){case E.FilterPredicateAnd.$Type:return"#4CAF50";case E.FilterPredicateOr.$Type:return"#2196F3"}}}]),t}(f.Component);dn=sn=pn([m.autobind,cn("design:paramtypes",[Object])],dn);var fn=Object(h.connect)((function(e){return{i18n:e.i18n,fields:e.fields}}))(dn),hn=fn,mn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},yn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFilterConfigRequested",value:function(){this.props.dispatch(Object(J.k)({filterId:this.props.filterId,filter:new E.FilterGroupCondition([],new E.FilterPredicateAnd)}))}},{key:"componentDidMount",value:function(){var e=this;this.props.initFilter&&this.props.dispatch(Object(J.k)({filterId:this.props.filterId,filter:new E.FilterGroupCondition([],new E.FilterPredicateAnd)})),Object(M.l)(this.props.initialValue).getOrElse((function(){return Object(M.l)(e.props.value).getOrElse((function(){return Object(M.l)(new E.FilterGroupCondition([],new E.FilterPredicateAnd))}))})).map((function(t){e.props.dispatch(Object(J.k)({filterId:e.props.filterId,filter:t}))}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;Object(M.l)(e.initialValue).foreach((function(e){Object(Z.a)(t.props.initialValue,e)||e.foreach((function(e){return t.props.dispatch(Object(J.k)({filterId:t.props.filterId,filter:e}))}))})),Object(M.l)(this.props.onChange).foreach((function(n){var r=Object(M.j)(e.filtersForm.filter,e.filterId.value);Object(Z.a)(Object(M.j)(t.props.filtersForm.filter,t.props.filterId.value),r)||n(r)})),this.props.value!==e.value&&Object(M.l)(e.value).foreach((function(n){Object(Z.a)(Object(M.j)(t.props.filtersForm.filter,t.props.filterId.value),n)||n.foreach((function(n){return t.props.dispatch(Object(J.k)({filterId:e.filterId,filter:n}))}))}))}},{key:"render",value:function(){var e=this;return f.createElement("div",null,Object(M.j)(this.props.filtersForm.filter,this.props.filterId.value).map((function(t){return f.createElement(hn,{formId:e.props.formId,sourceFormId:e.props.sourceFormId,filterId:e.props.filterId,parentGroups:[],group:t,selectedGroup:Object(T.d)(e.props.filtersForm,e.props.filterId),selectedCondition:Object(T.c)(e.props.filtersForm,e.props.filterId),displayFieldElements:e.props.displayFieldElements,filterExpressions:e.props.filterExpressions})})).getOrElse((function(){return e.props.initFilter?f.createElement("div",null):f.createElement(hn,{formId:e.props.formId,sourceFormId:e.props.sourceFormId,filterId:e.props.filterId,parentGroups:[],group:new E.FilterGroupCondition([],new E.FilterPredicateAnd),selectedGroup:Object(T.d)(e.props.filtersForm,e.props.filterId),selectedCondition:Object(T.c)(e.props.filtersForm,e.props.filterId),displayFieldElements:e.props.displayFieldElements,filterExpressions:e.props.filterExpressions})})))}}]),t}(f.Component);yn=mn([m.autobind],yn);var vn=Object(h.connect)((function(e){return{dictionaries:e.dictionaries,filtersForm:e.filtersForm,i18n:e.i18n}}))(Object(Y.a)((function(e){e.isTokenChecked&&(e.dictionaries.dictionariesFetchedForms[e.formId.value]||e.dictionaries.listFetching||e.dispatch(Object(K.a)(e.formId)))}),(function(){}),(function(e,t){e.isTokenChecked&&(Object(M.j)(e.dictionaries.dictionariesFetchedForms,e.formId.value).getOrElse((function(){return!0}))||e.dictionaries.listFetching||e.dispatch(Object(K.a)(e.formId)))}))(yn)),gn=n(37),bn=n(101),On=n(56),En=n(1902),Fn=n(2380),Tn=n.n(Fn),jn=n(269),Cn=n.n(jn),kn=n(102),Rn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},In=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){var e=this.props.fields.name;return f.createElement("form",null,f.createElement(re.a,{fullWidth:!0,autoFocus:!0,style:{marginBottom:"15px"},value:e.value,onChange:e.onChange,label:this.props.i18n.t("Название"),error:e.touched&&e.error,helperText:e.touched&&Object(M.l)(e.error).map((function(e){return e})).getOrNull()}),f.createElement(vn,{formId:this.props.formId,filterId:this.props.fields.filterId.value,initialValue:this.props.fields.filter.value?Object(M.l)(this.props.fields.filter.value):new M.b}))}}]),t}(f.Component);In=Rn([m.autobind],In);var wn=Object(h.connect)((function(e){return{i18n:e.i18n}}),(function(e){return{}}),(function(e,t,n){return Object.assign({},e,n)}),{withRef:!0})(Object(kn.reduxForm)({form:"newFilterForm",fields:["name","filterId","filter"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение!")),n}})(In)),Sn=n(24),$n=n(739),Pn=n(564),Vn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},xn=function(e){function t(){i()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.handleKeyDown=function(t){"Insert"===t.key&&e.onCreateRequest()},e}return p()(t,e),a()(t,[{key:"handleSubmit",value:function(e,t,n){var r=this;return new Promise((function(i,o){return e.then((function(e){i(e),r.props.dispatch(Object(un.f)(r.props.i18n.t(("create"===t?"Создание":"Сохранение")+" успешно завершено"))),r.props.dispatch(Object(K.b)()),r.handleClose(n)})).catch((function(e){o(e),r.props.dispatch(Object(un.f)(r.props.i18n.t(("create"===t?"Создание":"Сохранение")+" завершилось ошибкой")))}))}))}},{key:"openEditForm",value:function(e,t,n){var r=this,i=void 0,o=this.props.openDialog(e,f.createElement(wn,{ref:function(e){return i=Object(Sn.i)(e).flatMap((function(e){return Object(Sn.i)(e.wrappedInstance)}))},formId:this.props.formId,initialValues:n,onSubmit:t}),[f.createElement(y.a,{onClick:function(){return r.handleClose(o)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),f.createElement($n.a,{variant:"contained",color:"primary",onClick:function(){return i.map((function(e){return e.submit()}))},formName:"newFilterForm"},this.props.i18n.t("Сохранить"))]);return o}},{key:"handleClose",value:function(e){this.props.handleDialogClose(e)}},{key:"onCreateRequest",value:function(){var e=this,t=this.openEditForm(this.props.i18n.t("Новый фильтр"),(function(n){return e.handleSubmit(Object(T.b)(e.props.filtersForm,n.filterId).flatMap((function(t){return Object(je.e)(e.props.forms,e.props.formId).map((function(e){return Object(K.f)(e.id,[].concat(V()(e.entity.filters),[new E.FilterContainer(n.name,t)]))}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"create",t)}),{filterId:new E.Id(gn.v4())})}},{key:"onEditRequest",value:function(e,t){var n=this,r=this.openEditForm(this.props.i18n.t("Редактировать фильтр"),(function(e){return n.handleSubmit(Object(T.b)(n.props.filtersForm,e.filterId).flatMap((function(r){return Object(je.e)(n.props.forms,n.props.formId).map((function(n){return Object(K.f)(n.id,[].concat(V()(n.entity.filters.slice(0,t)),[new E.FilterContainer(e.name,r)],V()(n.entity.filters.slice(t+1))))}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"update",r)}),{name:e.name,filterId:new E.Id(gn.v4()),filter:e.filter})}},{key:"onUserFilterCreateRequest",value:function(){var e=this,t=this.openEditForm(this.props.i18n.t("Новый фильтр"),(function(n){return e.handleSubmit(Object(T.b)(e.props.filtersForm,n.filterId).map((function(t){return e.props.dispatch(Object(Pn.d)({filter:new E.FilterContainer(n.name,t)})),new Promise((function(e,t){return e()}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"create",t)}),{filterId:new E.Id(gn.v4())})}},{key:"onUserFilterEditRequest",value:function(e,t){var n=this,r=this.openEditForm(this.props.i18n.t("Редактировать фильтр"),(function(e){return n.handleSubmit(Object(T.b)(n.props.filtersForm,e.filterId).map((function(r){return n.props.dispatch(Object(Pn.f)({idx:t,filter:new E.FilterContainer(e.name,r)})),new Promise((function(e,t){return e()}))})).getOrElse((function(){return new Promise((function(e,t){return t()}))})),"update",r)}),{name:e.name,filterId:new E.Id(gn.v4()),filter:e.filter})}},{key:"onDelete",value:function(e){var t=this;Object(je.e)(this.props.forms,this.props.formId).map((function(n){return Object(K.f)(n.id,[].concat(V()(n.entity.filters.slice(0,e)),V()(n.entity.filters.slice(e+1)))).then((function(e){return t.props.dispatch(Object(K.b)())}))}))}},{key:"onUserFilterDelete",value:function(e){this.props.dispatch(Object(Pn.e)(e))}},{key:"renderContents",value:function(){var e=this;if(this.props.showSystemFilters){var t=Object(je.e)(this.props.forms,this.props.formId).map((function(e){return e.entity.filters})).getOrElse((function(){return[]}));return f.createElement(f.Fragment,null,f.createElement(z.b,null,f.createElement(y.a,{variant:"contained",onClick:this.onCreateRequest,color:"primary",disabled:this.props.actionsDisabled},this.props.i18n.t("Создать"))),f.createElement(_.a,{showId:!0,withActions:!0,error:this.props.forms.error,onRecordSelected:this.props.actionsDisabled?function(){}:this.onEditRequest,fetching:this.props.forms.fetching,empty:0===t.length,headers:[{id:"filterName",title:this.props.i18n.t("Название")}],rows:t.map((function(t,n){return{id:n.toString(),payload:t,fields:[t.name],buttons:[f.createElement(v.a,{disabled:e.props.actionsDisabled,style:q.d,key:"edit",onClick:function(r){r.stopPropagation(),e.onEditRequest(t,n)}},f.createElement(Cn.a,{style:q.e})),f.createElement(v.a,{disabled:e.props.actionsDisabled,style:q.d,key:"delete",onClick:function(t){t.stopPropagation(),e.onDelete(n)}},f.createElement(Rt.a,{style:q.e}))]}}))}))}if(this.props.showUserFilters){var n=this.props.userFilters.filters.filter((function(t){return Object(Sn.d)(t.filter.conditions).flatMap((function(t){return Object(je.e)(e.props.forms,e.props.formId).flatMap((function(n){return e.props.dispatch(Object(Re.b)(n.id,t.field))}))})).nonEmpty()}));return f.createElement(f.Fragment,null,f.createElement(z.b,null,f.createElement(y.a,{variant:"contained",onClick:this.onUserFilterCreateRequest,color:"primary"},this.props.i18n.t("Создать"))),f.createElement(_.a,{showId:!0,withActions:!0,error:new Sn.a,onRecordSelected:this.onUserFilterEditRequest,fetching:!1,empty:0===n.length,headers:[{id:"filterName",title:this.props.i18n.t("Название")}],rows:n.map((function(t,n){return{id:n.toString(),payload:t,fields:[t.name],buttons:[f.createElement(v.a,{style:q.d,key:"edit",onClick:function(r){r.stopPropagation(),e.onUserFilterEditRequest(t,n)}},f.createElement(Cn.a,{style:q.e})),f.createElement(v.a,{style:q.d,key:"delete",onClick:function(t){t.stopPropagation(),e.onUserFilterDelete(n)}},f.createElement(Rt.a,{style:q.e}))]}}))}))}}},{key:"render",value:function(){return f.createElement("div",{onKeyDown:this.handleKeyDown,style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},this.renderContents())}}]),t}(f.Component);xn=Vn([m.autobind],xn);var Dn=Object(h.connect)((function(e){return{i18n:e.i18n,forms:e.forms,filtersForm:e.filtersForm,userFilters:e.userFilters}}))(Object(de.a)(xn)),Ln=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Gn=function(e){function t(){return i()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFilterTemplateEditRequest",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Пользовательские фильтры"),f.createElement(Dn,{formId:this.props.formId,showUserFilters:!0,actionsDisabled:!0}),[f.createElement(y.a,{key:"close",variant:"contained",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть"))]);this.props.closePopover()}},{key:"onFilterTemplateChanged",value:function(e){this.props.dispatch(Object(J.k)({filterId:this.props.filterId,filter:e})),this.props.closePopover()}},{key:"handleFiltersLibraryClick",value:function(e){var t=this,n=Object(je.e)(this.props.forms,this.props.formId).map((function(e){return e.entity.filters})).getOrElse((function(){return[]})).map((function(e){return f.createElement(ee.a,{key:gn.v4(),value:e.name,onClick:function(){return t.onFilterTemplateChanged(e.filter)}},e.name)})),r=this.props.userFilters.filters.filter((function(e){return Object(M.g)(e.filter.conditions).flatMap((function(e){return Object(je.e)(t.props.forms,t.props.formId).flatMap((function(n){return t.props.dispatch(Object(Re.b)(n.id,e.field))}))})).nonEmpty()})).map((function(e){return f.createElement(ee.a,{key:gn.v4(),value:e.name,onClick:function(){return t.onFilterTemplateChanged(e.filter)}},e.name)}));this.props.openPopover(Object(M.l)(e.currentTarget),f.createElement(f.Fragment,null,f.createElement(ee.a,null,f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Системные"),":")),n,f.createElement(ee.a,null,f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Пользовательские"),":")),r,f.createElement(ee.a,{onClick:this.onFilterTemplateEditRequest},f.createElement("div",{style:{fontWeight:700}},this.props.i18n.t("Отредактировать")))))}},{key:"render",value:function(){return f.createElement(En.a,{title:this.props.i18n.t("Библиотека фильтров")},f.createElement(v.a,{onClick:this.handleFiltersLibraryClick},f.createElement(Tn.a,null)))}}]),t}(f.Component);Gn=Ln([m.autobind],Gn);var An=Object(h.connect)((function(e,t){return{i18n:e.i18n,userFilters:e.userFilters,forms:e.forms}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.userFilters===t.userFilters&&e.currentForm===t.currentForm}})(Object(Ce.a)(Object(de.a)(Gn)));n.d(t,"filterId",(function(){return _n}));var Nn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Mn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_n=new E.Id(gn.v4()),qn=function(e){function t(e){i()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={currentPage:0,rowPerPage:20,searchField:new M.b,searchValue:new M.b,filter:new M.b,filterEnabled:!1,markedFormRecords:[],processedFormRecords:[]},n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.outputValue.filter((function(e){return e.value.tpe.value===E.ValueObjectRefs.$Type.value})).map((function(e){return e.value.id.length})),n=e.outputValue.filter((function(e){return e.value.tpe.value===E.ValueObjectRefs.$Type.value})).map((function(e){return e.value.id.length}));Object(M.h)(n,t)||this.setState(D(this.state,{processedFormRecords:{$set:[]}}))}},{key:"combineFilter",value:function(e){return this.state.filterEnabled&&this.state.filter.nonEmpty?this.state.filter.map((function(t){return e.map((function(e){return new E.FilterGroupCondition([e,t],new E.FilterPredicateAnd)})).getOrElse((function(){return t}))})):e}},{key:"fetchFormRecords",value:function(e){var t=this;Object(W.d)(new E.DataPageRequest(this.state.currentPage,this.state.rowPerPage,this.props.childFormId,this.combineFilter(e||new M.b))).then((function(e){t.setState(D(t.state,{totalRecords:{$set:e.page.total}})),t.props.dispatch(Object(H.a)(t.props.display,t.props.input,t.props.parentFormId,t.props.objRefsField,e.page.records,e.page.total,t.props.i18n.t))})).catch((function(e){return console.error("Failed to resolve input data",e)}))}},{key:"onFirstPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:0}}),(function(){return e.fetchFormRecords()}))}},{key:"onLastPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:Math.ceil(this.props.inputValue.map((function(e){return e.total})).getOrElse((function(){return 0}))/this.state.rowPerPage)-1}}),(function(){return e.fetchFormRecords()}))}},{key:"onNextPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:this.state.currentPage+1}}),(function(){return e.fetchFormRecords()}))}},{key:"onPrevPage",value:function(){var e=this;this.setState(D(this.state,{currentPage:{$set:this.state.currentPage-1}}),(function(){return e.fetchFormRecords()}))}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(D(this.state,{rowPerPage:{$set:e}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchFieldChange",value:function(e){var t=this;this.setState(D(this.state,{searchField:{$set:new M.c(new E.Id(e))}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchValueChange",value:function(e){var t=this;this.setState(D(this.state,{searchValue:{$set:new M.c(e.target.value)}}),(function(){return t.fetchFormRecords()}))}},{key:"onSearchRecords",value:function(){var e=this;this.state.searchField.foreach((function(t){e.state.searchValue.foreach((function(n){var r=new E.FilterGroupCondition([new E.FilterCondition(t,new E.FilterExpressionContains,new E.ValueStr(n))],new E.FilterPredicateAnd);e.fetchFormRecords(new M.c(r))}))}))}},{key:"onFilterSave",value:function(e){var t=this;this.setState(D(this.state,{filter:{$set:this.props.filterForm}}),(function(){return t.props.handleDialogClose(e)}))}},{key:"onOpenFilterConfiguration",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Редактирование фильтрации"),f.createElement("div",null,f.createElement("div",{style:{position:"absolute",right:0,top:0,zIndex:10}},f.createElement(An,{filterId:_n,formId:this.props.childFormId})),f.createElement(vn,{initialValue:this.state.filter,filterId:_n,formId:this.props.childFormId})),[f.createElement(y.a,{variant:"contained",onClick:function(){return e.props.handleDialogClose(t)},style:{marginRight:"5px"}},this.props.i18n.t("Закрыть")),f.createElement(y.a,{variant:"contained",color:"primary",onClick:function(){return e.onFilterSave(t)}},this.props.i18n.t("Сохранить"))])}},{key:"onFilterToggle",value:function(){var e=this;this.setState(D(this.state,{filterEnabled:{$set:!this.state.filterEnabled}}),(function(){return e.fetchFormRecords()}))}},{key:"isValueDeleted",value:function(e){return e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusDeleted.$Type.value||e.formRecord.entity.attributes.status.tpe.value===E.FormDataStatusNominalDeleted.$Type.value}},{key:"onSelectAll",value:function(e,t){var n=this,r=this.props.inputValue.map((function(e){return e.displayValues})).getOrElse((function(){return[]})).filter((function(e){return e instanceof w.B})).filter((function(e){return!n.isValueDeleted(e)}));t?this.setState(D(this.state,{markedFormRecords:{$set:this.state.markedFormRecords.concat(r.filter((function(e){return 0===n.state.markedFormRecords.filter((function(t){return t.value===e.id.value})).length})).map((function(e){return e.id})))}})):this.setState(D(this.state,{markedFormRecords:{$set:this.state.markedFormRecords.filter((function(e){return 0===r.filter((function(t){return t.id.value===e.value})).length}))}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex((function(t){return t.value===e}));t>=0?this.setState(D(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(D(this.state,{markedFormRecords:{$push:[new E.Id(e)]}}))}},{key:"processFormRecords",value:function(e,t){var n=this;this.setState(D(this.state,{processedFormRecords:{$set:e.map((function(e){return e.id}))}}),(function(){t.finally((function(){n.setState(D(n.state,{processedFormRecords:{$set:[]}}))}))}))}},{key:"onMarkedFormRecordsAdd",value:function(){var e=this,t=this.props.inputValue.map((function(e){return e.displayValues})).getOrElse((function(){return[]})).filter((function(e){return e instanceof w.B})).filter((function(t){return e.state.markedFormRecords.filter((function(e){return e.value===t.id.value})).length>0})).filter((function(t){return 0===e.props.value.map((function(e){return e.id})).getOrElse((function(){return[]})).filter((function(e){return e.value===t.id.value})).length})).map((function(e){return e}));this.processFormRecords(t,this.props.onObjRefsAdd(t))}},{key:"onObjRefAdd",value:function(e){this.processFormRecords([e],this.props.onObjRefAdd(e))}},{key:"onObjRefDelete",value:function(e){var t=this;Object(M.l)(this.props.onObjRefDelete).foreach((function(n){t.processFormRecords([e],n(e))}))}},{key:"render",value:function(){var e=this,t=this.state.filterEnabled?f.createElement(k,{color:"#E91E63"}):f.createElement(R,null);return f.createElement("div",{style:{flexDirection:"column",width:"100%",display:"flex",minHeight:0}},f.createElement(z.b,{leftButtonGroup:[f.createElement(v.a,{key:"massAdding",onClick:this.onMarkedFormRecordsAdd},this.state.processedFormRecords.length>1?f.createElement(g.a,null):f.createElement(O.a,null)),f.createElement(v.a,{key:"filter",onClick:this.onFilterToggle},t),f.createElement(v.a,{key:"filter-set",onClick:this.onOpenFilterConfiguration},f.createElement(I,null))]}),f.createElement(U,{childFormId:this.props.childFormId,parentFormId:this.props.parentFormId,display:this.props.display,displayFields:this.props.displayFields,displayFieldsForAdding:this.props.displayFieldsForAdding,blockRendererId:this.props.blockRendererId,output:this.props.output,input:this.props.input,onObjRefAdd:this.onObjRefAdd,onObjRefDelete:this.onObjRefDelete,onSelectAll:this.onSelectAll,onRecordMarked:this.onRecordMarked,markedFormRecords:this.state.markedFormRecords,processedFormRecords:this.state.processedFormRecords,onlyOneChoice:this.props.onlyOneChoice}),f.createElement(z.a,{nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.props.inputValue.map((function(e){return e.total})).getOrElse((function(){return 0})),shouldShowMassActions:!1,massActionsComponents:[],searchField:this.state.searchField.map((function(e){return e.value})).getOrNull(),searchFields:this.props.childFields.getOrElse((function(){return[]})).filter((function(t){return e.props.displayFields.filter((function(e){return e.tpe.value===E.DisplayFieldByField.$Type.value})).filter((function(e){return t.id.value===e.fieldId.value})).length>0})),onSearchRecords:this.onSearchRecords,onSearchFieldChange:this.onSearchFieldChange,searchValue:this.state.searchValue.getOrElse((function(){return""})),onSearchValueChange:this.onSearchValueChange}))}}]),t}(f.Component);qn=Nn([m.autobind,Mn("design:paramtypes",[Object])],qn);t.default=Object(h.connect)((function(e,t){return{i18n:e.i18n,childFields:Object(F.f)(e.fields,t.childFormId),filterForm:Object(T.b)(e.filtersForm,_n),inputValue:Object(A.b)(e.dataInputs,t.display.id),outputValue:Object(j.e)(e.dataOutput,t.blockRendererId,t.output),systemFilters:e.currentForm.data.map((function(e){return e.entity.filters})),userFilters:e.userFilters.filters,value:Object(j.e)(e.dataOutput,t.blockRendererId,t.output).map((function(e){return e.value})).filter((function(e){return e.tpe.value===E.ValueObjectRefs.$Type.value}))}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataInputs.input===t.dataInputs.input&&e.dataOutput===t.dataOutput&&e.fields.list===t.fields.list&&e.filtersForm===t.filtersForm},areStatePropsEqual:function(e,t){return Object(M.h)(e.filterForm,t.filterForm)&&Object(M.h)(e.value,t.value)&&Object(M.h)(e.outputValue,t.outputValue)&&Object(M.h)(e.inputValue,t.inputValue)&&Object(M.h)(e.childFields,t.childFields)&&e.i18n===t.i18n}})(Object(On.a)([function(e){e.dispatch(Object(bn.g)(e.display,e.parentFormId))}],[],[],[])(Object(de.a)(qn)))}}]);