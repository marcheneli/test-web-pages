(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[3],{2254:function(e,t,n){var r={"./af":2007,"./af.js":2007,"./ar":2008,"./ar-dz":2009,"./ar-dz.js":2009,"./ar-kw":2010,"./ar-kw.js":2010,"./ar-ly":2011,"./ar-ly.js":2011,"./ar-ma":2012,"./ar-ma.js":2012,"./ar-sa":2013,"./ar-sa.js":2013,"./ar-tn":2014,"./ar-tn.js":2014,"./ar.js":2008,"./az":2015,"./az.js":2015,"./be":2016,"./be.js":2016,"./bg":2017,"./bg.js":2017,"./bm":2018,"./bm.js":2018,"./bn":2019,"./bn.js":2019,"./bo":2020,"./bo.js":2020,"./br":2021,"./br.js":2021,"./bs":2022,"./bs.js":2022,"./ca":2023,"./ca.js":2023,"./cs":2024,"./cs.js":2024,"./cv":2025,"./cv.js":2025,"./cy":2026,"./cy.js":2026,"./da":2027,"./da.js":2027,"./de":2028,"./de-at":2029,"./de-at.js":2029,"./de-ch":2030,"./de-ch.js":2030,"./de.js":2028,"./dv":2031,"./dv.js":2031,"./el":2032,"./el.js":2032,"./en-SG":2033,"./en-SG.js":2033,"./en-au":2034,"./en-au.js":2034,"./en-ca":2035,"./en-ca.js":2035,"./en-gb":2036,"./en-gb.js":2036,"./en-ie":2037,"./en-ie.js":2037,"./en-il":2038,"./en-il.js":2038,"./en-nz":2039,"./en-nz.js":2039,"./eo":2040,"./eo.js":2040,"./es":2041,"./es-do":2042,"./es-do.js":2042,"./es-us":2043,"./es-us.js":2043,"./es.js":2041,"./et":2044,"./et.js":2044,"./eu":2045,"./eu.js":2045,"./fa":2046,"./fa.js":2046,"./fi":2047,"./fi.js":2047,"./fo":2048,"./fo.js":2048,"./fr":2049,"./fr-ca":2050,"./fr-ca.js":2050,"./fr-ch":2051,"./fr-ch.js":2051,"./fr.js":2049,"./fy":2052,"./fy.js":2052,"./ga":2053,"./ga.js":2053,"./gd":2054,"./gd.js":2054,"./gl":2055,"./gl.js":2055,"./gom-latn":2056,"./gom-latn.js":2056,"./gu":2057,"./gu.js":2057,"./he":2058,"./he.js":2058,"./hi":2059,"./hi.js":2059,"./hr":2060,"./hr.js":2060,"./hu":2061,"./hu.js":2061,"./hy-am":2062,"./hy-am.js":2062,"./id":2063,"./id.js":2063,"./is":2064,"./is.js":2064,"./it":2065,"./it-ch":2066,"./it-ch.js":2066,"./it.js":2065,"./ja":2067,"./ja.js":2067,"./jv":2068,"./jv.js":2068,"./ka":2069,"./ka.js":2069,"./kk":2070,"./kk.js":2070,"./km":2071,"./km.js":2071,"./kn":2072,"./kn.js":2072,"./ko":2073,"./ko.js":2073,"./ku":2074,"./ku.js":2074,"./ky":2075,"./ky.js":2075,"./lb":2076,"./lb.js":2076,"./lo":2077,"./lo.js":2077,"./lt":2078,"./lt.js":2078,"./lv":2079,"./lv.js":2079,"./me":2080,"./me.js":2080,"./mi":2081,"./mi.js":2081,"./mk":2082,"./mk.js":2082,"./ml":2083,"./ml.js":2083,"./mn":2084,"./mn.js":2084,"./mr":2085,"./mr.js":2085,"./ms":2086,"./ms-my":2087,"./ms-my.js":2087,"./ms.js":2086,"./mt":2088,"./mt.js":2088,"./my":2089,"./my.js":2089,"./nb":2090,"./nb.js":2090,"./ne":2091,"./ne.js":2091,"./nl":2092,"./nl-be":2093,"./nl-be.js":2093,"./nl.js":2092,"./nn":2094,"./nn.js":2094,"./pa-in":2095,"./pa-in.js":2095,"./pl":2096,"./pl.js":2096,"./pt":2097,"./pt-br":2098,"./pt-br.js":2098,"./pt.js":2097,"./ro":2099,"./ro.js":2099,"./ru":2100,"./ru.js":2100,"./sd":2101,"./sd.js":2101,"./se":2102,"./se.js":2102,"./si":2103,"./si.js":2103,"./sk":2104,"./sk.js":2104,"./sl":2105,"./sl.js":2105,"./sq":2106,"./sq.js":2106,"./sr":2107,"./sr-cyrl":2108,"./sr-cyrl.js":2108,"./sr.js":2107,"./ss":2109,"./ss.js":2109,"./sv":2110,"./sv.js":2110,"./sw":2111,"./sw.js":2111,"./ta":2112,"./ta.js":2112,"./te":2113,"./te.js":2113,"./tet":2114,"./tet.js":2114,"./tg":2115,"./tg.js":2115,"./th":2116,"./th.js":2116,"./tl-ph":2117,"./tl-ph.js":2117,"./tlh":2118,"./tlh.js":2118,"./tr":2119,"./tr.js":2119,"./tzl":2120,"./tzl.js":2120,"./tzm":2121,"./tzm-latn":2122,"./tzm-latn.js":2122,"./tzm.js":2121,"./ug-cn":2123,"./ug-cn.js":2123,"./uk":2124,"./uk.js":2124,"./ur":2125,"./ur.js":2125,"./uz":2126,"./uz-latn":2127,"./uz-latn.js":2127,"./uz.js":2126,"./vi":2128,"./vi.js":2128,"./x-pseudo":2129,"./x-pseudo.js":2129,"./yo":2130,"./yo.js":2130,"./zh-cn":2131,"./zh-cn.js":2131,"./zh-hk":2132,"./zh-hk.js":2132,"./zh-tw":2133,"./zh-tw.js":2133};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=2254},2259:function(e,t,n){var r=n(2260);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(116)(r,o);r.locals&&(e.exports=r.locals)},2260:function(e,t,n){(e.exports=n(115)(!1)).push([e.i,".rbc-month-view{position:initial;height:auto}.rbc-event-with-actions{position:relative}\n",""])},2399:function(e,t,n){"use strict";n.r(t);var r,o=n(2),i=n.n(o),u=n(10),a=n.n(u),c=n(4),s=n.n(c),l=n(5),f=n.n(l),p=n(1),d=n(11),m=n(34),b=n.n(m),h=n(6),O=n.n(h),v=n(12),j=n.n(v),g=n(37),y=n(15),w=n(2392),k=n(2245),T=n.n(k),E=n(1908),D=n(358),I=n(8),R=n(723),C=n(253),P=n(192),V=n.n(P),F=n(3),M=n(36),S=n(67),A=n(174),W=n(31),x=n(111),z=n(22),_=n(0),B=(n(2255),n(2257),n(386)),N=n(77),Z=n(50),$=n(161),q=n(530),G=n(29),H=n(529),L=n(43),U=n(961),J=n(219),X=n(746),Y=n(731),K=n(379),Q=function(e,t,n,r,o){return function(i,u){o.handleDialogClose(r);var a=g.v4();e.foreach((function(e){i(Object(Y.b)(n)).foreach((function(n){var r=o.openDialog(u().i18n.t("Новая запись"),p.createElement(B.a,{formId:t,blockType:F.webRegistrationBlockTypeEdit,blockRendererId:a,rootBlockRendererId:Object(_.l)(a),formRecord:new _.b,formRecordId:new _.b,blockId:e,initialValues:n,initialValuesError:!1,getBlockComponent:H.a,onSave:function(){return new Promise((function(e,t){return t(new Error("onSave not implemented"))}))},onEdit:function(){return new Promise((function(e,t){return t(new Error("onEdit not implemented"))}))}}),[p.createElement(q.a,{blockRendererId:a,label:u().i18n.t("Сохранить"),onClick:function(){i(Object(N.f)(e,a,new _.b)).then((function(){return i(Object(N.a)(e,a,t))})).then((function(){return i(Object(Z.H)(a)),i(Object(N.b)(e,t,a)).then((function(n){return i(Object(X.b)(n.id,e,a,o)).then((function(){!function(e,n){if(o.handleDialogClose(n),i(Object(L.f)(u().i18n.t("Запись успешно создана"))),i(Object(Z.G)(a)),u().currentForm.data.filter((function(e){return F.FormType.isAnyDictionary(e.entity.formType)})).nonEmpty())return Object(J.e)(t),void i(Object(U.a)(t));i(Object(K.a)(t,e))}(n.id,r)}))}))})).catch((function(t){i(Object(Z.G)(a)),i(Object($.c)(t,o,a,e))}))}}),p.createElement(R.a,{variant:"contained",onClick:function(e){return o.handleDialogClose(r)},style:{marginRight:"10px"}},u().i18n.t("Закрыть"))])}))}))}},ee=(n(2259),n(54)),te=n(741),ne=n(714),re=n(715),oe=n(742),ie=n(743),ue=n(162),ae=n(459),ce=n(101),se=n(53),le=n(27),fe=n(39),pe=function(e,t){return new Date(e.getTime()-6e4*(t-e.getTimezoneOffset()))},de=function(e,t){return new Date(e.getTime()+6e4*(t-e.getTimezoneOffset()))},me=function(e,t,n,r,o){return function(i,u){Object(_.l)(o).flatMap((function(o){return function(e){return Object(_.l)(e).filter((function(e){return Array.isArray(e)})).map((function(e){return e.filter((function(e){return e instanceof Date})).map((function(e){return e}))})).flatMap((function(e){return Object(_.g)(e).map((function(e){return{start:Object(ne.a)(Object(oe.a)(e)),end:Object(re.a)(Object(ie.a)(e))}}))}))}(o).matchWith((function(o){return i(he(e,t,n,r,o)),new _.b}),(function(){return Object(_.l)(o)}))})).flatMap((function(o){return function(e){return Object(_.l)(e).filter((function(e){return!Array.isArray(e)})).filter((function(e){return e.start&&e.start instanceof Date&&e.end&&e.end instanceof Date})).map((function(e){return{start:Object(ne.a)(Object(oe.a)(e.start)),end:Object(re.a)(Object(ie.a)(e.end))}}))}(o).matchWith((function(o){return i(he(e,t,n,r,o)),new _.b}),(function(){return Object(_.l)(o)}))})).foreach((function(e){console.error("Unknown range type",e)}))}},be=function(e,t,n,r,o){return Object(_.l)({startDateTime:e.entity.getFormFieldValue(n.startDateTime).matchWith((function(e){return e.value instanceof F.ValueDate?e.value.value:new Date}),(function(){return new Date})),endDateTime:e.entity.getFormFieldValue(n.endDateTime).matchWith((function(e){return e.value instanceof F.ValueDate?e.value.value:new Date}),(function(){return new Date}))}).map((function(e){return{start:e.startDateTime.getTime(),end:e.endDateTime.getTime()}})).matchWith((function(o){return{start:pe(new Date(o.start),t),end:pe(new Date(o.end),t),title:e.entity.getFormFieldValue(n.label).map((function(e){return e.value.toString()})).getOrElse((function(){return""})),formDataId:e.id,resourceId:r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).flatMap((function(e){return Object(_.g)(e.id)}))})).map((function(e){return e.value})).getOrUndefined()}}),(function(){return{start:pe(Object(D.a)(new Date),t),end:pe(Object(te.a)(new Date),t),title:e.entity.getFormFieldValue(n.label).map((function(e){return e.value.toString()})).getOrElse((function(){return""})),formDataId:e.id,resourceId:r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).flatMap((function(e){return Object(_.g)(e.id)}))})).map((function(e){return e.value})).getOrUndefined()}}))},he=function(e,t,n,r,o){return function(i,u){t.dataOutput.foreach((function(a){Object(W.b)(u().fields,r,a.formField).foreach((function(r){return Object(_.g)(u().forms.list.filter((function(e){return e.id.value===r.entity.valueType.family.value}))).foreach((function(a){var c=n.eventProps.startDateTime,s=Object(le.e)(u().blockRendererContext,e).matchWith((function(e){return e.entity.getFormFieldValue(r.id).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).getOrElse((function(){return[]}))}),(function(){return[]})),l=new F.FilterGroupCondition((new Array).concat(n.eventProps.showAnothers?[]:[new F.RestrictedForm(a.id,s)]).concat([new F.FilterCondition(c,new F.FilterExpressionGt,new F.ValueDate(o.start.getTime())),new F.FilterCondition(c,new F.FilterExpressionLt,new F.ValueDate(o.end.getTime()))]),new F.FilterPredicateAnd);i(function(e,t,n,r,o,i,u){return function(a,c){a(Object(G.I)({blockRendererId:e,displayId:t.id})),Object(ue.a)(o,r).then((function(r){a(Object(G.H)({blockRendererId:e,displayId:t.id})),a(Object(G.E)({id:t.id,blockRendererId:e,display:r.list.map((function(e){return new G.A(e.id,I(be(e,n.timeZoneOffset,n.eventProps,n.resourceProps,c().i18n.t),{isOwn:{$set:u.filter((function(t){return t.value===e.id.value})).length>0}}),e)})),range:i}))})).catch((function(e){return console.error("Failed to resolve input data",e)}))}}(e,t,n,Object(_.l)(l),a.id,o,s))}))}))}))}},Oe=(r={},O()(r,F.CalendarDateConstraintRange.$Type.value,(function(e,t){return{start:e.start.matchWith((function(e){return Object(D.a)(pe(e,t))}),(function(){return Object(ne.a)(Object(oe.a)(pe(new Date,t)))})),end:e.end.matchWith((function(e){return Object(D.a)(pe(e,t))}),(function(){return Object(re.a)(Object(ie.a)(pe(new Date,t)))}))}})),O()(r,F.CalendarDateConstraintList.$Type.value,(function(e,t){return Object(_.l)(e.dates).filter((function(e){return e.length>0})).map((function(e){return e.sort((function(e,t){return e.getTime()>=t.getTime()?1:-1}))})).matchWith((function(e){return{start:Object(D.a)(pe(Object(_.f)(e),t)),end:Object(D.a)(pe(Object(_.f)(e.reverse()),t))}}),(function(){return{start:Object(ne.a)(Object(oe.a)(pe(new Date,t))),end:Object(re.a)(Object(ie.a)(pe(new Date,t)))}}))})),r),ve=n(220),je=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":j()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},ge=p.createContext(),ye=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"render",value:function(){return p.createElement(ge.Provider,{value:this.props},this.props.children)}}]),t}(p.PureComponent);ye=je([y.autobind],ye);var we=ge.Consumer,ke=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":j()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},Te=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"renderTitle",value:function(){return(this.props.event.isOwn||this.props.showAnothersLabel)&&this.props.title||p.createElement("span",null,"​")}},{key:"render",value:function(){return p.createElement("div",null,this.renderTitle())}}]),t}(p.Component);Te=ke([y.autobind],Te);var Ee,De,Ie,Re=Object(d.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),n),t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})((Ee=Te,function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"render",value:function(){var e=this;return p.createElement(we,null,(function(t){return p.createElement(Ee,Object.assign({onDelete:t.onDelete,onEdit:t.onEdit,showAnothersLabel:t.showAnothersLabel,ref:function(t){return e.ref=t}},e.props))}))}}]),t}(p.Component))),Ce=n(1914),Pe=n.n(Ce),Ve=n(763),Fe=n(24),Me=n(107),Se=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":j()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},Ae=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":j()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},We="PREV",xe="NEXT",ze="TODAY",_e="month",Be="week",Ne="day",Ze="agenda",$e=(De={},O()(De,_e,(function(e){return Object(oe.a)(e)})),O()(De,Be,(function(e){return Object(ne.a)(e)})),O()(De,Ne,(function(e){return Object(D.a)(e)})),O()(De,Ze,(function(e){return Object(D.a)(e)})),De),qe=(Ie={},O()(Ie,_e,(function(e){return Object(ie.a)(e)})),O()(Ie,Be,(function(e){return Object(re.a)(e)})),O()(Ie,Ne,(function(e){return Object(te.a)(e)})),O()(Ie,Ze,(function(e){return Object(te.a)(e)})),Ie),Ge=(new F.Id(g.v4()),{padding:"10px 6px 11px"}),He=function(e){function t(e){i()(this,t);var n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={datePickerOpen:!1},n}return f()(t,e),a()(t,[{key:"navigate",value:function(e){this.props.onNavigate(e)}},{key:"view",value:function(e){this.props.onView(e)}},{key:"viewNamesGroup",value:function(e){var t=this,n=this.props.views,r=this.props.view;if(Array.isArray(n)&&n.length>1)return n.map((function(n){return p.createElement("button",{type:"button",style:Ge,key:n,className:Pe()({"rbc-active":r===n}),onClick:t.view.bind(null,n)},e[n])}))}},{key:"openDatePickerModal",value:function(){}},{key:"onDateChoose",value:function(e){var t=this;this.setState(I(this.state,{datePickerOpen:{$set:!1}}),(function(){t.props.onNavigate("DATE",e)}))}},{key:"getStartOfView",value:function(){var e=this;return Object(fe.b)(this.props.view)($e).matchWith((function(t){return t(e.props.date)}),(function(){throw"unknown view type"}))}},{key:"getEndOfView",value:function(){var e=this;return Object(fe.b)(this.props.view)(qe).matchWith((function(t){return t(e.props.date)}),(function(){throw"unknown view type"}))}},{key:"isNextDisabled",value:function(){var e=this.getEndOfView().getTime();return Object(Fe.i)(this.props.range).filter((function(e){return Array.isArray(e)})).map((function(t){return t.filter((function(t){return Object(te.a)(t).getTime()>=e})).length<=1})).getOrElse((function(){return!1}))||Object(Fe.i)(this.props.range).filter((function(e){return!Array.isArray(e)})).flatMap((function(t){return t.end.map((function(t){return Object(te.a)(t).getTime()<=e}))})).getOrElse((function(){return!1}))}},{key:"isPrevDisabled",value:function(){var e=this.getStartOfView().getTime();return Object(Fe.i)(this.props.range).filter((function(e){return Array.isArray(e)})).map((function(t){return t.filter((function(t){return Object(D.a)(t).getTime()<=e})).length<=1})).getOrElse((function(){return!1}))||Object(Fe.i)(this.props.range).filter((function(e){return!Array.isArray(e)})).flatMap((function(t){return t.start.map((function(t){return Object(D.a)(t).getTime()>=e}))})).getOrElse((function(){return!1}))}},{key:"isTodayDisabled",value:function(){var e=Object(D.a)(new Date).getTime();return Object(Fe.i)(this.props.range).filter((function(e){return Array.isArray(e)})).map((function(t){return 0===t.filter((function(t){return Object(D.a)(t).getTime()===e})).length})).getOrElse((function(){return!1}))||Object(Fe.i)(this.props.range).filter((function(e){return!Array.isArray(e)})).map((function(t){return t.start.map((function(t){return t.getTime()>=e})).getOrElse((function(){return!1}))||t.end.map((function(t){return t.getTime()<=e})).getOrElse((function(){return!1}))})).getOrElse((function(){return!1}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.localizer.messages,r=t.label;return p.createElement("div",{className:"rbc-toolbar"},p.createElement("span",{className:"rbc-btn-group"},p.createElement("button",{type:"button",disabled:this.isTodayDisabled(),style:Object.assign(Object.assign({},Ge),this.isTodayDisabled()?{cursor:"not-allowed"}:{}),onClick:function(){return e.navigate(ze)}},n.today),p.createElement("button",{type:"button",disabled:this.isPrevDisabled(),style:Object.assign(Object.assign({},Ge),this.isPrevDisabled()?{cursor:"not-allowed"}:{}),onClick:function(){return e.navigate(We)}},n.previous),p.createElement("button",{type:"button",disabled:this.isNextDisabled(),style:Object.assign(Object.assign({},Ge),this.isNextDisabled()?{cursor:"not-allowed"}:{}),onClick:function(){return e.navigate(xe)}},n.next)),p.createElement("span",{className:"rbc-toolbar-label",onClick:this.openDatePickerModal},r),this.props.rightButtonsGroup&&p.createElement("span",{className:"rbc-btn-group"},this.props.rightButtonsGroup),p.createElement("span",{className:"rbc-btn-group"},this.viewNamesGroup(n)),p.createElement(Ve.DatePicker,{open:this.state.datePickerOpen,autoOk:!0,value:this.props.date,onChange:this.onDateChoose,style:{display:"none"}}))}}]),t}(p.Component);He=Se([y.autobind,Ae("design:paramtypes",[Object])],He);var Le,Ue,Je,Xe=Object(d.connect)((function(e,t){return{i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign({},e,n,t)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n},areStatePropsEqual:function(e,t){return e.i18n===t.i18n}})(Object(S.a)(Object(Me.a)(He))),Ye=function(e){return function(t){function n(){return i()(this,n),s()(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return f()(n,t),a()(n,[{key:"render",value:function(){return p.createElement(Xe,Object.assign({},this.props,{range:e}))}}]),n}(p.Component)},Ke=n(60),Qe=function(e,t,n,r,o){return function(i,u){if(!t.intersectionEnabled){var a=Object(z.f)(u().dataOutput,e,t.startDateTime),c=Object(z.f)(u().dataOutput,e,t.endDateTime),s=n.value.filter((function(e){return n.enabled})).map((function(e){return e.resource})).flatMap((function(t){return Object(z.f)(u().dataOutput,e,t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).getOrElse((function(){return[]})),l=a.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),f=c.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));if(r.filter((function(e){return o.filter((function(t){return t.value===e.id.value})).isEmpty()})).filter((function(e){return n.value.filter((function(e){return n.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).filter((function(e){return e.filter((function(e){return s.filter((function(t){return t.value===e.value})).length>0})).length>0})).nonEmpty()})).filter((function(e){var n=e.entity.getFormFieldValue(t.startDateTime),r=e.entity.getFormFieldValue(t.endDateTime),o=n.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),i=r.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));return o.filter((function(e){return l.getOrElse((function(){return 0}))<e&&f.getOrElse((function(){return 0}))>e})).nonEmpty()||i.filter((function(e){return l.getOrElse((function(){return 0}))<e&&f.getOrElse((function(){return 0}))>e})).nonEmpty()||o.getOrElse((function(){return 0}))<l.getOrElse((function(){return 0}))&&i.getOrElse((function(){return 0}))>f.getOrElse((function(){return 0}))})).length>0)throw new Ke.d}}},et=function(e,t,n,r,o,i){return function(u,a){var c=n.value.filter((function(e){return n.enabled})).map((function(e){return e.getMilliseconds()})).getOrElse((function(){return 0})),s=Object(z.f)(a().dataOutput,e,t.startDateTime),l=Object(z.f)(a().dataOutput,e,t.endDateTime),f=r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return Object(z.f)(a().dataOutput,e,t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).getOrElse((function(){return[]})),p=s.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),d=l.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));return 0===o.filter((function(e){return i.filter((function(t){return t.value===e.id.value})).isEmpty()})).filter((function(e){return r.value.filter((function(e){return r.enabled})).map((function(e){return e.resource})).flatMap((function(t){return e.entity.getFormFieldValue(t)})).filter((function(e){return e.value instanceof F.ValueObjectRefs})).map((function(e){return e.value})).map((function(e){return e.id})).filter((function(e){return e.filter((function(e){return f.filter((function(t){return t.value===e.value})).length>0})).length>0})).nonEmpty()})).filter((function(e){var n=e.entity.getFormFieldValue(t.startDateTime),r=e.entity.getFormFieldValue(t.endDateTime),o=n.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()})),i=r.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return e.value.getTime()}));return Math.abs(o.getOrElse((function(){return 0}))-d.getOrElse((function(){return 0})))<c||Math.abs(p.getOrElse((function(){return 0}))-i.getOrElse((function(){return 0})))<c})).length}},tt=function(e,t,n,r,o){return function(i,u){if(!i(et(e,t,t.minInterval,n,r,o)))throw new Ke.f(t.minInterval.value.filter((function(e){return t.minInterval.enabled})).map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})))}},nt=function(e,t,n,r,o){return function(i,u){if(!i(et(e,t,t.minOwnInterval,n,r,o)))throw new Ke.g(t.minOwnInterval.value.filter((function(e){return t.minOwnInterval.enabled})).map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})))}},rt=function(e,t,n,r){return function(o,i){var u=Object(z.f)(i().dataOutput,e,t.startDateTime),a=Object(z.f)(i().dataOutput,e,t.endDateTime),c=u.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return pe(e.value,r)})).map((function(e){return e.getTime()})),s=a.map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueDate})).map((function(e){return pe(e.value,r)})).map((function(e){return e.getTime()}));n.value.filter((function(e){return n.enabled})).flatMap((function(e){return e.min.map((function(e){return pe(e,r)})).filter((function(e){return e.getTime()-Object(D.a)(e).getTime()<=c.getOrElse((function(){return 0}))-Object(D.a)(c.getOrElse((function(){return 0}))).getTime()})).matchWith((function(t){return e.max}),(function(){throw new Ke.h})).map((function(e){return pe(e,r)})).filter((function(e){return e.getTime()-Object(D.a)(e).getTime()>=s.getOrElse((function(){return 0}))-Object(D.a)(s.getOrElse((function(){return 0}))).getTime()})).matchWith((function(t){return e.max}),(function(){throw new Ke.e}))}))}},ot=function(e,t,n){return n.value.filter((function(e){return n.enabled})).filter((function(n){return Object(_.l)(e.resourceId).matchWith((function(e){return t.filter((function(t){return t.resourceId===e}))}),(function(){return t})).filter((function(t){return Object(D.a)(t.start).getTime()===Object(D.a)(e.start).getTime()||Object(D.a)(t.end).getTime()===Object(D.a)(e.end).getTime()})).filter((function(t){return Math.abs(e.start.getTime()-Object(D.a)(e.start).getTime()-(t.end.getTime()-Object(D.a)(t.end).getTime()))<n.getMilliseconds()||Math.abs(t.start.getTime()-Object(D.a)(t.start).getTime()-(e.end.getTime()-Object(D.a)(e.end).getTime()))<n.getMilliseconds()})).length>0})).isEmpty()},it=n(864),ut=n.n(it),at=n(2261),ct=n.n(at),st=n(955),lt=n(2136),ft=n(2282),pt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},dt=function(e){return function(t){function n(){return i()(this,n),s()(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return f()(n,t),a()(n,[{key:"render",value:function(){var e=this.props,t=e.date,r=(pt(e,["date"]),n.range(t,{localizer:this.props.localizer}));return p.createElement(ct.a,Object.assign({},this.props,{range:r,eventOffset:15}))}}],[{key:"range",value:function(t,n){n.localizer;return Object(_.l)(e).filter((function(e){return Array.isArray(e)})).matchWith((function(e){return e.filter((function(e){return Object(ne.a)(e).getTime()===Object(ne.a)(t).getTime()}))}),(function(){return Object(_.l)(e).matchWith((function(e){return Object(st.a)({start:e.start.matchWith((function(e){return Object(ne.a)(e).getTime()<Object(ne.a)(t).getTime()?Object(ne.a)(t):Object(ne.a)(e)}),(function(){return Object(ne.a)(t)})),end:e.end.matchWith((function(e){return Object(re.a)(e).getTime()>Object(re.a)(t).getTime()?Object(re.a)(t):Object(re.a)(e)}),(function(){return Object(re.a)(t)}))})}),(function(){return Object(st.a)({start:Object(ne.a)(t),end:Object(re.a)(t)})}))})).sort((function(e,t){return e.getTime()>=t.getTime()?1:-1}))}},{key:"navigate",value:function(e,t){switch(t){case We:return Object(ft.a)(e,1);case xe:return Object(lt.a)(e,1);default:return e}}},{key:"title",value:function(e,t){var n=t.localizer,r=this.range(e,{localizer:n}),o=ut()(r),i=o[0],u=o.slice(1);return n.format({start:i,end:u.pop()},"dayRangeHeaderFormat")}}]),n}(p.Component)},mt=function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":j()(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},bt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":j()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ht=(Le={},O()(Le,F.CalendarDateConstraintList.$Type.value,(function(e){return Object(_.g)(e.dates)})),O()(Le,F.CalendarDateConstraintRange.$Type.value,(function(e){return e.start})),Le),Ot=(Ue={},O()(Ue,F.CalendarDateConstraintList.$Type.value,(function(e,t){return e.dates.map((function(e){return pe(e,t)}))})),O()(Ue,F.CalendarDateConstraintRange.$Type.value,(function(e,t){return{start:e.start.map((function(e){return pe(e,t)})),end:e.end.map((function(e){return pe(e,t)}))}})),Ue),vt=(Je={},O()(Je,F.CalendarViewDay.$Type.value,(function(){return Ne})),O()(Je,F.CalendarViewMonth.$Type.value,(function(){return _e})),O()(Je,F.CalendarViewWeek.$Type.value,(function(){return Be})),O()(Je,F.CalendarViewAgenda.$Type.value,(function(){return Ze})),Je),jt=Object(w.b)(E),gt=T()(w.a),yt={flex:"1"},wt=function(e){function t(e){i()(this,t);var n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.weekView=new _.b,n.calendarToolbar=new _.b;var r=e.control.viewProps.dateConstraint.value.filter((function(t){return e.control.viewProps.dateConstraint.enabled})).map((function(t){return Object(fe.b)(t.tpe.value)(Ot).matchWith((function(n){return n(t,e.control.timeZoneOffset)}),(function(){throw"unknown date constraint type"}))}));return n.weekView=Object(_.l)(dt(r.getOrUndefined())),n.calendarToolbar=Object(_.l)(Ye(r.getOrUndefined())),n}return f()(t,e),a()(t,[{key:"rangeChangeHandler",value:function(e){var t=this;this.props.formId.foreach((function(n){t.props.dispatch(me(t.props.blockRendererId,t.props.display,t.props.control,n,e))}))}},{key:"onBlur",value:function(){this.props.onControlBlur()}},{key:"getEvents",value:function(){return this.props.displayValues.matchWith((function(e){return e.filter((function(e){return e instanceof G.A})).map((function(e){return e.event}))}),(function(){return[]}))}},{key:"openCreateDialog",value:function(e,t){var n=this,r=g.v4(),o=this.props.control.eventBlock,i=this.props.openDialog(this.props.i18n.t("Новое событие"),p.createElement(B.a,{formId:e,blockType:F.webRegistrationBlockTypeEdit,blockRendererId:r,rootBlockRendererId:Object(_.l)(r),formRecord:new _.b,formRecordId:new _.b,blockId:o,initialValues:t,initialValuesError:!1,getBlockComponent:H.a,onSave:function(){return new Promise((function(e,t){return t(new Error("onSave not implemented"))}))},onEdit:function(){return new Promise((function(e,t){return t(new Error("onEdit not implemented"))}))},onOpenBlock:function(e,t){return n.props.dispatch(Q(e,t,r,i,n.props))}}),[p.createElement(R.a,{variant:"contained",key:"close",onClick:function(e){n.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),p.createElement(q.a,{key:"save",blockRendererId:r,label:this.props.i18n.t("Сохранить"),onClick:function(){n.props.dispatch(Object(N.f)(o,r,new _.b)).then((function(){return n.props.dispatch(Object(N.a)(o,r,e))})).then((function(){n.props.dispatch(Qe(r,n.props.control.eventProps,n.props.control.resourceProps,n.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof G.A})).map((function(e){return e.formRecord})),new _.b))})).then((function(){n.props.dispatch(tt(r,n.props.control.eventProps,n.props.control.resourceProps,n.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof G.A})).map((function(e){return e.formRecord})),new _.b))})).then((function(){n.props.dispatch(nt(r,n.props.control.eventProps,n.props.control.resourceProps,n.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof G.A})).filter((function(e){return e.event.isOwn})).map((function(e){return e.formRecord})),new _.b))})).then((function(){n.props.dispatch(rt(r,n.props.control.eventProps,n.props.control.viewProps.timeConstraint,n.props.control.timeZoneOffset))})).then((function(){return n.props.dispatch(Object(Z.H)(r)),n.childRegistration(o,e,r).then((function(t){return Object(ee.g)(e,t.id)})).then((function(e){n.props.handleDialogClose(i),n.props.onChange(n.props.value.matchWith((function(t){return I(t,{id:{$push:[e.record.id]}})}),(function(){return new F.ValueObjectRefs([e.record.id])})),n.props.output),n.props.dispatch(Object(G.F)({blockRendererId:n.props.blockRendererId,id:n.props.display.id,display:n.props.displayValues.getOrElse((function(){return[]})).concat(new G.A(e.record.id,I(be(e.record,n.props.control.timeZoneOffset,n.props.control.eventProps,n.props.control.resourceProps,n.props.i18n.t),{isOwn:{$set:!0}}),e.record))}))}))})).catch((function(e){n.props.dispatch(Object(Z.G)(r)),n.props.dispatch(Object($.c)(e,n.props,r,o))}))}})])}},{key:"childRegistration",value:function(e,t,n){var r=this;return this.props.dispatch(this.props.parentRecordId.matchWith((function(o){return Object(N.c)(e,o,r.props.output.formField,t,n,new _.b)}),(function(){return Object(N.b)(e,t,n)})))}},{key:"adjustSlotInfo",value:function(e){var t=this,n=this.props.control.eventProps.minInterval.value.filter((function(e){return t.props.control.eventProps.minInterval.enabled})).map((function(e){return e.getMilliseconds()})).getOrElse((function(){return 0})),r=Object(_.l)(e.resourceId).matchWith((function(e){return t.getEvents().filter((function(t){return t.resourceId===e}))}),(function(){return t.getEvents()})).filter((function(t){return Object(D.a)(t.start).getTime()===Object(D.a)(e.start).getTime()||Object(D.a)(t.end).getTime()===Object(D.a)(e.start).getTime()})),o=Object(_.g)(r.filter((function(t){return Math.abs(e.start.getTime()-t.end.getTime())<n}))).matchWith((function(e){return new Date(e.end.getTime()+n)}),(function(){return e.start})),i=Object(_.g)(r.filter((function(t){return Math.abs(t.start.getTime()-e.end.getTime())<n}))).matchWith((function(e){return new Date(e.start.getTime()-n)}),(function(){return e.end}));return I(e,{start:{$set:o},end:{$set:i}})}},{key:"getInitialValues",value:function(e){var t,n=this,r=de(e.start,this.props.control.timeZoneOffset),o=de(e.end,this.props.control.timeZoneOffset),i=new F.Duration(o.getTime()-r.getTime(),F.TimeUnitType.Milliseconds);return Object.assign((t={},O()(t,this.props.control.eventProps.startDateTime.value,new F.FormFieldValue(this.props.control.eventProps.startDateTime,new F.ValueDate(r.getTime()))),O()(t,this.props.control.eventProps.endDateTime.value,new F.FormFieldValue(this.props.control.eventProps.endDateTime,this.props.control.eventProps.maxDuration.value.filter((function(e){return n.props.control.eventProps.maxDuration.enabled})).matchWith((function(e){return i.getMinutes()>e.getMinutes()?new F.ValueDate(r.getTime()+e.getMilliseconds()):new F.ValueDate(o.getTime())}),(function(){return new F.ValueDate(o.getTime())})))),t),this.props.control.resourceProps.value.filter((function(e){return n.props.control.resourceProps.enabled})).map((function(e){return e.resource})).matchWith((function(t){return F.Id.createId(e.resourceId).matchWith((function(e){return O()({},t.value,new F.FormFieldValue(t,new F.ValueObjectRefs([e])))}),(function(){return{}}))}),(function(){return{}})))}},{key:"handleSlotSelect",value:function(e){var t=this;this.props.control.viewProps.timeConstraint.value.flatMap((function(e){return e.max})).map((function(e){return pe(e,t.props.control.timeZoneOffset)})).filter((function(t){return e.start.getTime()-Object(D.a)(e.start).getTime()<t.getTime()-Object(D.a)(t).getTime()})).isEmpty()&&this.props.control.viewProps.timeConstraint.enabled||Object(_.l)(e).flatMap((function(n){return t.checkSlotInfoIntersection(e,t.getEvents())})).flatMap((function(n){return t.checkMinOwnInterval(e,t.getEvents().filter((function(e){return e.isOwn})))})).foreach((function(e){Object(_.l)(e).filter((function(n){return function(e,t){return t.value.filter((function(e){return t.enabled})).filter((function(t){return t.getMilliseconds()<e.end.getTime()-e.start.getTime()})).isEmpty()}(e,t.props.control.eventProps.maxDuration)})).matchWith((function(e){t.props.field.filter((function(e){return e.entity.valueType instanceof F.ValueTypeObjectRefs})).foreach((function(n){t.openCreateDialog(n.entity.valueType.family,t.getInitialValues(t.adjustSlotInfo(e)))}))}),(function(){t.props.openSnackbar(p.createElement("span",null,t.props.i18n.t("Максимальная продолжительность")+" "+t.props.control.eventProps.maxDuration.value.map((function(e){return e.getMinutes().toString()})).getOrElse((function(){return""}))+" "+t.props.i18n.t("мин")+"."),new _.b)}))}))}},{key:"onDeleteRequested",value:function(e,t,n){var r=this,o=this.props.openDialog(this.props.i18n.t("Удаление"),p.createElement("p",null,this.props.i18n.t("Вы действительно хотите удалить? Это действие нельзя будет отменить")),[p.createElement(R.a,{key:"close",variant:"contained",onClick:function(){return r.props.handleDialogClose(o)},style:{marginRight:"10px"}},this.props.i18n.t("Отмена")),p.createElement(R.a,{key:"delete",variant:"contained",color:"primary",onClick:function(){r.props.formId.foreach((function(i){r.props.parentRecordId.matchWith((function(n){return Object(ee.n)([n],i,r.props.output.formField,e,[t])}),(function(){return new Promise((function(e,t){return e()}))})).then((function(n){return Object(ee.q)(e,t,new F.FormDataStatusNominalDeleted)})).then((function(){r.props.handleDialogClose(o),r.props.handleDialogClose(n),r.props.onChange(r.props.value.map((function(e){return new F.ValueObjectRefs(e.id.filter((function(e){return e.value!==t.value})))})).getOrElse((function(){return new F.ValueObjectRefs([])})),r.props.output),r.props.dispatch(Object(G.F)({blockRendererId:r.props.blockRendererId,id:r.props.display.id,display:r.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e.id.value!==t.value}))}))})).catch((function(e){console.log("unable to delete event",e)}))}))}},this.props.i18n.t("Удалить"))])}},{key:"onFormRecordRequested",value:function(e,t){}},{key:"handleEventSelect",value:function(e){var t=this;e.isOwn&&Object(_.g)(this.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value===e.formDataId.value}))).filter((function(e){return e instanceof G.A})).map((function(e){return e})).map((function(e){return e.formRecord})).foreach((function(e){var n=g.v4(),r=t.props.control.eventBlock,o=t.props.openDialog(t.props.i18n.t("Новое событие"),p.createElement("div",null,p.createElement("div",{style:{position:"absolute",top:12,right:5}},p.createElement(C.a,{onClick:function(){return t.onDeleteRequested(e.entity.formId,e.id,o)}},p.createElement(V.a,null))),p.createElement(B.a,{formId:e.entity.formId,blockType:F.webRegistrationBlockTypeEdit,blockRendererId:n,rootBlockRendererId:Object(_.l)(n),formRecord:Object(_.l)(e),formRecordId:Object(_.l)(e).map((function(e){return e.id})),blockId:r,initialValues:e.entity.values,initialValuesError:!1,getBlockComponent:H.a,onSave:function(){return new Promise((function(e,t){return t(new Error("onSave not implemented"))}))},onEdit:function(){return new Promise((function(e,t){return t(new Error("onEdit not implemented"))}))},onOpenBlock:function(e,r){return t.props.dispatch(Q(e,r,n,o,t.props))}})),[p.createElement(R.a,{variant:"contained",key:"close",onClick:function(e){t.props.handleDialogClose(o)},style:{marginRight:"10px"}},t.props.i18n.t("Закрыть")),p.createElement(q.a,{key:"save",blockRendererId:n,label:t.props.i18n.t("Сохранить"),onClick:function(){t.props.dispatch(Object(N.f)(r,n,new _.b)).then((function(){return t.props.dispatch(Object(N.a)(r,n,e.entity.formId))})).then((function(){t.props.dispatch(Qe(n,t.props.control.eventProps,t.props.control.resourceProps,t.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof G.A})).map((function(e){return e.formRecord})),Object(_.l)(e.id)))})).then((function(){t.props.dispatch(tt(n,t.props.control.eventProps,t.props.control.resourceProps,t.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof G.A})).map((function(e){return e.formRecord})),Object(_.l)(e.id)))})).then((function(){t.props.dispatch(nt(n,t.props.control.eventProps,t.props.control.resourceProps,t.props.displayValues.getOrElse((function(){return[]})).filter((function(e){return e instanceof G.A})).filter((function(e){return e.event.isOwn})).map((function(e){return e.formRecord})),Object(_.l)(e.id)))})).then((function(){t.props.dispatch(rt(n,t.props.control.eventProps,t.props.control.viewProps.timeConstraint,t.props.control.timeZoneOffset))})).then((function(){t.props.dispatch(Object(Z.H)(n)),t.props.dispatch(Object(ve.e)(r)).foreach((function(i){t.props.dispatch(Object(N.e)(r,e.entity.formId,i.entity,n,e.id)).then((function(t){return Object(ee.g)(e.entity.formId,e.id)})).then((function(e){t.props.handleDialogClose(o),t.props.dispatch(Object(G.F)({blockRendererId:t.props.blockRendererId,id:t.props.display.id,display:t.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value!==e.record.id.value})).concat(new G.A(e.record.id,I(be(e.record,t.props.control.timeZoneOffset,t.props.control.eventProps,t.props.control.resourceProps,t.props.i18n.t),{isOwn:{$set:!0}}),e.record))}))}))}))})).catch((function(e){t.props.dispatch(Object(Z.G)(n)),t.props.dispatch(Object($.c)(e,t.props,n,r))}))}})])}))}},{key:"getEventStyle",value:function(e){return Object.assign({},(e.isOwn?this.props.control.eventProps.colorOfOwns:this.props.control.eventProps.colorOfAnothers).matchWith((function(e){return{backgroundColor:e}}),(function(){return{}})))}},{key:"getEventProps",value:function(e){return{style:this.getEventStyle(e),className:"rbc-event-with-actions"}}},{key:"onMoveEvent",value:function(e){this.onDndEvent(e)}},{key:"onResizeEvent",value:function(e){this.onDndEvent(e)}},{key:"saveDndChanges",value:function(e){var t=this,n=de(e.start,this.props.control.timeZoneOffset),r=de(e.end,this.props.control.timeZoneOffset);Object(_.g)(this.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value===e.event.formDataId.value}))).filter((function(e){return e instanceof G.A})).foreach((function(o){Object(ee.o)(o.formRecord.entity.formId,[new F.FormDataValues(o.formRecord.id,[new F.FormFieldValue(t.props.control.eventProps.startDateTime,new F.ValueDate(n.getTime())),new F.FormFieldValue(t.props.control.eventProps.endDateTime,new F.ValueDate(r.getTime()))].concat(b()(t.props.control.resourceProps.value.filter((function(e){return t.props.control.resourceProps.enabled})).map((function(e){return e.resource})).matchWith((function(t){return F.Id.createId(e.resourceId).matchWith((function(e){return[new F.FormFieldValue(t,new F.ValueObjectRefs([e]))]}),(function(){return[]}))}),(function(){return[]})))))]).then((function(e){return Object(ee.g)(o.formRecord.entity.formId,o.formRecord.id)})).then((function(e){t.props.dispatch(Object(G.F)({blockRendererId:t.props.blockRendererId,id:t.props.display.id,display:t.props.displayValues.getOrElse((function(){return[]})).filter((function(t){return t.id.value!==e.record.id.value})).concat(new G.A(e.record.id,I(be(e.record,t.props.control.timeZoneOffset,t.props.control.eventProps,t.props.control.resourceProps,t.props.i18n.t),{isOwn:{$set:!0}}),e.record))}))})).catch((function(e){console.error("cannot save changes")}))}))}},{key:"checkSlotInfoIntersection",value:function(e,t){var n=this;return Object(_.l)(e).filter((function(e){return n.props.control.eventProps.intersectionEnabled||function(e,t){return 0===Object(_.l)(e.resourceId).matchWith((function(e){return t.filter((function(t){return t.resourceId===e}))}),(function(){return t})).filter((function(t){return Object(D.a)(t.start).getTime()===Object(D.a)(e.start).getTime()||Object(D.a)(t.end).getTime()===Object(D.a)(e.end).getTime()})).filter((function(t){return e.start.getTime()-Object(D.a)(e.start).getTime()<t.start.getTime()-Object(D.a)(t.start).getTime()&&e.end.getTime()-Object(D.a)(e.end).getTime()>t.start.getTime()-Object(D.a)(t.start).getTime()||e.start.getTime()-Object(D.a)(e.start).getTime()<t.end.getTime()-Object(D.a)(t.end).getTime()&&e.end.getTime()-Object(D.a)(e.end).getTime()>t.end.getTime()-Object(D.a)(t.end).getTime()||t.start.getTime()-Object(D.a)(t.start).getTime()>=e.start.getTime()-Object(D.a)(e.start).getTime()&&t.end.getTime()-Object(D.a)(t.end).getTime()<=e.end.getTime()-Object(D.a)(e.end).getTime()})).length}(e,t)})).matchWith((function(e){return Object(_.l)(e)}),(function(){return n.props.openSnackbar(p.createElement("span",null,n.props.i18n.t("Данный временной слот уже занят")),new _.b),new _.b}))}},{key:"checkMinInterval",value:function(e,t){var n=this;return Object(_.l)(e).filter((function(e){return ot(e,t,n.props.control.eventProps.minInterval)})).matchWith((function(e){return Object(_.l)(e)}),(function(){return n.props.openSnackbar(p.createElement("span",null,n.props.i18n.t("Интервал между событиями")+" "+n.props.control.eventProps.minInterval.value.map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})).toString()+" "+n.props.i18n.t("мин")),new _.b),new _.b}))}},{key:"checkMinOwnInterval",value:function(e,t){var n=this;return Object(_.l)(e).filter((function(e){return ot(e,t,n.props.control.eventProps.minOwnInterval)})).matchWith((function(e){return Object(_.l)(e)}),(function(){return n.props.openSnackbar(p.createElement("span",null,n.props.i18n.t("Интервал между собственными событиями")+" "+n.props.control.eventProps.minOwnInterval.value.map((function(e){return e.getMinutes()})).getOrElse((function(){return 0})).toString()+" "+n.props.i18n.t("мин")),new _.b),new _.b}))}},{key:"onDndEvent",value:function(e){var t=this;if(e.event.isOwn){var n=this.getEvents().filter((function(t){return t.formDataId.value!==e.event.formDataId.value}));Object(_.l)(e).flatMap((function(e){return t.checkSlotInfoIntersection(e,n)})).flatMap((function(e){return t.checkMinInterval(e,n)})).flatMap((function(e){return t.checkMinOwnInterval(e,n.filter((function(e){return e.isOwn})))})).foreach((function(e){t.saveDndChanges(e)}))}}},{key:"onEditClick",value:function(){}},{key:"onDeleteClick",value:function(){}},{key:"getDefaultDate",value:function(){var e=this;return this.props.control.viewProps.dateConstraint.value.filter((function(t){return e.props.control.viewProps.dateConstraint.enabled})).flatMap((function(e){return Object(fe.b)(e.tpe.value)(ht).flatMap((function(t){return t(e)}))})).matchWith((function(t){return pe(t,e.props.control.timeZoneOffset)}),(function(){return new Date}))}},{key:"getDefaultView",value:function(){return Object(fe.b)(this.props.control.viewProps.defaultView.tpe.value)(vt).matchWith((function(e){return e()}),(function(){throw"unknown calendar view type"}))}},{key:"render",value:function(){var e=this,t=this.props.display.elementCss.flatMap((function(e){return e.proportions.flatMap((function(e){return e.height}))})).getOrElse((function(){return"300px"}));return p.createElement(M.a,{display:this.props.display,style:yt,blockStyle:this.props.blockStyle},p.createElement("div",{style:{height:t}},p.createElement(ye,{onEdit:this.onEditClick,onDelete:this.onDeleteClick,showAnothersLabel:this.props.control.eventProps.showAnothersLabel},p.createElement(gt,Object.assign({selectable:!0,components:{event:Re,toolbar:this.calendarToolbar.getOrUndefined()}},{step:this.props.control.viewProps.slotProps.step.getMinutes(),timeslots:this.props.control.viewProps.slotProps.slots},{formats:{timeGutterFormat:"HH:mm",dayHeaderFormat:"dddd MMMM DD",eventTimeRangeFormat:function(e,t,n){var r=e.start,o=e.end;return n.format(r,"HH:mm",t)+" — "+n.format(o,"HH:mm",t)}},localizer:jt,defaultDate:this.getDefaultDate(),defaultView:this.getDefaultView(),events:this.getEvents()},this.props.control.resourceProps.value.filter((function(t){return e.props.control.resourceProps.enabled})).matchWith((function(t){return{resourceIdAccessor:"resourceId",resourceTitleAccessor:"resourceTitle",resources:e.props.dataInput.matchWith((function(e){return e.displayValues.map((function(e){return{resourceId:e.id.value,resourceTitle:e.toString()}}))}),(function(){return[]}))}}),(function(){return{}})),this.props.control.viewProps.timeConstraint.value.filter((function(t){return e.props.control.viewProps.timeConstraint.enabled})).flatMap((function(e){return e.min})).matchWith((function(t){return{min:pe(t,e.props.control.timeZoneOffset)}}),(function(){return{}})),this.props.control.viewProps.timeConstraint.value.filter((function(t){return e.props.control.viewProps.timeConstraint.enabled})).flatMap((function(e){return e.max})).matchWith((function(t){return{max:pe(t,e.props.control.timeZoneOffset)}}),(function(){return{}})),{onEventDrop:this.onMoveEvent,resizableAccessor:function(){return e.props.control.eventProps.resizable},onEventResize:this.onResizeEvent,onSelectEvent:this.handleEventSelect,onSelectSlot:this.handleSlotSelect,onRangeChange:this.rangeChangeHandler,eventPropGetter:this.getEventProps,culture:this.props.i18n.code,messages:{month:this.props.i18n.t("Месяц"),week:this.props.i18n.t("Неделя"),day:this.props.i18n.t("День"),today:this.props.i18n.t("Сегодня"),previous:this.props.i18n.t("Назад"),next:this.props.i18n.t("Вперед"),agenda:this.props.i18n.t("calendar|Мероприятия")},views:Object.assign(Object.assign(Object.assign(Object.assign({},this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewMonth})).length>0?{month:!0}:{}),this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewWeek})).length>0?this.weekView.map((function(e){return{week:e}})).getOrUndefined():{}),this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewDay})).length>0?{day:!0}:{}),this.props.control.viewProps.views.filter((function(e){return e instanceof F.CalendarViewAgenda})).length>0?{agenda:!0}:{})})))))}}]),t}(p.Component);wt=mt([y.autobind,bt("design:paramtypes",[Object])],wt);var kt=Object(d.connect)((function(e,t){return{field:t.formId.flatMap((function(n){return Object(W.e)(e,n,t.input.formField)})),value:Object(z.l)(e.dataOutput,t.blockRendererId,t.output).map((function(e){return e.value})).filter((function(e){return e instanceof F.ValueObjectRefs})).map((function(e){return e})),displayValues:Object(z.i)(e.dataOutput,t.blockRendererId,t.display.id),dataInput:Object(x.b)(e.dataInputs,t.display.id),error:Object(z.n)(e.dataOutput,t.blockRendererId,t.display.id),i18n:e.i18n}}),(function(e,t){return{dispatch:e}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataInputs.input===t.dataInputs.input&&e.dataOutput===t.dataOutput&&e.fields.list===t.fields.list},areOwnPropsEqual:function(e,t){return Object(_.h)(e.formId,t.formId)&&e.display===t.display&&e.blockRendererId===t.blockRendererId&&e.blockStyle===t.blockStyle&&e.output===t.output&&e.input===t.input&&e.onChange===t.onChange&&e.onControlBlur===t.onControlBlur},areStatePropsEqual:function(e,t){return Object(_.h)(e.field,t.field)&&Object(_.h)(e.displayValues,t.displayValues)&&Object(_.h)(e.dataInput,t.dataInput)&&Object(_.h)(e.error,t.error)&&e.i18n===t.i18n}})(Object(S.a)(Object(A.a)(wt))),Tt=n(93),Et=n(73),Dt=n(56),It=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),a()(t,[{key:"renderDisplayControl",value:function(){var e=this;return this.props.display.dataInput.map((function(t){return p.createElement(kt,{display:e.props.display,blockRendererId:e.props.blockRendererId,blockId:e.props.blockId,parentRecordId:e.props.parentRecordId,control:e.props.control,input:t,output:e.props.output,formId:e.props.formId,onControlBlur:e.props.onControlBlur,onChange:e.props.onChange,blockStyle:e.props.blockStyle})})).getOrElse((function(){return p.createElement("div",null,e.props.i18n.t("Не задано поле поставщик данных"))}))}},{key:"renderEditControl",value:function(){var e=this;return this.props.display.dataInput.map((function(t){return p.createElement(kt,{display:e.props.display,blockRendererId:e.props.blockRendererId,blockId:e.props.blockId,parentRecordId:e.props.parentRecordId,control:e.props.control,input:t,output:e.props.output,formId:e.props.formId,onControlBlur:e.props.onControlBlur,onChange:e.props.onChange,blockStyle:e.props.blockStyle})})).getOrElse((function(){return p.createElement("div",null,e.props.i18n.t("Не задано поле поставщик данных"))}))}},{key:"renderEditByClickControl",value:function(){return p.createElement(Tt.a,{display:this.props.display,blockRendererId:this.props.blockRendererId,output:this.props.output,displayComponent:this.renderDisplayControl(),editComponent:this.renderEditControl(),onChange:this.props.onChange})}}]),t}(Et.a),Rt=function(e,t){return Object(_.h)(e.formId,t.formId)&&Object(_.h)(e.blockStyle,t.blockStyle)&&e.display===t.display&&e.blockType.tpe.value===t.blockType.tpe.value&&e.blockRendererId===t.blockRendererId&&e.blockStyle===t.blockStyle&&e.output===t.output&&e.onChange===t.onChange&&e.onControlBlur===t.onControlBlur};t.default=Object(d.connect)((function(e,t){return{i18n:e.i18n,initialDictionaries:Object(le.h)(e.blockRendererContext,t.blockRendererId)}}),(function(e){return{dispatch:function(t){return e(t)}}}),(function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}),{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.blockRendererContext===t.blockRendererContext},areOwnPropsEqual:Rt})(Object(Dt.a)([function(e){e.isTokenChecked&&e.formId.foreach((function(t){var n;e.dispatch(he(e.blockRendererId,e.display,e.control,t,(n=e.control).viewProps.dateConstraint.value.filter((function(e){return n.viewProps.dateConstraint.enabled})).matchWith((function(e){return Object(fe.b)(e.tpe.value)(Oe).matchWith((function(t){return t(e,n.timeZoneOffset)}),(function(){throw"unknown date constraint type"}))}),(function(){return{start:Object(ne.a)(Object(oe.a)(pe(new Date,n.timeZoneOffset))),end:Object(re.a)(Object(ie.a)(pe(new Date,n.timeZoneOffset)))}})))),e.dispatch(function(e,t,n,r){return function(o,i){t.dataInput.foreach((function(u){Object(W.b)(i().fields,r,u.formField).filter((function(e){return e.entity.valueType instanceof F.ValueTypeObjectRefs})).map((function(e){return e.entity.valueType})).foreach((function(r){o(Object(J.c)(r.family)).then((function(){n.resourceProps.value.filter((function(e){return n.resourceProps.enabled})).map((function(e){return e.resource})).flatMap((function(e){return Object(W.b)(i().fields,r.family,e).filter((function(e){return e.entity.valueType instanceof F.ValueTypeObjectRefs}))})).foreach((function(n){Object(_.l)(n).map((function(e){return e.entity.valueType})).flatMap((function(e){return Object(se.e)(i().forms,e.family)})).foreach((function(r){F.FormType.isAnyDictionary(r.entity.formType)?o(Object(ce.f)(e,n,t,u)):Object(ue.a)(r.id,new _.b).then((function(e){return o(Object(ae.a)(t,u,r.id,n,e.list,e.list.length,i().i18n.t))})).catch((function(e){return console.error("Failed to resolve input data",e)}))}))}))}))}))}))}}(e.blockRendererId,e.display,e.control,t))}))}],[],[],[],(function(e,t){return!Rt(e,t)&&e.i18n!==t.i18n}))(It))}}]);