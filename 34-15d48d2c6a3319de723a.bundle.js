(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[34],{1459:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return l});var o=n(79),i=n(104),r=n(82),a=function(){return function(e,t){return e(r.default.isA5000?Object(o.Mb)():Object(o.h)())}},l=function(e,t){return function(n,r){return r().eventLine.data.foreach(function(a){Object(i.e)(r().forms,e).foreach(function(i){n(Object(o.H)(a.id,i.entity.formType.getFormTypeId(),e,t))})})}}},1461:function(e,t,n){"use strict";var o=n(6),i=n.n(o),r=n(10),a=n.n(r),l=n(7),c=n.n(l),s=n(8),p=n.n(s),u=n(2),d=n(14),h=n(1469),f=n(1459),m=n(320),g=n(69),v=n(0),E=n(624);t.a=function(e){return Object(d.connect)(function(e){return{auth:e.auth,websocket:e.websocket,routing:e.routing}})(function(e){return function(t){function n(){return i()(this,n),c()(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return p()(n,t),a()(n,[{key:"componentWillMount",value:function(){var e=this;this.props.auth.signedOut||this.props.websocket.active&&(this.props.auth.checking||this.props.auth.checked&&this.props.auth.signedIn||this.props.auth.signingIn||this.props.auth.signedIn||Object(v.toOption)(this.props.routing.location).map(function(t){Object(v.liftKey)(Object(E.a)(t.search),"token").map(function(t){t.map(function(t){e.props.dispatch(Object(h.d)(t)).catch(function(t){e.signOut()})})}).getOrElse(function(){e.props.auth.token.map(function(t){e.props.dispatch(Object(h.d)(t)).catch(function(t){e.signOut()})}).getOrElse(function(){e.signOut()})})}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.auth.signedOut||e.websocket.active&&(e.auth.checking||(e.auth.checked&&e.auth.signedIn||e.auth.signingIn||e.auth.signedIn)&&(!e.websocket.active||this.props.websocket.active)||e.auth.token.map(function(n){e.dispatch(Object(h.d)(n)).catch(function(e){t.signOut()})}).getOrElse(function(){t.signOut()}))}},{key:"signOut",value:function(){this.props.dispatch(Object(g.r)()),this.props.dispatch(Object(m.c)()),this.props.dispatch(Object(f.b)())}},{key:"render",value:function(){return this.props.auth.signedIn&&!this.props.auth.signingIn?u.createElement(e,this.props):u.createElement("div",null)}}]),n}(u.Component)}(e))}},1462:function(e,t,n){"use strict";var o=n(855);Object.defineProperty(t,"__esModule",{value:!0});var i={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=o(n(1464));Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))})},1463:function(e,t,n){"use strict";var o=n(855),i=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(36)),a=i(n(2)),l=(i(n(31)),o(n(1462))),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var n=e.breakpoint,o=void 0===n?"sm":n;return(0,l.default)()(function(e){return a.default.createElement(t,(0,r.default)({fullScreen:(0,l.isWidthDown)(o,e.width)},e))})}};t.default=c},1464:function(e,t,n){"use strict";var o=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isWidthDown=t.isWidthUp=void 0;var i=o(n(36)),r=o(n(39)),a=o(n(73)),l=o(n(74)),c=o(n(76)),s=o(n(77)),p=o(n(78)),u=o(n(2)),d=(o(n(31)),o(n(217))),h=o(n(373)),f=(n(61),o(n(539))),m=o(n(263)),g=n(859),v=o(n(860));t.isWidthUp=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?g.keys.indexOf(e)<g.keys.indexOf(t):g.keys.indexOf(e)<=g.keys.indexOf(t)};t.isWidthDown=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?g.keys.indexOf(t)<g.keys.indexOf(e):g.keys.indexOf(t)<=g.keys.indexOf(e)};var E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var n=e.withTheme,o=void 0!==n&&n,E=e.noSSR,y=void 0!==E&&E,b=e.initialWidth,O=e.resizeInterval,S=void 0===O?166:O,w=function(e){function n(e){var t;return(0,a.default)(this,n),(t=(0,c.default)(this,(0,s.default)(n).call(this,e))).state={width:y?t.getWidth():void 0},"undefined"!=typeof window&&(t.handleResize=(0,h.default)(function(){var e=t.getWidth();e!==t.state.width&&t.setState({width:e})},S)),t}return(0,p.default)(n,e),(0,l.default)(n,[{key:"componentDidMount",value:function(){var e=this.getWidth();e!==this.state.width&&this.setState({width:e})}},{key:"componentWillUnmount",value:function(){this.handleResize.clear()}},{key:"getWidth",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.innerWidth,t=this.props.theme.breakpoints,n=null,o=1;null===n&&o<g.keys.length;){var i=g.keys[o];if(e<t.values[i]){n=g.keys[o-1];break}o+=1}return n=n||"xl"}},{key:"render",value:function(){var e=(0,v.default)({theme:this.props.theme,name:"MuiWithWidth",props:(0,i.default)({},this.props)}),n=e.initialWidth,a=e.theme,l=e.width,c=(0,r.default)(e,["initialWidth","theme","width"]),s=(0,i.default)({width:l||this.state.width||n||b},c);return void 0===s.width?null:(o&&(s.theme=a),u.default.createElement(u.default.Fragment,null,u.default.createElement(t,s),u.default.createElement(d.default,{target:"window",onResize:this.handleResize})))}}]),n}(u.default.Component);return(0,f.default)(w,t),(0,m.default)()(w)}};t.default=E},1465:function(e,t,n){"use strict";var o=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.isHorizontal=O,t.getAnchor=S,t.default=t.styles=void 0;var i=o(n(36)),r=o(n(55)),a=o(n(39)),l=o(n(73)),c=o(n(74)),s=o(n(76)),p=o(n(77)),u=o(n(78)),d=o(n(2)),h=(o(n(31)),o(n(47))),f=o(n(625)),m=o(n(38)),g=o(n(858)),v=o(n(93)),E=n(110),y=n(321),b={left:"right",right:"left",top:"down",bottom:"up"};function O(e){return-1!==["left","right"].indexOf(e.anchor)}function S(e){return"rtl"===e.theme.direction&&O(e)?b[e.anchor]:e.anchor}var w=function(e){return{root:{},docked:{flex:"0 0 auto"},paper:{overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:e.zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:"none"},paperAnchorLeft:{left:0,right:"auto"},paperAnchorRight:{left:"auto",right:0},paperAnchorTop:{top:0,left:0,bottom:"auto",right:0,height:"auto",maxHeight:"100%"},paperAnchorBottom:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"},paperAnchorDockedLeft:{borderRight:"1px solid ".concat(e.palette.divider)},paperAnchorDockedTop:{borderBottom:"1px solid ".concat(e.palette.divider)},paperAnchorDockedRight:{borderLeft:"1px solid ".concat(e.palette.divider)},paperAnchorDockedBottom:{borderTop:"1px solid ".concat(e.palette.divider)},modal:{}}};t.styles=w;var C=function(e){function t(){var e,n;(0,l.default)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=(0,s.default)(this,(e=(0,p.default)(t)).call.apply(e,[this].concat(i)))).mounted=!1,n}return(0,u.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0}},{key:"render",value:function(){var e=this.props,t=(e.anchor,e.BackdropProps),n=e.children,o=e.classes,l=e.className,c=e.elevation,s=e.ModalProps,p=(s=void 0===s?{}:s).BackdropProps,u=(0,a.default)(s,["BackdropProps"]),m=e.onClose,y=e.open,O=e.PaperProps,w=e.SlideProps,C=(e.theme,e.transitionDuration),P=e.variant,x=(0,a.default)(e,["anchor","BackdropProps","children","classes","className","elevation","ModalProps","onClose","open","PaperProps","SlideProps","theme","transitionDuration","variant"]),k=S(this.props),I=d.default.createElement(v.default,(0,i.default)({elevation:"temporary"===P?c:0,square:!0,className:(0,h.default)(o.paper,o["paperAnchor".concat((0,E.capitalize)(k))],(0,r.default)({},o["paperAnchorDocked".concat((0,E.capitalize)(k))],"temporary"!==P))},O),n);if("permanent"===P)return d.default.createElement("div",(0,i.default)({className:(0,h.default)(o.root,o.docked,l)},x),I);var j=d.default.createElement(g.default,(0,i.default)({in:y,direction:b[k],timeout:C,appear:this.mounted},w),I);return"persistent"===P?d.default.createElement("div",(0,i.default)({className:(0,h.default)(o.root,o.docked,l)},x),j):d.default.createElement(f.default,(0,i.default)({BackdropProps:(0,i.default)({},t,p,{transitionDuration:C}),className:(0,h.default)(o.root,o.modal,l),open:y,onClose:m},x,u),j)}}]),t}(d.default.Component);C.defaultProps={anchor:"left",elevation:16,open:!1,transitionDuration:{enter:y.duration.enteringScreen,exit:y.duration.leavingScreen},variant:"temporary"};var P=(0,m.default)(w,{name:"MuiDrawer",flip:!1,withTheme:!0})(C);t.default=P},1473:function(e,t,n){"use strict";var o=n(12);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=o(n(1463))},1474:function(e,t,n){"use strict";var o=n(12);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=o(n(1465))},1476:function(e,t,n){"use strict";var o=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(2)),r=(0,o(n(44)).default)(i.default.createElement(i.default.Fragment,null,i.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),i.default.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})),"ArrowBack");t.default=r},1479:function(e,t,n){"use strict";var o=n(6),i=n.n(o),r=n(10),a=n.n(r),l=n(7),c=n.n(l),s=n(8),p=n.n(s),u=n(2),d=n(52),h=n.n(d),f=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return u.createElement(h.a,{component:"div",style:Object.assign({overflowY:"auto"},this.props.style)},this.props.children)}}]),t}(u.PureComponent);t.a=f},1510:function(e,t,n){"use strict";n.d(t,"e",function(){return p}),n.d(t,"c",function(){return u}),n.d(t,"b",function(){return d}),n.d(t,"f",function(){return h}),n.d(t,"d",function(){return f}),n.d(t,"a",function(){return m});var o=n(6),i=n.n(o),r=n(7),a=n.n(r),l=n(8),c=n.n(l),s=n(18),p=function(e){function t(e){return i()(this,t),a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Request",{id:e}))}return c()(t,e),t}(s.a),u=function(e){function t(e){return i()(this,t),a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Delete",{templateId:e}))}return c()(t,e),t}(s.a),d=function(e){function t(e){return i()(this,t),a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Create",{documentTemplate:e}))}return c()(t,e),t}(s.a),h=function(e){function t(e){return i()(this,t),a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Update",{documentTemplate:e}))}return c()(t,e),t}(s.a),f=function(e){function t(e){return i()(this,t),a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","List",{form:e}))}return c()(t,e),t}(s.a),m=function(e){function t(e){return i()(this,t),a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Document.Templates","Copy",{documentTemplateId:e}))}return c()(t,e),t}(s.a)},1516:function(e,t,n){"use strict";t.a=function(e){for(var t=-1,n=null==e?0:e.length,o={};++t<n;){var i=e[t];o[i[0]]=i[1]}return o}},1590:function(e,t,n){"use strict";var o=n(21),i=n(6),r=n.n(i),a=n(7),l=n.n(a),c=n(8),s=n.n(c),p=n(18),u=function(e){function t(e){return r()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","ListByEventLine",{eventLineId:e}))}return s()(t,e),t}(p.a),d=function(e){function t(e){return r()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Create",{generator:e}))}return s()(t,e),t}(p.a),h=function(e){function t(e){return r()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Update",{generator:e}))}return s()(t,e),t}(p.a),f=function(e){function t(e){return r()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ValuesGenerators","Delete",{generatorId:e}))}return s()(t,e),t}(p.a),m=n(17),g=n(440);n.d(t,"a",function(){return v}),n.d(t,"d",function(){return E}),n.d(t,"b",function(){return y}),n.d(t,"c",function(){return b});var v=function(e){return m.a.send(new d(e),Object(o.c)())},E=function(e){return m.a.send(new h(e),Object(o.f)())},y=function(e){return m.a.send(new f(e),Object(o.d)())},b=function(e){return function(t){return t(Object(g.e)()),m.a.send(new u(e),Object(o.g)()).then(function(e){return t(Object(g.f)(e.list)),e}).catch(function(e){throw t(Object(g.d)(e)),e})}}},1618:function(e,t,n){e.exports=n(97)(40)},1627:function(e,t,n){e.exports=n(97)(363)},1805:function(e,t,n){"use strict";var o=n(2),i=n(94),r=n.n(i);t.a=function(e){return o.createElement(r.a,Object.assign({},e),o.createElement("path",{d:"M14,9H19.5L14,3.5V9M7,2H15L21,8V20A2,2 0 0,1 19,22H7C5.89,22 5,21.1 5,20V4A2,2 0 0,1 7,2M11.93,12.44C12.34,13.34 12.86,14.08 13.46,14.59L13.87,14.91C13,15.07 11.8,15.35 10.53,15.84V15.84L10.42,15.88L10.92,14.84C11.37,13.97 11.7,13.18 11.93,12.44M18.41,16.25C18.59,16.07 18.68,15.84 18.69,15.59C18.72,15.39 18.67,15.2 18.57,15.04C18.28,14.57 17.53,14.35 16.29,14.35L15,14.42L14.13,13.84C13.5,13.32 12.93,12.41 12.53,11.28L12.57,11.14C12.9,9.81 13.21,8.2 12.55,7.54C12.39,7.38 12.17,7.3 11.94,7.3H11.7C11.33,7.3 11,7.69 10.91,8.07C10.54,9.4 10.76,10.13 11.13,11.34V11.35C10.88,12.23 10.56,13.25 10.05,14.28L9.09,16.08L8.2,16.57C7,17.32 6.43,18.16 6.32,18.69C6.28,18.88 6.3,19.05 6.37,19.23L6.4,19.28L6.88,19.59L7.32,19.7C8.13,19.7 9.05,18.75 10.29,16.63L10.47,16.56C11.5,16.23 12.78,16 14.5,15.81C15.53,16.32 16.74,16.55 17.5,16.55C17.94,16.55 18.24,16.44 18.41,16.25M18,15.54L18.09,15.65C18.08,15.75 18.05,15.76 18,15.78H17.96L17.77,15.8C17.31,15.8 16.6,15.61 15.87,15.29C15.96,15.19 16,15.19 16.1,15.19C17.5,15.19 17.9,15.44 18,15.54M8.83,17C8.18,18.19 7.59,18.85 7.14,19C7.19,18.62 7.64,17.96 8.35,17.31L8.83,17M11.85,10.09C11.62,9.19 11.61,8.46 11.78,8.04L11.85,7.92L12,7.97C12.17,8.21 12.19,8.53 12.09,9.07L12.06,9.23L11.9,10.05L11.85,10.09Z"}))}},1970:function(e,t,n){"use strict";var o=n(2),i=n(94),r=n.n(i);t.a=function(e){return o.createElement(r.a,Object.assign({},e),o.createElement("path",{d:"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"}))}},1973:function(e,t,n){"use strict";var o=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(2)),r=(0,o(n(44)).default)(i.default.createElement(i.default.Fragment,null,i.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),i.default.createElement("path",{fillOpacity:".36",d:"M0 20h24v4H0z"}),i.default.createElement("path",{d:"M11 3L5.5 17h2.25l1.12-3h6.25l1.12 3h2.25L13 3h-2zm-1.38 9L12 5.67 14.38 12H9.62z"})),"FormatColorText");t.default=r},2005:function(e,t,n){"use strict";var o=n(2),i=n(94),r=n.n(i);t.a=function(e){return o.createElement(r.a,Object.assign({},e),o.createElement("path",{d:"M2,6H4V18H2V6M5,6H6V18H5V6M7,6H10V18H7V6M11,6H12V18H11V6M14,6H16V18H14V6M17,6H20V18H17V6M21,6H22V18H21V6Z"}))}},2095:function(e,t){},2096:function(e,t){},2097:function(e,t){},2098:function(e,t){},2099:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQgAAAC/CAMAAAA1kLK0AAAAdVBMVEX///8AAADS0tLi4uIlJSVVVVW9vb3q6uo3Nzd1dXWenp7z8/NDQ0PHx8dtbW2xsbFmZmbc3Nz5+fkXFxeEhISVlZVdXV2mpqZISEgyMjLDw8Ps7OyMjIxPT0+bm5uSkpKAgICrq6s9PT0eHh4REREsLCx5eXmb4xQjAAAHIUlEQVR4nO3Y2ZaquhYG4MQGBQQVkaZUbIv3f8Q90yeA1Yw16pybf17UkgCT5EsHizEEAoFAIBAIBAKBQPw/I10/Cla1e3kwW+9Y0TbNesXKNpIFDcU6ZfGmeWypYE8Frbg0Xmf0N3s0zZKxTSPjUcsMTBc8IhatS3ZqG8Yu7YqdKUdHJ08ih0p5NxmYrQNj8/WGMog6iDSbkoqKB9WBiQxU0FOGVl3are/ihlbUoT39GwTnBWv5TB5k/MEKTjFnOd/KAhkpW9LfRMiIQ3HpkguoiI6ejHEdV5mBmYItu/MdW4kbXpQypiLRqpOfUmdgtg6ELW5QdRAhZAtxA5MZOK9EBnVpKSu1V3VY/TvE2kJsvoCopyEWDuIoM3gQWwNx0BDnKYiFuGX9LxALQAACEIAABCAAAQhAAAIQgAAEIAABCEAAAhCAAAQgAAEIQAACEIAABCAAAQhAAAIQgAAEIAABCEAAAhCAAAQgAAEIQAACEIAABCAAAQhAAAIQgAAEIAABCEAAAhCAAAQgAAEIQAACEIAABCAAAQhAAAIQgAAEIAABCEAAAhCAAAQgAAEIQAACEIAABCAAAQhAAAIQgAAEIAABCEAAAhCAAAQgAAEIQAACEIAABCAAAQhAAAIQgAAEIAABCEAAAhCAAAQgAAEIQADiFxAPA7ELIS6y1h7ExUIcHMRVZvAg7lRrCyHaVRqIk0zZmQyMfY4hdrrdFkLJLB3EjTL8BcQ+P7Mi7/v8xJI8kwU9RV6wY9zHH1QwF2fFpcdc3DLL+/hGPdXLiCOZgekCypDliYOoKYfQTUWOVKaMTAbq3Hyuq7TKY8og6iDSxMK/yKkOTGSggo4y5OrSbR79CcSfhIX4s/g1RFLLSE5emQ8xu/bl1p2aHW/99cO7dpUk3sNmdXmzxzp1Xd/dBXUiGx9ARLX3gCK69ufItMZkSPauhYlLN9On1fVZbS8vfg2Rmqm8DwsNxFKdzfQZffgsbFW8k+z+UqdLdWhSq/mu6qonsg8R65VRPnmnb1FEtU3hGr+h5ddEqc8u5VFvr+YDiOv3ECd+6I4U5+kR0dByOPug5s9Mxfr79sy5no60A/gQLRlE0VLtJYydReLuyPnaZm7k6hpAiPWx9VwvdZTIpojDq0iRVJybMaJWTRM3novaX9WIiuTVx64SBgHE5/fTfO4qMQER6a6p1AbIFqo3MrVekzS1+dNBNKpCO/7yki35IR21wkKcFvxZexDVStXKGwJCx3VpJXdbHTv3bC8WoiMCiA114FsC85DNuNBC5Pr+veqh1MwgMwrEbngYVSbzO63xHKgVukUWIiKEbNwZjZleKp2bDCvTBzIuUz1dyd06XCNoEL++HhSZ3JIHYSHWumMKJbA3iU2HCYMxRO1BkINdT0RHF7Y9CmJL/fAxhni5MRA40ILid+1mYt8pFdVgsZw/OL+NW+riQ0zyTRcWWogH70zBnHld3epyUTiCWLklhGrqtzG2dbEQczYFUbrFO+N6WTEV8feBT7Fw50FXR/rW0a5Rfz0o7vy5FhbBNmMhzvwpCzolEBmIjTdRhxAZt/0umddXc3QS744sLdhg+xxB5N6iQG19VXa/PouX68JODsr+5EFXp5yrhWq8fabLrwaF3Cxo3Bz8QgnxJAj6cZmzIlHvtA7i4k3hAQTtYQ+3uebxxu6F1M+52Gd6A8GnIfYvs+2IuMU7/W3BzBT1Brz4k5i2i9iZ0ajfyYMOjri/ek0G5/5LEpvR4/azVH9GiJj9DII2AX4LU58eehMpZMO38nyhnqDEQoh68FLD5Cat1qROvjEs+Ck4fXX3u1UoeIKK7Oltw28i9xckP9Lbky8OvNE1tlPD7Wc+BNVj/KhUMx7lsIo8Qx0BxI0GYTG8otSvIopo4W8c6qnmZ+9vrmEUNOGqUeZh3N4nkMNiZX6okk9v7HoQ1OTXxDvtUw3disdJl+T8kgzWZh+im5zHepWmFiddlxz49egveycHwSdfLERsp/robV0nI7VvNyu3fbrLPYgbH/SVqZ2sQeXegMPzHkQxvZ5FanbNXYbaO7u1CdPpCpDV5SfDwe6907Fwu6EGT/1Z7EG8JsdVxtWcjuT3UMyX9zq8wIOI3I7jx0VVIZWfcfcD77yPMDEgzGPnbxbD+kfDYRU1oXAYD/XfKjIqfhH/lP7zPIhwyU0rWVtyiL3Sr9eILmxJVwuWIubBi5O/RhSzszfC9m8g2u+HQz/8uBvGZfBqSN+S3J8ZHkRhB65c2sSHbSM+qYKXeLVrBOFBXG0KSUqNXCzbYXfaXWOlLt1Yl9kbiM/vh8NOvK/Ub7mKz3DSZJ+jGcrfQbCb/Cp/hoNtO/78idxHWhlCzC7ydxVup/btQPTLo/TWzXcQP1gd0vdrw5sb5vvT91fZi+e/zT+M1f6L/8b6eU0QCAQCgUAgEAgE4n8U/wHyWtwNBTM9nwAAAABJRU5ErkJggg=="},2100:function(e,t,n){e.exports=n.p+"images/qrcode.png"},2616:function(e,t,n){var o=n(2617);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,i);o.locals&&(e.exports=o.locals)},2617:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,'.Anchor__resize {\n  position: absolute;\n  display: block;\n  text-decoration: none; }\n\n.Anchor__resize::before {\n  position: absolute;\n  content: "";\n  background: #3f4652;\n  width: 10px;\n  height: 10px;\n  left: 13px;\n  top: 13px;\n  border: 2px solid #fff;\n  border-radius: 10px;\n  transition: background .15s linear;\n  box-shadow: 0 0 3px 1px rgba(0, 0, 0, 0.15); }\n\n.Anchor__resize:hover:before {\n  background: #00c4cc; }\n\n.Anchor__rotate {\n  position: absolute;\n  display: block;\n  text-decoration: none; }\n\n.Anchor__rotate::before {\n  position: absolute;\n  content: "";\n  background: #fff;\n  left: 11px;\n  top: 12px;\n  width: 16px;\n  height: 16px;\n  border-radius: 16px;\n  box-shadow: 0 0 3px 1px rgba(0, 0, 0, 0.15); }\n\n.Anchor__rotation-icon {\n  position: absolute;\n  width: 14px;\n  height: 14px;\n  left: 12px;\n  top: 14px; }\n',""])},2618:function(e,t,n){var o=n(2619);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,i);o.locals&&(e.exports=o.locals)},2619:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".templateEditorScene__sceneArea {\n  border: 0px; }\n\n.TemplateEditorScene__pixel-ratio {\n  width: 25mm;\n  height: 25mm;\n  position: absolute;\n  top: 0;\n  left: 0;\n  visibility: hidden; }\n",""])},2620:function(e,t,n){var o=n(2621);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,i);o.locals&&(e.exports=o.locals)},2621:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".DocumentTemplate-TextEditor__toolbar {\n  display: flex;\n  align-items: center; }\n\n.DocumentTemplate-TextEditor__textAlignCenter div {\n  text-align: center; }\n\n.DocumentTemplate-TextEditor__textAlignLeft div {\n  text-align: left; }\n\n.DocumentTemplate-TextEditor__textAlignJustify div {\n  text-align: justify; }\n\n.DocumentTemplate-TextEditor__textAlignRight div {\n  text-align: right; }\n",""])},2625:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAU8AAACWCAMAAABpVfqTAAAAe1BMVEX///8AAADY2Njt7e1NTU3j4+O2trbExMR3d3epqand3d3y8vKtra3Ozs6RkZFSUlLS0tI4ODiJiYm+vr4eHh5GRkacnJxgYGAXFxf4+PiDg4Pp6elpaWmWlpZZWVknJyefn589PT0uLi4QEBB7e3tBQUFubm4hISEqKioVx/GGAAAFnklEQVR4nO3aa5OiOBQG4BAFBFEBW20u4r17/v8v3NxzgnZXb9XuzBT1ni9CgAiPIZwEWWSiYIyVcoGZWEcklqZwawvkyof43DMSB1GQ0YK5KEjE5+rLemSsTGFMv14GtwUbs+eCbq1NYSVX3kg9KuQWPi6IzbI7n5kpSMfnk9ALtZHTvQKwnSmsGTzhCU94whOe8IQnPOEJT3jCE57whCc84QlPeMITnvCEJzzhCU94whOe8IQnPOEJT3jCE57whCc84QlPeMITnvCEJzzhCU94whOe8IQnPOEJT3jCE57whCc84QlPeMITnvCEJzzhCU94whOe8IQnPOEJT3jCE57whCc84QlPeMITnvCEJzzhCU94whOe8IQnPOEJT3jCE57whCc84QlPeMITnvCEJzzhCU94whOe8IQnPOEJT3jCE57whCc84QlPeMITnvCEJzzhCU94wnNantnYs6YHW4fga3rxeaTfJy/7TAsu5nvTcT3/0vNh9vygW1tT+Gm10jFf+WPP4HzSH3lmth65pTKFLct1cFlzw8WCPbjjuQtXuOSkIOb6MBcvC5bjw2g9qrAxhcHXBwWx3p13dKs5QZ6rSyX1qODfFTR89NXB+bw8Y3rYM1j+6gQRCAQCgUAgEH80mkRl4KejSwuTQaz3QRp+XLhRTryXA4bobpPwfC13j/ptWG17b/VCea+C/Vl+F6uPjE0zGjeyeNdJ8mww631Dd0rMohuhmDHY0a33tNoPO4bZuO1nvcUOmC9BTj6ZEFSnuiiKkwBVgFcxfiy64iFHvSZmfeD5KIqktwNS4blLikK2cTJpsJe/j1oSnr2o3u0vOK9FnIg2ev09F/ibo4lyvbDTLegoR7syLpHekl/VrIL1zFo9dD0LR/m5XujBf0kH1Vl0uxnPeaab+VHvn1vnejTJMLlY6Qt0LLG5g0t9e1pPO3XCzDyG6xREN2GXxaHnyrg1fn8549S66aVTOKkxueDKs7TNk7FfGqgpOT97TxdrPy+koneegvPO3oynC+0pehd/fMomHKmaw+O+G1z4ebz0B55z295EjzywV54Ds6pf1TmlqJQH8Sx8A9q+uHYyTSkjdQ/weXRqnj1rfaN7z5lsxdOMZdwVOz3Py/1jfeVn9V94Co6NXY67fK2bH5OclbzviWcTd6uFefyQx3oUzf/zK/k7QqWEa9X7LaPoZkrLbz0XeopfhTz8ahL+vZl/J55qPv+g04hNZPOJqXsO+ubeuNcXh+88ReN9uBV5eKXzqMy+Jxl77nR2JDqRz8YuTdWz43x7MK/V5NuiR5qmd/syRsaTZxf0npznx5vqH/1A6pPc75xz0X3+Uo7isfWWpeleDkJ3/+tV/eFoDUVnx4cPn1A+eUZPyc7yJp9nfvQaJK1M9R66g53b8ebEn+/Mjly6s0gl+zW7B+8Zg2sfXuSOmdxn5EnnSHqbX20P79Hho1uRDniS8e79VLvsff828nzFKRMmMRIoEh3b9+i2LWiCWpM6ZP2Jb/7TjPenfxq4CZHQcwgbnok07A+f8nnhuabrw0QnRFzcXKakYk94A8/XnHKfM1l95Ul/rnjEO5Vwr/q3LiPX5TSdoZ7hze4f8lX4xw/j6aqXPeuSbN9M9HZ/2FmzU3BPy6d87tbIWHsI2cqTyeOTKJwvMp77wYguwp9rPtHmKS/s0JbqnYe+3n2f5e3DJ0Tdva1Fcnqo23ujhpkkOpWr1+e8lllQ0PsaT/HUv7ZJ2X5Gpj3GVZ3LBCL8E9l0YnA4B11w1ms3e1OXni8de3L9ZzF9wFOGKj/865GTftjb9LZmEw1eX0TXt3Pv0wqRaO8GjzPLXIhbt8lozOTrvGEnxpCX4yystsh0drnMKrG9cu/fuusp2l3Oo70nFl3wB7TZ8qv9vohl9/2jJaye4d9uCEQQ/wCkc0b9jMQ7NAAAAABJRU5ErkJggg=="},2626:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAADcAQAAAAAzIfIsAAAA5klEQVR4Xt2ZUQrDQAhEB+b+d+0BFiz6qCyF/Lejicv4/BswCVE9x+v34PFTxkG5RlQd+YxQX1lQtxGMMltZ0DQwYrpwOQtK+ui9MT0LerOZMKfnnQXl6VBJjRkVBXH3zjrC+jQ4XJJ2ScHjIJ0mAEOzoAzE6XsiCu4S4AQYV6Lgrqbp00aFQTbSmt7RQg6EjefGcWQUHCWPwmhzyHGQxr4cUlxhEF8+7GhlFhTKhxQFV4LgPk+JljI1DmICprOkpoTBzlaE1hZnQUTL+hoKg/eSWqt7PgvK8PvjDR/C4FM4Cf7X34M3QjJPacLyl9AAAAAASUVORK5CYII="},2627:function(e,t,n){var o=n(2628);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(121)(o,i);o.locals&&(e.exports=o.locals)},2628:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".templateEditorPage {\n  display: flex;\n  flex-direction: column;\n  height: 100%; }\n  .templateEditorPage .templateEditorPage-nav {\n    margin-bottom: 20px;\n    background-color: #fff !important;\n    height: 48px !important;\n    width: 100% !important;\n    flex-shrink: 0; }\n  .templateEditorPage .templateEditorPage__actionsMenu {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    flex-shrink: 0;\n    padding: 10px; }\n  .templateEditorPage .templateEditorPage__viewport {\n    display: flex;\n    height: 100%;\n    overflow: hidden; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__viewport-page-scene {\n      display: flex;\n      flex-direction: row;\n      box-sizing: border-box;\n      flex: 1 1 auto;\n      overflow: hidden; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__viewport-page-list {\n      padding-right: 10px;\n      box-sizing: border-box;\n      flex-shrink: 0; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__viewport-attributes {\n      padding-left: 10px;\n      box-sizing: border-box;\n      display: flex;\n      overflow-x: auto;\n      flex-shrink: 0; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__viewport-paper {\n      overflow: hidden;\n      flex: 1 1 auto;\n      position: relative;\n      height: 100%;\n      display: flex;\n      flex-direction: column; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__viewport-paper-header {\n      background-color: #4285f4 !important;\n      height: 48px !important;\n      flex-shrink: 0; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__viewport-paper-header-title {\n      color: #fff !important;\n      line-height: 48px !important; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__pagesList {\n      padding: 10px 10px 76px; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__attributes {\n      overflow-x: auto;\n      overflow-y: hidden;\n      flex-shrink: 0;\n      padding: 0 8px;\n      position: absolute;\n      z-index: 5;\n      top: 0;\n      left: 0;\n      right: 0;\n      opacity: 0.95; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__scene {\n      display: block; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__navigation {\n      position: absolute;\n      bottom: 20px;\n      left: 0;\n      right: 0;\n      margin: auto;\n      text-align: center; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__bottomButton {\n      margin-right: 8px !important;\n      padding: 0 !important;\n      height: auto !important;\n      width: auto !important;\n      font-size: inherit !important; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__bottomButtonMarginBig {\n      margin-right: 24px !important;\n      padding: 0 !important;\n      height: auto !important;\n      width: auto !important;\n      font-size: inherit !important; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__pageNumberWrapper {\n      box-sizing: border-box;\n      border-radius: 12px;\n      display: inline-block;\n      margin: 10px; }\n    .templateEditorPage .templateEditorPage__viewport .templateEditorPage__pageNumber {\n      border-radius: 12px;\n      box-sizing: border-box;\n      display: inline-block;\n      vertical-align: bottom;\n      background-color: #e0e0e0;\n      height: 40px;\n      min-width: 40px;\n      line-height: 40px;\n      padding: 0 0.5em;\n      text-align: center;\n      margin: 5px; }\n\n.templateEditorPage__navMargin {\n  margin: 5px; }\n",""])},2721:function(e,t,n){"use strict";n.r(t);var o=n(6),i=n.n(o),r=n(10),a=n.n(r),l=n(7),c=n.n(l),s=n(8),p=n.n(s),u=n(11),d=n.n(u),h=n(2),f=n(14),m=n(13),g=n(51),v=n(3),E=n(45),y=n.n(E),b=n(160),O=n.n(b),S=n(25),w=n.n(S),C=n(93),P=n.n(C),x=n(19),k=n.n(x),I=n(218),j=n.n(I),D=n(190),T=n.n(D),M=n(33),A=n.n(M),F=n(52),z=n.n(F),R=n(24),_=n.n(R),V=n(1476),B=n.n(V),N=n(353),L=n.n(N),U=n(492),W=n.n(U),X=n(1772),$=n.n(X),H=n(1773),Y=n.n(H),Q=n(94),G=n.n(Q),K=function(e){return h.createElement(G.a,Object.assign({},e),h.createElement("path",{d:"M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M11,15V12H9V15H6V17H9V20H11V17H14V15H11Z"}))},q=function(e){return h.createElement(G.a,Object.assign({},e),h.createElement("path",{d:"M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M11,15V15H6V17H9V17H14V15H11Z"}))},J=n(1805),Z=n(414),ee=n.n(Z),te=n(1467),ne=n(1970),oe=n(2005),ie=n(543),re=n.n(ie),ae=n(295),le=n.n(ae),ce=n(863),se=n.n(ce),pe=n(35),ue=n(0),de=n(857),he=n.n(de),fe=n(856),me=n.n(fe),ge=n(59),ve=n(72),Ee=n.n(ve),ye=n(86),be=n.n(ye),Oe=n(1),Se=n(216),we=n(415),Ce=n(26),Pe=n.n(Ce),xe=n(29),ke=n(30),Ie=n.n(ke),je=n(54),De=n.n(je),Te=n(32),Me=n.n(Te),Ae=n(34),Fe=n.n(Ae),ze=n(16),Re=n(68),_e=n(270),Ve=n(228),Be=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Ne=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onSourceTypeChanged",value:function(e){this.props.onChange(this.getSource(e.target.value))}},{key:"getSource",value:function(e){switch(e){case Oe.DocumentElementDataSourceFormFieldRef.$Type.value:return new Oe.DocumentElementDataSourceFormFieldRef(new ue.None,new ue.None);case Oe.DocumentElementDataSourceValueTemplate.$Type.value:return new Oe.DocumentElementDataSourceValueTemplate("");case Oe.DocumentElementDataSourceStaticFile.$Type.value:return new Oe.DocumentElementDataSourceStaticFile(new Oe.Id(""));default:throw"unknown data source type"}}},{key:"onFieldChange",value:function(e){this.props.onChange(v(this.props.source,{formId:{$set:Object(ue.toOption)(this.props.formId)},formFieldId:{$set:e}}))}},{key:"onTemplateChanged",value:function(e){var t=Object(ze.convertToRaw)(e.getCurrentContent()),n=Object(_e.a)(t);this.props.onChange(v(this.props.source,{template:{$set:n}}))}},{key:"onFileChanged",value:function(e){this.props.onChange(v(this.props.source,{fileId:{$set:new Oe.Id(e.target.value)}}))}},{key:"render",value:function(){var e=this;return h.createElement("div",null,h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Тип значения")),h.createElement(Ie.a,{fullWidth:!0,value:this.props.source.tpe.value,onChange:this.onSourceTypeChanged},h.createElement(_.a,{value:Oe.DocumentElementDataSourceValueTemplate.$Type.value},h.createElement(De.a,{primary:this.props.i18n.t("Шаблон")})),h.createElement(_.a,{value:Oe.DocumentElementDataSourceFormFieldRef.$Type.value},h.createElement(De.a,{primary:this.props.i18n.t("Поле")})),h.createElement(_.a,{value:Oe.DocumentElementDataSourceStaticFile.$Type.value},h.createElement(De.a,{primary:this.props.i18n.t("Файл")})))),this.props.source instanceof Oe.DocumentElementDataSourceValueTemplate&&h.createElement("div",null,h.createElement(Ve.a,{formId:this.props.formId,generators:this.props.valuesGenerators.list,templateId:this.props.sharedValueId,template:this.props.source.template,onChange:this.onTemplateChanged})),this.props.source instanceof Oe.DocumentElementDataSourceFormFieldRef&&h.createElement("div",null,h.createElement(Re.a,{fullWidth:!0,errorText:new ue.None,fields:Object(xe.e)(this.props.fields,this.props.formId).getOrElse(function(){return[]}),labelText:Object(ue.toOption)("Поле"),value:this.props.source.formFieldId,onChanged:this.onFieldChange,emptyDisabled:!0})),this.props.source instanceof Oe.DocumentElementDataSourceStaticFile&&h.createElement("div",null,h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Файл")),h.createElement(Ie.a,{value:this.props.source.fileId.value,fullWidth:!0,onChange:this.onFileChanged},this.props.templateEditor.images.files.map(function(t){return h.createElement(_.a,{value:t.value,key:t.value},h.createElement(De.a,{primary:Object(ue.headOption)(e.props.fileMetas.list.filter(function(e){return e.id.value===t.value})).map(function(e){return e.entity.originalName}).getOrElse(function(){return e.props.i18n.t("Описание файла не найдено")})}))})))))}}]),t}(h.Component);Ne=Be([m.autobind],Ne);var Le=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor,fileMetas:e.fileMetas,fields:e.fields,valuesGenerators:e.valuesGenerators}})(Ne),Ue=n(161),We=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Xe=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},$e=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=Object(ue.headOption)(n.props.templateEditor.sharedValues.filter(function(e){return e.id===n.props.sharedValueId}));return n.state={value:o},n.props.onSubmit.then(function(){return n.handleSave()}),n}return p()(t,e),a()(t,[{key:"handleSave",value:function(){var e=this;this.state.value.foreach(function(t){return e.props.dispatch(Object(pe.Bc)(t))})}},{key:"handleValueChange",value:function(e){this.setState(v(this.state,{value:{$set:Object(ue.toOption)(e)}}))}},{key:"onSharedValueNameChanged",value:function(e,t){this.handleValueChange(v(e,{name:{$set:t}}))}},{key:"onSharedValueDefaultSourceChanged",value:function(e,t){this.handleValueChange(v(e,{defaultSource:{$set:t}}))}},{key:"onSharedValueTemplateChanged",value:function(e,t,n){this.handleFilterActionUpdate(v(e,{valueSource:{$set:n}}),t)}},{key:"onSharedValueFilterActionFilterChanged",value:function(e,t,n){var o=n.getOrElse(function(){return new Oe.FilterGroupCondition([],new Oe.FilterPredicateAnd)});this.handleFilterActionUpdate(v(e,{filter:{$set:o}}),t)}},{key:"onSharedValueFilterActionAdd",value:function(e){this.handleValueChange(v(e,{filterActions:{$push:[new Oe.FilterAction(ge.v4(),new Oe.FilterGroupCondition([],new Oe.FilterPredicateAnd),new Oe.DocumentElementDataSourceValueTemplate(""))]}}))}},{key:"onSharedValueFilterActionDelete",value:function(e,t){var n=t.filterActions.findIndex(function(t){return t.id===e});this.handleValueChange(v(t,{filterActions:{$splice:[[n,1]]}}))}},{key:"handleFilterActionUpdate",value:function(e,t){var n=t.filterActions.findIndex(function(t){return t.id===e.id});this.handleValueChange(v(t,{filterActions:{$splice:[[n,1,e]]}}))}},{key:"renderFilterActionEditor",value:function(e,t,n,o,i){var r=this,a=new Oe.Id(e.id);return h.createElement("div",null,h.createElement(w.a,{style:{float:"right"},onClick:function(n){n.stopPropagation(),r.onSharedValueFilterActionDelete(e.id,t)}},h.createElement(Ee.a,null)),h.createElement("p",null,this.props.i18n.t("Настройка фильтрации "+(i+1))),h.createElement(Ue.a,{formId:n,filterId:a,value:Object(ue.toOption)(e.filter),onChange:function(n){return r.onSharedValueFilterActionFilterChanged(e,t,n)}}),h.createElement(Le,{formId:n,sharedValueId:t.id,source:e.valueSource,onChange:function(n){return r.onSharedValueTemplateChanged(e,t,n)}}))}},{key:"render",value:function(){var e=this;try{var t=this.props.form.data.getOrElse(function(){throw new Error}),n=Object(xe.e)(this.props.fields,t.id).getOrElse(function(){throw new Error}),o=this.state.value.getOrElse(function(){throw new Error});return h.createElement("div",null,h.createElement(Pe.a,{label:this.props.i18n.t("Название"),fullWidth:!0,value:o.name,onChange:function(t){return e.onSharedValueNameChanged(o,t.target.value)}}),o.filterActions.map(function(i,r){return h.createElement("div",{key:i.id},e.renderFilterActionEditor(i,o,t.id,n,r))}),h.createElement(k.a,{variant:"raised",onClick:function(){return e.onSharedValueFilterActionAdd(o)},style:{marginTop:20}},this.props.i18n.t("Добавить фильтрацию")),h.createElement("p",null,this.props.i18n.t("Значение, если фильтрация не выполняется")),h.createElement(Le,{formId:t.id,sharedValueId:o.id,source:o.defaultSource,onChange:function(t){return e.onSharedValueDefaultSourceChanged(o,t)}}))}catch(e){return h.createElement("div",null,this.props.i18n.t("Произошла ошибка"))}}}]),t}(h.Component);$e=We([m.autobind,Xe("design:paramtypes",[Object])],$e);var He=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor,form:e.currentForm,fields:e.fields,valuesGenerators:e.valuesGenerators}})($e),Ye=n(46),Qe=n(83),Ge=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Ke=(new Oe.Id(ge.v4()),function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"handleAdd",value:function(){var e=this,t=ge.v4();this.props.dispatch(Object(pe.Bc)(new Oe.ConditionalValue(t,"",new Oe.DocumentElementDataSourceValueTemplate(""),[])));var n=new ue.None,o=new Promise(function(e,t){n=Object(ue.toOption)(e)}).then(function(){return e.props.handleDialogClose(i)}),i=this.props.openDialog(this.props.i18n.t("Редактирование"),h.createElement(He,{sharedValueId:t,onSubmit:o}),[h.createElement(k.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(k.a,{variant:"raised",color:"primary",onClick:function(){return n.foreach(function(e){return e()})}},this.props.i18n.t("Сохранить"))])}},{key:"handleEdit",value:function(e){var t=this,n=new ue.None,o=new Promise(function(e,t){n=Object(ue.toOption)(e)}).then(function(){return t.props.handleDialogClose(i)}),i=this.props.openDialog(this.props.i18n.t("Редактирование"),h.createElement(He,{sharedValueId:e,onSubmit:o}),[h.createElement(k.a,{variant:"raised",onClick:function(){return t.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(k.a,{variant:"raised",color:"primary",onClick:function(){return n.foreach(function(e){return e()})}},this.props.i18n.t("Сохранить"))])}},{key:"handleDelete",value:function(e){this.props.dispatch(Object(pe.Cc)(e))}},{key:"render",value:function(){var e=this,t=this.props.templateEditor.sharedValues.filter(function(e){return e.tpe.value===Oe.ConditionalValue.$Type.value});return h.createElement("div",null,h.createElement(Se.b,null,h.createElement(k.a,{variant:"raised",onClick:this.handleAdd,color:"primary"},this.props.i18n.t("Добавить"))),h.createElement(we.a,{showId:!1,error:new ue.None,headers:[{id:"fontName",title:this.props.i18n.t("Название")}],rows:t.map(function(t,n){return{id:t.id,payload:t,fields:[t.name],buttons:[h.createElement(w.a,{key:"edit",style:Ye.f,onClick:function(n){n.stopPropagation(),e.handleEdit(t.id)}},h.createElement(be.a,{style:Ye.g})),h.createElement(w.a,{key:"delete",style:Ye.f,onClick:function(n){n.stopPropagation(),e.handleDelete(t.id)}},h.createElement(Ee.a,{style:Ye.g}))]}})}))}}]),t}(h.Component));Ke=Ge([m.autobind],Ke);var qe=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor}})(Object(Qe.a)(Ke)),Je=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Ze=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},et=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=Object(ue.headOption)(n.props.templateEditor.sharedValues.filter(function(e){return e.id===n.props.sharedValueId}));return n.state={value:o},n.props.onSubmit.then(function(){return n.handleSave()}),n}return p()(t,e),a()(t,[{key:"handleSave",value:function(){var e=this;this.state.value.foreach(function(t){return e.props.dispatch(Object(pe.Bc)(t))})}},{key:"handleValueChange",value:function(e){this.setState(v(this.state,{value:{$set:Object(ue.toOption)(e)}}))}},{key:"onSharedValueNameChanged",value:function(e,t){this.handleValueChange(v(e,{name:{$set:t}}))}},{key:"onSharedValueEditorStateChanged",value:function(e,t){var n=Object(ze.convertToRaw)(t.getCurrentContent()),o=new Oe.ContentState(new ue.Some(JSON.stringify(n))),i=Object(_e.a)(n);this.handleValueChange(v(e,{editorState:{$set:o},template:{$set:i}}))}},{key:"render",value:function(){var e=this;try{var t=this.props.form.data.getOrElse(function(){throw new Error}),n=this.state.value.getOrElse(function(){throw new Error});return h.createElement("div",null,h.createElement(Pe.a,{label:this.props.i18n.t("Название"),fullWidth:!0,value:n.name,onChange:function(t){return e.onSharedValueNameChanged(n,t.target.value)}}),h.createElement(Ve.a,{formId:t.id,generators:this.props.valuesGenerators.list,templateId:n.id,template:n.template,onChange:function(t){return e.onSharedValueEditorStateChanged(n,t)}}))}catch(e){return h.createElement("div",null,this.props.i18n.t("Произошла ошибка"))}}}]),t}(h.Component);et=Je([m.autobind,Ze("design:paramtypes",[Object])],et);var tt=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor,form:e.currentForm,valuesGenerators:e.valuesGenerators}})(et),nt=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},ot=(new Oe.Id(ge.v4()),function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"handleAdd",value:function(){var e=this,t=ge.v4();this.props.dispatch(Object(pe.Bc)(new Oe.StaticValue(t,"","")));var n=new ue.None,o=new Promise(function(e,t){n=Object(ue.toOption)(e)}).then(function(){return e.props.handleDialogClose(i)}),i=this.props.openDialog(this.props.i18n.t("Редактирование"),h.createElement(tt,{sharedValueId:t,onSubmit:o}),[h.createElement(k.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(k.a,{variant:"raised",color:"primary",onClick:function(){return n.foreach(function(e){return e()})}},this.props.i18n.t("Закрыть"))])}},{key:"handleEdit",value:function(e){var t=this,n=new ue.None,o=new Promise(function(e,t){n=Object(ue.toOption)(e)}).then(function(){return t.props.handleDialogClose(i)}),i=this.props.openDialog(this.props.i18n.t("Редактирование"),h.createElement(tt,{sharedValueId:e,onSubmit:o}),[h.createElement(k.a,{variant:"raised",onClick:function(){return t.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(k.a,{variant:"raised",color:"primary",onClick:function(){return n.foreach(function(e){return e()})}},this.props.i18n.t("Сохранить"))])}},{key:"handleDelete",value:function(e){this.props.dispatch(Object(pe.Cc)(e))}},{key:"render",value:function(){var e=this,t=this.props.templateEditor.sharedValues.filter(function(e){return e.tpe.value===Oe.StaticValue.$Type.value});return h.createElement("div",null,h.createElement(Se.b,null,h.createElement(k.a,{variant:"raised",onClick:this.handleAdd,color:"primary"},this.props.i18n.t("Добавить"))),h.createElement(we.a,{showId:!1,error:new ue.None,headers:[{id:"fontName",title:this.props.i18n.t("Название")}],rows:t.map(function(t,n){return{id:t.id,payload:t,fields:[t.name],buttons:[h.createElement(w.a,{key:"edit",style:Ye.f,onClick:function(n){n.stopPropagation(),e.handleEdit(t.id)}},h.createElement(be.a,{style:Ye.g})),h.createElement(w.a,{key:"delete",style:Ye.f,onClick:function(n){n.stopPropagation(),e.handleDelete(t.id)}},h.createElement(Ee.a,{style:Ye.g}))]}})}))}}]),t}(h.Component));ot=nt([m.autobind],ot);var it=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor}})(Object(Qe.a)(ot)),rt=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},at=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},lt=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=Object(ue.headOption)(n.props.templateEditor.sharedValues.filter(function(e){return e.id===n.props.sharedValueId}));return n.state={value:o},n.props.onSubmit.then(function(){return n.handleSave()}),n}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this.state.value.getOrElse(function(){throw new Error});e.script.body||this.onSharedValueScriptChanged(e,'function validate(counter){ \n            var template = ["0", "А", "Б", "В", "Г", "Д", "Е"];\n            return template[counter] || "undefined";\n            };\n            validate(counter);')}},{key:"handleSave",value:function(){var e=this;this.state.value.foreach(function(t){return e.props.dispatch(Object(pe.Bc)(t))})}},{key:"handleValueChange",value:function(e){this.setState(v(this.state,{value:{$set:Object(ue.toOption)(e)}}))}},{key:"onSharedValueNameChanged",value:function(e,t){this.handleValueChange(v(e,{name:{$set:t}}))}},{key:"onSharedValueCalcTypeChanged",value:function(e,t){this.handleValueChange(v(e,{calcType:{$set:this.sharedCalcTypeToClass(t)}}))}},{key:"onSharedValueScriptChanged",value:function(e,t){this.handleValueChange(v(e,{script:{body:{$set:t}}}))}},{key:"sharedCalcTypeToName",value:function(e){switch(e){case Oe.SameDocumentSum.$Type:return this.props.i18n.t("Количество документов текущего типа");case Oe.TotalPrintedSum.$Type:return this.props.i18n.t("Количество печатных документов");case Oe.TotalVirtualSum.$Type:return this.props.i18n.t("Количество виртуальных документов");default:return this.props.i18n.t("Произошла ошибка")}}},{key:"sharedCalcTypeToClass",value:function(e){switch(e){case Oe.SameDocumentSum.$Type.value:return new Oe.SameDocumentSum;case Oe.TotalPrintedSum.$Type.value:return new Oe.TotalPrintedSum;case Oe.TotalVirtualSum.$Type.value:return new Oe.TotalVirtualSum;default:return new Oe.SameDocumentSum}}},{key:"render",value:function(){var e=this;try{var t=this.state.value.getOrElse(function(){throw new Error});return h.createElement("div",null,h.createElement(Pe.a,{label:this.props.i18n.t("Название"),fullWidth:!0,value:t.name,onChange:function(n){return e.onSharedValueNameChanged(t,n.target.value)}}),h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Выбрать тип переменной (counter)")),h.createElement(Ie.a,{value:t.calcType.tpe.value,onChange:function(n){return e.onSharedValueCalcTypeChanged(t,n.target.value)}},Oe.SharedCalcTypes.map(function(t,n){return h.createElement(_.a,{key:n,value:t.tpe.value},e.sharedCalcTypeToName(t.tpe))}))),h.createElement(Pe.a,{label:this.props.i18n.t("Скрипт"),fullWidth:!0,value:t.script.body,onChange:function(n){return e.onSharedValueScriptChanged(t,n.target.value)},multiline:!0,rows:4,rowsMax:10}))}catch(e){return h.createElement("div",null,this.props.i18n.t("Произошла ошибка"))}}}]),t}(h.Component);lt=rt([m.autobind,at("design:paramtypes",[Object])],lt);var ct=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor}})(lt),st=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},pt=(new Oe.Id(ge.v4()),function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"handleAdd",value:function(){var e=this,t=ge.v4();this.props.dispatch(Object(pe.Bc)(new Oe.CalculatedValue(t,"",new Oe.SameDocumentSum,new Oe.TransformScript(""))));var n=new ue.None,o=new Promise(function(e,t){n=Object(ue.toOption)(e)}).then(function(){return e.props.handleDialogClose(i)}),i=this.props.openDialog(this.props.i18n.t("Редактирование"),h.createElement(ct,{sharedValueId:t,onSubmit:o}),[h.createElement(k.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(k.a,{variant:"raised",color:"primary",onClick:function(){return n.foreach(function(e){return e()})}},this.props.i18n.t("Сохранить"))])}},{key:"handleEdit",value:function(e){var t=this,n=new ue.None,o=new Promise(function(e,t){n=Object(ue.toOption)(e)}).then(function(){return t.props.handleDialogClose(i)}),i=this.props.openDialog(this.props.i18n.t("Редактирование"),h.createElement(ct,{sharedValueId:e,onSubmit:o}),[h.createElement(k.a,{variant:"raised",onClick:function(){return t.props.handleDialogClose(i)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(k.a,{variant:"raised",color:"primary",onClick:function(){return n.foreach(function(e){return e()})}},this.props.i18n.t("Сохранить"))])}},{key:"handleDelete",value:function(e){this.props.dispatch(Object(pe.Cc)(e))}},{key:"render",value:function(){var e=this,t=this.props.templateEditor.sharedValues.filter(function(e){return e.tpe.value===Oe.CalculatedValue.$Type.value});return h.createElement("div",null,h.createElement(Se.b,null,h.createElement(k.a,{onClick:this.handleAdd,color:"primary",variant:"raised"},this.props.i18n.t("Добавить"))),h.createElement(we.a,{showId:!1,error:new ue.None,headers:[{id:"fontName",title:this.props.i18n.t("Название")}],rows:t.map(function(t,n){return{id:t.id,payload:t,fields:[t.name],buttons:[h.createElement(w.a,{key:"edit",style:Ye.f,onClick:function(n){n.stopPropagation(),e.handleEdit(t.id)}},h.createElement(be.a,{style:Ye.g})),h.createElement(w.a,{key:"delete",style:Ye.f,onClick:function(n){n.stopPropagation(),e.handleDelete(t.id)}},h.createElement(Ee.a,{style:Ye.g}))]}})}))}}]),t}(h.Component));pt=st([m.autobind],pt);var ut=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor}})(Object(Qe.a)(pt)),dt=n(1479),ht=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},ft=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},mt=0,gt=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={selectedIndex:mt},n}return p()(t,e),a()(t,[{key:"onSelected",value:function(e){this.setState(v(this.state,{selectedIndex:{$set:e}}))}},{key:"renderTabContents",value:function(){switch(this.state.selectedIndex){case mt:return h.createElement(it,null);case 1:return h.createElement(qe,null);case 2:return h.createElement(ut,null);default:return h.createElement("div",null,"unknown content")}}},{key:"render",value:function(){var e=this;return h.createElement("div",null,h.createElement(he.a,{value:this.state.selectedIndex,onChange:function(t,n){return e.onSelected(n)},indicatorColor:"primary",textColor:"primary",fullWidth:!0},h.createElement(me.a,{value:mt,label:this.props.i18n.t("Статичные")}),h.createElement(me.a,{value:1,label:this.props.i18n.t("Условные")}),h.createElement(me.a,{value:2,label:this.props.i18n.t("Скрипт")})),h.createElement(dt.a,null,this.renderTabContents()))}}]),t}(h.Component);gt=ht([m.autobind,ft("design:paramtypes",[Object])],gt);var vt=Object(f.connect)(function(e){return{i18n:e.i18n}})(gt),Et=n(79),yt=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},bt=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ot=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={openMenu:!1,fileInput:new ue.None,settingsPopover:{open:!1,anchorElement:new ue.None}},n}return p()(t,e),a()(t,[{key:"onParagraphSelected",value:function(){var e=this;0!==this.props.fonts.list.length?this.props.dispatch(Object(pe.Gb)(pe.l.Paragaph)):this.props.openDialog(this.props.i18n.t("Ошибка"),h.createElement("div",null,h.createElement("p",null,this.props.i18n.t("Для организации не добавлено ни одного шрифта. Управлять шрифтами вы можете на "),h.createElement("a",{href:"javascript:void(null);",onClick:function(){e.props.dispatch(Object(Et.pb)())}},this.props.i18n.t("странице организациии")))),[h.createElement(k.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(!0)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть"))])}},{key:"onImageSelected",value:function(){this.props.dispatch(Object(pe.Gb)(pe.l.Image))}},{key:"onLineSelected",value:function(){this.props.dispatch(Object(pe.Gb)(pe.l.Line))}},{key:"onRectSelected",value:function(){this.props.dispatch(Object(pe.Gb)(pe.l.Rect))}},{key:"onBarcodeSelected",value:function(){this.props.dispatch(Object(pe.Gb)(pe.l.Barcode))}},{key:"openSettingsPopover",value:function(e){this.state.settingsPopover.open||this.setState(v(this.state,{settingsPopover:{$set:{open:!0,anchorElement:new ue.Some(e.currentTarget)}}}))}},{key:"closeSettingsPopover",value:function(){this.setState(v(this.state,{settingsPopover:{$set:{open:!1,anchorElement:new ue.None}}}))}},{key:"onSharedValuesSetting",value:function(){var e=this;this.closeSettingsPopover(),this.props.openDialog(this.props.i18n.t("Общие текстовые значения"),h.createElement(vt,null),[h.createElement(k.a,{variant:"raised",onClick:function(){return e.props.handleDialogClose(!0)}},this.props.i18n.t("Закрыть"))])}},{key:"render",value:function(){var e=this;return h.createElement(P.a,{className:this.props.className},h.createElement(w.a,{onClick:this.onParagraphSelected},h.createElement(le.a,null,"P")),h.createElement(w.a,{onClick:this.onImageSelected},h.createElement(ne.a,null)),h.createElement(w.a,{onClick:this.onBarcodeSelected},h.createElement(oe.a,null)),h.createElement(w.a,{onClick:this.openSettingsPopover},h.createElement(re.a,null)),this.state.settingsPopover.open&&h.createElement(T.a,{open:this.state.settingsPopover.open,anchorEl:this.state.settingsPopover.anchorElement.getOrElse(function(){throw"popover anchor hasn't been provided"}),anchorOrigin:{horizontal:"right",vertical:"top"},transformOrigin:{horizontal:"left",vertical:"top"},onClose:this.closeSettingsPopover},h.createElement(se.a,null,h.createElement(_.a,{onClick:function(t){t.stopPropagation(),e.onSharedValuesSetting()}},this.props.i18n.t("Общие значения")))))}}]),t}(h.Component);Ot=yt([m.autobind,bt("design:paramtypes",[Object])],Ot);var St=Object(f.connect)(function(e){return{i18n:e.i18n,templateEditor:e.templateEditor,auth:e.auth,eventLine:e.eventLine,organisation:e.organisation,fonts:e.fonts}})(Ot),wt=n(43),Ct=n.n(wt),Pt=n(203),xt=n.n(Pt),kt=n(189),It=n.n(kt),jt=n(1973),Dt=n.n(jt),Tt=n(690),Mt=n.n(Tt),At=n(309),Ft=n.n(At),zt=n(687),Rt=n.n(zt),_t=n(329),Vt=n.n(_t),Bt=n(331),Nt=n.n(Bt),Lt=n(272),Ut=n.n(Lt),Wt=n(330),Xt=n.n(Wt),$t=n(631),Ht=n.n($t),Yt={width:80},Qt=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={value:n.formatString(e.value.toString())},n.newValue=new ue.None,n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState(v(this.state,{value:{$set:this.newValue.map(function(e){return t.newValue=new ue.None,t.formatString(e)}).getOrElse(function(){return t.props.value!==e.value?t.formatString(e.value.toString()):t.state.value})}}))}},{key:"formatString",value:function(e){return Object(ue.lift)(e.split("."),1).map(function(t){return t.length>2?e.slice(0,2-t.length):e}).getOrElse(function(){return e})}},{key:"handleChange",value:function(e){var t=e.trim().replace(",",".");""===t?this.props.onChange(0):this.props.onChange(Number.parseFloat(t)),this.newValue=Object(ue.toOption)(t)}},{key:"render",value:function(){var e=this;return h.createElement(Pe.a,{style:Yt,onChange:function(t){return e.handleChange(t.target.value)},value:this.state.value,label:this.props.label,onFocus:this.props.onFocus,onBlur:this.props.onBlur})}}]),t}(h.Component),Gt={width:80},Kt=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={value:n.formatString((100*e.value).toString())},n.newValue=new ue.None,n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState(v(this.state,{value:{$set:this.newValue.map(function(e){return t.newValue=new ue.None,t.formatString(e)}).getOrElse(function(){return t.props.value!==e.value?t.formatString((100*e.value).toString()):t.state.value})}}))}},{key:"formatString",value:function(e){return Object(ue.lift)(e.split("."),1).map(function(t){return t.length>2?e.slice(0,2-t.length):e}).getOrElse(function(){return e})}},{key:"handleChange",value:function(e){var t=e.trim().replace(",",".");if(""===t)this.props.onChange(0),this.newValue=Object(ue.toOption)(t);else{var n=Number.parseFloat(t)/100;if(void 0!==this.props.minValue&&n<this.props.minValue)this.props.onChange(this.props.minValue),this.newValue=Object(ue.toOption)(this.formatString((100*this.props.minValue).toString()));else{if(void 0!==this.props.maxValue&&n>this.props.maxValue)return this.props.onChange(this.props.maxValue),void(this.newValue=Object(ue.toOption)(this.formatString((100*this.props.maxValue).toString())));this.props.onChange(Number.parseFloat(t)/100),this.newValue=Object(ue.toOption)(t)}}}},{key:"render",value:function(){var e=this;return h.createElement(Pe.a,{style:this.props.style||Gt,onChange:function(t){return e.handleChange(t.target.value)},value:this.state.value,label:this.props.label,onFocus:this.props.onFocus,onBlur:this.props.onBlur})}}]),t}(h.Component),qt=n(99),Jt=n(139),Zt=n(542),en=n.n(Zt),tn=n(433),nn=n(153),on=n(872),rn=n.n(on),an=n(873),ln=n.n(an),cn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},sn=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onFormFieldSelected",value:function(e){this.props.onFormFieldSelected(this.props.formId,Object(ue.toOption)(new Oe.Id(e.target.value)))}},{key:"getFormFields",value:function(){var e=this;return this.props.formId.flatMap(function(t){return Object(xe.e)(e.props.fields,t)})}},{key:"render",value:function(){return h.createElement("div",{style:this.props.style},h.createElement(Me.a,{style:{width:"200px"}},h.createElement(Fe.a,{shrink:!0},this.props.i18n.t("Поле")),h.createElement(Ie.a,{native:!0,onChange:this.onFormFieldSelected,value:this.props.selectedField.map(function(e){return e.value}).getOrElse(function(){return"!noFormField"})},h.createElement("option",{value:"!noFormField"}),this.getFormFields().getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===Oe.ValueTypeFileList.$Type.value}).map(function(e){return h.createElement("option",{value:e.id.value,key:e.id.value},e.entity.caption)}))))}}]),t}(h.Component);sn=cn([m.autobind],sn);var pn=Object(f.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(sn),un=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},dn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},hn=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={childFormId:n.props.childFormId,childRefId:n.props.childRefId,displayFieldId:n.props.displayFieldId},n}return p()(t,e),a()(t,[{key:"onFormFieldSelected",value:function(e){this.setState(v(this.state,{childRefId:{$set:Object(ue.toOption)(new Oe.Id(e.target.value))}}))}},{key:"onRefFormFieldSelected",value:function(e,t){var n=this;this.setState(v(this.state,{displayFieldId:{$set:Object(ue.toOption)(new Oe.Id(e.target.value))}}),function(){return n.state.childRefId.foreach(function(e){return n.state.displayFieldId.foreach(function(o){return n.props.onRefFormFieldSelected(t,e,o)})})})}},{key:"getFormFields",value:function(){var e=this;return this.props.formId.flatMap(function(t){return Object(xe.e)(e.props.fields,t)})}},{key:"getSelectedField",value:function(){var e=this;return this.state.childRefId.flatMap(function(t){return Object(ue.headOption)(e.getFormFields().getOrElse(function(){return[]}).filter(function(e){return e.id.value===t.value}))})}},{key:"render",value:function(){var e=this;return h.createElement("div",{style:this.props.style},h.createElement(Me.a,{style:{width:"200px"}},h.createElement(Fe.a,{shrink:!0},this.props.i18n.t("Поле")),h.createElement(Ie.a,{native:!0,onChange:this.onFormFieldSelected,value:this.state.childRefId.map(function(e){return e.value}).getOrElse(function(){return"!noFormField"})},h.createElement("option",{value:"!noFormField"}),this.getFormFields().getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===Oe.ValueTypeObjectRefs.$Type.value}).map(function(e){return h.createElement("option",{value:e.id.value,key:e.id.value},e.entity.caption)}))),this.getSelectedField().map(function(t){return t.entity.valueType.tpe.value===Oe.ValueTypeObjectRefs.$Type.value&&h.createElement(Me.a,{style:{width:"200px"}},h.createElement(Fe.a,{shrink:!0},e.props.i18n.t("Поле дочерней формы")),h.createElement(Ie.a,{native:!0,onChange:function(n){return e.onRefFormFieldSelected(n,t.entity.valueType.family)},value:e.state.displayFieldId.map(function(e){return e.value}).getOrElse(function(){return"!noFormField"})},h.createElement("option",{value:"!noFormField"}),Object(xe.e)(e.props.fields,t.entity.valueType.family).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tpe.value===Oe.ValueTypeFileList.$Type.value}).map(function(e){return h.createElement("option",{value:e.id.value,key:e.id.value},e.entity.caption)})))}).getOrNull())}}]),t}(h.Component);hn=un([m.autobind,dn("design:paramtypes",[Object])],hn);var fn=Object(f.connect)(function(e){return{i18n:e.i18n,fields:e.fields}})(hn),mn=n(113),gn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},vn=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},En=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={menuAnchorEl:new ue.None,menuType:new ue.None,fileInput:new ue.None,fileMetaId:new ue.None},n}return p()(t,e),a()(t,[{key:"onAbscissaChanged",value:function(e){this.props.dispatch(Object(pe.Fb)(e))}},{key:"onOrdinateChanged",value:function(e){this.props.dispatch(Object(pe.cc)(e))}},{key:"onRotationChanged",value:function(e){this.props.dispatch(Object(pe.dc)(e))}},{key:"onWidthChanged",value:function(e){var t=this;this.props.dispatch(Object(pe.fc)(e)),this.getActiveElement().map(function(n){if(n.size.aspectRatio){var o=n.size.width/n.size.height;t.onHeightChanged(e/o)}})}},{key:"onHeightChanged",value:function(e){var t=this;this.props.dispatch(Object(pe.Wb)(e)),this.getActiveElement().map(function(n){if(n.size.aspectRatio){var o=n.size.width/n.size.height;t.onWidthChanged(e*o)}})}},{key:"onAspectRatioChanged",value:function(e){this.props.dispatch(Object(pe.Hb)(e.target.checked))}},{key:"onPageWidthChanged",value:function(e){this.props.dispatch(Object(pe.nc)(e))}},{key:"onPageHeightChanged",value:function(e){this.props.dispatch(Object(pe.mc)(e))}},{key:"onImageSourceTypeChanged",value:function(e){var t=e.target.value;t&&this.props.dispatch(Object(pe.Zb)(new ue.TypeId(t)))}},{key:"onBarcodeGeneratorChanged",value:function(e){var t=e.target.value;t&&this.props.dispatch(Object(pe.Kb)(new ue.TypeId(t)))}},{key:"onBarcodeProviderTypeChanged",value:function(e){var t=e.target.value;t&&this.props.dispatch(Object(pe.Mb)(new ue.TypeId(t)))}},{key:"onBarcodeProviderChanged",value:function(e){this.props.dispatch(Object(pe.Lb)(e))}},{key:"onFormFieldImageDataSourceChanged",value:function(e,t){this.props.dispatch(Object(pe.Yb)(new Oe.DocumentElementDataSourceFormFieldRef(e,t)))}},{key:"onRefFormFieldImageDataSourceChanged",value:function(e,t,n){this.props.dispatch(Object(pe.Yb)(new Oe.DocumentElementDataSourceChildField(e,t,n)))}},{key:"onElementLevelChanged",value:function(e){this.props.dispatch(Object(pe.ac)(e.target.value))}},{key:"onElementMaxLinesChanged",value:function(e){var t=parseInt(e.target.value);isNaN(t)||this.props.dispatch(Object(pe.Vb)(t))}},{key:"onElementLineSpacingChanged",value:function(e){var t=parseFloat(e.target.value);isNaN(t)||this.props.dispatch(Object(pe.Ub)(t))}},{key:"onElementImageFileChanged",value:function(e){this.props.dispatch(Object(pe.Yb)(new Oe.DocumentElementDataSourceStaticFile(new Oe.Id(e.target.value))))}},{key:"onElementImageSourceChanged",value:function(e){this.props.dispatch(Object(pe.Yb)(new Oe.DocumentElementDataSourceSharedValue(e.target.value)))}},{key:"onParagraphFontFamilyChange",value:function(e){var t=this;Object(ue.headOption)(this.props.fonts.list.filter(function(t){return t.name===e})).foreach(function(e){return t.onParagraphFontStyleChange(Object(ue.head)(e.fonts).getName())})}},{key:"onParagraphFontStyleChange",value:function(e){var t=this.removeCustomInlineStyle("fontfamily"),n="fontfamily-"+e,o=this.toggleCustomInlineStyle(n,t);this.handleTextEditorStateChange(o)}},{key:"onFontSizeChange",value:function(e){var t=this.removeCustomInlineStyle("fontsize"),n="fontsize-"+e,o=this.toggleCustomInlineStyle(n,t);this.handleTextEditorStateChange(o)}},{key:"removeCustomInlineStyle",value:function(e){var t=this.props.templateEditor.textEditorState.editorState.getOrElse(function(){throw new Error("editorState isn't initialized")}),n=t.getSelection(),o=t.getCurrentInlineStyle();if(n.isCollapsed())return ze.EditorState.setInlineStyleOverride(t,o.remove(o.find(function(t){return"string"==typeof t&&t.indexOf(e.slice(0,e.indexOf("-")))>=0})));var i=ze.Modifier.removeInlineStyle(t.getCurrentContent(),n,o.find(function(t){return"string"==typeof t&&t.indexOf(e.slice(0,e.indexOf("-")))>=0}));return ze.EditorState.push(t,i,"change-inline-style")}},{key:"toggleCustomInlineStyle",value:function(e,t){var n=t||this.props.templateEditor.textEditorState.editorState.getOrElse(function(){throw new Error("editorState isn't initialized")});return ze.RichUtils.toggleInlineStyle(n,e)}},{key:"toggleTextEffect",value:function(e){var t=this.removeCustomInlineStyle("texttransform");this.handleTextEditorStateChange(this.toggleCustomInlineStyle(e,t))}},{key:"onColorPopoverOpen",value:function(e){this.props.dispatch(Object(pe.Fc)(e.currentTarget))}},{key:"onUppercaseClick",value:function(){this.toggleTextEffect("texttransform-uppercase")}},{key:"onLowercaseClick",value:function(){this.toggleTextEffect("texttransform-lowercase")}},{key:"onCapitalizeClick",value:function(){this.toggleTextEffect("texttransform-capitalize")}},{key:"onFormatAlignCenterClick",value:function(){this.handleTextEditorStateChange(this.setBlockData({"text-align":"center"}))}},{key:"onFormatAlignJustifyClick",value:function(){this.handleTextEditorStateChange(this.setBlockData({"text-align":"justify"}))}},{key:"onFormatAlignLeftClick",value:function(){this.handleTextEditorStateChange(this.setBlockData({"text-align":"left"}))}},{key:"onFormatAlignRightClick",value:function(){this.handleTextEditorStateChange(this.setBlockData({"text-align":"right"}))}},{key:"setBlockData",value:function(e){return this.props.templateEditor.textEditorState.editorState.map(function(t){var n=t.getCurrentContent(),o=t.getSelection(),i=ze.Modifier.setBlockData(n,o,e);return ze.EditorState.push(t,i,"change-block-data")}).getOrElse(function(){throw new Error("editorState hasn't initialized")})}},{key:"onFormatUnderlinedClick",value:function(){var e=this;this.props.templateEditor.textEditorState.editorState.map(function(t){e.handleTextEditorStateChange(ze.RichUtils.toggleInlineStyle(t,"UNDERLINE"))})}},{key:"onFormatStrikethroughClick",value:function(){var e=this;this.props.templateEditor.textEditorState.editorState.map(function(t){e.handleTextEditorStateChange(ze.RichUtils.toggleInlineStyle(t,"STRIKETHROUGH"))})}},{key:"openAddDataSourcePopover",value:function(e){this.props.templateEditor.textEditorState.addDataSourcePopover.open||this.props.dispatch(Object(pe.Kc)(e.currentTarget))}},{key:"handleTextEditorStateChange",value:function(e){this.props.dispatch(Object(pe.Pc)(e))}},{key:"handleCropTopChanged",value:function(e){this.props.dispatch(Object(pe.Sb)(e))}},{key:"handleCropRightChanged",value:function(e){this.props.dispatch(Object(pe.Rb)(e))}},{key:"handleCropBottomChanged",value:function(e){this.props.dispatch(Object(pe.Pb)(e))}},{key:"handleCropLeftChanged",value:function(e){this.props.dispatch(Object(pe.Qb)(e))}},{key:"handleBrightnessChanged",value:function(e){this.props.dispatch(Object(pe.Ob)(e))}},{key:"handleOpacityChanged",value:function(e){this.props.dispatch(Object(pe.bc)(e))}},{key:"onFileSelected",value:function(e){var t=this;e.forEach(function(e){return t.setState({fileMetaId:Object(ue.toOption)(e)})})}},{key:"onFileInserted",value:function(){var e=this;this.state.fileMetaId.map(function(t){var n=new Oe.Id(t);e.props.dispatch(Object(pe.gc)(n)),Object(qt.b)(n).then(function(t){e.props.dispatch(Object(Jt.e)([t.record]))}).catch(function(e){console.log("File fetched with error",e)})})}},{key:"handleAddFile",value:function(){var e=this,t=this.props.openDialog(this.props.i18n.t("Выбор файла"),this.props.organisation.organisationId.map(function(t){return h.createElement(tn.a,{organisationId:t,excludedFolders:[].concat(Ct()(Oe.FileTypes.map(function(e){return Object(nn.b)(e.$Type.value)}))),initialFolder:Object(ue.toOption)("free"),onSelectionChange:e.onFileSelected,acceptedFiles:new ue.None,elementId:new ue.None})}).getOrElse(function(){return h.createElement("div",null,e.props.i18n.t("Организация не найдена"))}),[h.createElement(en.a,{variant:"raised",onClick:function(n){return e.props.handleDialogClose(t)},style:{marginRight:"10px"}},this.props.i18n.t("Закрыть")),h.createElement(en.a,{variant:"raised",onClick:function(){e.onFileInserted(),e.props.handleDialogClose(t)},color:"primary"},this.props.i18n.t("Вставить"))])}},{key:"fileInputHandler",value:function(e){this.setState(v(this.state,{fileInput:{$set:Object(ue.toOption)(e)}}))}},{key:"getParagraphFontStyleName",value:function(){return this.props.templateEditor.textEditorState.editorState.flatMap(function(e){try{var t=e.getCurrentInlineStyle();return Object(ue.toOption)(t.find(function(e){return"string"==typeof e&&e.indexOf("fontfamily")>=0})).flatMap(function(e){return Object(ue.toOption)(e.slice("fontfamily-".length))})}catch(e){return Object(ue.toOption)("")}})}},{key:"getFontSize",value:function(){return this.props.templateEditor.textEditorState.editorState.flatMap(function(e){try{var t=e.getCurrentInlineStyle();return Object(ue.toOption)(t.find(function(e){return"string"==typeof e&&e.indexOf("fontsize")>=0})).map(function(e){return e.slice("fontsize-".length)})}catch(e){return Object(ue.toOption)("")}})}},{key:"getActiveElement",value:function(){var e=this.props.templateEditor,t=e.activeElementId,n=e.pages,o=e.activePageIndex;return t.zip(o).flatMap(function(e){var t=e._2,o=e._1.value;return Object(ue.headOption)(n[t].elements.filter(function(e){return e.ownId.value===o}))})}},{key:"renderOpacitySettings",value:function(e){return h.createElement(Kt,{style:{width:135},label:this.props.i18n.t("Прозрачность")+" (%)",value:e.opacity.level.getOrElse(function(){return 0}),minValue:0,maxValue:1,onChange:this.handleOpacityChanged,onBlur:this.props.onInputBlur,onFocus:this.props.onInputFocus})}},{key:"handleBarcodeColorChange",value:function(e){this.props.dispatch(Object(pe.Jb)(new Oe.ElementColor(e.r,e.g,e.b,e.a)))}},{key:"handleBarcodeBgColorChange",value:function(e){this.props.dispatch(Object(pe.Ib)(new Oe.ElementColor(e.r,e.g,e.b,e.a)))}},{key:"handleBarcodeScalingChange",value:function(e,t){this.props.dispatch(Object(pe.Nb)(t))}},{key:"onColorPickerOpen",value:function(){this.props.onInputFocus()}},{key:"onColorPickerClose",value:function(){this.props.onInputBlur()}},{key:"renderBarcodeColorSettings",value:function(e){var t=e.display.config.map(function(e){return e.displayParams}).getOrElse(function(){return new Oe.BarcodeDisplayParams}),n=t.fgColor,o=t.bgColor;return h.createElement(h.Fragment,null,h.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginRight:15}},h.createElement(z.a,{variant:"caption"},this.props.i18n.t("Цвет баркода")),h.createElement(mn.a,{rgbOutput:!0,value:"rgba("+n.r+", "+n.g+", "+n.b+", "+n.a+")",onChange:this.handleBarcodeColorChange,onPickerOpen:this.onColorPickerOpen,onPickerClose:this.onColorPickerClose})),h.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},h.createElement(z.a,{variant:"caption"},this.props.i18n.t("Цвет фона баркода")),h.createElement(mn.a,{rgbOutput:!0,value:"rgba("+o.r+", "+o.g+", "+o.b+", "+o.a+")",onChange:this.handleBarcodeBgColorChange,onPickerOpen:this.onColorPickerOpen,onPickerClose:this.onColorPickerClose})),h.createElement(rn.a,{style:{marginLeft:5},label:this.props.i18n.t("Масштабировать"),control:h.createElement(ln.a,{checked:t.scaling,onChange:this.handleBarcodeScalingChange})}))}},{key:"render",value:function(){var e=this,t=this.props.templateEditor,n=t.activeElementId,o=t.pages,i=t.activePageIndex;return n.zip(i).flatMap(function(t){var n=t._2,i=t._1.value;return Object(ue.headOption)(o[n].elements.filter(function(e){return e.ownId.value===i})).map(function(t){return h.createElement(P.a,{className:e.props.className,style:{padding:15}},h.createElement("div",{style:{display:"flex"}},h.createElement("div",{style:{display:"flex",flexDirection:"column"}},h.createElement("div",null,h.createElement(Qt,{onChange:e.onWidthChanged,value:t.size.width,label:e.props.i18n.t("Ширина"),onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus}),h.createElement(Qt,{onChange:e.onHeightChanged,value:t.size.height,label:e.props.i18n.t("Высота"),onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),h.createElement("div",null,h.createElement(rn.a,{label:e.props.i18n.t("Сохранять пропорции"),control:h.createElement(ln.a,{style:Object.assign({},Ye.f,{paddingLeft:7}),checked:t.size.aspectRatio,onChange:e.onAspectRatioChanged})}))),t.position instanceof Oe.ElementPositionAbsolutePosition&&h.createElement("div",{style:{display:"flex"}},h.createElement("div",null,h.createElement(Qt,{onChange:e.onAbscissaChanged,value:t.position.x,label:e.props.i18n.t("X"),onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),h.createElement("div",null,h.createElement(Qt,{onChange:e.onOrdinateChanged,value:t.position.y,label:e.props.i18n.t("Y"),onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),h.createElement("div",null,h.createElement(Qt,{onChange:e.onRotationChanged,value:t.rotation,label:e.props.i18n.t("Поворот"),onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus}))),h.createElement("div",null,h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,{htmlFor:"level-attribute-select"},e.props.i18n.t("Уровень")),h.createElement(Ie.a,{value:e.props.templateEditor.pages[n].elements.indexOf(t).toString(),onChange:e.onElementLevelChanged,style:{width:60},inputProps:{id:"level-attribute-select"}},e.props.templateEditor.pages[n].elements.map(function(e,t){return h.createElement(_.a,{key:e.ownId.value.toString(),value:t},t.toString())})))),t.display instanceof Oe.DocumentElementDisplayParagraph&&h.createElement("div",null,h.createElement(Pe.a,{type:"number",style:{width:100,minWidth:100},label:e.props.i18n.t("Max строк"),value:t.display.maxLines,onChange:e.onElementMaxLinesChanged,onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus}),h.createElement(Pe.a,{style:{width:200,minWidth:200},label:e.props.i18n.t("Межстрочный интервал"),value:t.display.lineSpacing.getOrElse(function(){return 1.2}),onChange:e.onElementLineSpacingChanged,onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),(t.display instanceof Oe.DocumentElementDisplayImage||t.display instanceof Oe.DocumentElementDisplayBarcode)&&e.renderOpacitySettings(t),t.display instanceof Oe.DocumentElementDisplayBarcode&&e.renderBarcodeColorSettings(t),t.display instanceof Oe.DocumentElementDisplayImage&&h.createElement("div",{style:{display:"flex"}},h.createElement("div",null,h.createElement(Kt,{label:e.props.i18n.t("Яркость")+" (%)",style:{width:100},value:t.brightness.level,minValue:0,maxValue:2,onChange:e.handleBrightnessChanged,onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),h.createElement("span",{style:{marginRight:8,marginTop:37,fontSize:14}},e.props.i18n.t("Обрезка"),":"),h.createElement("div",null,h.createElement(Qt,{label:e.props.i18n.t("Сверху"),value:t.crop.top,onChange:e.handleCropTopChanged,onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),h.createElement("div",null,h.createElement(Qt,{label:e.props.i18n.t("Справа"),value:t.crop.right,onChange:e.handleCropRightChanged,onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),h.createElement("div",null,h.createElement(Qt,{label:e.props.i18n.t("Снизу"),value:t.crop.bottom,onChange:e.handleCropBottomChanged,onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})),h.createElement("div",null,h.createElement(Qt,{label:e.props.i18n.t("Слева"),value:t.crop.left,onChange:e.handleCropLeftChanged,onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus})))),t.display instanceof Oe.DocumentElementDisplayParagraph&&e.createParagraphAttributesTab(t,t.display),t.display instanceof Oe.DocumentElementDisplayImage&&e.createImageAttributesTab(t,t.display),t.display instanceof Oe.DocumentElementDisplayBarcode&&e.createBarcodeAttributesTab(t,t.display))})}).getOrElse(function(){return e.props.templateEditor.activePageIndex.flatMap(function(t){return Object(ue.toOption)(e.props.templateEditor.pages[t]).map(function(t){return h.createElement(P.a,{className:e.props.className},h.createElement(Qt,{onChange:e.onPageWidthChanged,value:t.pageSize.width,label:e.props.i18n.t("Ширина"),onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus}),h.createElement(Qt,{onChange:e.onPageHeightChanged,value:t.pageSize.height,label:e.props.i18n.t("Высота"),onBlur:e.props.onInputBlur,onFocus:e.props.onInputFocus}))})}).getOrElse(function(){return h.createElement("div",null)})})}},{key:"onMenuOpen",value:function(e,t){this.setState({menuType:new ue.Some(e),menuAnchorEl:new ue.Some(t)})}},{key:"onMenuClosed",value:function(){this.setState({menuType:new ue.None,menuAnchorEl:new ue.None})}},{key:"createParagraphAttributesTab",value:function(e,t){var n=this,o=this.getParagraphFontStyleName(),i=o.flatMap(function(e){return Oe.ElementFont.getFontFamily(n.props.fonts.list,e)});return h.createElement("div",{style:{display:"flex",alignItems:"center"}},this.props.templateEditor.sceneState.doubleClicked&&h.createElement("div",{style:{display:"flex",alignItems:"center",marginRight:16}},h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Шрифт")),h.createElement(Ie.a,{value:i.map(function(e){return e.name}).getOrElse(function(){return""}),onChange:function(e){return n.onParagraphFontFamilyChange(e.target.value)}},this.props.fonts.list.map(function(e,t){return h.createElement(_.a,{value:e.name,key:t},e.name)}))),h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Стиль")),h.createElement(Ie.a,{value:o.getOrElse(function(){return""}),onChange:function(e){return n.onParagraphFontStyleChange(e.target.value)}},i.flatMap(function(e){return Object(ue.headOption)(n.props.fonts.list.filter(function(t){return t.name===e.name})).map(function(t){return t.fonts.map(function(t){return h.createElement(_.a,{value:t.getName(),key:t.getName()},Oe.ElementFont.handleFontStyleName(e.name,t.getName(),n.props.i18n.t("Regular")))})})}).getOrNull())),h.createElement(Pe.a,{style:{width:"80px"},value:this.getFontSize().getOrElse(function(){return""}),onChange:function(e){return n.onFontSizeChange(e.target.value)},label:this.props.i18n.t("Размер"),onBlur:this.props.onInputBlur,onFocus:this.props.onInputFocus}),h.createElement(w.a,{onClick:function(e){return n.onMenuOpen("align",Object(g.findDOMNode)(e.currentTarget))}},h.createElement(Ut.a,null)),h.createElement(xt.a,{open:this.state.menuAnchorEl.nonEmpty()&&this.state.menuType.contains("align"),anchorEl:this.state.menuAnchorEl.getOrUndefined(),anchorOrigin:{horizontal:"left",vertical:"top"},transformOrigin:{horizontal:"left",vertical:"top"},onClose:this.onMenuClosed},h.createElement(_.a,{onClick:this.onFormatAlignJustifyClick},h.createElement(It.a,null,h.createElement(Nt.a,null))),h.createElement(_.a,{onClick:this.onFormatAlignLeftClick},h.createElement(It.a,null,h.createElement(Ut.a,null))),h.createElement(_.a,{onClick:this.onFormatAlignCenterClick},h.createElement(It.a,null,h.createElement(Vt.a,null))),h.createElement(_.a,{onClick:this.onFormatAlignRightClick},h.createElement(It.a,null,h.createElement(Xt.a,null)))),h.createElement(w.a,{onClick:function(e){return n.onMenuOpen("underlined",Object(g.findDOMNode)(e.currentTarget))}},h.createElement(Ft.a,null)),h.createElement(xt.a,{open:this.state.menuAnchorEl.nonEmpty()&&this.state.menuType.contains("underlined"),anchorEl:this.state.menuAnchorEl.getOrUndefined(),onClose:this.onMenuClosed,anchorOrigin:{horizontal:"left",vertical:"top"},transformOrigin:{horizontal:"left",vertical:"top"}},h.createElement(_.a,{onClick:this.onFormatStrikethroughClick},h.createElement(It.a,null,h.createElement(Rt.a,null))),h.createElement(_.a,{onClick:this.onFormatUnderlinedClick},h.createElement(It.a,null,h.createElement(Rt.a,null)))),h.createElement(w.a,{onClick:function(e){return n.onMenuOpen("capitalisation",Object(g.findDOMNode)(e.currentTarget))}},h.createElement(le.a,null,h.createElement("div",{style:{fontSize:20}},"TT"))),h.createElement(xt.a,{open:this.state.menuAnchorEl.nonEmpty()&&this.state.menuType.contains("capitalisation"),onClose:this.onMenuClosed,anchorEl:this.state.menuAnchorEl.getOrUndefined(),anchorOrigin:{horizontal:"left",vertical:"top"},transformOrigin:{horizontal:"left",vertical:"top"}},h.createElement(_.a,{onClick:this.onUppercaseClick},h.createElement(It.a,null,h.createElement(le.a,null,"TT"))),h.createElement(_.a,{onClick:this.onLowercaseClick},h.createElement(It.a,null,h.createElement(le.a,null,"tt"))),h.createElement(_.a,{onClick:this.onCapitalizeClick},h.createElement(It.a,null,h.createElement(le.a,null,"Tt"))),h.createElement(_.a,{onClick:this.onFormatUnderlinedClick},h.createElement(It.a,null,h.createElement(Ft.a,null)))),h.createElement(w.a,{onClick:this.onColorPopoverOpen},h.createElement(Dt.a,{style:{color:this.props.templateEditor.textEditorState.colorPopover.color.getOrElse(function(){return"#000"})}})),h.createElement(w.a,{onClick:this.openAddDataSourcePopover},h.createElement(Mt.a,null))))}},{key:"getImageSource",value:function(e){return this.props.templateEditor.imageSourceType.getOrElse(function(){return e.source.tpe})}},{key:"createImageAttributesTab",value:function(e,t){var n=this;return h.createElement("div",{style:{display:"flex"}},h.createElement(Me.a,{fullWidth:!0,style:{width:200}},h.createElement(Fe.a,null,this.props.i18n.t("Поставщик данных")),h.createElement(Ie.a,{value:this.props.templateEditor.imageSourceType.map(function(e){return e.value}).getOrElse(function(){return t.source.tpe.value}),onChange:this.onImageSourceTypeChanged},Oe.DocumentElementImageDataSourceTypes.map(function(e){return h.createElement(_.a,{value:e.value,key:e.value},function(){switch(e){case Oe.DocumentElementDataSourceFormFieldRef.$Type:return n.props.i18n.t("Фото формы");case Oe.DocumentElementDataSourceChildField.$Type:return n.props.i18n.t("Фото ссылочной формы");case Oe.DocumentElementDataSourceStaticFile.$Type:return n.props.i18n.t("Статическое изображение");case Oe.DocumentElementDataSourceSharedValue.$Type:return n.props.i18n.t("Общие значения");default:throw"Unknown image data source type"}}())}))),this.getImageSource(t).value===Oe.DocumentElementDataSourceFormFieldRef.$Type.value&&h.createElement(pn,{style:{marginLeft:15},formId:this.props.currentForm.data.map(function(e){return e.id}),onFormFieldSelected:this.onFormFieldImageDataSourceChanged,selectedField:t.source.tpe.value===Oe.DocumentElementDataSourceFormFieldRef.$Type.value?t.source.formFieldId:new ue.None}),this.getImageSource(t).value===Oe.DocumentElementDataSourceChildField.$Type.value&&h.createElement(fn,{style:{marginLeft:15},formId:this.props.currentForm.data.map(function(e){return e.id}),childFormId:Object(ue.toOption)(t.source.childFormId),childRefId:Object(ue.toOption)(t.source.childRefId),displayFieldId:Object(ue.toOption)(t.source.displayFieldId),onRefFormFieldSelected:this.onRefFormFieldImageDataSourceChanged}),this.getImageSource(t).value===Oe.DocumentElementDataSourceStaticFile.$Type.value&&h.createElement("div",{style:{display:"flex",alignItems:"center",width:"300px"}},h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Файл")),h.createElement(Ie.a,{value:Object(ue.toOption)(t.source.fileId).map(function(e){return e.value}).getOrElse(function(){return""}),onChange:this.onElementImageFileChanged},this.props.templateEditor.images.files.map(function(e){return h.createElement(_.a,{value:e.value,key:e.value},Object(ue.headOption)(n.props.fileMetas.list.filter(function(t){return t.id.value===e.value})).map(function(e){return e.entity.originalName}).getOrElse(function(){return n.props.i18n.t("Описание файла не найдено")}))}))),h.createElement(w.a,{onClick:this.handleAddFile},h.createElement(Ht.a,null))),this.getImageSource(t).value===Oe.DocumentElementDataSourceSharedValue.$Type.value&&h.createElement("div",{style:{flex:1}},h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Общее значение")),h.createElement(Ie.a,{value:Object(ue.toOption)(t.source.id).getOrElse(function(){return""}),onChange:this.onElementImageSourceChanged},this.props.templateEditor.sharedValues.map(function(e){return h.createElement(_.a,{value:e.id,key:e.id},e.name)})))))}},{key:"validateBarcodeProviderTypeStaticValue",value:function(e,t){var n=this;return t.config.map(function(e){return e.barcodeGeneratorType}).flatMap(function(t){return t.tpe.value!==Oe.BarcodeGeneratorTypeEAN13.$Type.value||e.match(/^[0-9]{12}$/)?new ue.None:Object(ue.toOption)(n.props.i18n.t("Значение должно содержать 12 цифр"))})}},{key:"createBarcodeAttributesTab",value:function(e,t){var n=this;return h.createElement("div",{style:{display:"flex"}},h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Тип штрихкода")),h.createElement(Ie.a,{value:t.config.map(function(e){return e.barcodeGeneratorType.tpe.value}).getOrElse(function(){return""}),onChange:this.onBarcodeGeneratorChanged},Oe.BarcodeGeneratorTypes.map(function(e){return h.createElement(_.a,{value:e.value,key:e.value},function(){switch(e.value){case Oe.BarcodeGeneratorTypeCode128.$Type.value:return n.props.i18n.t("Code 128");case Oe.BarcodeGeneratorTypeQRCode.$Type.value:return n.props.i18n.t("QR Code");case Oe.BarcodeGeneratorTypeDataMatrix.$Type.value:return n.props.i18n.t("Data Matrix");case Oe.BarcodeGeneratorTypeEAN13.$Type.value:return n.props.i18n.t("Code EAN13")}}())}))),h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Поставщик данных")),h.createElement(Ie.a,{value:t.config.map(function(e){return e.barcodeProviderType.tpe.value}).getOrElse(function(){return""}),onChange:this.onBarcodeProviderTypeChanged},Oe.BarcodeProviderTypes.map(function(e){return h.createElement(_.a,{value:e.value,key:e.value},function(){switch(e.value){case Oe.BarcodeProviderTypeBadgeId.$Type.value:return n.props.i18n.t("Авто (соответствует ID бейджа)");case Oe.BarcodeProviderTypeGenerator.$Type.value:return n.props.i18n.t("Генератор значений");case Oe.BarcodeProviderTypeProperty.$Type.value:return n.props.i18n.t("Поле формы");case Oe.BarcodeProviderTypeStatic.$Type.value:return n.props.i18n.t("Статическое значение");case Oe.BarcodeProviderTypeSharedValue.$Type.value:return n.props.i18n.t("Общее значение");case Oe.BarcodeProviderTypeAssignment.$Type.value:return n.props.i18n.t("Назначаемый")}}())}))),t.config.collect(function(e){switch(e.barcodeProviderType.tpe.value){case Oe.BarcodeProviderTypeProperty.$Type.value:var t=e.barcodeProviderType;return h.createElement(Re.a,{errorText:new ue.None,labelText:new ue.Some(n.props.i18n.t("Поле")),fullWidth:!0,fields:n.props.currentForm.data.flatMap(function(e){return Object(ue.liftKey)(n.props.fields.list,e.id.value)}).getOrElse(function(){return[]}),onChanged:function(e){return n.onBarcodeProviderChanged(new Oe.BarcodeProviderTypeProperty(e.getOrElse(function(){return new Oe.Id("")})))},value:Object(ue.toOption)(t.property)});case Oe.BarcodeProviderTypeStatic.$Type.value:return h.createElement(Pe.a,{label:n.props.i18n.t("Статический текст"),onChange:function(e){return n.onBarcodeProviderChanged(new Oe.BarcodeProviderTypeStatic(new ue.Some(e.target.value)))},value:e.barcodeProviderType.staticValue.getOrElse(function(){return""}),onBlur:n.props.onInputBlur,onFocus:n.props.onInputFocus});case Oe.BarcodeProviderTypeGenerator.$Type.value:return h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,n.props.i18n.t("Генератор")),h.createElement(Ie.a,{onChange:function(e){return n.onBarcodeProviderChanged(new Oe.BarcodeProviderTypeGenerator(new Oe.Id(e.target.value)))},value:e.barcodeProviderType.value.value},n.props.valuesGenerators.list.map(function(e){return h.createElement(_.a,{key:e.id.value,value:e.id.value},e.entity.name)})));case Oe.BarcodeProviderTypeSharedValue.$Type.value:return h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,n.props.i18n.t("Общее значение")),h.createElement(Ie.a,{onChange:function(e){return n.onBarcodeProviderChanged(new Oe.BarcodeProviderTypeSharedValue(e.target.value))},value:e.barcodeProviderType.id},n.props.templateEditor.sharedValues.map(function(e){return h.createElement(_.a,{key:e.id,value:e.id},e.name)})))}}).getOrElse(function(){return h.createElement("div",null," ")}))}}]),t}(h.Component);En=gn([m.autobind,vn("design:paramtypes",[Object])],En);var yn=Object(f.connect)(function(e){return{fonts:e.fonts,i18n:e.i18n,currentForm:e.currentForm,templateEditor:e.templateEditor,fields:e.fields,valuesGenerators:e.valuesGenerators,fileMetas:e.fileMetas,auth:e.auth,eventLine:e.eventLine,organisation:e.organisation}})(En),bn=(n(2616),function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a}),On=function(e){function t(){i()(this,t);var e=c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.width=40,e.height=40,e}return p()(t,e),a()(t,[{key:"onMouseDown",value:function(e){e.preventDefault(),this.props.onSelect(e,this.onResize)}},{key:"onMouseUp",value:function(e){e.preventDefault(),this.props.onUnselect(e)}},{key:"onMouseMove",value:function(e){e.preventDefault(),this.props.onMove(e)}},{key:"onResize",value:function(e,t){}},{key:"getX",value:function(){return 0}},{key:"getY",value:function(){return 0}},{key:"render",value:function(){return h.createElement("a",{className:"Anchor__resize",style:{width:this.width+"px",height:this.height+"px",borderRadius:"50%",top:this.getY()+"px",left:this.getX()+"px"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove})}}]),t}(h.Component),Sn=On=bn([m.autobind],On),wn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Cn=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((90-this.props.element.rotation+r)*Math.PI/180)-e.initialElementSize.width/2,l=i*Math.cos((this.props.element.rotation-r)*Math.PI/180)-e.initialElementSize.height/2,c=n+e.initialElementSize.width*Math.cos(this.props.element.rotation*Math.PI/180)/2-e.initialElementSize.height*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-(a+e.initialElementSize.width)*Math.cos(this.props.element.rotation*Math.PI/180)/2+(l+e.initialElementSize.height)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,s=o+e.initialElementSize.width*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+e.initialElementSize.height*Math.cos(this.props.element.rotation*Math.PI/180)/2-(a+e.initialElementSize.width)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-(l+e.initialElementSize.height)*Math.cos(this.props.element.rotation*Math.PI/180)/2,p=e.initialElementSize.width+a,u=e.initialElementSize.height+l;if(this.props.element.size.aspectRatio){var d=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.Wb)(u+a/d)),this.props.dispatch(Object(pe.fc)(p+l*d))}else this.props.dispatch(Object(pe.fc)(p)),this.props.dispatch(Object(pe.Wb)(u));this.props.dispatch(Object(pe.Fb)(c-p/2)),this.props.dispatch(Object(pe.cc)(s-u/2))}},{key:"getX",value:function(){return-this.width/2}},{key:"getY",value:function(){return-this.height/2}}]),t}(Sn),Pn=Cn=wn([m.autobind],Cn),xn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},kn=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((r-this.props.element.rotation)*Math.PI/180)-e.initialElementSize.height/2,l=n-e.initialElementSize.height*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+(a+e.initialElementSize.height)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,c=o+e.initialElementSize.height*Math.cos(this.props.element.rotation*Math.PI/180)/2-(a+e.initialElementSize.height)*Math.cos(this.props.element.rotation*Math.PI/180)/2,s=e.initialElementSize.height+a;if(this.props.dispatch(Object(pe.Wb)(s)),this.props.element.size.aspectRatio){var p=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.fc)(s*p))}this.props.dispatch(Object(pe.Fb)(l-e.initialElementSize.width/2)),this.props.dispatch(Object(pe.cc)(c-s/2))}},{key:"getX",value:function(){return this.props.element.size.width*this.props.scale/2-this.width/2}},{key:"getY",value:function(){return-this.height/2}}]),t}(Sn),In=kn=xn([m.autobind],kn),jn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Dn=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((90+this.props.element.rotation-r)*Math.PI/180)-e.initialElementSize.width/2,l=i*Math.cos((r-this.props.element.rotation)*Math.PI/180)-e.initialElementSize.height/2,c=n-e.initialElementSize.width*Math.cos(this.props.element.rotation*Math.PI/180)/2-e.initialElementSize.height*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+(a+e.initialElementSize.width)*Math.cos(this.props.element.rotation*Math.PI/180)/2+(l+e.initialElementSize.height)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,s=o-e.initialElementSize.width*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+e.initialElementSize.height*Math.cos(this.props.element.rotation*Math.PI/180)/2+(a+e.initialElementSize.width)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-(l+e.initialElementSize.height)*Math.cos(this.props.element.rotation*Math.PI/180)/2,p=e.initialElementSize.width+a,u=e.initialElementSize.height+l;if(this.props.element.size.aspectRatio){var d=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.Wb)(u+a/d)),this.props.dispatch(Object(pe.fc)(p+l*d))}else this.props.dispatch(Object(pe.fc)(p)),this.props.dispatch(Object(pe.Wb)(u));this.props.dispatch(Object(pe.Fb)(c-p/2)),this.props.dispatch(Object(pe.cc)(s-u/2))}},{key:"getX",value:function(){return this.props.element.size.width*this.props.scale-this.width/2}},{key:"getY",value:function(){return-this.height/2}}]),t}(Sn),Tn=Dn=jn([m.autobind],Dn),Mn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},An=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((this.props.element.rotation-(90+r))*Math.PI/180)-e.initialElementSize.width/2,l=i*Math.cos((180-this.props.element.rotation+r)*Math.PI/180)-e.initialElementSize.height/2,c=n+e.initialElementSize.width*Math.cos(this.props.element.rotation*Math.PI/180)/2+e.initialElementSize.height*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-(a+e.initialElementSize.width)*Math.cos(this.props.element.rotation*Math.PI/180)/2-(l+e.initialElementSize.height)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,s=o+e.initialElementSize.width*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-e.initialElementSize.height*Math.cos(this.props.element.rotation*Math.PI/180)/2-(a+e.initialElementSize.width)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+(l+e.initialElementSize.height)*Math.cos(this.props.element.rotation*Math.PI/180)/2,p=e.initialElementSize.width+a,u=e.initialElementSize.height+l;if(this.props.element.size.aspectRatio){var d=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.Wb)(u+a/d)),this.props.dispatch(Object(pe.fc)(p+l*d))}else this.props.dispatch(Object(pe.fc)(p)),this.props.dispatch(Object(pe.Wb)(u));this.props.dispatch(Object(pe.Fb)(c-p/2)),this.props.dispatch(Object(pe.cc)(s-u/2))}},{key:"getX",value:function(){return-this.width/2}},{key:"getY",value:function(){return this.props.element.size.height*this.props.scale-this.height/2}}]),t}(Sn),Fn=An=Mn([m.autobind],An),zn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Rn=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((r-90-this.props.element.rotation)*Math.PI/180)-e.initialElementSize.width/2,l=i*Math.cos((180-r+this.props.element.rotation)*Math.PI/180)-e.initialElementSize.height/2,c=n-e.initialElementSize.width*Math.cos(this.props.element.rotation*Math.PI/180)/2+e.initialElementSize.height*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+(a+e.initialElementSize.width)*Math.cos(this.props.element.rotation*Math.PI/180)/2-(l+e.initialElementSize.height)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,s=o-e.initialElementSize.width*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-e.initialElementSize.height*Math.cos(this.props.element.rotation*Math.PI/180)/2+(a+e.initialElementSize.width)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+(l+e.initialElementSize.height)*Math.cos(this.props.element.rotation*Math.PI/180)/2,p=e.initialElementSize.width+a,u=e.initialElementSize.height+l;if(this.props.element.size.aspectRatio){var d=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.Wb)(u+a/d)),this.props.dispatch(Object(pe.fc)(p+l*d))}else this.props.dispatch(Object(pe.fc)(p)),this.props.dispatch(Object(pe.Wb)(u));this.props.dispatch(Object(pe.Fb)(c-p/2)),this.props.dispatch(Object(pe.cc)(s-u/2))}},{key:"getX",value:function(){return this.props.element.size.width*this.props.scale-this.width/2}},{key:"getY",value:function(){return this.props.element.size.height*this.props.scale-this.height/2}}]),t}(Sn),_n=Rn=zn([m.autobind],Rn),Vn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Bn=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((this.props.element.rotation-(r+180))*Math.PI/180)-e.initialElementSize.height/2,l=n+e.initialElementSize.height*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-(a+e.initialElementSize.height)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,c=o-e.initialElementSize.height*Math.cos(this.props.element.rotation*Math.PI/180)/2+(a+e.initialElementSize.height)*Math.cos(this.props.element.rotation*Math.PI/180)/2,s=e.initialElementSize.height+a;if(this.props.dispatch(Object(pe.Wb)(s)),this.props.element.size.aspectRatio){var p=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.fc)(s*p))}this.props.dispatch(Object(pe.Fb)(l-e.initialElementSize.width/2)),this.props.dispatch(Object(pe.cc)(c-s/2))}},{key:"getX",value:function(){return this.props.element.size.width*this.props.scale/2-this.width/2}},{key:"getY",value:function(){return this.props.element.size.height*this.props.scale-this.height/2}}]),t}(Sn),Nn=Bn=Vn([m.autobind],Bn),Ln=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Un=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((r-90-this.props.element.rotation)*Math.PI/180)-e.initialElementSize.width/2,l=n-e.initialElementSize.width*Math.cos(this.props.element.rotation*Math.PI/180)/2+(a+e.initialElementSize.width)*Math.cos(this.props.element.rotation*Math.PI/180)/2,c=o-e.initialElementSize.width*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2+(a+e.initialElementSize.width)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,s=e.initialElementSize.width+a;if(this.props.dispatch(Object(pe.fc)(s)),this.props.element.size.aspectRatio){var p=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.Wb)(s/p))}this.props.dispatch(Object(pe.Fb)(l-s/2)),this.props.dispatch(Object(pe.cc)(c-e.initialElementSize.height/2))}},{key:"getX",value:function(){return this.props.element.size.width*this.props.scale-this.width/2}},{key:"getY",value:function(){return this.props.element.size.height*this.props.scale/2-this.height/2}}]),t}(Sn),Wn=Un=Ln([m.autobind],Un),Xn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},$n=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2,i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2)),r=-180*Math.atan2(n-t.x,o-t.y)/Math.PI,a=i*Math.cos((90+r-this.props.element.rotation)*Math.PI/180)-e.initialElementSize.width/2,l=n+e.initialElementSize.width*Math.cos(this.props.element.rotation*Math.PI/180)/2-(a+e.initialElementSize.width)*Math.cos(this.props.element.rotation*Math.PI/180)/2,c=o+e.initialElementSize.width*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2-(a+e.initialElementSize.width)*Math.cos((90-this.props.element.rotation)*Math.PI/180)/2,s=e.initialElementSize.width+a;if(this.props.dispatch(Object(pe.fc)(s)),this.props.element.size.aspectRatio){var p=this.props.element.size.width/this.props.element.size.height;this.props.dispatch(Object(pe.Wb)(s/p))}this.props.dispatch(Object(pe.Fb)(l-s/2)),this.props.dispatch(Object(pe.cc)(c-e.initialElementSize.height/2))}},{key:"getX",value:function(){return-this.width/2}},{key:"getY",value:function(){return this.props.element.size.height*this.props.scale/2-this.height/2}}]),t}(Sn),Hn=$n=Xn([m.autobind],$n),Yn=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Qn=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"onResize",value:function(e,t){var n=e.initialElementPosition.pointX+e.initialElementSize.width/2,o=e.initialElementPosition.pointY+e.initialElementSize.height/2;this.props.dispatch(Object(pe.dc)(-180*Math.atan2(n-t.x,o-t.y)/Math.PI))}},{key:"getX",value:function(){return this.props.element.size.width*this.props.scale/2-this.width/2}},{key:"getY",value:function(){return-60}},{key:"render",value:function(){return h.createElement("a",{className:"Anchor__rotate",style:{width:this.width+"px",height:this.height+"px",borderRadius:"50%",top:this.getY()+"px",left:this.getX()+"px"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove},h.createElement("svg",{className:"Anchor__rotation-icon",viewBox:"0 0 10 12"},h.createElement("path",{fill:"#3F4652",d:"M5,0C2.2,0,0,2.2,0,5h2c0-1.7,1.3-3,3-3s3,1.3,3,3S6.7,8,5,8V6L2,9l3,3v-2c2.8,0,5-2.2,5-5 S7.8,0,5,0z"})))}}]),t}(Sn),Gn=Qn=Yn([m.autobind],Qn),Kn=(n(2618),n(557)),qn=n(75),Jn=n.n(qn),Zn=(n(2620),n(50)),eo=n(145),to=function(e,t,n,o){var i,r=no(e).map(function(e){return e.map(function(e){return function(e,t,n){return{text:ao(e.dataSource,t,n).getOrElse(function(){return""}),style:oo(e),entity:ro(e)}}(e,n,o)})}),a=r.map(function(e){return t=e,n=Object(eo.List)(t.map(function(e){return e.text.split("").map(function(t){return e.entity.map(function(t){return ze.CharacterMetadata.create({style:e.style,entity:t})}).getOrElse(function(){return ze.CharacterMetadata.create({style:e.style})})})}).reduce(function(e,t){return e.concat(t)},[])),new ze.ContentBlock({key:Object(ze.genKey)(),type:"unstyled",depth:0,data:Object(eo.Map)({}),text:t.map(function(e){return e.text}).join(""),characterList:n});var t,n}),l=ze.ContentState.createFromBlockArray(a,(i=function(e){return e.reduce(function(e,t){return e.concat(t.map(function(e){return e.entity}))},[])}(r),Object(eo.OrderedMap)({}).withMutations(function(e){i.forEach(function(t){t.foreach(function(t){e.set(t,ze.Entity.get(t))})})}).toOrderedMap()));return ze.EditorState.createWithContent(l,t)};function no(e){return e.reduce(function(e,t){return Object(ue.toOption)(t).filter(function(e){return e.dataSource instanceof Oe.DocumentElementDataSourceStaticValue}).map(function(e){return e.dataSource.value}).filter(function(e){return 0!==e.length&&10===e.charCodeAt(0)}).map(function(){return e.push([]),e}).getOrElse(function(){return e[e.length-1].push(t),e})},[[]])}function oo(e){return Object(eo.OrderedSet)().withMutations(function(t){e.font.isUnderlined&&t.add("UNDERLINE"),t.add("fontfamily-"+e.font.font.getName()),t.add("fontsize-"+e.font.fontSize),t.add("fontcolor-"+e.font.color),e.effects.forEach(function(e){switch(e.tpe.value){case Oe.DocumentElementDisplayEffectToUppercase.$Type.value:t.add("texttransform-uppercase");break;case Oe.DocumentElementDisplayEffectToLowercase.$Type.value:t.add("texttransform-lowercase");break;case Oe.DocumentElementDisplayEffectToCapitalize.$Type.value:t.add("texttransform-capitalize")}})}).toOrderedSet()}function io(e){return Object(ue.headOption)(e.effects.filter(function(e){return e.tpe.value===Oe.DocumentElementDisplayEffectSubstring.$Type.value}))}function ro(e){return e.dataSource instanceof Oe.DocumentElementDataSourceFormFieldRef?Object(ue.toOption)((t=e.dataSource,n=io(e),ze.Entity.create("FIELDID","IMMUTABLE",{fieldId:t.formFieldId.map(function(e){return e.value}).getOrElse(function(){return""}),formId:t.formId.map(function(e){return e.value}).getOrElse(function(){return""}),substringEffect:n}))):e.dataSource instanceof Oe.DocumentElementDataSourceParentField?Object(ue.toOption)(function(e,t){return ze.Entity.create("PARENTFIELDID","IMMUTABLE",{parentFormId:e.parentFormId.value,refFieldId:e.refFieldId.value,displayFieldId:e.displayFieldId.value,substringEffect:t})}(e.dataSource,io(e))):e.dataSource instanceof Oe.DocumentElementDataSourceSharedValue?Object(ue.toOption)(function(e,t){return ze.Entity.create("SHAREDVALUEID","IMMUTABLE",{sharedValueId:e.id,substringEffect:t})}(e.dataSource,io(e))):new ue.None;var t,n}function ao(e,t,n){return e instanceof Oe.DocumentElementDataSourceFormFieldRef?function(e,t){return Object(ue.headOption)(Object(xe.e)(t,e.formId.getOrElse(function(){return new Oe.Id("")})).getOrElse(function(){return[]}).filter(function(t){return t.id.value===e.formFieldId.map(function(e){return e.value}).getOrElse(function(){return""})})).map(function(e){return"{{"+e.entity.caption+"}}"})}(e,t):e instanceof Oe.DocumentElementDataSourceParentField?function(e,t){return Object(ue.headOption)(Object(xe.e)(t,e.parentFormId).getOrElse(function(){return[]}).filter(function(t){return t.id.value===e.displayFieldId.value})).map(function(e){return"{{"+e.entity.caption+"}}"})}(e,t):e instanceof Oe.DocumentElementDataSourceSharedValue?function(e,t){return Object(ue.headOption)(t.filter(function(t){return t.id===e.id})).map(function(e){return"{{"+e.name+"}}"})}(e,n):Object(ue.toOption)(e).filter(function(e){return e instanceof Oe.DocumentElementDataSourceStaticValue}).map(function(e){return e}).map(function(e){return e.value})}var lo=n(183),co=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},so=function(e){var t=e.getData().get("text-align");if(!t)return"DocumentTemplate-TextEditor__textAlignLeft";switch(t){case"center":return"DocumentTemplate-TextEditor__textAlignCenter";case"left":return"DocumentTemplate-TextEditor__textAlignLeft";case"right":return"DocumentTemplate-TextEditor__textAlignRight";case"justify":return"DocumentTemplate-TextEditor__textAlignJustify";default:return"DocumentTemplate-TextEditor__textAlignLeft"}},po={},uo={},ho=Object.assign({},po,uo),fo=new ze.CompositeDecorator([{strategy:function(e,t){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"FIELDID"===ze.Entity.get(t).getType()},t)},component:function(e){return h.createElement("span",null,e.children)}},{strategy:function(e,t){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"PARENTFIELDID"===ze.Entity.get(t).getType()},t)},component:function(e){return h.createElement("span",null,e.children)}},{strategy:function(e,t){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"SHAREDVALUEID"===ze.Entity.get(t).getType()},t)},component:function(e){return h.createElement("span",null,e.children)}}]),mo=function(e){var t={};return e.toJS().forEach(function(e){e.indexOf("color")>=0&&(t.color=e.slice("fontcolor-".length)),e.indexOf("transform")>=0&&(t.textTransform=e.slice("texttransform-".length)),e.indexOf("fontsize")>=0&&(t.fontSize=e.slice("fontsize-".length)+"pt"),e.indexOf("fontfamily")>=0&&(t.fontFamily=e.slice("fontfamily-".length))}),t},go=function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentWillMount",value:function(){var e=void 0;e=this.props.paragraph.body.length>0?to(this.props.paragraph.body,fo,this.props.formFields,this.props.templateEditor.sharedValues):ze.EditorState.createWithContent(ze.ContentState.createFromText(this.props.i18n.t("Текст надписи")),fo),this.handleEditorStateChange(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this;if(this.props.templateEditor.textEditorState.editorState.map(function(n){return e.templateEditor.textEditorState.editorState.map(function(e){e===n||t.props.onChange(e)})}),this.props.formFields.list!==e.formFields.list||this.props.templateEditor.sharedValues!==e.templateEditor.sharedValues){var n=to(e.paragraph.body,fo,e.formFields,e.templateEditor.sharedValues);this.props.templateEditor.textEditorState.editorState.foreach(function(e){var o=e.getSelection(),i=ze.EditorState.acceptSelection(n,new ze.SelectionState({anchorKey:o.getAnchorKey(),anchorOffset:o.getAnchorOffset(),focusKey:o.getFocusKey(),focusOffset:o.getFocusOffset(),isBackward:!1}));t.handleEditorStateChange(i)})}}},{key:"handleEditorStateChange",value:function(e){this.props.dispatch(Object(pe.Pc)(e))}},{key:"handleKeyCommand",value:function(e){var t=this;return this.props.templateEditor.textEditorState.editorState.map(function(n){var o=ze.RichUtils.handleKeyCommand(n,e);return o?(t.handleEditorStateChange(o),lo.a):lo.b}).getOrElse(function(){throw new Error("editorState hasn't initialized")})}},{key:"handleBeforeInput",value:function(e){return this.props.templateEditor.textEditorState.editorState.map(function(e){var t=e.getSelection(),n=t.getAnchorKey(),o=e.getCurrentContent().getBlockForKey(n),i=t.getStartOffset();return o.getEntityAt(i-1)&&o.getEntityAt(i)&&0!==i&&o.getEntityAt(i-1)===o.getEntityAt(i)?lo.a:lo.b}).getOrElse(function(){return lo.b})}},{key:"onFieldIdChange",value:function(e){this.props.dispatch(Object(pe.Hc)(e))}},{key:"onRefFieldIdChange",value:function(e){this.props.dispatch(Object(pe.Lc)(e))}},{key:"onParentFormIdChange",value:function(e){this.props.dispatch(Object(pe.Ic)(Object(ue.toOption)(new Oe.Id(e.target.value))))}},{key:"onDataSourceTypeChange",value:function(e){this.props.dispatch(Object(pe.Oc)(Object(ue.toOption)(new ue.TypeId(e.target.value))))}},{key:"onSharedValueIdChange",value:function(e){this.props.dispatch(Object(pe.Mc)(Object(ue.toOption)(e.target.value)))}},{key:"onDisplayFieldIdChange",value:function(e){this.props.dispatch(Object(pe.Gc)(e))}},{key:"onSubstringEffectEnabled",value:function(e,t){this.props.dispatch(Object(pe.Nc)(this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect.matchWith(function(e){return new ue.None},function(){return Object(ue.toOption)(new Oe.DocumentElementDisplayEffectSubstring(0,0))})))}},{key:"onSubstringEffectFromChanged",value:function(e){var t=""===e.target.value?-1:parseInt(e.target.value);isNaN(t)||this.props.dispatch(Object(pe.Nc)(this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect.matchWith(function(e){return Object(ue.toOption)(v(e,{from:{$set:t}}))},function(){return new ue.None})))}},{key:"onSubstringEffectToChanged",value:function(e){var t=""===e.target.value?-1:parseInt(e.target.value);isNaN(t)||this.props.dispatch(Object(pe.Nc)(this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect.matchWith(function(e){return Object(ue.toOption)(v(e,{to:{$set:t}}))},function(){return new ue.None})))}},{key:"getDataSourceEntity",value:function(){var e=this.props.templateEditor.textEditorState.addDataSourcePopover.dataSourceType.map(function(e){return e.value}).getOrElse(function(){return""});switch(e){case Oe.DocumentElementDataSourceFormFieldRef.$Type.value:return ze.Entity.create("FIELDID","IMMUTABLE",{fieldId:this.props.templateEditor.textEditorState.addDataSourcePopover.fieldId.map(function(e){return e.value}).getOrElse(function(){return""}),formId:this.props.form.data.map(function(e){return e.id.value}).getOrElse(function(){return""}),substringEffect:this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect});case Oe.DocumentElementDataSourceParentField.$Type.value:return ze.Entity.create("PARENTFIELDID","IMMUTABLE",{parentFormId:this.props.templateEditor.textEditorState.addDataSourcePopover.parentFormId.map(function(e){return e.value}).getOrElse(function(){return""}),refFieldId:this.props.templateEditor.textEditorState.addDataSourcePopover.refFieldId.map(function(e){return e.value}).getOrElse(function(){return""}),displayFieldId:this.props.templateEditor.textEditorState.addDataSourcePopover.displayFieldId.map(function(e){return e.value}).getOrElse(function(){return""}),substringEffect:this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect});case Oe.DocumentElementDataSourceSharedValue.$Type.value:return ze.Entity.create("SHAREDVALUEID","IMMUTABLE",{sharedValueId:this.props.templateEditor.textEditorState.addDataSourcePopover.sharedValueId.map(function(e){return e}).getOrElse(function(){return""}),substringEffect:this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect});default:throw"Unknown data source type "+e}}},{key:"getDataSourceEntityText",value:function(){var e=this,t=this.props.templateEditor.textEditorState.addDataSourcePopover.dataSourceType.map(function(e){return e.value}).getOrElse(function(){return""});switch(t){case Oe.DocumentElementDataSourceFormFieldRef.$Type.value:return this.props.templateEditor.textEditorState.addDataSourcePopover.fieldId.flatMap(function(t){return Object(ue.headOption)(e.props.fields.filter(function(e){return e.id.value===t.value}))}).map(function(e){return e.entity.caption}).getOrElse(function(){return e.props.i18n.t("Поле не найдено")});case Oe.DocumentElementDataSourceParentField.$Type.value:return this.props.templateEditor.textEditorState.addDataSourcePopover.parentFormId.flatMap(function(t){return e.props.templateEditor.textEditorState.addDataSourcePopover.displayFieldId.flatMap(function(n){return Object(ue.headOption)(Object(xe.e)(e.props.formFields,t).getOrElse(function(){return[]}).filter(function(e){return e.id.value===n.value}))})}).map(function(e){return e.entity.caption}).getOrElse(function(){return e.props.i18n.t("Поле не найдено")});case Oe.DocumentElementDataSourceSharedValue.$Type.value:return this.props.templateEditor.textEditorState.addDataSourcePopover.sharedValueId.flatMap(function(t){return Object(ue.headOption)(e.props.templateEditor.sharedValues.filter(function(e){return e.id===t}))}).map(function(e){return e.name}).getOrElse(function(){return e.props.i18n.t("Общее значение не найдено")});default:throw"Unknown data source type "+t}}},{key:"onAddDataSource",value:function(){var e=this;this.props.templateEditor.textEditorState.editorState.map(function(t){var n=e.getDataSourceEntity(),o=t.getCurrentContent(),i=t.getSelection(),r=t.getCurrentInlineStyle(),a=ze.Modifier.insertText(o,i,"{{"+e.getDataSourceEntityText()+"}}",r,n),l=ze.EditorState.push(t,a,"insert-characters");e.handleEditorStateChange(l),e.closeAddDataSourcePopover()})}},{key:"closeAddDataSourcePopover",value:function(){this.props.dispatch(Object(pe.Jc)())}},{key:"setBlockData",value:function(e){return this.props.templateEditor.textEditorState.editorState.map(function(t){var n=t.getCurrentContent(),o=t.getSelection(),i=ze.Modifier.setBlockData(n,o,e);return ze.EditorState.push(t,i,"change-block-data")}).getOrElse(function(){throw new Error("editorState hasn't initialized")})}},{key:"toggleCustomInlineStyle",value:function(e){return this.props.templateEditor.textEditorState.editorState.map(function(t){return ze.RichUtils.toggleInlineStyle(t,e)}).getOrElse(function(){throw new Error("editorState hasn't initialized")})}},{key:"onColorPopoverClose",value:function(){this.props.dispatch(Object(pe.Ec)())}},{key:"onColorSelect",value:function(e){var t="fontcolor-"+e.hex;this.props.dispatch(Object(pe.Dc)(Object(ue.toOption)(e.hex))),this.onColorPopoverClose(),this.handleEditorStateChange(this.toggleCustomInlineStyle(t))}},{key:"render",value:function(){var e=this;return h.createElement("div",{style:{position:"relative"}},this.props.templateEditor.textEditorState.addDataSourcePopover.open&&h.createElement(T.a,{open:this.props.templateEditor.textEditorState.addDataSourcePopover.open,anchorEl:this.props.templateEditor.textEditorState.addDataSourcePopover.anchorElement.getOrElse(function(){throw"popover anchor hasn't been provided"}),anchorOrigin:{horizontal:"right",vertical:"bottom"},transformOrigin:{horizontal:"right",vertical:"top"},onClose:this.closeAddDataSourcePopover,style:{padding:"5px"}},h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,{htmlFor:"datasource-type-selector"},this.props.i18n.t("Источник значения")),h.createElement(Ie.a,{inputProps:{id:"datasource-type-selector"},value:this.props.templateEditor.textEditorState.addDataSourcePopover.dataSourceType.map(function(e){return e.value}).getOrElse(function(){return""}),onChange:this.onDataSourceTypeChange},Oe.DocumentElementParagraphDataSourceTypes.map(function(t){return h.createElement(_.a,{key:t.value,value:t.value},Object(Zn.q)(t,e.props.i18n.t))}))),this.props.templateEditor.textEditorState.addDataSourcePopover.dataSourceType.filter(function(e){return e.value===Oe.DocumentElementDataSourceParentField.$Type.value}).nonEmpty()&&h.createElement("div",null,h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Родительская форма")),h.createElement(Ie.a,{value:this.props.templateEditor.textEditorState.addDataSourcePopover.parentFormId.map(function(e){return e.value}).getOrElse(function(){return""}),onChange:this.onParentFormIdChange},this.props.forms.list.filter(function(t){return e.props.refFields.filter(function(e){return e.entity.formId.value===t.id.value}).length>0}).map(function(e){return h.createElement(_.a,{key:e.id.value,value:e.id.value},e.entity.name)}))),h.createElement(Re.a,{errorText:new ue.None,labelText:new ue.Some(this.props.i18n.t("Поле поиска")),fullWidth:!0,fields:this.props.refFields,onChanged:this.onRefFieldIdChange,value:this.props.templateEditor.textEditorState.addDataSourcePopover.refFieldId}),h.createElement(Re.a,{errorText:new ue.None,labelText:new ue.Some(this.props.i18n.t("Поле отображения")),fullWidth:!0,fields:this.props.templateEditor.textEditorState.addDataSourcePopover.parentFormId.flatMap(function(t){return Object(xe.e)(e.props.formFields,t)}).getOrElse(function(){return[]}),onChanged:this.onDisplayFieldIdChange,value:this.props.templateEditor.textEditorState.addDataSourcePopover.displayFieldId})),this.props.templateEditor.textEditorState.addDataSourcePopover.dataSourceType.filter(function(e){return e.value===Oe.DocumentElementDataSourceFormFieldRef.$Type.value}).nonEmpty()&&h.createElement(Re.a,{errorText:new ue.None,labelText:new ue.Some(this.props.i18n.t("Поле")),fullWidth:!0,fields:this.props.fields,onChanged:this.onFieldIdChange,value:this.props.templateEditor.textEditorState.addDataSourcePopover.fieldId}),this.props.templateEditor.textEditorState.addDataSourcePopover.dataSourceType.filter(function(e){return e.value===Oe.DocumentElementDataSourceSharedValue.$Type.value}).nonEmpty()&&h.createElement(Me.a,{fullWidth:!0},h.createElement(Fe.a,null,this.props.i18n.t("Общее значение")),h.createElement(Ie.a,{onChange:this.onSharedValueIdChange,value:this.props.templateEditor.textEditorState.addDataSourcePopover.sharedValueId.getOrElse(function(){return""})},this.props.templateEditor.sharedValues.map(function(e){return h.createElement(_.a,{key:e.id,value:e.id},e.name)}))),this.props.templateEditor.textEditorState.addDataSourcePopover.dataSourceType.nonEmpty()&&h.createElement("div",null,h.createElement(A.a,{label:this.props.i18n.t("Выборка подстроки"),control:h.createElement(Jn.a,{checked:this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect.nonEmpty(),onChange:this.onSubstringEffectEnabled})}),this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect.nonEmpty()&&h.createElement("div",{style:{display:"flex"}},h.createElement(Pe.a,{style:{marginRight:"5px"},label:this.props.i18n.t("От"),type:"number",value:this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect.map(function(e){return-1===e.from?"":e.from.toString()}).getOrElse(function(){return"0"}),onChange:this.onSubstringEffectFromChanged}),h.createElement(Pe.a,{style:{marginLeft:"5px"},label:this.props.i18n.t("До"),type:"number",value:this.props.templateEditor.textEditorState.addDataSourcePopover.substringEffect.map(function(e){return-1===e.to?"":e.to.toString()}).getOrElse(function(){return"0"}),onChange:this.onSubstringEffectToChanged}))),h.createElement("div",{style:{textAlign:"right"}},h.createElement(k.a,{variant:"raised",onClick:this.onAddDataSource},this.props.i18n.t("Вставить")))),this.props.templateEditor.textEditorState.colorPopover.open&&h.createElement(T.a,{open:this.props.templateEditor.textEditorState.colorPopover.open,anchorEl:this.props.templateEditor.textEditorState.colorPopover.anchorElement.getOrElse(function(){throw"popover anchor hasn't been provided"}),anchorOrigin:{horizontal:"left",vertical:"bottom"},transformOrigin:{horizontal:"left",vertical:"top"},onClose:this.onColorPopoverClose},h.createElement(Kn.SketchPicker,{color:{hex:this.props.templateEditor.textEditorState.colorPopover.color.getOrElse(function(){return"#000"})},onChangeComplete:this.onColorSelect})),h.createElement("div",{style:this.props.style},this.props.templateEditor.textEditorState.editorState.map(function(t){return h.createElement(ze.Editor,{editorState:t,customStyleMap:ho,customStyleFn:mo,blockStyleFn:so,handleKeyCommand:e.handleKeyCommand,handleBeforeInput:e.handleBeforeInput,onChange:e.handleEditorStateChange})}).getOrNull()))}}]),t}(h.Component);go=co([m.autobind],go);var vo=Object(f.connect)(function(e){return{i18n:e.i18n,form:e.currentForm,forms:e.forms,fonts:e.fonts,formFields:e.fields,templateEditor:e.templateEditor}})(go),Eo=n(1516),yo=n(109),bo=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},Oo=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},So=n(2006);So.GlobalWorkerOptions.workerSrc=n(1917);var wo=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={page:new ue.None,pageFetching:!1,pageError:new ue.None},n}return p()(t,e),a()(t,[{key:"getActivePage",value:function(e){return e.templateEditor.activePageIndex.flatMap(function(t){return Object(ue.toOption)(e.templateEditor.pages[t])})}},{key:"shouldComponentUpdate",value:function(e,t){var n=!Object(ue.isEqual)(e.templateEditor.pdfTemplate,this.props.templateEditor.pdfTemplate),o=!Object(ue.isEqual)(e.templateEditor.activePageIndex,this.props.templateEditor.activePageIndex),i=!o&&!Object(ue.isEqual)(this.getActivePage(e).map(function(e){return e.pageSize.width}),this.getActivePage(this.props).map(function(e){return e.pageSize.width})),r=!o&&!Object(ue.isEqual)(this.getActivePage(e).map(function(e){return e.pageSize.height}),this.getActivePage(this.props).map(function(e){return e.pageSize.height})),a=this.state!==t;return n||o||i||r||a}},{key:"componentDidMount",value:function(){this.downloadPdfPage(this.props,this.state)}},{key:"componentDidUpdate",value:function(){this.updatePDFTemplate(this.props,this.state)}},{key:"componentWillReceiveProps",value:function(e,t){Object(ue.isEqual)(e.templateEditor.pdfTemplate.map(function(e){return e.fileId.value}),this.props.templateEditor.pdfTemplate.map(function(e){return e.fileId.value}))||this.downloadPdfPage(e,t)}},{key:"downloadPdfPage",value:function(e,t){var n=this;e.templateEditor.activePageIndex.foreach(function(o){Object(ue.toOption)(e.templateEditor.pages[o]).map(function(e){return e.pageSize}).map(function(i){n.getPDFSrc(e).foreach(function(e){So.getDocument(e).then(function(e){e.getPage(o+1).then(function(e){n.setState(v(t,{page:{$set:Object(ue.toOption)(e)}}))})})})})})}},{key:"updatePDFTemplate",value:function(e,t){var n=Object(ue.toOption)(this.refs.pdfCanvas);n.isEmpty()||this.getActivePage(e).map(function(e){return e.pageSize}).map(function(o){t.page.map(function(t){n.foreach(function(n){var i=e.templateEditor.scale,r=e.templateEditor.pixelRatio,a=n.getContext("2d");Object(ue.toOption)(a).foreach(function(e){e.clearRect(0,0,n.width,n.height);var a=t.getViewport(1);n.width=o.width*i*r,n.height=o.height*i*r,t.render({canvasContext:e,viewport:a}),e.scale(o.width*i*r/a.width,o.height*i*r/a.height)})})})})}},{key:"getPDFSrc",value:function(e){return e.templateEditor.pdfTemplate.map(function(e){return e.fileId}).flatMap(function(t){return Object(yo.a)(e.auth,t,e.cdnAddress)})}},{key:"render",value:function(){return this.props.templateEditor.pdfTemplate.filter(function(e){return e.showEnabled}).map(function(e){return h.createElement("canvas",{style:{position:"absolute",top:0,right:0},ref:"pdfCanvas"})}).getOrNull()}}]),t}(h.Component);wo=bo([m.autobind,Oo("design:paramtypes",[Object])],wo);var Co=Object(f.connect)(function(e){return{templateEditor:e.templateEditor,auth:e.auth,cdnAddress:e.config.cdnAddress}})(wo),Po=function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},xo=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ko=function(e){function t(e){i()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.stage=new ue.None,n}return p()(t,e),a()(t,[{key:"componentWillReceiveProps",value:function(e){this.props.templateEditor.scale,e.templateEditor.scale}},{key:"componentWillMount",value:function(){document.addEventListener("keydown",this.onKeyDown)}},{key:"componentWillUnmount",value:function(){this.stage=new ue.None,document.removeEventListener("keydown",this.onKeyDown)}},{key:"onKeyDown",value:function(e){if(this.props.templateEditor.sceneState.doubleClicked||this.props.templateEditor.inputFocused)return null;switch(e.keyCode){case 8:case 46:this.onElementDeleted();break;case 37:e.preventDefault(),this.onMoveLeft();break;case 38:e.preventDefault(),this.onMoveUp();break;case 39:e.preventDefault(),this.onMoveRight();break;case 40:e.preventDefault(),this.onMoveDown()}}},{key:"onElementDeleted",value:function(){this.props.dispatch(Object(pe.Tb)())}},{key:"handleStateUpdate",value:function(e){return this.props.dispatch(Object(pe.uc)(e))}},{key:"decorateCreatedComponent",value:function(e,t){var n=this;return h.cloneElement(e,{key:t.map(function(e){return e.ownId.value}).getOrUndefined(),onMouseDown:function(e){return n.onTouchStarted(e,t)},onMouseUp:function(e){return n.onTouchEnded(e)},onMouseMove:function(e){return n.onTouchMove(e,t)}})}},{key:"createTextPreview",value:function(e,t,n){var o=this,i=n.map(function(e){return e.rotation}).getOrElse(function(){return 0}),r=e.map(function(e){return e.pointX}).getOrElse(function(){return 0}),a=e.map(function(e){return e.pointY}).getOrElse(function(){return 0}),l=n.map(function(e){return e.size.width/2}).getOrElse(function(){return 0}),c=n.map(function(e){return e.size.height/2}).getOrElse(function(){return 0});return this.decorateCreatedComponent(h.createElement("div",{style:{position:"absolute",width:2*l+"px",height:2*c+"px",top:a+"px",left:r+"px",transform:"rotate("+i+"deg)"}},n.flatMap(function(e){return e.display.dataSource.flatMap(function(e){switch(e.tpe){case Oe.DocumentElementDataSourceFormFieldRef.$Type:var t=e;return t.formFieldId.flatMap(function(e){return t.formId.flatMap(function(t){return Object(ue.liftKey)(o.props.fields.list,t.value).flatMap(function(t){return Object(ue.toOption)(t.find(function(t){return t.id.value===e.value}))}).map(function(e){return o.props.i18n.t("Ссылка на: '%s'").replace("%s",e.entity.name)})})});case Oe.DocumentElementDataSourceStaticValue.$Type:return Object(ue.toOption)(e.value);default:throw"Unknown DocumentElementDisplayText type"}})}).getOrElse(function(){return o.props.i18n.t("Источник данных не задан")})),n)}},{key:"getDataSourceValue",value:function(e){var t=this;switch(e.tpe.value){case Oe.DocumentElementDataSourceStaticValue.$Type.value:var n=e.value;return""===n?" ":n;case Oe.DocumentElementDataSourceFormFieldRef.$Type.value:var o=e;return o.formFieldId.flatMap(function(e){return o.formId.flatMap(function(n){return Object(ue.liftKey)(t.props.fields.list,n.value).flatMap(function(t){return Object(ue.toOption)(t.find(function(t){return t.id.value===e.value}))}).map(function(e){return"{{"+e.entity.caption+"}}"})})}).getOrElse(function(){return"{{"+t.props.i18n.t("Поле не найдено")+"}}"});case Oe.DocumentElementDataSourceParentField.$Type.value:var i=e;return Object(ue.liftKey)(this.props.fields.list,i.parentFormId.value).flatMap(function(e){return Object(ue.toOption)(e.find(function(e){return e.id.value===i.displayFieldId.value}))}).map(function(e){return"{{"+e.entity.caption+"}}"}).getOrElse(function(){return"{{"+t.props.i18n.t("Поле не найдено")+"}}"});case Oe.DocumentElementDataSourceSharedValue.$Type.value:var r=e;return Object(ue.headOption)(this.props.templateEditor.sharedValues.filter(function(e){return e.id===r.id})).map(function(e){return"{{"+e.name+"}}"}).getOrElse(function(){return"{{"+t.props.i18n.t("Общее значение не найдено")+"}}"});default:throw"Unknown data source type"}}},{key:"createParagraphPreview",value:function(e,t,n){var o=this;return this.props.templateEditor.sceneState.doubleClickedId===n.map(function(e){return e.ownId.value}).getOrElse(function(){return""})?null:e.zip(t).map(function(e){var t=n.map(function(e){return e.rotation}).getOrElse(function(){return 0}),i=e._1,r=e._2,a=(n.map(function(e){return e.size.width/2}).getOrElse(function(){return 0}),n.map(function(e){return e.size.height/2}).getOrElse(function(){return 0}),o.props.templateEditor.pixelRatio);return o.decorateCreatedComponent(h.createElement("div",{style:{position:"absolute",width:(r.pointX-i.pointX)*a+"px",height:(r.pointY-i.pointY)*a+"px",top:i.pointY*a+"px",left:i.pointX*a+"px",textAlign:n.flatMap(function(e){return e.horizontalAlignment}).map(function(e){return e.toString()}).getOrElse(function(){return"left"}),transform:"rotate("+t+"deg)",overflow:"hidden",background:"rgba(255, 255, 255, 0)",lineHeight:n.flatMap(function(e){return e.display.lineSpacing}).getOrElse(function(){return 1.2})}},n.map(function(e){return no(e.display.body).map(function(e,t){return h.createElement("div",{key:t,style:{whiteSpace:"pre-wrap",wordWrap:"break-word"}},e.map(function(e,t){return h.createElement("span",{key:t,style:Object.assign({fontSize:e.font.fontSize+"pt",fontFamily:e.font.font.getName()},o.getEffectsStyle(e.effects))},o.getDataSourceValue(e.dataSource))}))})}).getOrElse(function(){return[h.createElement("span",{key:"0",style:{fontSize:"12pt"}},o.props.i18n.t("Текст надписи"))]})),n)}).getOrNull()}},{key:"createLinePreview",value:function(e,t){return this.decorateCreatedComponent(h.createElement("line",{style:{stroke:"rgb(0, 0, 0)",strokeWidth:2},x1:e[0],y1:e[1],x2:e[2],y2:e[3]}),t)}},{key:"createRectanglePreview",value:function(e,t,n){var o=this;return e.zip(t).map(function(e){var t=o.props.templateEditor.pixelRatio,i=e._1,r=e._2,a=n.map(function(e){return e.rotation}).getOrElse(function(){return 0});n.map(function(e){return e.size.width/2}).getOrElse(function(){return 0}),n.map(function(e){return e.size.height/2}).getOrElse(function(){return 0});return o.decorateCreatedComponent(h.createElement("div",{style:{position:"absolute",width:(r.pointX-i.pointX)*t+"px",height:(r.pointY-i.pointY)*t+"px",top:i.pointY*t+"px",left:i.pointX*t+"px",transform:"rotate("+a+"deg)",boxSizing:"border-box",border:"1px solid #000"}}),n)}).getOrNull()}},{key:"getImageElementSource",value:function(e){var t=this;return e.flatMap(function(e){switch(e.display.source.tpe.value){case Oe.DocumentElementDataSourceFormFieldRef.$Type.value:return new ue.None;case Oe.DocumentElementDataSourceStaticFile.$Type.value:var n=e.display.source.fileId;return Object(yo.a)(t.props.auth,n,t.props.cdnAddress);case Oe.DocumentElementDataSourceSharedValue.$Type.value:case Oe.DocumentElementDataSourceChildField.$Type.value:return new ue.None;default:throw"Unknown image data source type"}})}},{key:"createImagePreview",value:function(e,t,o){var i=this;return e.zip(t).map(function(e){var t=i.props.templateEditor.pixelRatio,r=o.map(function(e){return e.rotation}).getOrElse(function(){return 0}),a=e._1,l=e._2,c=o.map(function(e){return e.crop.top}).getOrElse(function(){return 0}),s=o.map(function(e){return e.crop.right}).getOrElse(function(){return 0}),p=o.map(function(e){return e.crop.bottom}).getOrElse(function(){return 0}),u=o.map(function(e){return e.crop.left}).getOrElse(function(){return 0}),d=o.flatMap(function(e){return e.opacity.level}).getOrElse(function(){return 0});return i.decorateCreatedComponent(h.createElement("div",{style:{overflow:"hidden",position:"absolute",top:a.pointY*t+"px",left:a.pointX*t+"px",transform:"rotate("+r+"deg)"}},h.createElement("img",{style:{margin:-c*t+"px "+-s*t+"px "+-p*t+"px "+-u*t+"px",width:(l.pointX-a.pointX+s+u)*t+"px",height:(l.pointY-a.pointY+c+p)*t+"px",opacity:1-d},src:i.getImageElementSource(o).getOrElse(function(){return n(622)})})),o)}).getOrNull()}},{key:"createBarcodePreview",value:function(e,t,o){var i=this,r=o.flatMap(function(e){return e.display.config.map(function(e){return e.barcodeGeneratorType.tpe}).map(function(e){switch(e){case Oe.BarcodeGeneratorTypeCode128.$Type:return n(2625);case Oe.BarcodeGeneratorTypeDataMatrix.$Type:return n(2626);case Oe.BarcodeGeneratorTypeEAN13.$Type:return n(2099);case Oe.BarcodeGeneratorTypeQRCode.$Type:default:return n(2100)}})}).getOrElse(function(){return n(2099)});return e.zip(t).map(function(e){var t=i.props.templateEditor.pixelRatio,n=o.map(function(e){return e.rotation}).getOrElse(function(){return 0}),a=e._1,l=e._2,c=o.flatMap(function(e){return e.opacity.level}).getOrElse(function(){return 0});return i.decorateCreatedComponent(h.createElement("img",{style:{position:"absolute",width:(l.pointX-a.pointX)*t+"px",height:(l.pointY-a.pointY)*t+"px",top:a.pointY*t+"px",left:a.pointX*t+"px",transform:"rotate("+n+"deg)",opacity:1-c},src:r}),o)}).getOrNull()}},{key:"renderPageElement",value:function(e){switch(e.display.tpe){case Oe.DocumentElementDisplayText.$Type:return this.createTextPreview(new ue.Some({pointX:e.position.x,pointY:e.position.y}),new ue.Some({pointX:e.position.x+e.size.width,pointY:e.position.y+e.size.height}),new ue.Some(e));case Oe.DocumentElementDisplayParagraph.$Type:return this.createParagraphPreview(new ue.Some({pointX:e.position.x,pointY:e.position.y}),new ue.Some({pointX:e.position.x+e.size.width,pointY:e.position.y+e.size.height}),new ue.Some(e));case Oe.DocumentElementDisplayRect.$Type:return this.createRectanglePreview(new ue.Some({pointX:e.position.x,pointY:e.position.y}),new ue.Some({pointX:e.position.x+e.size.width,pointY:e.position.y+e.size.height}),new ue.Some(e));case Oe.DocumentElementDisplayLine.$Type:return this.createLinePreview([e.position.x,e.position.y,e.position.x+e.size.width,e.position.y+e.size.height],new ue.Some(e));case Oe.DocumentElementDisplayImage.$Type:return this.createImagePreview(new ue.Some({pointX:e.position.x,pointY:e.position.y}),new ue.Some({pointX:e.position.x+e.size.width,pointY:e.position.y+e.size.height}),new ue.Some(e));case Oe.DocumentElementDisplayBarcode.$Type:return this.createBarcodePreview(new ue.Some({pointX:e.position.x,pointY:e.position.y}),new ue.Some({pointX:e.position.x+e.size.width,pointY:e.position.y+e.size.height}),new ue.Some(e))}}},{key:"showDrawingPreview",value:function(){var e=this;return this.props.templateEditor.drawingContext.map(function(t){switch(t.drawingContext){case pe.l.Line:return t.startPoint.zip(t.endPoint).map(function(t){return e.createLinePreview([t._1.pointX,t._1.pointY,t._2.pointX,t._2.pointY],new ue.None)}).getOrNull();case pe.l.Text:return e.createTextPreview(t.startPoint,t.endPoint,new ue.None);case pe.l.Paragaph:return e.createParagraphPreview(t.startPoint,t.endPoint,new ue.None);case pe.l.Rect:return e.createRectanglePreview(t.startPoint,t.endPoint,new ue.None);case pe.l.Image:return e.createImagePreview(t.startPoint,t.endPoint,new ue.None);case pe.l.Barcode:return e.createBarcodePreview(t.startPoint,t.endPoint,new ue.None)}})}},{key:"onTouchStarted",value:function(e,t){var n=this;e.stopPropagation(),this.stage.foreach(function(o){var i=o.getClientRects()[0],r=n.props.templateEditor.scale,a=n.props.templateEditor.pixelRatio,l=e.clientX-i.left,c=e.clientY-i.top;(t||new ue.None).map(function(e){n.handleStateUpdate(v(n.props.templateEditor.sceneState,{doubleClicked:{$set:n.props.templateEditor.sceneState.clickedElementId===e.ownId.value||n.props.templateEditor.sceneState.doubleClickedId===e.ownId.value},doubleClickedId:{$set:(n.props.templateEditor.sceneState.clickedElementId===e.ownId.value||n.props.templateEditor.sceneState.doubleClickedId===e.ownId.value)&&e.ownId.value},clickedElementId:{$set:e.ownId.value}})),setTimeout(function(){n.props.templateEditor.activeElementId.foreach(function(e){e&&n.handleStateUpdate(v(n.props.templateEditor.sceneState,{clickedElementId:{$set:""}}))})},250),n.props.templateEditor.activeElementId.map(function(t){t.value!=e.ownId.value&&n.props.dispatch(Object(pe.ec)(e.ownId))}).getOrElse(function(){return n.props.dispatch(Object(pe.ec)(e.ownId))}),n.props.dispatch(Object(pe.Ab)({draggingContext:e.ownId,startedAt:(new Date).getTime(),originalPoint:new ue.Some({pointX:l/(r*a),pointY:c/(r*a)}),currentPoint:new ue.Some({pointX:l/(r*a),pointY:c/(r*a)}),initialElementPosition:new ue.Some({pointX:e.position.x,pointY:e.position.y})}))}).getOrElse(function(){n.handleStateUpdate(v(n.props.templateEditor.sceneState,{doubleClicked:{$set:!1},clickedElementId:{$set:""},doubleClickedId:{$set:""}})),n.props.dispatch(Object(pe.ec)(new Oe.DocumentElementId)),n.props.templateEditor.selectedDrawingContext.map(function(e){n.props.dispatch(Object(pe.Bb)(e)),n.props.dispatch(Object(pe.Eb)({startPoint:new ue.Some({pointX:l/(r*a),pointY:c/(r*a)}),endPoint:new ue.Some({pointX:l/(r*a),pointY:c/(r*a)})}))})})})}},{key:"onTouchEnded",value:function(e){var t=this;e.stopPropagation(),this.stage.foreach(function(n){var o=n.getClientRects()[0],i=t.props.templateEditor.scale,r=t.props.templateEditor.pixelRatio;t.props.templateEditor.sceneState.anchorContext.map(function(n){return t.onAnchorUnselect(e)});var a={pointX:(e.clientX-o.left)/(i*r),pointY:(e.clientY-o.top)/(i*r)};t.props.dispatch(t.props.templateEditor.drawingContext.map(function(e){return Object(pe.Cb)(a)}).getOrElse(function(){return Object(pe.yb)(a)}))})}},{key:"onTouchMove",value:function(e,t){var n=this;e.stopPropagation(),this.stage.foreach(function(t){var o=t.getClientRects()[0],i=e.clientX-o.left,r=e.clientY-o.top,a=n.props.templateEditor.scale,l=n.props.templateEditor.pixelRatio;n.props.templateEditor.sceneState.anchorContext.map(function(e){n.props.templateEditor.sceneState.onResize(e,{x:i/(a*l),y:r/(a*l)})}).getOrElse(function(){return n.props.templateEditor.drawingContext.map(function(e){n.props.dispatch(Object(pe.Db)({pointX:i/(a*l),pointY:r/(a*l)}))}).getOrElse(function(){n.props.templateEditor.sceneState.doubleClicked||n.props.dispatch(Object(pe.zb)({pointX:i/(a*l),pointY:r/(a*l)}))})})})}},{key:"onAbscissaChanged",value:function(e){this.props.dispatch(Object(pe.Fb)(e))}},{key:"onOrdinateChanged",value:function(e){this.props.dispatch(Object(pe.cc)(e))}},{key:"onElementMoveY",value:function(e){var t=this;this.props.templateEditor.activePageIndex.foreach(function(n){t.props.templateEditor.activeElementId.foreach(function(o){Object(ue.headOption)(t.props.templateEditor.pages[n].elements.filter(function(e){return e.ownId.value===o.value})).foreach(function(n){t.onOrdinateChanged(n.position.y+e)})})})}},{key:"onElementMoveX",value:function(e){var t=this;this.props.templateEditor.activePageIndex.foreach(function(n){t.props.templateEditor.activeElementId.foreach(function(o){Object(ue.headOption)(t.props.templateEditor.pages[n].elements.filter(function(e){return e.ownId.value===o.value})).foreach(function(n){t.onAbscissaChanged(n.position.x+e)})})})}},{key:"onMoveUp",value:function(){this.onElementMoveY(-1)}},{key:"onMoveDown",value:function(){this.onElementMoveY(1)}},{key:"onMoveLeft",value:function(){this.onElementMoveX(-1)}},{key:"onMoveRight",value:function(){this.onElementMoveX(1)}},{key:"onAnchorSelect",value:function(e,t){var n=this;e.stopPropagation(),this.stage.foreach(function(o){var i=o.getClientRects()[0],r=e.clientX-i.left,a=e.clientY-i.top,l=n.props.templateEditor.pixelRatio,c=n.props.templateEditor.scale;n.props.templateEditor.activeElementId.map(function(e){return Object(ue.toOption)(n.props.templateEditor.activePageIndex.map(function(t){return n.props.templateEditor.pages[t].elements.find(function(t){return t.ownId.value===e.value})}).getOrElse(function(){})).map(function(e){n.handleStateUpdate(v(n.props.templateEditor.sceneState,{onResize:{$set:t},anchorContext:{$set:new ue.Some({anchorId:"",originalPoint:{pointX:r/(c*l),pointY:a/(c*l)},initialElementPosition:{pointX:e.position.x,pointY:e.position.y},initialElementSize:e.size})}}))}).getOrNull()}).getOrNull(),n.props.templateEditor.draggingContext.foreach(function(e){n.props.dispatch(Object(pe.yb)({pointX:r/(c*l),pointY:a/(c*l)}))})})}},{key:"onAnchorUnselect",value:function(e){this.handleStateUpdate(v(this.props.templateEditor.sceneState,{onResize:{$set:null},anchorContext:{$set:new ue.None}}))}},{key:"onAnchorMove",value:function(e){var t=this;e.stopPropagation(),this.stage.foreach(function(n){var o=n.getClientRects()[0],i=e.clientX-o.left,r=e.clientY-o.top,a=t.props.templateEditor.scale,l=t.props.templateEditor.pixelRatio;t.props.templateEditor.sceneState.anchorContext.map(function(e){t.props.templateEditor.sceneState.onResize(e,{x:i/(a*l),y:r/(a*l)})})})}},{key:"renderResizeFrame",value:function(e){var t=this;return this.props.templateEditor.activeElementId.flatMap(function(n){return Object(ue.headOption)(e.elements.filter(function(e){return e.ownId.value===n.value})).map(function(e){var n=e.rotation,o=e.position,i=e.size.width/2,r=e.size.height/2,a=t.props.templateEditor.scale,l=t.props.templateEditor.pixelRatio;switch(e.display.tpe){case Oe.DocumentElementDisplayImage.$Type:case Oe.DocumentElementDisplayBarcode.$Type:case Oe.DocumentElementDisplayParagraph.$Type:case Oe.DocumentElementDisplayText.$Type:return h.createElement("div",{key:e.ownId.value.toString(),style:{position:"absolute",width:2*i*(a*l)+"px",height:2*r*(a*l)+"px",top:o.y*(a*l)+"px",left:o.x*(a*l)+"px",transform:"rotate("+n+"deg)",border:"1px solid #000",boxSizing:"border-box"}},h.createElement("div",{style:{position:"absolute",width:2*i*(a*l)+"px",height:2*r*(a*l)+"px",top:"0px",left:"0px"},onMouseDown:function(n){return t.onTouchStarted(n,Object(ue.toOption)(e))},onMouseMove:function(n){return t.onTouchMove(n,Object(ue.toOption)(e))},onMouseUp:t.onTouchEnded}),h.createElement(Pn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(In,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Tn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Fn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Nn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(_n,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Wn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Hn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Gn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}));case Oe.DocumentElementDisplayRect.$Type:return h.createElement("div",{key:e.ownId.value.toString(),style:{position:"absolute",width:2*i*(a*l)+"px",height:2*r*(a*l)+"px",top:o.y*(a*l)+"px",left:o.x*(a*l)+"px",transform:"rotate("+n+"deg)"}},h.createElement("div",{style:{position:"absolute",width:2*i*(a*l)+"px",height:2*r*(a*l)+"px",top:"0px",left:"0px"},onMouseDown:function(n){return t.onTouchStarted(n,Object(ue.toOption)(e))},onMouseMove:function(n){return t.onTouchMove(n,Object(ue.toOption)(e))},onMouseUp:t.onTouchEnded}),h.createElement(Pn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(In,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Tn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Fn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Nn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(_n,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Wn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Hn,{onSelect:t.onAnchorSelect,onUnselect:t.onTouchEnded,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}),h.createElement(Gn,{onSelect:t.onAnchorSelect,onUnselect:t.onAnchorUnselect,onMove:t.onAnchorMove,element:e,scale:a*l,dispatch:t.props.dispatch}))}})}).getOrNull()}},{key:"stageRefHandler",value:function(e){e&&(this.stage=Object(ue.toOption)(g.findDOMNode(e)))}},{key:"renderSceneArea",value:function(e){var t=this,n=this.props.templateEditor.pages[e],o=this.props.templateEditor.scale,i=this.props.templateEditor.pixelRatio;if(!n)return h.createElement("div",null," ");var r=i*(n.pageSize.width*o-n.pageSize.width)/2,a=i*(n.pageSize.height*o-n.pageSize.height)/2;return h.createElement("div",{ref:this.stageRefHandler,style:{position:"relative",width:n.pageSize.width*o*i+"px",height:n.pageSize.height*o*i+"px",textAlign:"left"}},h.createElement("div",{onMouseDown:function(e){return t.onTouchStarted(e,new ue.None)},onMouseUp:this.onTouchEnded,onMouseMove:function(e){return t.onTouchMove(e,new ue.None)},style:{position:"absolute",top:"0px",left:"0px",width:n.pageSize.width*o*i+"px",height:n.pageSize.height*o*i+" * pixelRatiopx"}}),h.createElement("div",{style:{position:"relative",width:n.pageSize.width*i+"px",height:n.pageSize.height*i+"px",transform:"translate("+r+"px, "+a+"px) scale("+o+", "+o+")"}},h.createElement("div",{onMouseDown:function(e){return t.onTouchStarted(e,new ue.None)},onMouseUp:this.onTouchEnded,onMouseMove:function(e){return t.onTouchMove(e,new ue.None)},style:{position:"relative",width:n.pageSize.width*i+"px",height:n.pageSize.height*i+"px"}}),this.renderPDFTemplate(),n.elements.map(function(e){return t.renderPageElement(e)}),this.showDrawingPreview().getOrNull()),this.renderResizeFrame(n))}},{key:"getHorizontalAlignment",value:function(e){switch(e){case"center":return new Oe.ElementHorizontalAlignmentCentered;case"left":return new Oe.ElementHorizontalAlignmentLeft;case"right":return new Oe.ElementHorizontalAlignmentRight;case"justify":return new Oe.ElementHorizontalAlignmentJustified;default:throw"uknown alignment"}}},{key:"onTextEditorChange",value:function(e){var t=this,n=Object(ze.convertToRaw)(e.getCurrentContent());Object(ue.headOption)(n.blocks).foreach(function(e){var o,i,r;t.props.dispatch(Object(pe.oc)({body:(o=n,i=t.props.fonts.list,r=Object(ue.headOption)(i).flatMap(function(e){return Object(ue.headOption)(e.fonts)}).getOrElse(function(){throw new Error("There's no fonts")}),o.blocks.map(function(e){var t=function(t){return Object(ue.headOption)(e.entityRanges.filter(function(e){return e.offset<=t&&t<e.offset+e.length})).map(function(e){return e.key})},n=e.inlineStyleRanges.reduce(function(e,t){for(var n=t.offset;n<t.length+t.offset;n++)e[n]?e[n].push(t.style):e[n]=[t.style];return e},[]);return(""===e.text?[{text:"",styles:n[0]?n[0]:[],entityKey:t(0)}]:e.text.split("").reduce(function(e,o,i){var r=[];n[i]&&(r=r.concat(n[i]));var a=t(i);if(0===i)e.push({text:o,styles:r,entityKey:a});else{var l=e[e.length-1];a.map(function(t){l.entityKey.filter(function(e){return e===t}).map(function(){l.text+=o}).getOrElse(function(){e.push({text:o,styles:r,entityKey:a})})}).getOrElse(function(){l.entityKey.isEmpty()&&l.styles.length===r.length&&l.styles.filter(function(e){return r.indexOf(e)>=0}).length===r.length?l.text+=o:e.push({text:o,styles:r,entityKey:a})})}return e},[])).map(function(e){var t=e.entityKey.flatMap(function(e){return Object(ue.liftKey)(o.entityMap,e.toString())}).map(function(e){return e.data.parentFormId?new Oe.DocumentElementDataSourceParentField(new Oe.Id(e.data.parentFormId),new Oe.Id(e.data.refFieldId),new Oe.Id(e.data.displayFieldId)):e.data.sharedValueId?new Oe.DocumentElementDataSourceSharedValue(e.data.sharedValueId):new Oe.DocumentElementDataSourceFormFieldRef(Object(ue.toOption)(new Oe.Id(e.data.formId)),Object(ue.toOption)(new Oe.Id(e.data.fieldId)))}).getOrElse(function(){return new Oe.DocumentElementDataSourceStaticValue(e.text)}),n=e.entityKey.flatMap(function(e){return Object(ue.liftKey)(o.entityMap,e.toString())}).flatMap(function(e){return e.data.substringEffect?e.data.substringEffect:new ue.None}),a=new Oe.DocumentElementDisplayTextChunk(t,new Oe.ElementFont(r),n.map(function(e){return[e]}).getOrElse(function(){return[]}));return e.styles.forEach(function(e){if(0===e.indexOf("fontfamily-")){var t=e.slice("fontfamily-".length);Oe.ElementFont.getFontFile(i,t).foreach(function(e){a=v(a,{font:{font:{$set:e}}})})}if(0===e.indexOf("fontsize-")){var n=e.slice("fontsize-".length);a=v(a,{font:{fontSize:{$set:parseFloat(n)}}})}if(0===e.indexOf("fontcolor-")){var o=e.slice("fontcolor-".length);a=v(a,{font:{color:{$set:o}}})}if(0===e.indexOf("texttransform-")){var r=e.slice("texttransform-".length),l=void 0;switch(r){case"uppercase":l=new Oe.DocumentElementDisplayEffectToUppercase;break;case"lowercase":l=new Oe.DocumentElementDisplayEffectToLowercase;break;case"capitalize":l=new Oe.DocumentElementDisplayEffectToCapitalize}"none"!==r&&(a=v(a,{effects:{$push:[l]}})),"none"===r&&(a=v(a,{effects:{$set:[]}}))}"BOLD"===e&&(a=v(a,{font:{isBold:{$set:!0}}})),"ITALIC"===e&&(a=v(a,{font:{isItalic:{$set:!0}}})),"UNDERLINE"===e&&(a=a=v(a,{font:{isUnderlined:{$set:!0}}}))}),a})}).reduce(function(e,t){return e.concat(t).concat(new Oe.DocumentElementDisplayTextChunk(new Oe.DocumentElementDataSourceStaticValue(String.fromCharCode(10)),new Oe.ElementFont(r),[]))},[]).slice(0,-1)),editorState:new Oe.ContentState(new ue.Some(JSON.stringify(n)))})),e.data instanceof Object&&Object(ue.toOption)(e.data["text-align"]).foreach(function(e){return t.props.dispatch(Object(pe.Xb)(t.getHorizontalAlignment(e)))})})}},{key:"pixelRatioRefHandler",value:function(e){var t=this;e&&Object(ue.toOption)(g.findDOMNode(e)).foreach(function(e){return t.props.dispatch(Object(pe.qc)(e.clientHeight*window.devicePixelRatio/25))})}},{key:"renderPixelRatio",value:function(){return h.createElement("div",{ref:this.pixelRatioRefHandler,className:"TemplateEditorScene__pixel-ratio"})}},{key:"renderPDFTemplate",value:function(){return h.createElement(Co,null)}},{key:"renderTextEditor",value:function(e){var t=this,n=this.props.templateEditor.pages[e];return n&&this.props.templateEditor.sceneState.doubleClicked?this.props.templateEditor.activeElementId.flatMap(function(e){return Object(ue.headOption)(n.elements.filter(function(t){return t.ownId.value===e.value})).filter(function(e){return e.display.tpe.value===Oe.DocumentElementDisplayParagraph.$Type.value}).map(function(e){var n=e.rotation,o=e.position,i=t.props.templateEditor.pixelRatio,r=e.size.width*i/2,a=e.size.height*i/2,l=t.props.templateEditor.scale,c=r*l-r,s=a*l-a,p=e.display.lineSpacing.getOrElse(function(){return 1.2});return h.createElement("div",{style:{width:2*r+"px",height:2*a+"px",position:"absolute",top:o.y*l*i+"px",left:o.x*l*i+"px",transform:"rotate("+n+"deg)"},onMouseDown:function(e){return e.stopPropagation()}},h.createElement(vo,{style:{transform:"translate("+c+"px, "+s+"px) scale("+l+", "+l+")",backgroundColor:"#fff",width:2*r+"px",height:2*a+"px",lineHeight:p,fontSize:"12pt",overflow:"hidden",background:"rgba(255, 255, 255, 0)"},refFields:t.props.templateEditor.refFields,fields:t.props.currentForm.data.flatMap(function(e){return Object(ue.liftKey)(t.props.fields.list,e.id.value)}).getOrElse(function(){return[]}),paragraph:e.display,onChange:t.onTextEditorChange}))})}).getOrNull():null}},{key:"getEffectsStyle",value:function(e){return Object(Eo.a)(e.map(function(e){switch(e.tpe.value){case Oe.DocumentElementDisplayEffectToLowercase.$Type.value:return["textTransform","lowercase"];case Oe.DocumentElementDisplayEffectToUppercase.$Type.value:return["textTransform","uppercase"];case Oe.DocumentElementDisplayEffectToCapitalize.$Type.value:return["textTransform","capitalize"];default:return[]}}))}},{key:"onCreatePage",value:function(){this.props.dispatch(Object(pe.kc)())}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.props.className},0===this.props.templateEditor.pages.length?h.createElement("div",{style:{padding:"20px"}},h.createElement(k.a,{variant:"raised",onClick:this.onCreatePage,color:"primary"},this.props.i18n.t("Добавить страницу"))):this.props.templateEditor.activePageIndex.map(function(t){return h.createElement("div",{style:{position:"relative"}},e.renderPixelRatio(),e.renderSceneArea(t),e.renderTextEditor(t))}).getOrElse(function(){return h.createElement("div",{style:{padding:"20px"}},e.props.i18n.t("Выберите страницу из списка в левой части экрана"))}))}}]),t}(h.Component);ko=Po([m.autobind,xo("design:paramtypes",[Object])],ko);var Io=Object(f.connect)(function(e){return{fonts:e.fonts,i18n:e.i18n,fields:e.fields,currentForm:e.currentForm,templateEditor:e.templateEditor,auth:e.auth,cdnAddress:e.config.cdnAddress}})(ko),jo=n(556),Do=n(84),To=n(124),Mo=n(176),Ao=n(1590),Fo=n(21),zo=n(1510),Ro=n(17),_o=n(71),Vo=n(627),Bo=n(650),No=n(136),Lo=n(1461),Uo=n(105),Wo=(n(2627),function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a}),Xo=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},$o=function(e){var t;e.dispatch(Object(Mo.h)(new Oe.Id(e.params.formId))),e.auth.token.foreach(function(t){return e.dispatch(Object(jo.a)(t))}),e.dispatch((t=new Oe.Id(e.params.templateId),function(e){return e(Object(pe.wc)()),Ro.a.send(new zo.e(t),Object(Fo.e)()).then(function(t){return e(Object(pe.xc)(t.record)),t}).catch(function(t){throw e(Object(pe.vc)(t)),t})})).then(function(t){return t.record.entity.documentSchema.definition.foreach(function(t){t.pages.forEach(function(t){return t.elements.forEach(function(t){return t.dataSource.foreach(function(t){switch(t.tpe){case Oe.DocumentElementDataSourceFormFieldRef.$Type:t.formId.foreach(function(t){return e.dispatch(Object(Do.c)(t)).then(function(e){return console.log("Fields fetched for ",t)})})}})})})})}),Object(Do.e)(new Oe.Id(e.params.formId)).then(function(t){e.dispatch(Object(pe.rc)(t));var n=t.reduce(function(e,t){return e.filter(function(e){return e.value===t.entity.formId.value}).length>0?e:e.concat(t.entity.formId)},[]);Promise.all(n.map(function(e){return Object(Do.d)(e)})).then(function(t){e.dispatch(Object(To.j)({form:new Oe.Id(e.params.formId),fields:t}))})}),e.dispatch(Object(Ao.c)(new Oe.Id(e.params.eventLineId)))},Ho=function(e){function t(e){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Object.assign(te.a.screenInitialState(),{pdftemplatePopover:{open:!1,anchorElement:new ue.None},fileInput:new ue.None})))}return p()(t,e),a()(t,[{key:"renderNavigation",value:function(){return h.createElement(Vo.a,null)}},{key:"openDocumentTemplatesPage",value:function(){var e=this;this.props.currentForm.data.foreach(function(t){return e.props.dispatch(Object(Et.s)(new Oe.Id(e.props.params.eventLineId),new Oe.Id(e.props.params.formTypeId),t.id))})}},{key:"onSave",value:function(){var e=this;this.props.dispatch(function(e,t){return t().templateEditor.record.map(function(n){return e(Object(pe.yc)()),Ro.a.send(new zo.f(v(n,{entity:{documentSchema:{definition:{$set:new ue.Some(new Oe.DocumentSchemaDefinition(t().templateEditor.pages,n.entity.documentSchema.definition.flatMap(function(e){return e.created}),n.entity.documentSchema.definition.flatMap(function(e){return e.updated}),t().templateEditor.pdfTemplate))},images:{$set:t().templateEditor.images},sharedValues:{$set:t().templateEditor.sharedValues}}}})),Object(Fo.f)()).then(function(t){return e(Object(pe.zc)()),t}).catch(function(t){throw e(Object(pe.Ac)(t)),t})}).getOrElse(function(){return Promise.reject("no record context found")})}).then(function(t){return e.props.dispatch(Object(_o.h)(e.props.i18n.t("Изменения успешно сохранены")))}).catch(function(t){return e.props.dispatch(Object(_o.h)(e.props.i18n.t("Сохранения изменений прервалось с ошибкой")))})}},{key:"onScaleChange",value:function(e){this.props.templateEditor.scale<=.2&&!e||(e?this.props.dispatch(Object(pe.tc)(this.props.templateEditor.scale+.15)):this.props.dispatch(Object(pe.tc)(this.props.templateEditor.scale-.15)))}},{key:"onNextPage",value:function(){this.props.dispatch(Object(pe.lc)(this.props.templateEditor.activePageIndex.map(function(e){return e+1}).getOrElse(function(){return 0})))}},{key:"onPrevPage",value:function(){this.props.dispatch(Object(pe.lc)(this.props.templateEditor.activePageIndex.map(function(e){return e-1}).getOrElse(function(){return 0})))}},{key:"onCreatePage",value:function(){this.props.dispatch(Object(pe.kc)())}},{key:"onClonePage",value:function(){var e=this;this.props.templateEditor.activePageIndex.foreach(function(t){return Object(ue.lift)(e.props.templateEditor.pages,t).foreach(function(t){return e.props.dispatch(Object(pe.xb)(t))})})}},{key:"onCreatePageRequest",value:function(e){this.props.openPopover(Object(ue.toOption)(e.currentTarget),h.createElement(h.Fragment,null,h.createElement(_.a,{onClick:this.onCreatePage},this.props.i18n.t("Добавить новую")),h.createElement(_.a,{onClick:this.onClonePage},this.props.i18n.t("Добавить копированием"))))}},{key:"onElementClone",value:function(){var e=this;this.props.templateEditor.activePageIndex.foreach(function(t){return Object(ue.lift)(e.props.templateEditor.pages,t).foreach(function(t){return e.props.templateEditor.activeElementId.foreach(function(n){return Object(ue.headOption)(t.elements.filter(function(e){return e.ownId.value===n.value})).foreach(function(t){return e.props.dispatch(Object(pe.jc)(t))})})})})}},{key:"onRemovePage",value:function(){this.props.dispatch(Object(pe.sc)())}},{key:"onElementDeleted",value:function(){this.props.dispatch(Object(pe.Tb)())}},{key:"handleInputFocus",value:function(){this.props.dispatch(Object(pe.ic)())}},{key:"handleInputBlur",value:function(){this.props.dispatch(Object(pe.hc)())}},{key:"openPdfTemplatePopover",value:function(e){this.state.pdftemplatePopover.open||this.setState(v(this.state,{pdftemplatePopover:{$set:{open:!0,anchorElement:new ue.Some(Object(g.findDOMNode)(e.currentTarget))}}}))}},{key:"closePdfTemplatePopover",value:function(){this.state.pdftemplatePopover.open&&this.setState(v(this.state,{pdftemplatePopover:{$set:{open:!1,anchorElement:new ue.None}}}))}},{key:"fileInputHandler",value:function(e){this.setState(v(this.state,{fileInput:{$set:Object(ue.toOption)(e)}}))}},{key:"fileChanged",value:function(e){var t=this,n=e.target.files[0];Object(qt.h)(n,this.props.cdnAddress,this.props.auth.token,this.props.organisation.organisationId,this.props.eventLine.eventLineId,new ue.None,new ue.None,"true").then(function(e){t.onPdfTemplateFileChanged(e)}).catch(function(e){console.log("File uploaded with error",e)})}},{key:"onPdfTemplateLoad",value:function(){this.state.fileInput.foreach(function(e){e.click()})}},{key:"onPdfTemplateFileChanged",value:function(e){var t=this;this.props.templateEditor.pdfTemplate.map(function(n){t.props.dispatch(Object(pe.pc)(v(n,{fileId:{$set:e}})))}).getOrElse(function(){t.props.dispatch(Object(pe.pc)(new Oe.PdfTemplate(e,!1)))})}},{key:"onPdfTemplatePrintEnabledChanged",value:function(){var e=this;this.props.templateEditor.pdfTemplate.map(function(t){e.props.dispatch(Object(pe.pc)(v(t,{enabled:{$set:!t.enabled}})))})}},{key:"onPdfTemplateShowEnabledChanged",value:function(){var e=this;this.props.templateEditor.pdfTemplate.map(function(t){e.props.dispatch(Object(pe.pc)(v(t,{showEnabled:{$set:!t.showEnabled}})))})}},{key:"render",value:function(){var e=this,t=this.props.i18n,n=this.props.templateEditor.record.map(function(t){return e.props.i18n.t("Шаблон")+" "+t.entity.name}).getOrElse(function(){return e.props.i18n.t("Шаблон документа не найден")});return this.renderScreenBody({className:"formBlockPage"},h.createElement("div",{className:"templateEditorPage"},h.createElement("input",{ref:this.fileInputHandler,type:"file",onChange:this.fileChanged,style:{display:"none"}}),h.createElement(j.a,{className:"templateEditorPage-nav"},h.createElement(w.a,{onClick:this.openDocumentTemplatesPage},h.createElement(B.a,null)),h.createElement("div",{style:{flex:1,textAlign:"center"}},this.props.templateEditor.fetching?h.createElement(O.a,{style:{marginTop:"6px"},size:36}):h.createElement(z.a,{variant:"title",style:{lineHeight:"48px"}},n)),h.createElement(k.a,{variant:"raised",style:{margin:"6px 24px"},onClick:this.onSave,color:"primary"},t.t("Сохранить"))),h.createElement("div",{className:"templateEditorPage__viewport"},h.createElement("div",{className:"templateEditorPage__viewport-page-scene"},h.createElement(St,{className:"templateEditorPage__actionsMenu",openDialog:this.openDialog,handleDialogClose:this.handleDialogClose}),h.createElement(P.a,{style:{overflow:"hidden",flex:"1 1 auto",position:"relative",height:"100%",display:"flex",flexDirection:"column"}},h.createElement(yn,{className:"templateEditorPage__attributes",onInputBlur:this.handleInputBlur,onInputFocus:this.handleInputFocus,handleDialogClose:this.handleDialogClose,openDialog:this.openDialog}),h.createElement(P.a,{style:{padding:"200px 60px 80px 60px",textAlign:"center",flex:"1 1 auto",overflow:"auto",width:"100%",height:"100%",boxSizing:"border-box",position:"relative",border:"none"},onMouseDown:function(){return e.props.dispatch(Object(pe.ec)(new Oe.DocumentElementId))}},h.createElement(P.a,{style:{display:"inline-block"}},h.createElement(Io,{openDialog:this.openDialog,handleDialogClose:this.handleDialogClose,className:"templateEditorPage__scene"}))),h.createElement("div",{className:"templateEditorPage__navigation"},h.createElement("div",{className:"templateEditorPage__pageNumber"},this.props.templateEditor.activePageIndex.getOrElse(function(){return-1})+1+"/"+this.props.templateEditor.pages.length),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",disabled:this.props.templateEditor.activePageIndex.filter(function(e){return 0!==e}).isEmpty(),onClick:this.onPrevPage},h.createElement(W.a,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",disabled:this.props.templateEditor.activePageIndex.filter(function(t){return t!==e.props.templateEditor.pages.length-1}).isEmpty(),onClick:this.onNextPage},h.createElement(L.a,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",disabled:this.props.templateEditor.activePageIndex.isEmpty(),onClick:function(t){return e.onScaleChange(!0)}},h.createElement($.a,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",disabled:this.props.templateEditor.activePageIndex.isEmpty(),onClick:function(t){return e.onScaleChange(!1)}},h.createElement(Y.a,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",onClick:this.onCreatePageRequest},h.createElement(K,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",disabled:this.props.templateEditor.pages.length<1,onClick:this.onRemovePage},h.createElement(q,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",onClick:this.openPdfTemplatePopover},h.createElement(J.a,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",onClick:this.onElementClone},h.createElement(Bo.a,null)),h.createElement(k.a,{variant:"fab",mini:!0,className:"templateEditorPage__navMargin",onClick:this.onElementDeleted},h.createElement(ee.a,null)))))),this.state.pdftemplatePopover.open&&h.createElement(T.a,{open:this.state.pdftemplatePopover.open,anchorEl:this.state.pdftemplatePopover.anchorElement.getOrElse(function(){throw"popover anchor hasn't been provided"}),anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},onClose:this.closePdfTemplatePopover,style:{marginBottom:"10px",transform:"translate(0px, -10px)"}},h.createElement("div",{style:{padding:"10px 30px"}},h.createElement("p",{style:{marginBottom:"10px",textAlign:"center"}},this.props.templateEditor.pdfTemplate.nonEmpty()?this.props.i18n.t("Файл подложки был загружен"):this.props.i18n.t("Файл подложки не загружен")),h.createElement("div",{style:{marginBottom:"10px",textAlign:"center"}},h.createElement(k.a,{variant:"raised",color:"primary",onClick:this.onPdfTemplateLoad},this.props.templateEditor.pdfTemplate.isEmpty()?this.props.i18n.t("Загрузить"):this.props.i18n.t("Заменить"))),h.createElement("div",{style:{marginBottom:"10px"}},h.createElement(A.a,{label:this.props.i18n.t("Показать подложку "),style:{textAlign:"center"},control:h.createElement(y.a,{checked:this.props.templateEditor.pdfTemplate.map(function(e){return e.showEnabled}).getOrElse(function(){return!1}),disabled:this.props.templateEditor.pdfTemplate.isEmpty(),onChange:this.onPdfTemplateShowEnabledChanged})})),h.createElement("div",{style:{marginBottom:"10px"}},h.createElement(A.a,{label:this.props.i18n.t("Печатать подложку"),style:{textAlign:"center"},control:h.createElement(y.a,{checked:this.props.templateEditor.pdfTemplate.map(function(e){return e.enabled}).getOrElse(function(){return!1}),disabled:this.props.templateEditor.pdfTemplate.isEmpty(),onChange:this.onPdfTemplatePrintEnabledChanged})}))))))}}]),t}(te.a);Ho=Wo([m.autobind,Xo("design:paramtypes",[Object])],Ho);t.default=Object(f.connect)(function(e){return{i18n:e.i18n,auth:e.auth,currentForm:e.currentForm,templateEditor:e.templateEditor,forms:e.forms,eventLine:e.eventLine,organisation:e.organisation,cdnAddress:e.config.cdnAddress}})(Object(Lo.a)(Object(No.a)(function(e){e.isTokenChecked&&$o(e)},function(){},function(e,t){e.params.templateId!==t.params.templateId&&$o(e),e.params.templateId===t.params.templateId&&e.isTokenChecked&&!t.isTokenChecked&&$o(e)})(Object(Uo.a)(Ho))))}}]);