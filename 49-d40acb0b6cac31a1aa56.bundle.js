(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[49],{1509:function(e,t,n){"use strict";n(244);var r=n(17),o=n(6),i=n.n(o),a=n(7),c=n.n(a),u=n(8),s=n.n(u),l=n(18),p=(function(e){function t(){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","List",{}))}s()(t,e)}(l.a),function(e){function t(e){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListForm",{formId:e}))}s()(t,e)}(l.a),function(e){function t(e){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","ListFormDescriptions",{formId:e}))}return s()(t,e),t}(l.a)),d=function(e){function t(e){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Update",{config:e}))}return s()(t,e),t}(l.a),f=function(e){function t(e){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Create",{config:e}))}return s()(t,e),t}(l.a),h=function(e){function t(e){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Delete",{configId:e}))}return s()(t,e),t}(l.a),m=function(e){function t(e){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Config","Request",{configId:e}))}return s()(t,e),t}(l.a),b=n(21);n.d(t,"c",function(){return v}),n.d(t,"e",function(){return O}),n.d(t,"d",function(){return g}),n.d(t,"a",function(){return y}),n.d(t,"b",function(){return j});var v=function(e){return r.a.send(new p(e),function(e){return e})},O=function(e){return r.a.send(new d(e),Object(b.f)())},g=function(e){return r.a.send(new m(e),Object(b.e)())},y=function(e){return r.a.send(new f(e),Object(b.f)())},j=function(e){return r.a.send(new h(e),b.d)}},1512:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return c});var r=n(244),o=n(1509),i=n(87),a=function(e){return function(t,n){return t(Object(r.h)({form:e})),o.c(e).then(function(n){return t(Object(r.i)({form:e,resolved:n})),n}).catch(function(n){throw t(Object(r.g)({form:e,error:n})),n})}},c=function(e){return function(t){return t(Object(i.b)(function(e){return!e.exportPipelines.descriptionsFetching&&e.exportPipelines.descriptionsFetching},a(e)))}}},1597:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(2)),i=(0,r(n(44)).default)(o.default.createElement(o.default.Fragment,null,o.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),o.default.createElement("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"})),"CloudDownload");t.default=i},1806:function(e,t,n){"use strict";var r=n(448),o=n(17),i=n(6),a=n.n(i),c=n(7),u=n.n(c),s=n(8),l=n.n(s),p=n(18),d=function(e){function t(e){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","List",{pipelineId:e}))}return l()(t,e),t}(p.a),f=(function(e){function t(e){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Update",{operation:e}))}l()(t,e)}(p.a),function(e){function t(e,n){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Execute",{pipelineId:e,filter:n}))}return l()(t,e),t}(p.a)),h=(function(e){function t(e){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","Delete",{operationId:e}))}l()(t,e)}(p.a),function(e){function t(e,n,r){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Export.Operation","ExecuteParent",{pipelineId:e,formDataList:n,refFieldId:r}))}return l()(t,e),t}(p.a)),m=n(21);n.d(t,"c",function(){return b}),n.d(t,"a",function(){return v}),n.d(t,"b",function(){return O});var b=function(e){return function(t){return t(Object(r.b)()),o.a.send(new d(e),Object(m.g)()).then(function(e){return t(Object(r.c)(e.list)),e}).catch(function(e){throw t(Object(r.a)(e)),e})}},v=function(e,t){return o.a.send(new f(e,t),Object(m.f)())},O=function(e,t,n){return o.a.send(new h(e,t,n),Object(m.f)())}},1886:function(e,t,n){"use strict";var r=n(496),o=n(17),i=n(6),a=n.n(i),c=n(7),u=n.n(c),s=n(8),l=n.n(s),p=n(18),d=function(e){function t(){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Printers","List",{}))}return l()(t,e),t}(p.a),f=function(e){function t(){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Printers","Scan",{}))}return l()(t,e),t}(p.a),h=function(e){function t(e){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Printers","PrintFile",{fileId:e}))}return l()(t,e),t}(p.a),m=n(21);n.d(t,"a",function(){return b}),n.d(t,"c",function(){return v}),n.d(t,"b",function(){return O});var b=function(){return function(e){return e(Object(r.e)()),o.a.send(new d,Object(m.g)()).then(function(t){return e(Object(r.f)(t.list)),t}).catch(function(t){throw e(Object(r.d)(t)),t})}},v=function(){return function(e){return e(Object(r.e)()),o.a.send(new f,Object(m.i)()).then(function(t){return e(b()),t}).catch(function(t){throw e(Object(r.d)(t)),t})}},O=function(e){return o.a.send(new h(e),function(e){return e})}},1990:function(e,t,n){"use strict";var r=n(4),o=n.n(r),i=n(6),a=n.n(i),c=n(10),u=n.n(c),s=n(7),l=n.n(s),p=n(8),d=n.n(p),f=n(2),h=n(14),m=n(3),b=n(160),v=n.n(b),O=n(98),g=n.n(O),y=n(107),j=n.n(y),k=n(1),R=n(136),E=n(1512),F=n(0),I=n(652),C=n(54),P=n.n(C),w=n(189),D=n.n(w),V=function(e){function t(e){a()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={exporting:{}},n}return d()(t,e),u()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;Object(F.toOption)(0===this.getExports(this.props).length&&1===this.getExports(e).length).filter(function(e){return e}).foreach(function(){return Object(F.headOption)(t.getExports(e)).foreach(function(e){return e.foreach(function(e){return k.Id.createId(e.id.toString()).foreach(function(e){return t.props.onSelect(e)})})})})}},{key:"getExports",value:function(e){return e.user.userRole.map(function(t){var n=t.entity.getExports(e.formId);return e.eventLine.data.map(function(e){return t.entity.canAdminEvent(e.id)}).getOrElse(function(){return!1})?Object(I.d)(e.exportPipelines,e.formId).getOrElse(function(){return[]}).map(function(e){return Object(F.toOption)(e)}):n.map(function(t){return Object(F.headOption)(Object(I.d)(e.exportPipelines,e.formId).getOrElse(function(){return[]}).filter(function(e){return e.id.toString()===t.value}))})}).getOrElse(function(){return[]})}},{key:"exportInProccess",value:function(e,t){this.setState(m(this.state,{exporting:{$set:Object.assign({},this.state.exporting,o()({},e.value,t))}}))}},{key:"exportInProcess",value:function(e){return Object(F.liftKey)(this.state.exporting,e.id.toString()).getOrElse(function(){return!1})}},{key:"render",value:function(){var e=this;return Object(I.f)(this.props.exportPipelines,this.props.formId).getOrElse(function(){return!0})?f.createElement(v.a,null):0===this.getExports(this.props).length?f.createElement("p",null,this.props.i18n.t("Нет доступных экспортов")):f.createElement(g.a,null,this.getExports(this.props).map(function(t){return t.map(function(t){return f.createElement(j.a,{button:!0,disabled:e.exportInProcess(t),onClick:function(){return k.Id.createId(t.id.toString()).foreach(function(t){return e.props.onSelect(t)})}},e.exportInProcess(t)&&f.createElement(D.a,null,f.createElement(v.a,null)),f.createElement(P.a,{primary:t.name}))}).getOrNull()}))}}]),t}(f.Component);t.a=Object(h.connect)(function(e){return{i18n:e.i18n,exportPipelines:e.exportPipelines,user:e.user,eventLine:e.eventLine}})(Object(R.a)(function(e){e.isTokenChecked&&Object(I.d)(e.exportPipelines,e.formId).isEmpty()&&e.dispatch(Object(E.b)(e.formId))},function(){},function(e,t){e.formId.value!==t.formId.value&&Object(I.d)(e.exportPipelines,e.formId).isEmpty()&&e.dispatch(Object(E.b)(e.formId)),e.formId.value===t.formId.value&&e.isTokenChecked&&!t.isTokenChecked&&Object(I.d)(e.exportPipelines,e.formId).isEmpty()&&e.dispatch(Object(E.b)(e.formId))})(V))},1998:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(2)),i=(0,r(n(44)).default)(o.default.createElement(o.default.Fragment,null,o.default.createElement("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"}),o.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"})),"LocalPrintshop");t.default=i},2005:function(e,t,n){"use strict";var r=n(2),o=n(94),i=n.n(o);t.a=function(e){return r.createElement(i.a,Object.assign({},e),r.createElement("path",{d:"M2,6H4V18H2V6M5,6H6V18H5V6M7,6H10V18H7V6M11,6H12V18H11V6M14,6H16V18H14V6M17,6H20V18H17V6M21,6H22V18H21V6Z"}))}},2694:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(2)),i=(0,r(n(44)).default)(o.default.createElement(o.default.Fragment,null,o.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),o.default.createElement("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"})),"AddCircleOutline");t.default=i},2695:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(2)),i=(0,r(n(44)).default)(o.default.createElement(o.default.Fragment,null,o.default.createElement("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"}),o.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"})),"List");t.default=i},2696:function(e,t,n){var r=n(2697);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(121)(r,o);r.locals&&(e.exports=r.locals)},2697:function(e,t,n){(e.exports=n(120)(!1)).push([e.i,".ObjRefsTableEditor__button {\n  border: 1px solid grey;\n  margin-left: 5px;\n  margin-right: 5px;\n  padding: 4px;\n  border-radius: 5px; }\n  .ObjRefsTableEditor__button:hover {\n    cursor: pointer;\n    background-color: #f2f2f2; }\n",""])},2698:function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(2)),i=(0,r(n(44)).default)(o.default.createElement(o.default.Fragment,null,o.default.createElement("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"}),o.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"})),"Adjust");t.default=i},2729:function(e,t,n){"use strict";n.r(t);var r=n(6),o=n.n(r),i=n(10),a=n.n(i),c=n(7),u=n.n(c),s=n(8),l=n.n(s),p=n(2),d=n(14),f=n(372),h=n(29),m=n(0),b=n(1453),v=n(43),O=n.n(v),g=n(4),y=n.n(g),j=n(11),k=n.n(j),R=n(13),E=n(308),F=n(52),I=n.n(F),C=n(19),P=n.n(C),w=n(25),D=n.n(w),V=n(241),S=n.n(V),_=n(243),x=n.n(_),T=n(242),$=n.n(T),A=n(261),B=n.n(A),L=n(26),M=n.n(L),q=n(86),H=n.n(q),z=n(414),N=n.n(z),W=n(1767),K=n.n(W),U=n(1998),G=n.n(U),J=n(2698),Z=n.n(J),Q=n(1593),X=n.n(Q),Y=n(2005),ee=n(94),te=n.n(ee),ne=function(e){return p.createElement(te.a,Object.assign({},e),p.createElement("path",{d:"M15,7H20.5L15,1.5V7M8,0H16L22,6V18A2,2 0 0,1 20,20H8C6.89,20 6,19.1 6,18V2A2,2 0 0,1 8,0M4,4V22H20V24H4A2,2 0 0,1 2,22V4H4Z"}))},re=n(1597),oe=n.n(re),ie=n(1518),ae=n.n(ie),ce=n(415),ue=n(1),se=n(240);var le=function(e){if(!(e.hasOwnProperty("block")&&e.hasOwnProperty("i18n")&&e.hasOwnProperty("blockId")))return e;var t=e.block,n=e.i18n,r=e.blockId;return Object.assign({},e,{i18n:pe(n,t,r)})};function pe(e,t,n){return Object(se.b)(t,n).filter(function(e){return e.entity.languageConfig.enabled}).map(function(n){var r=n.entity.languageConfig.langs,o=t.settings.selectedLangOrderIndex;return{t:function(e){return Object(m.headOption)(r.filter(function(e){return e.order===o})).flatMap(function(t){return Object(m.liftKey)(t.translationMap,e)}).getOrElse(function(){return e})},code:e.code}}).getOrElse(function(){return e})}var de=n(1492),fe=n(100),he=n(1498),me=n(621),be=n(215),ve=n(3),Oe=n(1504),ge=n(1466),ye=n(216),je=n(147),ke=n(59),Re=n(71),Ee=n(1806),Fe=n(623),Ie=n(1886),Ce=n(1990),Pe=n(636),we=function(e,t){return function(n,r){var o=n(Object(he.c)(e)).filter(function(e){return e instanceof ue.MembersLimitLinkedValues}),i=t.filter(function(e){return o.filter(function(t){return t.linkedFieldId.value===e.id.value}).length>0}).map(function(e){return e.entity.valueType.family}).map(function(e){return n(Object(Pe.b)(e,new m.None))});return Promise.all(i)}},De=n(1540),Ve=n(1534),Se=n(201),_e=n(1501),xe=n(188),Te=n(104),$e=n(1503),Ae=n(174),Be=n(1459),Le=n(2694),Me=n.n(Le),qe=n(2695),He=n.n(qe),ze=n(640),Ne=n(620),We=n(83),Ke=n(1502),Ue=n(639),Ge=n(1541),Je=n(1470),Ze=n(46),Qe=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Xe=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),a()(t,[{key:"onSaveClick",value:function(e){var t=this;this.getDocumentPdfFileId(e).matchWith(function(e){t.props.dispatch(Object(Je.c)(e))},function(){t.props.dispatch(Object(Re.h)(t.props.i18n.t("Файл в документе не найден")))})}},{key:"getDocumentIssueDate",value:function(e){var t=this;return this.props.dateFormField.flatMap(function(t){return Object(m.liftKey)(e.entity.values,t.id.value)}).matchWith(function(e){return e.value.toString()},function(){return t.props.i18n.t("Значение не найдено")})}},{key:"getDocumentPdfFileId",value:function(e){return this.props.pdfFormField.flatMap(function(t){return Object(m.liftKey)(e.entity.values,t.id.value)}).filter(function(e){return e.value.tpe.value===ue.ValueFileList.$Type.value}).flatMap(function(e){return Object(m.headOption)(e.value.files)})}},{key:"getDocumentIssueTime",value:function(e){var t=this;return this.props.timeFormField.flatMap(function(t){return Object(m.liftKey)(e.entity.values,t.id.value)}).matchWith(function(e){return e.value.toString()},function(){return t.props.i18n.t("Значение не найдено")})}},{key:"getDocumentActiveStatus",value:function(e){var t=this;return this.props.activeStatusFormField.flatMap(function(t){return Object(m.liftKey)(e.entity.values,t.id.value)}).matchWith(function(e){return e.value.toString()},function(){return t.props.i18n.t("Значение не найдено")})}},{key:"render",value:function(){var e=this;return p.createElement(ce.a,{showId:!1,fetching:this.props.isDocumentRecordsFetching,error:this.props.documentRecordsError,empty:0===this.props.documentRecords.getOrElse(function(){return[]}).length,withActions:!0,headers:[{id:"date",title:this.props.i18n.t("Дата")},{id:"time",title:this.props.i18n.t("Время")},{id:"status",title:this.props.i18n.t("Статус активности")}],rows:this.props.documentRecords.getOrElse(function(){return[]}).sort(function(e,t){return e.id.value>t.id.value?1:-1}).map(function(t,n){return{payload:t,id:n.toString(),fields:[e.getDocumentIssueDate(t),e.getDocumentIssueTime(t),e.getDocumentActiveStatus(t)],buttons:[p.createElement(D.a,{key:"download",style:Ze.f,onClick:function(n){n.stopPropagation(),e.onSaveClick(t)}},p.createElement(oe.a,{style:Ze.g}))]}})})}}]),t}(p.Component);Xe=Qe([R.autobind],Xe);var Ye=Object(d.connect)(function(e,t){var n=t.document.entity.logParams.refId.filter(function(e){return t.document.entity.logParams.enabled}).flatMap(function(n){return Object(h.d)(e,t.document.entity.form,n)}).filter(function(e){return e.entity.valueType.tpe.value===ue.ValueTypeObjectRefs.$Type.value}),r=n.map(function(e){return e.entity.valueType.family}).flatMap(function(t){return Object(h.e)(e.fields,t)}).getOrElse(function(){return[]});return{i18n:e.i18n,documentRecords:Object(Ue.b)(e.documentRecords,t.formRecord.id,t.document.id),isDocumentRecordsFetching:Object(Ue.e)(e.documentRecords,t.formRecord.id,t.document.id),documentRecordsError:Object(Ue.c)(e.documentRecords,t.formRecord.id,t.document.id),documentLogFormField:n,dateFormField:Object(m.headOption)(r.filter(function(e){return"date"===e.entity.name})),timeFormField:Object(m.headOption)(r.filter(function(e){return"time"===e.entity.name})),pdfFormField:Object(m.headOption)(r.filter(function(e){return"pdf"===e.entity.name})),activeStatusFormField:Object(m.headOption)(r.filter(function(e){return"active"===e.entity.name}))}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,t,n)},{areStatesEqual:function(e,t){return e.documentRecords===t.documentRecords&&e.fields===t.fields&&e.i18n===t.i18n},areStatePropsEqual:function(e,t){return Object(m.isEqual)(e.documentRecords,t.documentRecords)&&Object(m.isEqual)(e.documentLogFormField,t.documentLogFormField)&&Object(m.isEqual)(e.pdfFormField,t.pdfFormField)&&Object(m.isEqual)(e.documentRecordsError,t.documentRecordsError)&&e.isDocumentRecordsFetching===t.isDocumentRecordsFetching&&e.i18n===t.i18n}})(Object(Ne.a)([function(e){e.documentLogFormField.foreach(function(t){Object(m.liftKey)(e.formRecord.entity.values,t.id.value).foreach(function(n){e.dispatch(Object(Ge.b)(t.entity.valueType.family,e.document.id,e.formRecord.id,n.value.id)),e.dispatch(Object(Ae.e)(t.entity.valueType.family))})})}])(Xe)),et=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tt=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),a()(t,[{key:"onIssueDocumentClick",value:function(e){var t=this;this.props.dispatch(Object(Ke.a)(this.props,this.props.formRecord.id,e,!1)).then(function(n){n.matchWith(function(n){t.openDocumentRecordsList(e)},function(e){t.props.dispatch(Object(Re.h)(t.props.i18n.t("При генерации документа произошла ошибка")))})})}},{key:"openDocumentRecordsList",value:function(e){var t=this;Object(je.i)(this.props.formRecord.entity.formId,this.props.formRecord.id).then(function(n){var r=t.props.openDialog(t.props.i18n.t("Сгенерированные документы"),p.createElement(Ye,{formRecord:n.record,document:e}),[p.createElement(P.a,{key:"close",variant:"raised",style:{marginRight:"10px"},onClick:function(){return t.props.handleDialogClose(r)}},t.props.i18n.t("Закрыть"))])})}},{key:"onListClick",value:function(e){this.openDocumentRecordsList(e)}},{key:"render",value:function(){var e=this;return p.createElement(ce.a,{showId:!1,fetching:this.props.isDocumentsFetching,error:this.props.documentsError,empty:0===this.props.documents.getOrElse(function(){return[]}).length,withActions:!0,headers:[{id:"documentName",title:this.props.i18n.t("Название документа")}],rows:this.props.documents.getOrElse(function(){return[]}).map(function(t,n){return{payload:t,id:n.toString(),fields:[t.entity.name],buttons:[p.createElement(D.a,{key:"generate",style:Ze.f,onClick:function(n){n.stopPropagation(),e.onIssueDocumentClick(t)}},p.createElement(Me.a,{style:Ze.g})),p.createElement(D.a,{key:"list",style:Ze.f,onClick:function(n){n.stopPropagation(),e.onListClick(t)}},p.createElement(He.a,{style:Ze.g}))]}})})}}]),t}(p.Component);tt=et([R.autobind],tt);var nt=Object(d.connect)(function(e,t){return{i18n:e.i18n,documents:Object(ze.b)(e.formDataDocuments,t.formRecord.id),isDocumentsFetching:Object(ze.e)(e.formDataDocuments,t.formRecord.id),documentsError:Object(ze.c)(e.formDataDocuments,t.formRecord.id)}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,t,n)},{areStatesEqual:function(e,t){return e.formDataDocuments===t.formDataDocuments&&e.i18n===t.i18n},areStatePropsEqual:function(e,t){return Object(m.isEqual)(e.documents,t.documents)&&Object(m.isEqual)(e.documentsError,t.documentsError)&&e.isDocumentsFetching===t.isDocumentsFetching&&e.i18n===t.i18n}})(Object(Ne.a)([function(e){e.dispatch(Object(Ke.b)(e.formRecord.entity.formId,e.formRecord.id))}])(Object(We.a)(tt))),rt=n(626),ot=n(1454),it=n(409),at=n.n(it),ct=(n(2696),n(322)),ut=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},st=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},lt=function(e){function t(e){o()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={dialog:{open:!1,actions:[],title:new m.None,body:new m.None,width:new m.None},saveBlock:!1,markedFormRecords:[],processedFormRecords:[],currentPage:0,rowPerPage:20,searchValue:"",requestedCloseEnabled:!0},n}return l()(t,e),a()(t,[{key:"fetchFormRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.None;return this.props.parentRecordId.map(function(n){return e.props.dispatch(Object(Oe.a)(new ue.DataPageRequest(e.state.currentPage,e.state.rowPerPage,e.props.objRefFormId,t),new ue.ParentFormData(e.props.formId,n,e.props.output.formField),e.props.control,e.props.display.id,e.props.blockRendererId))})}},{key:"onChange",value:function(e){this.props.onChange(e,this.props.output)}},{key:"sliceCurrentPage",value:function(e){return e.slice(this.state.currentPage*this.state.rowPerPage,(this.state.currentPage+1)*this.state.rowPerPage)}},{key:"handleDialogClose",value:function(e){(e||this.state.requestedCloseEnabled)&&this.setState(ve(this.state,{dialog:{open:{$set:!1},width:{$set:new m.None}},requestedCloseEnabled:{$set:!0}}))}},{key:"openDialog",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments[3];this.setState(ve(this.state,{dialog:{$set:{open:!0,title:new m.Some(e),body:new m.Some(t),actions:n||[],width:Object(m.toOption)(r)}}}))}},{key:"convertDataOutputValuesToFormFieldValues",value:function(e){return e.map(function(e){return new ue.FormFieldValue(e.output.formField,e.value)}).filter(function(e){return""!==e.formFieldId.value}).reduce(function(e,t){return e[t.formFieldId.value]=t,e},{})}},{key:"getLimitValue",value:function(e,t){var n=this;return Object(m.headOption)(this.props.dispatch(Object(he.c)(this.props.blockRendererId)).filter(function(n){return n.cfgId===e&&n instanceof ue.MembersLimitLinkedValues&&n.linkedValues.filter(function(e){return e.dictId.value===t.value}).length>0})).flatMap(function(r){return Object(m.headOption)(n.props.dispatch(Object($e.b)(n.props.blockRendererId)).getOrElse(function(){return[]}).filter(function(t){return t.cfgId===e})).flatMap(function(e){return Object(m.toOption)(e.data.values.get(t.value))})})}},{key:"getInitialDictionaries",value:function(e){var t,n=this,r=this.props.dispatch((t=this.props.formId,function(e,n){return Object(Te.e)(n().forms,t)})).map(function(e){return e.entity.limits}).getOrElse(function(){return[]});return this.props.dispatch(Object($e.b)(this.props.blockRendererId)).map(function(t){return t.filter(function(e){return e.data instanceof ue.LimitDataLinkedValues}).reduce(function(t,o){return Object(m.headOption)(n.props.objRefFormFields.getOrElse(function(){return[]}).filter(function(e){return Object(m.headOption)(r.filter(function(e){return e.limitType.id===o.cfgId})).filter(function(t){return t.limitType.memberTypeId.value===e.id.value}).nonEmpty()})).map(function(r){return ve(t,y()({},r.entity.valueType.family.value,{$set:n.props.dispatch(Object(Pe.d)(r.entity.valueType.family)).map(function(t){return t.map(function(e){return{formRecord:e,limitValue:Object(m.toOption)(o.data.values.get(e.id.value))}}).map(function(t){return Object.assign({},t,{freeAmount:t.limitValue.map(function(e){return e.avail}).getOrElse(function(){return 0})+e.flatMap(function(e){return Object(m.liftKey)(e,r.id.value).filter(function(e){return e.value.tpe.value===ue.ValueObjectRefs.$Type.value}).map(function(e){return e.value.id.filter(function(e){return e.value===t.formRecord.id.value}).length>0?1:0})}).getOrElse(function(){return 0})})}).filter(function(e){return e.freeAmount>0&&e.limitValue.filter(function(e){return e.limitPresent}).nonEmpty()||!o.required&&e.limitValue.filter(function(e){return e.limitPresent}).isEmpty()}).map(function(e){return e.limitValue.filter(function(e){return e.limitPresent}).matchWith(function(t){return Object(m.headOption)(r.entity.valueType.displayFields).map(function(n){return ve(e.formRecord,{entity:{values:{$set:Object.keys(e.formRecord.entity.values).reduce(function(n,r){return ue.Id.createId(r).flatMap(function(t){return e.formRecord.entity.getFormFieldValue(t)}).filter(function(e){return e.value instanceof ue.ValueStr}).matchWith(function(o){return ve(n,y()({},r,{$set:ve(o,{value:{$set:new ue.ValueStr(o.value.toString()+" "+e.freeAmount+"/"+t.all)}})}))},function(){return n})},e.formRecord.entity.values)}}})}).getOrElse(function(){return e.formRecord})},function(){return e.formRecord})})}).getOrElse(function(){return[]})}))}).getOrElse(function(){return t})},{})}).getOrElse(function(){})}},{key:"checkFormRecordLimits",value:function(){var e=this.props.dispatch(Object($e.b)(this.props.blockRendererId)).getOrElse(function(){return[]});if(0===e.length)return!0;if(e.filter(function(e){return e.data instanceof ue.LimitDataTotal&&(e.data.values.avail<1&&e.data.values.limitPresent&&e.required||!e.data.values.limitPresent&&e.required)}).length>0)return!1;var t=e.filter(function(e){return e.data instanceof ue.LimitDataLinkedValues});return!(t.length>0&&0===t.filter(function(e){return[].concat(O()(e.data.values)).filter(function(t){return t[1].avail>0||!t[1].limitPresent&&!e.required}).length>0}).length)}},{key:"onCreateClick",value:function(){var e=this;this.fetchFormRecordLimits().foreach(function(t){t.then(function(){e.checkFormRecordLimits()?e.setState(ve(e.state,{requestedCloseEnabled:{$set:!1}}),function(){return e.onCreateWithLimitDictionariesRequested()}):e.showExceedLimitsDialog()}).catch(function(t){e.props.dispatch(Object(Se.b)(t))})})}},{key:"showExceedLimitsDialog",value:function(){var e=this;this.openDialog(this.props.i18n.t("Новая запись"),p.createElement("div",null,this.props.i18n.t("Создание новой записи невозможно, так как превышен лимит")),[p.createElement(P.a,{variant:"raised",onClick:function(t){return e.handleDialogClose(!0)}},this.props.i18n.t("Закрыть"))])}},{key:"childRegistration",value:function(e,t,n){var r=this;return this.props.dispatch(this.props.parentRecordId.matchWith(function(o){return Object(ge.d)(e,o,r.props.output.formField,t,n,r.props.control.formDataRefOperations.parentFieldId.filter(function(){return r.props.control.formDataRefOperations.writingParentId}))},function(){return Object(ge.c)(e,t,n)}))}},{key:"getInitialValues",value:function(){var e,t,n=this;return this.props.dispatch((e=this.props.control,t=this.props.blockRendererId,function(n,r){return new Promise(function(n,o){var i=r().blockRendererContext;n(e.formDataRefOperations.fieldConnectionEnabled?e.formDataRefOperations.fieldConnections.reduce(function(e,n){return Object(f.g)(i,t,n.parentField).map(function(t){return e[n.childField.value]=new ue.FormFieldValue(n.childField,t),e}).getOrElse(function(){return e})},{}):{})})})).then(function(e){return n.getChildFormFieldValue().matchWith(function(t){return Object.assign(e,y()({},t.formFieldId.value,t))},function(){return e})})}},{key:"onCreateWithLimitDictionariesRequested",value:function(){var e=this;this.props.dispatch(we(this.props.blockRendererId,this.props.objRefFormFields.getOrElse(function(){return[]}))).then(function(){e.onCreateRequested()}).catch(function(t){e.props.dispatch(Object(Re.h)(t))})}},{key:"onEditWithLimitDictionariesRequested",value:function(e,t){var n=this;this.props.dispatch(we(this.props.blockRendererId,this.props.objRefFormFields.getOrElse(function(){return[]}))).then(function(){n.onEditRequested(e,t)}).catch(function(e){n.props.dispatch(Object(Re.h)(e))})}},{key:"onCreateRequested",value:function(){var e=this,t=ke.v4();this.getInitialValues().then(function(n){e.props.control.formDataRefOperations.addingNewBlock.map(function(r){return e.props.getBlockComponent&&e.props.getBlockComponent(e.props.objRefFormId,new m.None,r,t,ue.webRegistrationBlockTypeEdit,e.props.rootBlockRendererId.matchWith(function(e){return Object(m.toOption)(e)},function(){return Object(m.toOption)(e.props.blockRendererId)}),function(n){return e.openDialog(e.props.i18n.t("Новая запись"),n,[p.createElement(P.a,{key:"close",variant:"raised",onClick:function(t){return e.handleDialogClose(!0)},style:{marginRight:"10px"}},e.props.i18n.t("Закрыть")),p.createElement(P.a,{key:"save",variant:"raised",onClick:function(){e.state.saveBlock||e.setState(ve(e.state,{saveBlock:{$set:!0}}),function(){e.props.dispatch(Object(ge.g)(r,t,new m.None)).then(function(){return e.props.dispatch(Object(ge.a)(r,t,e.props.objRefFormId))}).then(function(){return e.childRegistration(r,e.props.objRefFormId,t).then(function(t){return n=t.id,e.handleDialogClose(!0),e.props.dispatch(Object(Re.h)(e.props.i18n.t("Запись успешно создана"))),e.setState(ve(e.state,{saveBlock:{$set:!1}})),void e.onAddByCreating(n);var n}).catch(function(n){e.props.dispatch(Object(Se.c)(n,e.props,t,e.props.blockId)),e.setState(ve(e.state,{saveBlock:{$set:!1}}))})}).catch(function(n){e.props.dispatch(Object(Se.c)(n,e.props,t,e.props.blockId)),console.log("block invalid",n),e.setState(ve(e.state,{saveBlock:{$set:!1}}))})})},color:"primary"},e.props.i18n.t("Сохранить"))])},e.getInitialDictionaries(new m.None),n)}).getOrElse(function(){throw e.props.i18n.t("Ошибка - не выбран блок создания анкеты")})}).catch(function(t){e.props.dispatch(Object(Re.h)(t))})}},{key:"onEditClick",value:function(e,t){var n=this;this.fetchFormRecordLimits().foreach(function(r){r.then(function(){n.setState(ve(n.state,{requestedCloseEnabled:{$set:!1}}),function(){return n.onEditWithLimitDictionariesRequested(e,t)})}).catch(function(e){n.props.dispatch(Object(Se.b)(e))})})}},{key:"onEditRequested",value:function(e,t){var n=this,r=ke.v4();t.block.map(function(t){return n.props.getBlockComponent&&n.props.getBlockComponent(n.props.objRefFormId,Object(m.toOption)(e.formRecord),t,r,ue.webRegistrationBlockTypeEdit,n.props.rootBlockRendererId.matchWith(function(e){return Object(m.toOption)(e)},function(){return Object(m.toOption)(n.props.blockRendererId)}),function(o){return n.openDialog(n.props.i18n.t("Редактирование"),o,[p.createElement(P.a,{onClick:function(e){return n.handleDialogClose(!0)},style:{marginRight:"10px"}},n.props.i18n.t("Закрыть")),p.createElement(P.a,{color:"primary",variant:"raised",onClick:function(){n.state.saveBlock||n.setState(ve(n.state,{saveBlock:{$set:!0}}),function(){n.props.dispatch(Object(xe.f)(t)).foreach(function(o){n.props.dispatch(Object(ge.g)(t,r,new m.None)).then(function(){return n.props.dispatch(Object(ge.a)(t,r,n.props.objRefFormId))}).then(function(){return n.props.dispatch(Object(ge.f)(t,n.props.objRefFormId,o.entity,r,e.id))}).then(function(e){return t=e,n.handleDialogClose(!0),n.props.dispatch(Object(Re.h)(n.props.i18n.t("Запись успешно отредактирована"))),n.setState(ve(n.state,{saveBlock:{$set:!1}})),void n.onEditComplete(t);var t}).catch(function(e){n.props.dispatch(Object(Se.c)(e,n.props,r,t)),n.setState(ve(n.state,{saveBlock:{$set:!1}}))})})})}},n.props.i18n.t("Сохранить"))])},n.getInitialDictionaries(Object(m.toOption)(e.formRecord.entity.values)),e.formRecord.entity.values)}).getOrElse(function(){n.props.dispatch(Object(Re.h)(n.props.i18n.t("Ошибка - не выбран блок создания анкеты")))})}},{key:"onOpenClick",value:function(e,t){var n=this,r=ke.v4();t.block.map(function(t){return n.props.getBlockComponent&&n.props.getBlockComponent(n.props.objRefFormId,Object(m.toOption)(e.formRecord),t,r,ue.webRegistrationBlockTypeDisplay,n.props.rootBlockRendererId.matchWith(function(e){return Object(m.toOption)(e)},function(){return Object(m.toOption)(n.props.blockRendererId)}),function(e){return n.openDialog(n.props.i18n.t("Просмотр"),e,[p.createElement(P.a,{onClick:function(e){return n.handleDialogClose(!0)},style:{marginRight:"10px"}},n.props.i18n.t("Закрыть"))])},{},e.formRecord.entity.values)}).getOrElse(function(){n.props.dispatch(Object(Re.h)(n.props.i18n.t("Ошибка - не выбран блок просмотра анкеты")))})}},{key:"onMassEditRequested",value:function(){var e=this,t=ke.v4();this.props.control.formDataRefOperations.massEditBlock.map(function(n){return e.props.getBlockComponent&&e.props.getBlockComponent(e.props.objRefFormId,new m.None,n,t,ue.webRegistrationBlockTypeEdit,e.props.rootBlockRendererId.matchWith(function(e){return Object(m.toOption)(e)},function(){return Object(m.toOption)(e.props.blockRendererId)}),function(r){return e.openDialog(e.props.i18n.t("Массовое редактирование"),r,[p.createElement(P.a,{onClick:function(t){return e.handleDialogClose()},style:{marginRight:"10px"}},e.props.i18n.t("Закрыть")),p.createElement(P.a,{color:"primary",variant:"raised",onClick:function(){e.props.dispatch(Object(xe.f)(n)).foreach(function(r){var o=0===e.state.markedFormRecords.length?e.props.value.map(function(e){return e.id}).getOrElse(function(){return[]}):e.state.markedFormRecords;e.props.dispatch(Object(ge.g)(n,t,new m.None)).then(function(){return e.props.dispatch(Object(ge.e)(n,e.props.objRefFormId,r.entity,t,o)).then(function(t){e.handleGroupUpdating()}).catch(function(r){e.props.dispatch(Object(Se.c)(r,e.props,t,n)),e.handleRegisterFailed()})})})}},e.props.i18n.t("Сохранить"))])})}).getOrElse(function(){e.props.dispatch(Object(Re.h)(e.props.i18n.t("Ошибка - не выбран блок массового редактирования анкеты")))})}},{key:"onAddClick",value:function(){var e=this;this.props.control.formDataRefOperations.addingExisting&&this.fetchFormRecordLimits().foreach(function(t){t.then(function(){e.props.dispatch(Object(Ae.c)(e.props.formId,e.props.output.formField)).foreach(function(t){e.openDialog(e.props.i18n.t("Добавление записи"),p.createElement(ct.a,{params:{},componentProps:{childFormId:e.props.objRefFormId,parentFormId:e.props.formId,objRefsField:t,displayFields:e.props.control.displayFields,displayFieldsForAdding:e.props.control.displayFieldsForAdding,blockRendererId:e.props.blockRendererId,display:e.props.display,output:e.props.output,input:e.props.input,onObjRefAdd:e.onAddValue,onObjRefsAdd:e.onAddValues,onObjRefDelete:e.onDeleteValue},load:function(){return n.e(8).then(n.bind(null,2753))}}),[p.createElement(P.a,{variant:"raised",key:"close",onClick:function(t){return e.handleDialogClose()},style:{marginRight:"10px"}},e.props.i18n.t("Закрыть"))],"85%")})})})}},{key:"getChildFormFieldValue",value:function(){var e=this;return this.props.control.formDataRefOperations.parentFieldId.filter(function(){return e.props.control.formDataRefOperations.writingParentId}).flatMap(function(t){return e.props.parentRecordId.map(function(e){return new ue.FormFieldValue(t,new ue.ValueObjectRefs([e]))})})}},{key:"onAddValue",value:function(e){return this.onAddValues([e])}},{key:"fetchFormRecordLimits",value:function(){var e=this;return this.props.parentRecordId.map(function(t){return e.props.dispatch(Object(_e.b)(e.props.formId,t,e.props.blockRendererId))})}},{key:"onAddValues",value:function(e){var t=this;if(!this.props.control.formDataRefOperations.addingExisting)return new Promise(function(e,t){return t()});var n=this.props.control.formDataRefOperations.moveChildren?je.o:je.a;return this.props.parentRecordId.matchWith(function(r){return n([r],t.props.formId,t.props.output.formField,t.props.objRefFormId,e.map(function(e){return e.id}))},function(){return new Promise(function(e,t){t(new Error("Parent record id has not been provided"))})}).then(function(){t.onChange(t.props.value.filter(function(e){return e.tpe.value===ue.ValueObjectRefs.$Type.value}).map(function(t){return new ue.ValueObjectRefs(t.id.concat(e.map(function(e){return e.id})))}).getOrElse(function(){return new ue.ValueObjectRefs(e.map(function(e){return e.id}))})),t.fetchFormRecords().foreach(function(e){return e.then(function(){return t.fetchFormRecordLimits()})})}).catch(function(e){throw t.props.dispatch(Object(Se.b)(e)),e})}},{key:"onAddByCreating",value:function(e){var t=this,n=this.props.value.filter(function(e){return e.tpe.value===ue.ValueObjectRefs.$Type.value}).map(function(t){return t.id.filter(function(t){return t.value!==e.value})}).map(function(t){return new ue.ValueObjectRefs(t.concat(e))}).getOrElse(function(){return new ue.ValueObjectRefs([e])});this.onChange(n),this.fetchFormRecords().foreach(function(e){return e.then(function(){return t.fetchFormRecordLimits()})})}},{key:"onEditComplete",value:function(e){var t=this,n=this.props.value.filter(function(e){return e.tpe.value===ue.ValueObjectRefs.$Type.value}).map(function(t){return t.id.filter(function(t){return t.value!==e.value})}).map(function(t){return new ue.ValueObjectRefs(t.concat(e))}).getOrElse(function(){return new ue.ValueObjectRefs([e])});this.onChange(n),this.fetchFormRecords().foreach(function(e){return e.then(function(){return t.fetchFormRecordLimits()})})}},{key:"onDeleteValue",value:function(e){return this.deleteObjRef(e)}},{key:"deleteObjRef",value:function(e){var t=this;return this.props.parentRecordId.matchWith(function(n){return Object(je.p)([n],t.props.formId,t.props.output.formField,t.props.objRefFormId,[e.id])},function(){return new Promise(function(e,t){return e()})}).then(function(){t.onChange(t.props.value.map(function(t){return new ue.ValueObjectRefs(t.id.filter(function(t){return t.value!==e.id.value}))}).getOrElse(function(){return new ue.ValueObjectRefs([])})),t.fetchFormRecords().foreach(function(e){return e.then(function(){return t.fetchFormRecordLimits()})})})}},{key:"onViewValue",value:function(e){this.props.dispatch(Object(Be.a)(this.props.objRefFormId,e.id))}},{key:"onRecordSelected",value:function(e){}},{key:"onSelectAll",value:function(){this.state.markedFormRecords.length===this.sliceCurrentPage(this.props.value.map(function(e){return e.id}).getOrElse(function(){return[]})).length?this.setState(ve(this.state,{markedFormRecords:{$set:[]}})):this.setState(ve(this.state,{markedFormRecords:{$set:this.sliceCurrentPage(this.props.value.map(function(e){return e.id}).getOrElse(function(){return[]}))}}))}},{key:"onRecordMarked",value:function(e){var t=this.state.markedFormRecords.findIndex(function(t){return t.value===e});t>=0?this.setState(ve(this.state,{markedFormRecords:{$splice:[[t,1]]}})):this.setState(ve(this.state,{markedFormRecords:{$push:[new ue.Id(e)]}}))}},{key:"handleRegisterFailed",value:function(){this.handleDialogClose(),this.props.dispatch(Object(Re.h)(this.props.i18n.t("Сохранения изменений прервалось с ошибкой")))}},{key:"handleGroupUpdating",value:function(){this.handleDialogClose(),this.fetchFormRecords(),this.props.dispatch(Object(Re.h)(this.props.i18n.t("Изменения успешно сохранены")))}},{key:"handleUpdating",value:function(){this.handleDialogClose(),this.fetchFormRecords(),this.props.dispatch(Object(Re.h)(this.props.i18n.t("Изменения успешно сохранены"))),this.fetchFormRecordLimits()}},{key:"onOpenExports",value:function(){var e,t,n,r,o;this.props.dispatch((e=this.props.parentRecordId,t=this.props.output,n=this.props.objRefFormId,r=this.openDialog,o=this.handleDialogClose,function(i,a){var c=function(e){e.entity.file.map(function(e){return a().auth.token.map(function(t){Object(Fe.b)(e,t,a().config.cdnAddress)})})};r(a().i18n.t("Выберите экспорт"),p.createElement(Ce.a,{formId:n,onSelect:function(n){e.foreach(function(e){Object(Ee.b)(n,[e],t.formField).then(function(e){o(),i(Object(Ee.c)(n)).then(function(t){Object(m.headOption)(t.list.filter(function(t){return t.id.value===e.id.value})).map(function(e){return c(e)})})}).catch(function(e){o(),i(Object(Re.h)(a().i18n.t("Ошибка во время создания операции экспорта!")))})})}}),[])}))}},{key:"onFirstPage",value:function(){var e=this;this.setState(ve(this.state,{currentPage:{$set:0},markedFormRecords:{$set:[]}}),function(){return e.fetchFormRecords()})}},{key:"onLastPage",value:function(){var e=this;this.setState(ve(this.state,{currentPage:{$set:Math.ceil(this.props.value.map(function(e){return e.id.length}).getOrElse(function(){return 0})/this.state.rowPerPage)-1},markedFormRecords:{$set:[]}}),function(){return e.fetchFormRecords()})}},{key:"onNextPage",value:function(){var e=this;this.setState(ve(this.state,{currentPage:{$set:this.state.currentPage+1},markedFormRecords:{$set:[]}}),function(){return e.fetchFormRecords()})}},{key:"onPrevPage",value:function(){var e=this;this.setState(ve(this.state,{currentPage:{$set:this.state.currentPage-1},markedFormRecords:{$set:[]}}),function(){return e.fetchFormRecords()})}},{key:"onPageSizeChanged",value:function(e){var t=this;this.setState(ve(this.state,{rowPerPage:{$set:e},markedFormRecords:{$set:this.state.rowPerPage<=e?this.state.markedFormRecords:[]}}),function(){return t.fetchFormRecords()})}},{key:"getActionButton",value:function(e,t){var n=this,r=e.display.enabled,o=e.display.value.getOrElse(function(){return""}),i=function(e){return p.createElement(I.a,{className:"ObjRefsTableEditor__button",variant:"caption",align:"center",onClick:e},o)};switch(e.tpe.value){case ue.ElementControlActionDownloadDocument.$Type.value:return r?i(function(){return n.onDownloadDocument(e,t)}):p.createElement(D.a,{style:Ze.f,key:"download-document",onClick:function(){return n.onDownloadDocument(e,t)}},p.createElement(oe.a,{style:Ze.g}));case ue.ElementControlActionIssueDocument.$Type.value:return r?i(function(){return n.onIssueDocument(e,t)}):p.createElement(D.a,{style:Ze.f,key:"issue",onClick:function(){return n.onIssueDocument(e,t)}},p.createElement(ne,{style:Ze.g}));case ue.ElementControlActionPrintFile.$Type.value:return r?i(function(){return n.onPrintFile(e,t)}):p.createElement(D.a,{style:Ze.f,key:"print",onClick:function(){return n.onPrintFile(e,t)}},p.createElement(G.a,{style:Ze.g}));case ue.ElementControlActionDownloadFile.$Type.value:return r?i(function(){return n.onDownloadFile(e,t)}):p.createElement(D.a,{style:Ze.f,key:"download-file",onClick:function(){return n.onDownloadFile(e,t)}},p.createElement(oe.a,{style:Ze.g}));case ue.ElementControlActionAssignBarcode.$Type.value:return r?i(function(){return n.onAssignBarcodes(e,t)}):p.createElement(D.a,{style:Ze.f,key:"assignBarcode",onClick:function(){return n.onAssignBarcodes(e,t)}},p.createElement(Y.a,{style:Ze.g}));case ue.ElementControlActionSetFieldValue.$Type.value:var a=e;return Object(de.e)(t.formRecord,a.filter)?r?i(function(){return n.onSetValue(a,t)}):p.createElement(D.a,{style:Ze.f,key:"set",onClick:function(){return n.onSetValue(a,t)}},p.createElement(Z.a,{style:Ze.g})):p.createElement("div",null);case ue.ElementControlActionOpen.$Type.value:return r?i(function(){return n.onOpenClick(t,e)}):p.createElement(D.a,{style:Ze.f,key:"open",onClick:function(){return n.onOpenClick(t,e)}},p.createElement(K.a,{style:Ze.g}));case ue.ElementControlActionView.$Type.value:return r?i(function(){return n.onViewValue(t)}):p.createElement(D.a,{style:Ze.f,key:"view",onClick:function(){return n.onViewValue(t)}},p.createElement(ae.a,{style:Ze.g}));case ue.ElementControlActionEdit.$Type.value:return r?i(function(){return n.onEditClick(t,e)}):p.createElement(D.a,{style:Ze.f,key:"edit",onClick:function(){return n.onEditClick(t,e)}},p.createElement(H.a,{style:Ze.g}));case ue.ElementControlActionDelete.$Type.value:return r?i(function(){return n.onDeleteValue(t)}):p.createElement(D.a,{style:Ze.f,key:"delete",onClick:function(){return n.onDeleteValue(t)}},p.createElement(N.a,{style:Ze.g}));default:throw"Unknown element control action type"}}},{key:"onSetValue",value:function(e,t){}},{key:"onPrintFile",value:function(e,t){this.props.dispatch(function(e,t){return function(n,r){return Object(m.toOption)(t.formRecord.entity.values[e.fileField.value]).flatMap(function(e){return Object(m.headOption)(e.value.files)}).map(function(e){r().user.terminal.flatMap(function(e){return Object(m.headOption)(r().terminals.list.filter(function(t){return t.id.value===e.value}))}).foreach(function(t){t.entity.printer.map(function(){Object(Ie.b)(e).then(function(){n(Object(Re.h)(r().i18n.t("Файл успешно отправлен на печать")))}).catch(function(e){n(Object(Re.h)(r().i18n.t("При печати файла произошла ошибка")))})}).getOrElse(function(){r().auth.token.map(function(t){return Object(Fe.b)(e,t,r().config.cdnAddress)})})})}).getOrElse(function(){n(Object(Re.h)(r().i18n.t("Файл отсутствует")))})}}(e,t))}},{key:"onDownloadFile",value:function(e,t){this.props.dispatch(function(e,t){return function(n,r){return Object(m.toOption)(t.formRecord.entity.values[e.fileField.value]).flatMap(function(e){return Object(m.headOption)(e.value.files)}).map(function(e){r().auth.token.map(function(t){return Object(Fe.b)(e,t,r().config.cdnAddress)})}).getOrElse(function(){n(Object(Re.h)(r().i18n.t("Файл отсутствует")))})}}(e,t))}},{key:"onDownloadDocument",value:function(e,t){this.props.dispatch(function(e,t){return function(n,r){return Object(m.toOption)(t.formRecord).flatMap(function(t){return Object(m.toOption)(t.entity.values[e.documentField.value]).map(function(e){return Object(m.headOption)(Object(h.e)(r().fields,t.entity.formId).getOrElse(function(){return[]}).filter(function(t){return t.id.value===e.formFieldId.value}).filter(function(e){return e.entity.valueType.tpe.value===ue.ValueTypeObjectRefs.$Type.value&&e.entity.valueType.tag.map(function(e){return e.tpe.value===ue.ValueTagDocumentRecordRefs.$Type.value}).getOrElse(function(){return!1})})).foreach(function(t){Object(m.headOption)(e.value.id).foreach(function(e){Object(je.i)(t.entity.valueType.family,e).then(function(e){Object(m.headOption)(Object(h.e)(r().fields,t.entity.valueType.family).getOrElse(function(){return[]}).filter(function(e){return e.entity.valueType.tag.map(function(e){return e.tpe.value===ue.ValueTagPdf.$Type.value}).getOrElse(function(){return!1})})).foreach(function(t){Object(m.toOption)(e.record.entity.values[t.id.value]).foreach(function(e){Object(m.headOption)(e.value.files.reverse()).foreach(function(e){r().auth.token.map(function(t){return Object(Fe.b)(e,t,r().config.cdnAddress)})})})})})})})})})}}(e,t))}},{key:"onIssueDocument",value:function(e,t){var n=this;this.openDialog(this.props.i18n.t("Генерация документа"),p.createElement(nt,{formRecord:t.formRecord}),[p.createElement(P.a,{variant:"raised",key:"close",onClick:function(e){return n.handleDialogClose()}},this.props.i18n.t("Закрыть"))])}},{key:"onSearchValueChanged",value:function(e){this.setState(ve(this.state,{searchValue:{$set:e.target.value}}))}},{key:"getFilteredValue",value:function(e,t){return Object(m.headOption)(this.props.objRefFormFields.getOrElse(function(){return[]}).filter(function(e){return e.id.value===t.value})).map(function(e){return e.entity.valueType.tpe.value}).matchWith(function(t){switch(t){case ue.ValueTypeStr.$Type.value:return new ue.ValueStr(e);case ue.ValueTypeValuesList.$Type.value:return new ue.ValueList(e.split(",").map(function(e){return new ue.ValueStr(e.trim())}));default:return new ue.ValueStr(e)}},function(){return new ue.ValueStr(e)})}},{key:"onSearchRecords",value:function(){var e=this,t=this.props.control.searchSettings.filter(function(t){return!!e.state.searchValue&&t.enabled}).map(function(t){return new ue.FilterCondition(t.field,new ue.FilterExpressionContains,e.getFilteredValue(e.state.searchValue,t.field))});this.setState(ve(this.state,{currentPage:{$set:0},markedFormRecords:{$set:[]}}),function(){return e.fetchFormRecords(t)})}},{key:"openAssignBarcodeDialog",value:function(e,t){var n=this;this.openDialog(this.props.i18n.t("Значение штрихкода"),p.createElement(De.a,{onChange:e,onSave:t,withRemoveOldValue:!1}),[p.createElement(P.a,{variant:"raised",style:{marginRight:"5px"},onClick:function(){return n.handleDialogClose()}},this.props.i18n.t("Отмена")),p.createElement(P.a,{variant:"raised",color:"primary",onClick:t},this.props.i18n.t("Сохранить"))])}},{key:"onAssignBarcodes",value:function(e,t){var n=this,r="";this.openAssignBarcodeDialog(function(e,t){r=e,t},function(){Object(Ve.a)(t.id,[new ue.AssignBarcode(new ue.BarcodeId(""),r)],e.removeOldCodes).then(function(){n.handleDialogClose(),n.props.dispatch(Object(Re.h)(n.props.i18n.t("Код успешно присвоен")))}).catch(function(e){n.props.dispatch(Object(Se.b)(e))})})}},{key:"isTemplate",value:function(e){return e.includes("$id")}},{key:"getFormattedValues",value:function(e){var t=this,n=e.formRecord;return e.values.map(function(e){return t.isTemplate(e)?e.replace(/\$id\d+/gi,function(e){return Object(m.liftKey)(n.entity.values,e.replace("$id","")).map(function(e){return e.value.toString()}).getOrElse(function(){return""})}):e})}},{key:"render",value:function(){var e=this,t=(this.props.error,this.props.objRefFormFields.getOrElse(function(){return[]})),n=(Object(m.headOption)(t.filter(function(e){return e.entity.valueType.tag.map(function(e){return e.tpe.value===ue.ValueTagSimpleDictionaryPosition.$Type.value}).getOrElse(function(){return!1})})),this.props.control.displayFields.map(function(e,t){return{id:t.toString(),title:e.caption}})),r=this.props.displayValues.getOrElse(function(){return[]}).filter(function(e){return e instanceof fe.t}).slice(0,this.state.rowPerPage),o=this.props.control.searchSettings.map(function(e){return e.enabled}).getOrElse(function(){return!1}),i=Object(m.headOption)(Object(E.a)(this.props.control.displayFields.map(function(e,t){return e.sort.enabled?t:void 0}).filter(function(e){return void 0!==e}))).getOrElse(function(){return-1}),a=this.props.control.displayFields.reduce(function(e,t,n){return Object.assign({},e,y()({},n,!t.sort.enabled||t.sort.value.map(function(e){return e.tpe.value===ue.SortOrderAsc.$Type.value}).getOrElse(function(){return!0})))},{}),c=this.props.control.formDataRefOperations,u=c.addingExisting,s=c.addingNew,l=c.massEdit;return p.createElement("div",null,p.createElement(ye.b,{leftButtonGroup:[].concat(O()(u?[p.createElement(P.a,{key:"add",variant:"raised",size:"small",onClick:this.onAddClick,style:{marginRight:"5px"}},this.props.i18n.t("Добавить"))]:[]),O()(s?[p.createElement(P.a,{key:"create",variant:"raised",size:"small",onClick:this.onCreateClick,style:{marginRight:"5px"}},this.props.i18n.t("Создать"))]:[]),O()(l?[p.createElement(P.a,{key:"edit",variant:"raised",size:"small",onClick:this.onMassEditRequested,style:{marginRight:"5px"}},0===this.state.markedFormRecords.length?this.props.i18n.t("Редактирование (все)"):this.props.i18n.t("Редактирование (выбранные)"))]:[]),O()(this.props.control.exportEnabled?[p.createElement(P.a,{key:"export",variant:"raised",size:"small",onClick:this.onOpenExports,style:{marginRight:"5px"}},this.props.i18n.t("Экспорт"))]:[]))}),o&&p.createElement("form",{onSubmit:function(t){t.preventDefault(),e.onSearchRecords()},style:{marginBottom:"22px"}},p.createElement(M.a,{style:{boxSizing:"border-box",paddingRight:14},variant:"outlined",fullWidth:!0,color:"primary",value:this.state.searchValue,placeholder:this.props.i18n.t("Поиск"),onChange:this.onSearchValueChanged,InputProps:{startAdornment:p.createElement(at.a,{position:"start"},p.createElement(X.a,{style:{fill:"#BDBDBD"}}))}})),p.createElement(ce.a,{showId:!1,error:new m.None,onSelectAll:this.props.control.formDataRefOperations.massEdit?this.onSelectAll:void 0,onRecordMarked:this.props.control.formDataRefOperations.massEdit?this.onRecordMarked:void 0,onRecordSelected:this.onRecordSelected,markedRecords:this.state.markedFormRecords.map(function(e){return e.value}),fetching:this.props.displayValuesFetching.getOrElse(function(){return!1}),empty:this.props.displayValues.isEmpty(),withActions:!0,headers:(this.props.control.orderNumberEnabled?[{id:"0",title:"№"}]:[]).concat(n),columnStyles:this.props.control.displayFields.map(function(e){return{flex:e.columnWidth}}),columnIndexSort:i,columnOrderAsc:a,rows:r.map(function(t,n){var r=t.formRecord.entity.attributes.status.tpe.value===ue.FormDataStatusDeleted.$Type.value||t.formRecord.entity.attributes.status.tpe.value===ue.FormDataStatusNominalDeleted.$Type.value;return{payload:t.id.value,id:t.id.value,deleted:r,fields:(e.props.control.orderNumberEnabled?[(n+e.state.currentPage*e.state.rowPerPage+1).toString()]:[]).concat(e.getFormattedValues(t)),buttons:e.props.control.objRefActions.map(function(n){return e.getActionButton(n,t)})}})}),p.createElement(ot.a,{display:this.props.display,error:this.props.error,blockStyle:this.props.blockStyle}),p.createElement(ye.a,{blockTableSearch:this.props.control.searchSettings.map(function(e){return e.enabled}).getOrElse(function(){return!1}),nextPage:this.onNextPage,prevPage:this.onPrevPage,firstPage:this.onFirstPage,lastPage:this.onLastPage,changePageSize:this.onPageSizeChanged,currentPage:this.state.currentPage,rowPerPage:this.state.rowPerPage,totalRecords:this.props.total,shouldShowMassActions:!1,massActionsComponents:[],searchValue:this.state.searchValue,onSearchValueChange:this.onSearchValueChanged,onSearchRecords:this.onSearchRecords}),p.createElement(S.a,{fullWidth:!0,maxWidth:"md",open:this.state.dialog.open,onClose:function(){return e.handleDialogClose(!1)},className:"ObjRefsTableEditor__dialog"},p.createElement(B.a,{style:{borderBottom:"none"}},this.state.dialog.title.getOrElse(function(){return""})),p.createElement($.a,null,this.state.dialog.body.getOrElse(function(){return p.createElement("div",null)})),p.createElement(x.a,{style:{borderTop:"none"}},this.state.dialog.actions)))}}]),t}(p.Component);lt=ut([function(e){var t,n=p.createFactory(e);return(t=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),a()(t,[{key:"render",value:function(){return n(le(this.props))}}]),t}(p.Component)).displayName="WithBlockLangs("+(e.displayName||e.name)+")",t},R.autobind,st("design:paramtypes",[Object])],lt);var pt=Object(d.connect)(function(e,t){var n=Object(be.d)(e.dataOutput,t.blockRendererId,t.output);return{i18n:e.i18n,objRefFormFields:Object(h.e)(e.fields,t.objRefFormId),dataInput:Object(me.b)(e.dataInputs,t.display.id),total:Object(be.g)(e.dataOutput,t.blockRendererId,t.display.id).getOrElse(function(){return 0}),displayValues:Object(be.h)(e.dataOutput,t.blockRendererId,t.display.id),value:n.map(function(e){return e.value}).filter(function(e){return e.tpe.value===ue.ValueObjectRefs.$Type.value}),displayValuesFetching:Object(be.i)(e.dataOutput,t.blockRendererId,t.display.id),error:Object(be.m)(e.dataOutput,t.blockRendererId,t.display.id),rootBlockRendererId:Object(f.j)(e.blockRendererContext,t.blockRendererId)}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,t,n)},{areStatesEqual:function(e,t){return e.i18n===t.i18n&&e.dataInputs.input===t.dataInputs.input&&e.dataOutput===t.dataOutput&&e.fields.list===t.fields.list&&e.filtersForm===t.filtersForm&&e.blockRendererContext===t.blockRendererContext},areStatePropsEqual:function(e,t){return Object(m.isEqual)(e.objRefFormFields,t.objRefFormFields)&&Object(m.isEqual)(e.displayValues,t.displayValues)&&Object(m.isEqual)(e.dataInput,t.dataInput)&&Object(m.isEqual)(e.value,t.value)&&Object(m.isEqual)(e.displayValuesFetching,t.displayValuesFetching)&&Object(m.isEqual)(e.error,t.error)&&Object(m.isEqual)(e.rootBlockRendererId,t.rootBlockRendererId)&&e.i18n===t.i18n}})(Object(rt.a)(lt)),dt=n(1452),ft=n(1458),ht=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),a()(t,[{key:"renderDisplayControl",value:function(){return this.renderEditControl()}},{key:"renderEditControl",value:function(){var e=this;return p.createElement(dt.a,{display:this.props.display,blockStyle:this.props.blockStyle},this.props.display.dataInput.map(function(t){return e.props.objRefFormId.map(function(n){return p.createElement(pt,{display:e.props.display,blockRendererId:e.props.blockRendererId,blockId:e.props.blockId,objRefFormId:n,control:e.props.control,input:t,output:e.props.output,formId:e.props.formId,parentRecordId:e.props.parentRecordId,getBlockComponent:e.props.getBlockComponent,onChange:e.props.onChange,blockStyle:e.props.blockStyle})}).getOrElse(function(){return p.createElement("div",null,e.props.i18n.t("Форма не найдена"))})}).getOrElse(function(){return p.createElement("div",null,e.props.i18n.t("Не задано поле поставщик данных"))}))}},{key:"renderEditByClickControl",value:function(){return p.createElement("div",null,this.props.i18n.t("Компонент для редактирования по клику не задан"))}}]),t}(b.a),mt=function(e){e.parentRecordId.foreach(function(t){e.dispatch(Object(ft.d)(e.blockRendererId,e.formId,e.control,e.display,t))})};t.default=Object(d.connect)(function(e,t){return{i18n:e.i18n,objRefFormId:Object(h.d)(e,t.formId,t.output.formField).map(function(e){return e.entity.valueType.family}),initialValues:Object(f.h)(e.blockRendererContext,t.blockRendererId)}},function(e,t){return{dispatch:e}},function(e,t,n){return Object.assign({},e,t,n)},{areStatesEqual:function(e,t){return e.fields.list===t.fields.list&&e.i18n===t.i18n&&e.dataOutput===t.dataOutput},areStatePropsEqual:function(e,t){return e.i18n===t.i18n&&Object(m.isEqual)(e.objRefFormId,t.objRefFormId)},areOwnPropsEqual:function(e,t){return e.blockRendererId===t.blockRendererId&&e.formId.value===t.formId.value&&e.blockId.value===t.blockId.value&&e.display===t.display&&e.blockType===t.blockType&&e.control===t.control&&Object(m.isEqual)(e.parentRecordId,e.parentRecordId)&&Object(m.isEqual)(e.blockStyle,e.blockStyle)}})(Object(Ne.a)([mt],[function(e,t){Object(m.isEqual)(e.initialValues,t.initialValues)||mt(e),Object(m.isEqual)(e.initialValues,t.initialValues)&&e.isTokenChecked&&!t.isTokenChecked&&mt(e)}],[],[],function(e,t){return!function(e,t){return e.formId.value===t.formId.value&&Object(m.isEqual)(e.blockStyle,t.blockStyle)&&e.display===t.display&&e.blockType.tpe.value===t.blockType.tpe.value&&e.blockRendererId===t.blockRendererId&&e.blockStyle===t.blockStyle&&e.output===t.output&&e.onChange===t.onChange&&e.onControlBlur===t.onControlBlur}(e,t)&&e.i18n!==t.i18n})(ht))}}]);