(window.webpackJsonpwww=window.webpackJsonpwww||[]).push([[19],{1479:function(e,t,n){"use strict";var r=n(6),i=n.n(r),o=n(10),a=n.n(o),u=n(7),s=n.n(u),c=n(8),p=n.n(c),l=n(2),d=n(52),f=n.n(d),m=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"render",value:function(){return l.createElement(f.a,{component:"div",style:Object.assign({overflowY:"auto"},this.props.style)},this.props.children)}}]),t}(l.PureComponent);t.a=m},1491:function(e,t,n){"use strict";var r=n(21),i=(n(221),n(6)),o=n.n(i),a=n(7),u=n.n(a),s=n(8),c=n.n(s),p=n(18),l=(function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","List",{form:e}))}c()(t,e)}(p.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","ListDescriptions",{form:e}))}return c()(t,e),t}(p.a)),d=(function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","ListEventLineDescriptions",{id:e}))}c()(t,e)}(p.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","ListEventLine",{id:e}))}c()(t,e)}(p.a),function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Create",{pipeline:e}))}return c()(t,e),t}(p.a)),f=function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Update",{pipeline:e}))}return c()(t,e),t}(p.a),m=function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Request",{id:e}))}return c()(t,e),t}(p.a),v=function(e){function t(e){return o()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Import.Pipelines","Delete",{id:e}))}return c()(t,e),t}(p.a),h=n(17),y=n(644),b=n(82),E=n(428);n.d(t,"a",function(){return O}),n.d(t,"h",function(){return T}),n.d(t,"b",function(){return g}),n.d(t,"e",function(){return w}),n.d(t,"c",function(){return I}),n.d(t,"d",function(){return P}),n.d(t,"g",function(){return j}),n.d(t,"f",function(){return F});var O=function(e){return h.a.send(new d(e),Object(r.f)())},T=function(e){return h.a.send(new f(e),Object(r.f)())},g=function(e){return h.a.send(new v(e),Object(r.f)())},w=function(e){return h.a.send(new m(e),Object(r.e)())},I=function(e){return function(t){return t(Object(E.e)()),h.a.send(new m(e),Object(r.e)()).then(function(e){return t(Object(E.f)(e.record)),e}).catch(function(e){throw t(Object(E.d)(e)),e})}},P=function(e){return h.a.send(new l(e),function(e){return e})},j=function(e,t,n){var r=new FormData;return r.append("file",e),r.append("config",n),y.b(r,b.default.server_address+"/api/app/files/import",t,function(e){return e})},F=function(e,t,n){var r=new FormData;return r.append("file",e),y.b(r,b.default.server_address+"/api/app/files/import/"+n.value,t,function(e){return e})}},1494:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return s});var r=n(221),i=n(1491),o=n(87),a=function(e){return function(t,n){return t(Object(r.k)(e)),i.d(e).then(function(n){return t(Object(r.l)({form:e,result:n})),n}).catch(function(n){throw t(Object(r.j)({form:e,error:n})),n})}},u=function(e){return function(t,n){return t(Object(o.b)(function(e){return!e.importPipelines.descriptionsFetching&&e.importPipelines.descriptionsFetching},a(e)))}},s=function(e){return function(t,n){return t(Object(o.b)(function(e){return!e.importPipelines.eventLineDescriptionsFetching&&e.importPipelines.eventLineDescriptionsFetching},function(e){return function(t,n){return t(Object(r.n)(e)),i.d(e).then(function(n){return t(Object(r.o)({eventLineId:e,result:n})),n}).catch(function(n){throw t(Object(r.m)({eventLineId:e,error:n})),n})}}(e)))}}},1768:function(e,t,n){"use strict";var r=n(6),i=n.n(r),o=n(10),a=n.n(o),u=n(7),s=n.n(u),c=n(8),p=n.n(c),l=n(2),d=n(642);t.a=function(e){return function(t){function n(){return i()(this,n),s()(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return p()(n,t),a()(n,[{key:"render",value:function(){var t=this;return l.createElement(d.a,null,function(n){return l.createElement(e,Object.assign({onTabChange:n.onTabChange,currentTab:n.currentTab,ref:function(e){return t.ref=e}},t.props))})}}]),n}(l.Component)}},1887:function(e,t,n){"use strict";var r=n(17),i=n(21),o=n(6),a=n.n(o),u=n(7),s=n.n(u),c=n(8),p=n.n(c),l=n(18),d=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics.Dashboard","Create",{entity:e}))}return p()(t,e),t}(l.a),f=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics.Dashboard","Update",{entity:e}))}return p()(t,e),t}(l.a),m=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics.Dashboard","Delete",{id:e}))}return p()(t,e),t}(l.a),v=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics.Dashboard","Resolve",{id:e}))}return p()(t,e),t}(l.a),h=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics.Dashboard","ListEventLine",{eventLineId:e}))}return p()(t,e),t}(l.a);n.d(t,"e",function(){return y}),n.d(t,"a",function(){return b}),n.d(t,"b",function(){return E}),n.d(t,"d",function(){return O}),n.d(t,"c",function(){return T});var y=function(e){return r.a.send(new f(e),Object(i.f)())},b=function(e){return r.a.send(new d(e),Object(i.c)())},E=function(e){return r.a.send(new m(e),Object(i.f)())},O=function(e){return r.a.send(new v(e),Object(i.e)())},T=function(e){return r.a.send(new h(e),Object(i.g)())}},1907:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return u});var r=n(1887),i=n(499),o=n(498),a=function(e){return function(t,n){return t(Object(i.e)()),r.c(e).then(function(e){return t(Object(i.f)(e.list))}).catch(function(e){return t(Object(i.d)(e))})}},u=function(e){return function(t,n){return t(Object(o.e)()),r.d(e).then(function(e){return t(Object(o.f)(e.record))}).catch(function(e){return t(Object(o.d)(e))})}}},2014:function(e,t,n){"use strict";var r=n(17),i=n(21),o=n(6),a=n.n(o),u=n(7),s=n.n(u),c=n(8),p=n.n(c),l=n(18),d=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics","Create",{entity:e}))}return p()(t,e),t}(l.a),f=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics","Update",{entity:e}))}return p()(t,e),t}(l.a),m=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics","Delete",{id:e}))}return p()(t,e),t}(l.a),v=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics","ListDashboard",{dashboardId:e}))}return p()(t,e),t}(l.a),h=function(e){function t(e){return a()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Metrics","ListEventLine",{eventLineId:e}))}return p()(t,e),t}(l.a);n.d(t,"e",function(){return y}),n.d(t,"a",function(){return b}),n.d(t,"b",function(){return E}),n.d(t,"c",function(){return O}),n.d(t,"d",function(){return T});var y=function(e){return r.a.send(new f(e),Object(i.f)())},b=function(e){return r.a.send(new d(e),Object(i.c)())},E=function(e){return r.a.send(new m(e),Object(i.f)())},O=function(e){return r.a.send(new v(e),Object(i.g)())},T=function(e){return r.a.send(new h(e),Object(i.g)())}},2054:function(e,t,n){"use strict";var r=n(6),i=n.n(r),o=n(10),a=n.n(o),u=n(7),s=n.n(u),c=n(8),p=n.n(c),l=n(11),d=n.n(l),f=n(2),m=n(13),v=n(14),h=n(3),y=n(25),b=n.n(y),E=n(19),O=n.n(E),T=n(86),g=n.n(T),w=n(414),I=n.n(w),P=n(265),j=n.n(P),F=n(415),k=n(2055),A=n(1),M=n(216),D=n(2014),_=n(2056),C=n(136),$=n(71),S=n(83),B=n(201),L=n(46),N=n(2057),R=n(0),W=n(642),V=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},q=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},x=function(e){function t(e){i()(this,t);var n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={markedMetrics:[],disabled:!1},n}return p()(t,e),a()(t,[{key:"onCreateRequested",value:function(){var e=this,t=void 0,n=this.props.openDialog(this.props.i18n.t("Создание метрики"),f.createElement(W.b,null,f.createElement(k.a,{ref:function(e){return t=Object(R.toOption)(e).flatMap(function(e){return Object(R.toOption)(e.wrappedInstance.ref)})},onSubmit:function(t){return function(t){return Object(D.a)(new A.MetricEntity(t.name,(new Date).getTime(),new R.None,new A.Id(t.formId),Object(N.b)(t,e.props,k.b),new R.None)).then(function(t){e.props.dispatch(Object(_.b)(e.props.eventLineId)),e.props.dispatch(Object($.h)(e.props.i18n.t("Метрика успешно создана!"))),e.props.handleDialogClose(n)}).catch(function(t){e.props.dispatch(Object(B.a)(t))})}(t)},initialValues:{name:"",periodStart:new Date,periodEnd:new Date,periodEndType:A.DateValueNow.$Type.value}})),[f.createElement(O.a,{key:"close",variant:"raised",style:{marginRight:"10px"},onClick:function(){return e.props.handleDialogClose(n)}},this.props.i18n.t("Закрыть")),f.createElement(O.a,{key:"save",variant:"raised",onClick:function(){return t.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"onEditRequest",value:function(e){var t=this,n=void 0,r=this.props.openDialog(this.props.i18n.t("Редактирование метрики"),f.createElement(W.b,null,f.createElement(k.a,{ref:function(e){return n=Object(R.toOption)(e).flatMap(function(e){return Object(R.toOption)(e.wrappedInstance.ref)})},onSubmit:function(n){return function(n){return Object(D.e)(h(e,{entity:{$set:new A.MetricEntity(n.name,(new Date).getTime(),new R.None,new A.Id(n.formId),Object(N.b)(n,t.props,k.b),new R.None)}})).then(function(e){t.props.dispatch(Object(_.b)(t.props.eventLineId)),t.props.dispatch(Object($.h)(t.props.i18n.t("Изменения в метрике успешно сохранены!"))),t.props.handleDialogClose(r)}).catch(function(e){t.props.dispatch(Object(B.a)(e))})}(n)},initialValues:Object(N.a)(e)})),[f.createElement(O.a,{key:"close",variant:"raised",onClick:function(){return t.props.handleDialogClose(r)}},this.props.i18n.t("Закрыть")),f.createElement(O.a,{key:"save",variant:"raised",onClick:function(){return n.map(function(e){return e.submit()})},color:"primary"},this.props.i18n.t("Сохранить"))])}},{key:"onDeleteRequest",value:function(e){var t=this,n=this.props.openDialog(this.props.i18n.t("Удаление метрики"),f.createElement("p",null,this.props.i18n.t("Вы уверены? Это действие нельзя будет отменить")),[f.createElement(O.a,{key:"close",variant:"raised",onClick:function(){return t.props.handleDialogClose(n)}},this.props.i18n.t("Закрыть")),f.createElement(O.a,{key:"yes",variant:"raised",onClick:function(){Object(D.b)(e).then(function(e){t.props.dispatch(Object(_.b)(t.props.eventLineId)),t.props.dispatch(Object($.h)(t.props.i18n.t("Метрика успешно удалёна!"))),t.props.handleDialogClose(n)}).catch(function(e){t.props.dispatch(Object(B.a)(e))})},color:"primary"},this.props.i18n.t("Удалить"))])}},{key:"onAddRequest",value:function(e){var t=this;this.setState(h(this.state,{disabled:{$set:!0}}),function(){t.props.onMetricsAdded&&t.props.onMetricsAdded([e]).then(function(){t.setState(h(t.state,{markedMetrics:{$set:t.state.markedMetrics.filter(function(t){return t.value!==e.value})},disabled:{$set:!1}}))}).catch(function(){t.setState(h(t.state,{disabled:{$set:!1}}))})})}},{key:"onAddMarkedRequest",value:function(){var e=this,t=this.props.metrics.metricsDashboard.map(function(e){return e.entity.metrics}).getOrElse(function(){return[]}),n=this.state.markedMetrics.filter(function(e){return 0===t.filter(function(t){return t.value===e.value}).length});this.setState(h(this.state,{disabled:{$set:!0}}),function(){e.props.onMetricsAdded&&e.props.onMetricsAdded(n).then(function(){e.setState(h(e.state,{markedMetrics:{$set:[]},disabled:{$set:!1}}))}).catch(function(){e.setState(h(e.state,{disabled:{$set:!1}}))})})}},{key:"onMetricMarked",value:function(e){var t=this.state.markedMetrics.findIndex(function(t){return t.value===e.id.value});t>=0?this.setState(h(this.state,{markedMetrics:{$splice:[[t,1]]}})):this.setState(h(this.state,{markedMetrics:{$push:[e.id]}}))}},{key:"onSelectAll",value:function(e,t){this.props.metrics.metricsDashboard.map(function(e){return e.entity.metrics}).getOrElse(function(){return[]});t?this.setState(h(this.state,{markedMetrics:{$set:this.props.metrics.eventLinesMetricsList.map(function(e){return e.id})}})):this.setState(h(this.state,{markedMetrics:{$set:[]}}))}},{key:"render",value:function(){var e=this;return f.createElement("div",{style:{display:"flex",flexDirection:"column",minHeight:"0",overflowY:"auto"}},f.createElement(M.b,{leftButtonGroup:[]},!this.props.onMetricsAdded&&f.createElement(O.a,{variant:"raised",onClick:this.onCreateRequested,color:"primary"},this.props.i18n.t("Создать")),this.props.onMetricsAdded&&f.createElement(O.a,{style:{marginLeft:"10px"},variant:"raised",disabled:0===this.state.markedMetrics.length||this.state.disabled,onClick:this.onAddMarkedRequest,color:"primary"},this.props.i18n.t("Добавить"))),f.createElement(F.a,{showId:!0,fetching:this.props.metrics.eventLinesMetricsFetching,error:this.props.metrics.eventLinesMetricsError,empty:!this.props.metrics.eventLinesMetricsFetching&&0===this.props.metrics.eventLinesMetricsList.length,markedRecords:this.state.markedMetrics.map(function(e){return e.value}),onRecordSelected:this.props.onMetricsAdded?function(){}:this.onEditRequest,onRecordMarked:this.props.onMetricsAdded?this.onMetricMarked:void 0,onSelectAll:this.props.onMetricsAdded?this.onSelectAll:void 0,headers:[{id:"metricName",title:this.props.i18n.t("Название")}],withActions:!0,rows:this.props.metrics.eventLinesMetricsFetching?[]:this.props.metrics.eventLinesMetricsList.map(function(t){return{payload:t,id:t.id.value,fields:[t.entity.name],selectDisabled:e.props.metrics.metricsDashboard.map(function(e){return e.entity.metrics}).getOrElse(function(){return[]}).filter(function(e){return e.value===t.id.value}).length>0,buttons:e.props.onMetricsAdded?[f.createElement(b.a,{key:"add",style:L.f,disabled:e.props.metrics.metricsDashboard.map(function(e){return e.entity.metrics}).getOrElse(function(){return[]}).filter(function(e){return e.value===t.id.value}).length>0||e.state.disabled,onClick:function(n){n.stopPropagation(),e.onAddRequest(t.id)}},f.createElement(j.a,{style:L.g}))]:[f.createElement(b.a,{key:"edit",style:L.f,onClick:function(n){n.stopPropagation(),e.onEditRequest(t)}},f.createElement(g.a,{style:L.g})),f.createElement(b.a,{key:"delete",style:L.f,onClick:function(n){n.stopPropagation(),e.onDeleteRequest(t.id)}},f.createElement(I.a,{style:L.g}))]}})}))}}]),t}(f.Component);x=V([m.autobind,q("design:paramtypes",[Object])],x),t.a=Object(v.connect)(function(e){return{metrics:e.metrics,i18n:e.i18n}})(Object(C.a)(function(e){e.isTokenChecked&&e.dispatch(Object(_.b)(e.eventLineId))})(Object(S.a)(x)))},2055:function(e,t,n){"use strict";n.d(t,"b",function(){return ne});var r=n(6),i=n.n(r),o=n(10),a=n.n(o),u=n(7),s=n.n(u),c=n(8),p=n.n(c),l=n(11),d=n.n(l),f=n(2),m=n(14),v=n(95),h=n(13),y=n(59),b=n(156),E=n.n(b),O=n(32),T=n.n(O),g=n(26),w=n.n(g),I=n(34),P=n.n(I),j=n(30),F=n.n(j),k=n(24),A=n.n(k),M=n(54),D=n.n(M),_=n(856),C=n.n(_),$=n(857),S=n.n($),B=n(560),L=n.n(B),N=n(561),R=n.n(N),W=n(378),V=n.n(W),q=n(1479),x=n(103),U=n(29),Y=n(0),J=n(104),H=n(1),G=n(50),z=n(161),K=n(68),Q=n(1768),X=n(188),Z=n(1494),ee=n(174),te=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":d()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ne=new H.Id(y.v4()),re=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p()(t,e),a()(t,[{key:"componentDidMount",value:function(){var e=this;Object(Y.toOption)(this.props.fields.formId.value).filter(function(e){return""!==e}).foreach(function(t){e.fetchForForm(new H.Id(t))})}},{key:"onPeriodStartChange",value:function(e){var t=e.toDate();this.props.fields.periodStart.onChange(t)}},{key:"onPeriodEndChange",value:function(e){var t=e.toDate();this.props.fields.periodEnd.onChange(t)}},{key:"renderPeriodBetween",value:function(){return f.createElement("div",null,f.createElement(V.a,{label:this.props.i18n.t("C"),fullWidth:!0,value:this.props.fields.periodStart.value||new Date,onChange:this.onPeriodStartChange,leftArrowIcon:f.createElement(L.a,null),rightArrowIcon:f.createElement(R.a,null),format:"dd.MM.yyyy"}),f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,this.props.i18n.t("Тип даты")),f.createElement(F.a,{fullWidth:!0,value:this.props.fields.periodEndType.value,onChange:this.props.fields.periodEndType.onChange},f.createElement(A.a,{value:H.DateValueTimestamp.$Type.value},f.createElement(D.a,{primary:this.props.i18n.t("Определенная дата")})),f.createElement(A.a,{value:H.DateValueNow.$Type.value},f.createElement(D.a,{primary:this.props.i18n.t("Момент запроса метрики")})))),this.props.fields.periodEndType.value===H.DateValueTimestamp.$Type.value&&f.createElement(V.a,{label:this.props.i18n.t("По"),fullWidth:!0,value:this.props.fields.periodEnd.value||new Date,onChange:this.onPeriodEndChange,leftArrowIcon:f.createElement(L.a,null),rightArrowIcon:f.createElement(R.a,null),format:"dd.MM.yyyy"}))}},{key:"renderPeriodEditor",value:function(){return f.createElement(f.Fragment,null,f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,this.props.i18n.t("Промежуток времени")),f.createElement(F.a,{value:this.props.fields.period.value,onChange:this.props.fields.period.onChange},f.createElement(A.a,{value:H.PeriodToday.$Type.value},this.props.i18n.t("Сегодня")),f.createElement(A.a,{value:H.PeriodYesterday.$Type.value},this.props.i18n.t("Вчера")),f.createElement(A.a,{value:H.PeriodThisWeek.$Type.value},this.props.i18n.t("В эту неделю")),f.createElement(A.a,{value:H.PeriodThisMonth.$Type.value},this.props.i18n.t("В этот месяц")),f.createElement(A.a,{value:H.PeriodLastMonth.$Type.value},this.props.i18n.t("В прошлый месяц")),f.createElement(A.a,{value:H.PeriodBetween.$Type.value},this.props.i18n.t("Произвольный промежуток")))),this.props.fields.period.value===H.PeriodBetween.$Type.value&&this.renderPeriodBetween())}},{key:"onFormChange",value:function(e){if(""!==e.target.value){var t=new H.Id(e.target.value);this.fetchForForm(t)}this.props.fields.formId.onChange(e.target.value)}},{key:"fetchForForm",value:function(e){this.props.dispatch(Object(ee.e)(e)),this.props.dispatch(Object(Z.b)(e)),this.props.dispatch(Object(X.b)(e))}},{key:"renderFormEditor",value:function(e){return f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,this.props.i18n.t("Форма")),f.createElement(F.a,{native:!0,value:this.props.fields.formId.value,onChange:this.onFormChange,error:this.props.fields.formId.touched&&this.props.fields.formId.error},f.createElement("option",{value:""},""),f.createElement("optgroup",{label:this.props.i18n.t("Формы")},Object(J.f)(this.props.forms,e.id).filter(function(e){return H.FormType.isForm(e.entity.formType)}).map(function(e){return f.createElement("option",{value:e.id.value,key:e.id.value},e.entity.name)})),f.createElement("optgroup",{label:this.props.i18n.t("Справочники")},Object(J.f)(this.props.forms,e.id).filter(function(e){return H.FormType.isAnyDictionary(e.entity.formType)}).map(function(e){return f.createElement("option",{value:e.id.value,key:e.id.value},e.entity.name)})),f.createElement("optgroup",{label:this.props.i18n.t("Служебные")},Object(J.f)(this.props.forms,e.id).filter(function(e){return H.FormType.isService(e.entity.formType)}).map(function(e){return f.createElement("option",{value:e.id.value,key:e.id.value},e.entity.name)}))),this.props.fields.formId.touched&&this.props.fields.formId.error&&f.createElement(E.a,null,this.props.fields.formId.error))}},{key:"renderEventTypeEditor",value:function(e,t){var n=this;return f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,t),f.createElement(F.a,{fullWidth:!0,value:e.value,onChange:e.onChange},H.EventTypes.map(function(e,t){return f.createElement(A.a,{key:t,value:e.tpe.value},Object(G.F)(e.tpe.value,n.props.i18n.t))})))}},{key:"renderBlockSelect",value:function(e,t){return f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,t),f.createElement(F.a,{fullWidth:!0,native:!0,value:e.value,onChange:e.onChange},f.createElement("option",{value:""}),Object(x.c)(this.props.blocks,new H.Id(this.props.fields.formId.value)).getOrElse(function(){return[]}).map(function(e,t){return f.createElement("option",{key:t,value:e.id.toString()},e.name)})))}},{key:"renderImportPipelineSelect",value:function(e,t){return f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,t),f.createElement(F.a,{value:e.value,fullWidth:!0,onChange:e.onChange},this.props.importPipelines.descriptionsList.map(function(e,t){return f.createElement("option",{key:t,value:e.id.toString()},e.name)})))}},{key:"renderEventAttr",value:function(e,t){return f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,t),f.createElement(F.a,{fullWidth:!0,value:e.value,onChange:e.onChange},f.createElement(A.a,{value:H.EventAttributesAny.$Type.value},f.createElement(D.a,{primary:this.props.i18n.t("Все")})),f.createElement(A.a,{value:H.EventAttributesEmpty.$Type.value},f.createElement(D.a,{primary:this.props.i18n.t("По пустам параметрам")})),f.createElement(A.a,{value:H.EventAttributesBlock.$Type.value},f.createElement(D.a,{primary:this.props.i18n.t("Блок")})),f.createElement(A.a,{value:H.EventAttributesImport.$Type.value},f.createElement(D.a,{primary:this.props.i18n.t("Импорт")}))))}},{key:"onFieldChanged",value:function(e){var t=this;e.foreach(function(e){t.props.fields.formFieldId.onChange(e.value)})}},{key:"getFormFields",value:function(){var e=this;return Object(Y.toOption)(this.props.fields.formId.value).flatMap(function(t){return Object(U.e)(e.props.formFields,new H.Id(t))}).getOrElse(function(){return[]})}},{key:"renderFieldSelector",value:function(){return f.createElement(K.a,{native:!0,fullWidth:!0,labelText:Object(Y.toOption)(this.props.i18n.t("Поле суммирования")),onChanged:this.onFieldChanged,value:Object(Y.toOption)(this.props.fields.formFieldId.value).map(function(e){return new H.Id(e)}),fields:this.getFormFields(),errorText:new Y.None})}},{key:"renderFilterConfiguration",value:function(){var e=this;return Object(Y.toOption)(this.props.fields.formId.value).filter(function(e){return""!==e}).map(function(e){return new H.Id(e)}).matchWith(function(t){return f.createElement(z.a,{initialValue:""===e.props.fields.filter.value?new Y.None:new Y.Some(e.props.fields.filter.value),filterId:ne,formId:t})},function(){return f.createElement("div",null,e.props.i18n.t("Для конфигурации фильтра необходимо указать форму в первой вкладке"))})}},{key:"renderMetricTypeSelect",value:function(){return f.createElement(T.a,{fullWidth:!0},f.createElement(P.a,null,this.props.i18n.t("Тип метрики")),f.createElement(F.a,{value:this.props.fields.metricParamsType.value,onChange:this.props.fields.metricParamsType.onChange},f.createElement(A.a,{value:H.MetricParamsFormDataNumberFiltered.$Type.value},this.props.i18n.t("Число анкет")),f.createElement(A.a,{value:H.MetricParamsEventsNumberFiltered.$Type.value},this.props.i18n.t("Число событий")),f.createElement(A.a,{value:H.MetricParamsFormDataNumericFieldSum.$Type.value},this.props.i18n.t("Сумма значений поля")),f.createElement(A.a,{value:H.MetricParamsConversionRate.$Type.value},this.props.i18n.t("Конверсия")),f.createElement(A.a,{value:H.MetricParamsAverageTimeBetweenEvents.$Type.value},this.props.i18n.t("Среднее время между событиями"))))}},{key:"renderNameEditor",value:function(){return f.createElement(w.a,{fullWidth:!0,autoFocus:!0,value:this.props.fields.name.value,onChange:this.props.fields.name.onChange,label:this.props.i18n.t("Название"),error:this.props.fields.name.touched&&this.props.fields.name.error,helperText:this.props.fields.name.touched&&Object(Y.toOption)(this.props.fields.name.error).map(function(e){return e}).getOrNull()})}},{key:"renderFirstEventEditor",value:function(e,t,n,r){return f.createElement(f.Fragment,null,this.props.fields.metricParamsType.value!==H.MetricParamsFormDataNumericFieldSum.$Type.value&&this.renderEventTypeEditor(this.props.fields.eventTypeFirst,e),this.props.fields.metricParamsType.value!==H.MetricParamsFormDataNumericFieldSum.$Type.value&&this.renderEventAttr(this.props.fields.eventAttrFirst,t),this.props.fields.metricParamsType.value!==H.MetricParamsFormDataNumericFieldSum.$Type.value&&this.props.fields.eventAttrFirst.value===H.EventAttributesBlock.$Type.value&&this.renderBlockSelect(this.props.fields.eventAttrBlockIdFirst,n),this.props.fields.metricParamsType.value!==H.MetricParamsFormDataNumericFieldSum.$Type.value&&this.props.fields.eventAttrFirst.value===H.EventAttributesImport.$Type.value&&this.renderImportPipelineSelect(this.props.fields.eventAttrImportPipelineIdFirst,r),this.props.fields.metricParamsType.value===H.MetricParamsFormDataNumericFieldSum.$Type.value&&this.renderFieldSelector())}},{key:"renderSecondEventEditor",value:function(){return f.createElement(f.Fragment,null,this.renderEventTypeEditor(this.props.fields.eventTypeSecond,this.props.i18n.t("Тип второго события")),this.renderEventAttr(this.props.fields.eventAttrSecond,this.props.i18n.t("Источник второго события")),this.props.fields.eventAttrSecond.value===H.EventAttributesBlock.$Type.value&&this.renderBlockSelect(this.props.fields.eventAttrBlockIdSecond,this.props.i18n.t("Блок второго события")),this.props.fields.eventAttrSecond.value===H.EventAttributesImport.$Type.value&&this.renderImportPipelineSelect(this.props.fields.eventAttrImportPipelineIdSecond,this.props.i18n.t("Кофигурация импорта второго события")))}},{key:"renderTabContents",value:function(e){return 0===this.props.currentTab?f.createElement("div",null,this.renderNameEditor(),this.renderFormEditor(e),this.renderPeriodEditor()):1===this.props.currentTab?this.renderFilterConfiguration():f.createElement("div",null,this.renderMetricTypeSelect(),this.props.fields.metricParamsType.value===H.MetricParamsAverageTimeBetweenEvents.$Type.value||this.props.fields.metricParamsType.value===H.MetricParamsConversionRate.$Type.value?this.renderFirstEventEditor(this.props.i18n.t("Тип первого события"),this.props.i18n.t("Источник первого события"),this.props.i18n.t("Блок второго события"),this.props.i18n.t("Кофигурация импорта второго события")):this.renderFirstEventEditor(this.props.i18n.t("Тип события"),this.props.i18n.t("Источник события"),this.props.i18n.t("Блок события"),this.props.i18n.t("Кофигурация импорта события")),(this.props.fields.metricParamsType.value===H.MetricParamsAverageTimeBetweenEvents.$Type.value||this.props.fields.metricParamsType.value===H.MetricParamsConversionRate.$Type.value)&&this.renderSecondEventEditor())}},{key:"render",value:function(){var e=this;return this.props.eventLine.data.map(function(t){return f.createElement("form",null,f.createElement(S.a,{value:e.props.currentTab,onChange:function(t,n){return e.props.onTabChange(n)},indicatorColor:"primary",textColor:"primary",fullWidth:!0},f.createElement(C.a,{value:0,label:e.props.i18n.t("Общее")}),f.createElement(C.a,{value:1,label:e.props.i18n.t("Фильтр")}),f.createElement(C.a,{value:2,label:e.props.i18n.t("Тип события")})),f.createElement(q.a,{style:{minHeight:"100px"}},e.renderTabContents(t)))}).getOrNull()}}]),t}(f.Component);re=te([h.autobind],re),t.a=Object(m.connect)(function(e){return{i18n:e.i18n,currentForm:e.currentForm,formFields:e.fields,forms:e.forms,blocks:e.blocks,importPipelines:e.importPipelines,eventLine:e.eventLine}},function(e){return{}},function(e,t,n){return Object.assign({},e,n)},{withRef:!0})(Object(Q.a)(Object(v.reduxForm)({form:"metricEntityForm",fields:["name","formId","metricParamsType","eventTypeFirst","eventTypeSecond","period","periodStart","periodEnd","periodEndType","eventAttrFirst","eventAttrSecond","filter","eventAttrBlockIdFirst","eventAttrImportPipelineIdFirst","eventAttrBlockIdSecond","eventAttrImportPipelineIdSecond","formFieldId"],validate:function(e,t){var n={};return e.name&&0!==e.name.trim().length||(n.name=t.i18n.t("Обязательное значение")),e.formId&&0!==e.formId.trim().length||(n.formId=t.i18n.t("Обязательное значение")),n}})(re)))},2056:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a});var r=n(2014),i=n(281),o=function(e){return function(t,n){return t(Object(i.i)()),r.c(e).then(function(e){return t(Object(i.k)(e.list))}).catch(function(e){return t(Object(i.h)(e))})}},a=function(e){return function(t,n){return t(Object(i.m)()),r.d(e).then(function(e){return t(Object(i.n)(e.list))}).catch(function(e){return t(Object(i.l)(e))})}}},2057:function(e,t,n){"use strict";n.d(t,"b",function(){return g}),n.d(t,"a",function(){return w});var r,i,o,a,u,s=n(4),c=n.n(s),p=n(1),l=n(0),d=n(56),f=n(798),m=(r={},c()(r,p.DateValueNow.$Type.value,function(e){return new p.DateValueNow}),c()(r,p.DateValueTimestamp.$Type.value,function(e){return new p.DateValueTimestamp(e)}),r),v=(i={},c()(i,p.EventAttributesBlock.$Type.value,function(e){return new p.EventAttributesBlock(e.blockId)}),c()(i,p.EventAttributesEmpty.$Type.value,function(e){return new p.EventAttributesEmpty}),c()(i,p.EventAttributesAny.$Type.value,function(e){return new p.EventAttributesAny}),c()(i,p.EventAttributesImport.$Type.value,function(e){return new p.EventAttributesImport(e.importId)}),i),h=function(e,t){return Object(d.b)(e)(v).map(function(e){return e(t)}).getOrElse(function(){throw"unknown event attr type"})},y=(o={},c()(o,p.PeriodBetween.$Type.value,function(e){return new p.PeriodBetween(new p.DateValueTimestamp(e.periodStart.getTime()),(t=e.periodEnd?e.periodEnd.getTime():(new Date).getTime(),n=e.periodEndType,Object(d.b)(n)(m).map(function(e){return e(t)}).getOrElse(function(){throw"unknown date value type"})));var t,n}),c()(o,p.PeriodLastMonth.$Type.value,function(e){return new p.PeriodLastMonth}),c()(o,p.PeriodThisMonth.$Type.value,function(e){return new p.PeriodThisMonth}),c()(o,p.PeriodThisWeek.$Type.value,function(e){return new p.PeriodThisWeek}),c()(o,p.PeriodToday.$Type.value,function(e){return new p.PeriodToday}),c()(o,p.PeriodYesterday.$Type.value,function(e){return new p.PeriodYesterday}),o),b=function(e){return Object(d.b)(e.period)(y).map(function(t){return t(e)}).getOrElse(function(){throw"unknown period type"})},E=(a={},c()(a,p.EventTypeFormDataCreated.$Type.value,new p.EventTypeFormDataCreated),c()(a,p.EventTypeFormDataDeleted.$Type.value,new p.EventTypeFormDataDeleted),c()(a,p.EventTypeFormDataUpdated.$Type.value,new p.EventTypeFormDataUpdated),c()(a,p.EventTypeDocumentPrinted.$Type.value,new p.EventTypeDocumentPrinted),c()(a,p.EventTypeEmailTracked.$Type.value,new p.EventTypeEmailTracked),c()(a,p.EventTypeEmailFetched.$Type.value,new p.EventTypeEmailFetched),c()(a,p.EventTypeInteraction.$Type.value,new p.EventTypeInteraction),c()(a,p.EventTypeJourneyEvent.$Type.value,new p.EventTypeJourneyEvent),a),O=function(e){return Object(d.b)(e)(E).getOrElse(function(){throw"unknown event type"})},T=(u={},c()(u,p.MetricParamsAverageTimeBetweenEvents.$Type.value,function(e,t,n){return new p.MetricParamsAverageTimeBetweenEvents(O(e.eventTypeFirst),O(e.eventTypeSecond),b(e),t.dispatch(Object(f.a)(n)),Object(l.toOption)(h(e.eventAttrFirst,{blockId:new p.Id(e.eventAttrBlockIdFirst),importId:new p.Id(e.eventAttrImportPipelineIdFirst)})).filter(function(e){return!(e instanceof p.EventAttributesAny)}),Object(l.toOption)(h(e.eventAttrFirst,{blockId:new p.Id(e.eventAttrBlockIdSecond),importId:new p.Id(e.eventAttrImportPipelineIdSecond)})).filter(function(e){return!(e instanceof p.EventAttributesAny)}))}),c()(u,p.MetricParamsConversionRate.$Type.value,function(e,t,n){return new p.MetricParamsConversionRate(O(e.eventTypeFirst),O(e.eventTypeSecond),b(e),t.dispatch(Object(f.a)(n)),Object(l.toOption)(h(e.eventAttrFirst,{blockId:new p.Id(e.eventAttrBlockIdFirst),importId:new p.Id(e.eventAttrImportPipelineIdFirst)})).filter(function(e){return!(e instanceof p.EventAttributesAny)}),Object(l.toOption)(h(e.eventAttrFirst,{blockId:new p.Id(e.eventAttrBlockIdSecond),importId:new p.Id(e.eventAttrImportPipelineIdSecond)})).filter(function(e){return!(e instanceof p.EventAttributesAny)}))}),c()(u,p.MetricParamsEventsNumberFiltered.$Type.value,function(e,t,n){return new p.MetricParamsEventsNumberFiltered(O(e.eventTypeFirst),b(e),t.dispatch(Object(f.a)(n)),Object(l.toOption)(h(e.eventAttrFirst,{blockId:new p.Id(e.eventAttrBlockIdFirst),importId:new p.Id(e.eventAttrImportPipelineIdFirst)})).filter(function(e){return!(e instanceof p.EventAttributesAny)}))}),c()(u,p.MetricParamsFormDataNumberFiltered.$Type.value,function(e,t,n){return new p.MetricParamsFormDataNumberFiltered(O(e.eventTypeFirst),b(e),t.dispatch(Object(f.a)(n)),Object(l.toOption)(h(e.eventAttrFirst,{blockId:new p.Id(e.eventAttrBlockIdFirst),importId:new p.Id(e.eventAttrImportPipelineIdFirst)})).filter(function(e){return!(e instanceof p.EventAttributesAny)}))}),c()(u,p.MetricParamsFormDataNumericFieldSum.$Type.value,function(e,t,n){return new p.MetricParamsFormDataNumericFieldSum(b(e),t.dispatch(Object(f.a)(n)),new p.Id(e.formFieldId))}),u),g=function(e,t,n){return Object(d.b)(e.metricParamsType)(T).map(function(r){return r(e,t,n)}).getOrElse(function(){throw"unknown metric params type"})},w=function(e){var t,n={name:e.entity.name,formId:e.entity.formId.value,metricParamsType:e.entity.params.tpe.value};return e.entity.params instanceof p.MetricParamsFormDataNumberFiltered||e.entity.params instanceof p.MetricParamsEventsNumberFiltered?Object.assign({},n,{period:(t=e.entity.params).period.tpe.value,filter:t.filter.getOrNull(),eventTypeFirst:t.eventType.tpe.value,eventAttrFirst:t.attrs.map(function(e){return e.tpe.value}).getOrElse(function(){return p.EventAttributesAny.$Type.value}),eventAttrBlockIdFirst:t.attrs.filter(function(e){return e instanceof p.EventAttributesBlock}).map(function(e){return e.blockId.value}).getOrElse(function(){return""}),eventAttrImportPipelineIdFirst:t.attrs.filter(function(e){return e instanceof p.EventAttributesImport}).map(function(e){return e.pipeline.value}).getOrElse(function(){return""}),periodStart:Object(l.toOption)(t.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.start}).filter(function(e){return e instanceof p.DateValueTimestamp}).map(function(e){return e.v}).getOrElse(function(){return new Date}),periodEnd:Object(l.toOption)(t.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.end}).filter(function(e){return e instanceof p.DateValueTimestamp}).map(function(e){return e.v}).getOrElse(function(){return new Date}),periodEndType:Object(l.toOption)(t.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.end.tpe.value}).getOrElse(function(){return p.DateValueNow.$Type.value})}):e.entity.params instanceof p.MetricParamsFormDataNumericFieldSum?Object.assign({formFieldId:e.entity.params.fieldId.value},n,function(e){return{period:e.period.tpe.value,filter:e.filter.getOrNull(),periodStart:Object(l.toOption)(e.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.start}).filter(function(e){return e instanceof p.DateValueTimestamp}).map(function(e){return e.v}).getOrElse(function(){return new Date}),periodEnd:Object(l.toOption)(e.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.end}).filter(function(e){return e instanceof p.DateValueTimestamp}).map(function(e){return e.v}).getOrElse(function(){return new Date}),periodEndType:Object(l.toOption)(e.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.end.tpe.value}).getOrElse(function(){return p.DateValueNow.$Type.value})}}(e.entity.params)):e.entity.params instanceof p.MetricParamsAverageTimeBetweenEvents||e.entity.params instanceof p.MetricParamsConversionRate?Object.assign({},n,function(e){return{period:e.period.tpe.value,filter:e.filter.getOrNull(),eventTypeFirst:e.eventTypeFirst.tpe.value,eventAttrFirst:e.attrsFirst.map(function(e){return e.tpe.value}).getOrElse(function(){return p.EventAttributesAny.$Type.value}),eventAttrBlockIdFirst:e.attrsFirst.filter(function(e){return e instanceof p.EventAttributesBlock}).map(function(e){return e.blockId.value}).getOrElse(function(){return""}),eventAttrImportPipelineIdFirst:e.attrsFirst.filter(function(e){return e instanceof p.EventAttributesImport}).map(function(e){return e.pipeline.value}).getOrElse(function(){return""}),eventTypeSecond:e.eventTypeSecond.tpe.value,eventAttrSecond:e.attrsSecond.map(function(e){return e.tpe.value}).getOrElse(function(){return p.EventAttributesAny.$Type.value}),eventAttrBlockIdSecond:e.attrsSecond.filter(function(e){return e instanceof p.EventAttributesBlock}).map(function(e){return e.blockId.value}).getOrElse(function(){return""}),eventAttrImportPipelineIdSecond:e.attrsSecond.filter(function(e){return e instanceof p.EventAttributesImport}).map(function(e){return e.pipeline.value}).getOrElse(function(){return""}),periodStart:Object(l.toOption)(e.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.start}).filter(function(e){return e instanceof p.DateValueTimestamp}).map(function(e){return e.v}).getOrElse(function(){return new Date}),periodEnd:Object(l.toOption)(e.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.end}).filter(function(e){return e instanceof p.DateValueTimestamp}).map(function(e){return e.v}).getOrElse(function(){return new Date}),periodEndType:Object(l.toOption)(e.period).filter(function(e){return e instanceof p.PeriodBetween}).map(function(e){return e.end.tpe.value}).getOrElse(function(){return p.DateValueNow.$Type.value})}}(e.entity.params)):void 0}}}]);